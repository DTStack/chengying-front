"use strict";(self.webpackChunkdt_em_front=self.webpackChunkdt_em_front||[]).push([[4169],{23111:(e,t,i)=>{i.r(t);var o=i(16830),n=i(82334),s=i(63580);class r extends o.R6{constructor(){super({id:"editor.action.fontZoomIn",label:s.N("EditorFontZoomIn.label","Editor Font Zoom In"),alias:"Editor Font Zoom In",precondition:void 0})}run(e,t){n.C.setZoomLevel(n.C.getZoomLevel()+1)}}class a extends o.R6{constructor(){super({id:"editor.action.fontZoomOut",label:s.N("EditorFontZoomOut.label","Editor Font Zoom Out"),alias:"Editor Font Zoom Out",precondition:void 0})}run(e,t){n.C.setZoomLevel(n.C.getZoomLevel()-1)}}class d extends o.R6{constructor(){super({id:"editor.action.fontZoomReset",label:s.N("EditorFontZoomReset.label","Editor Font Zoom Reset"),alias:"Editor Font Zoom Reset",precondition:void 0})}run(e,t){n.C.setZoomLevel(0)}}(0,o.Qr)(r),(0,o.Qr)(a),(0,o.Qr)(d)},44325:(e,t,i)=>{i.d(t,{Qq:()=>R,Qs:()=>L,Zg:()=>x,x$:()=>I,xC:()=>D});var o=i(85152),n=i(9488),s=i(71050),r=i(17301),a=i(53725),d=i(91741),l=i(98401),h=i(70666),c=i(39925),u=i(65520),g=i(50187),p=i(24314),m=i(3860),f=i(44101),_=i(90469),v=i(88216),C=i(69939),w=i(63580),y=i(94565),b=i(90553),S=i(72065),k=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function a(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};function x(e){if(!(e=e.filter(e=>e.range)).length)return;let{range:t}=e[0];for(let i=1;i<e.length;i++)t=p.e.plusRange(t,e[i].range);const{startLineNumber:i,endLineNumber:n}=t;i===n?1===e.length?(0,o.Z9)(w.N("hint11","Made 1 formatting edit on line {0}",i)):(0,o.Z9)(w.N("hintn1","Made {0} formatting edits on line {1}",e.length,i)):1===e.length?(0,o.Z9)(w.N("hint1n","Made 1 formatting edit between lines {0} and {1}",i,n)):(0,o.Z9)(w.N("hintnn","Made {0} formatting edits between lines {1} and {2}",e.length,i,n))}function M(e){const t=[],i=new Set,o=f.Az.ordered(e);for(const e of o)t.push(e),e.extensionId&&i.add(b.k.toKey(e.extensionId));const n=f.vN.ordered(e);for(const e of n){if(e.extensionId){if(i.has(b.k.toKey(e.extensionId)))continue;i.add(b.k.toKey(e.extensionId))}t.push({displayName:e.displayName,extensionId:e.extensionId,provideDocumentFormattingEdits:(t,i,o)=>e.provideDocumentRangeFormattingEdits(t,t.getFullModelRange(),i,o)})}return t}class D{static setFormatterSelector(e){return{dispose:D._selectors.unshift(e)}}static select(e,t,i){return k(this,void 0,void 0,(function*(){if(0===e.length)return;const o=a.$.first(D._selectors);return o?yield o(e,t,i):void 0}))}}function I(e,t,i,o,n,s){return k(this,void 0,void 0,(function*(){const r=e.get(S.TG),a=(0,u.CL)(t)?t.getModel():t,d=f.vN.ordered(a),l=yield D.select(d,a,o);l&&(n.report(l),yield r.invokeFunction(N,l,t,i,s))}))}function N(e,t,i,o,s){return k(this,void 0,void 0,(function*(){const r=e.get(_.p);let a,d;(0,u.CL)(i)?(a=i.getModel(),d=new c.Dl(i,5,void 0,s)):(a=i,d=new c.YQ(i,s));let l=[],h=0;for(let e of(0,n._2)(o).sort(p.e.compareRangesUsingStarts))h>0&&p.e.areIntersectingOrTouching(l[h-1],e)?l[h-1]=p.e.fromPositions(l[h-1].getStartPosition(),e.getEndPosition()):h=l.push(e);const g=e=>k(this,void 0,void 0,(function*(){return(yield t.provideDocumentRangeFormattingEdits(a,e,a.getFormattingOptions(),d.token))||[]})),f=(e,t)=>{if(!e.length||!t.length)return!1;const i=e.reduce((e,t)=>p.e.plusRange(e,t.range),e[0].range);if(!t.some(e=>p.e.intersectRanges(i,e.range)))return!1;for(let i of e)for(let e of t)if(p.e.intersectRanges(i.range,e.range))return!0;return!1},v=[],w=[];try{for(let e of l){if(d.token.isCancellationRequested)return!0;w.push(yield g(e))}for(let e=0;e<l.length;++e)for(let t=e+1;t<l.length;++t){if(d.token.isCancellationRequested)return!0;if(f(w[e],w[t])){const i=p.e.plusRange(l[e],l[t]),o=yield g(i);l.splice(t,1),l.splice(e,1),l.push(i),w.splice(t,1),w.splice(e,1),w.push(o),e=0,t=0}}for(let e of w){if(d.token.isCancellationRequested)return!0;const t=yield r.computeMoreMinimalEdits(a.uri,e);t&&v.push(...t)}}finally{d.dispose()}if(0===v.length)return!1;if((0,u.CL)(i))C.V.execute(i,v,!0),x(v),i.revealPositionInCenterIfOutsideViewport(i.getPosition(),1);else{const[{range:e}]=v,t=new m.Y(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn);a.pushEditOperations([t],v.map(e=>({text:e.text,range:p.e.lift(e.range),forceMoveMarkers:!0})),e=>{for(const{range:i}of e)if(p.e.areIntersectingOrTouching(i,t))return[new m.Y(i.startLineNumber,i.startColumn,i.endLineNumber,i.endColumn)];return null})}return!0}))}function R(e,t,i,o,n){return k(this,void 0,void 0,(function*(){const s=e.get(S.TG),r=(0,u.CL)(t)?t.getModel():t,a=M(r),d=yield D.select(a,r,i);d&&(o.report(d),yield s.invokeFunction(P,d,t,i,n))}))}function P(e,t,i,o,n){return k(this,void 0,void 0,(function*(){const s=e.get(_.p);let r,a,d;(0,u.CL)(i)?(r=i.getModel(),a=new c.Dl(i,5,void 0,n)):(r=i,a=new c.YQ(i,n));try{const e=yield t.provideDocumentFormattingEdits(r,r.getFormattingOptions(),a.token);if(d=yield s.computeMoreMinimalEdits(r.uri,e),a.token.isCancellationRequested)return!0}finally{a.dispose()}if(!d||0===d.length)return!1;if((0,u.CL)(i))C.V.execute(i,d,2!==o),2!==o&&(x(d),i.revealPositionInCenterIfOutsideViewport(i.getPosition(),1));else{const[{range:e}]=d,t=new m.Y(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn);r.pushEditOperations([t],d.map(e=>({text:e.text,range:p.e.lift(e.range),forceMoveMarkers:!0})),e=>{for(const{range:i}of e)if(p.e.areIntersectingOrTouching(i,t))return[new m.Y(i.startLineNumber,i.startColumn,i.endLineNumber,i.endColumn)];return null})}return!0}))}function L(e,t,i,o,n){const a=f.ln.ordered(t);return 0===a.length||a[0].autoFormatTriggerCharacters.indexOf(o)<0?Promise.resolve(void 0):Promise.resolve(a[0].provideOnTypeFormattingEdits(t,i,o,n,s.T.None)).catch(r.Cp).then(i=>e.computeMoreMinimalEdits(t.uri,i))}D._selectors=new d.S,y.P0.registerCommand("_executeFormatRangeProvider",(function(e,...t){return k(this,void 0,void 0,(function*(){const[i,o,a]=t;(0,l.p_)(h.o.isUri(i)),(0,l.p_)(p.e.isIRange(o));const d=e.get(v.S),c=e.get(_.p),u=yield d.createModelReference(i);try{return function(e,t,i,o,s){return k(this,void 0,void 0,(function*(){const a=f.vN.ordered(t);for(const d of a){let a=yield Promise.resolve(d.provideDocumentRangeFormattingEdits(t,i,o,s)).catch(r.Cp);if((0,n.Of)(a))return yield e.computeMoreMinimalEdits(t.uri,a)}}))}(c,u.object.textEditorModel,p.e.lift(o),a,s.T.None)}finally{u.dispose()}}))})),y.P0.registerCommand("_executeFormatDocumentProvider",(function(e,...t){return k(this,void 0,void 0,(function*(){const[i,o]=t;(0,l.p_)(h.o.isUri(i));const a=e.get(v.S),d=e.get(_.p),c=yield a.createModelReference(i);try{return function(e,t,i,o){return k(this,void 0,void 0,(function*(){const s=M(t);for(const a of s){let s=yield Promise.resolve(a.provideDocumentFormattingEdits(t,i,o)).catch(r.Cp);if((0,n.Of)(s))return yield e.computeMoreMinimalEdits(t.uri,s)}}))}(d,c.object.textEditorModel,o,s.T.None)}finally{c.dispose()}}))})),y.P0.registerCommand("_executeFormatOnTypeProvider",(function(e,...t){return k(this,void 0,void 0,(function*(){const[i,o,n,s]=t;(0,l.p_)(h.o.isUri(i)),(0,l.p_)(g.L.isIPosition(o)),(0,l.p_)("string"==typeof n);const r=e.get(v.S),a=e.get(_.p),d=yield r.createModelReference(i);try{return L(a,d.object.textEditorModel,g.L.lift(o),n,s)}finally{d.dispose()}}))}))},44818:(e,t,i)=>{i.r(t);var o=i(9488),n=i(71050),s=i(17301),r=i(22258),a=i(9917),d=i(16830),l=i(11640),h=i(44906),c=i(24314),u=i(29102),g=i(44101),p=i(90469),m=i(44325),f=i(69939),_=i(63580),v=i(94565),C=i(38819),w=i(72065),y=i(90535),b=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},S=function(e,t){return function(i,o){t(i,o,e)}},k=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function a(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};let x=class{constructor(e,t){this._workerService=t,this._callOnDispose=new a.SL,this._callOnModel=new a.SL,this._editor=e,this._callOnDispose.add(e.onDidChangeConfiguration(()=>this._update())),this._callOnDispose.add(e.onDidChangeModel(()=>this._update())),this._callOnDispose.add(e.onDidChangeModelLanguage(()=>this._update())),this._callOnDispose.add(g.ln.onDidChange(this._update,this))}dispose(){this._callOnDispose.dispose(),this._callOnModel.dispose()}_update(){if(this._callOnModel.clear(),!this._editor.getOption(48))return;if(!this._editor.hasModel())return;const e=this._editor.getModel(),[t]=g.ln.ordered(e);if(!t||!t.autoFormatTriggerCharacters)return;let i=new h.q;for(let e of t.autoFormatTriggerCharacters)i.add(e.charCodeAt(0));this._callOnModel.add(this._editor.onDidType(e=>{let t=e.charCodeAt(e.length-1);i.has(t)&&this._trigger(String.fromCharCode(t))}))}_trigger(e){if(!this._editor.hasModel())return;if(this._editor.getSelections().length>1||!this._editor.getSelection().isEmpty())return;const t=this._editor.getModel(),i=this._editor.getPosition();let n=!1;const s=this._editor.onDidChangeModelContent(e=>{if(e.isFlush)return n=!0,void s.dispose();for(let t=0,o=e.changes.length;t<o;t++){if(e.changes[t].range.endLineNumber<=i.lineNumber)return n=!0,void s.dispose()}});(0,m.Qs)(this._workerService,t,i,e,t.getFormattingOptions()).then(e=>{s.dispose(),n||(0,o.Of)(e)&&(f.V.execute(this._editor,e,!0),(0,m.Zg)(e))},e=>{throw s.dispose(),e})}};x.ID="editor.contrib.autoFormat",x=b([S(1,p.p)],x);let M=class{constructor(e,t){this.editor=e,this._instantiationService=t,this._callOnDispose=new a.SL,this._callOnModel=new a.SL,this._callOnDispose.add(e.onDidChangeConfiguration(()=>this._update())),this._callOnDispose.add(e.onDidChangeModel(()=>this._update())),this._callOnDispose.add(e.onDidChangeModelLanguage(()=>this._update())),this._callOnDispose.add(g.vN.onDidChange(this._update,this))}dispose(){this._callOnDispose.dispose(),this._callOnModel.dispose()}_update(){this._callOnModel.clear(),this.editor.getOption(47)&&this.editor.hasModel()&&g.vN.has(this.editor.getModel())&&this._callOnModel.add(this.editor.onDidPaste(({range:e})=>this._trigger(e)))}_trigger(e){this.editor.hasModel()&&(this.editor.getSelections().length>1||this._instantiationService.invokeFunction(m.x$,this.editor,e,2,y.Ex.None,n.T.None).catch(s.dL))}};M.ID="editor.contrib.formatOnPaste",M=b([S(1,w.TG)],M);class D extends d.R6{constructor(){super({id:"editor.action.formatDocument",label:_.N("formatDocument.label","Format Document"),alias:"Format Document",precondition:C.Ao.and(u.u.notInCompositeEditor,u.u.writable,u.u.hasDocumentFormattingProvider),kbOpts:{kbExpr:u.u.editorTextFocus,primary:1572,linux:{primary:3111},weight:100},contextMenuOpts:{group:"1_modification",order:1.3}})}run(e,t){return k(this,void 0,void 0,(function*(){if(t.hasModel()){const i=e.get(w.TG),o=e.get(y.ek);yield o.showWhile(i.invokeFunction(m.Qq,t,1,y.Ex.None,n.T.None),250)}}))}}class I extends d.R6{constructor(){super({id:"editor.action.formatSelection",label:_.N("formatSelection.label","Format Selection"),alias:"Format Selection",precondition:C.Ao.and(u.u.writable,u.u.hasDocumentSelectionFormattingProvider),kbOpts:{kbExpr:u.u.editorTextFocus,primary:(0,r.gx)(2089,2084),weight:100},contextMenuOpts:{when:u.u.hasNonEmptySelection,group:"1_modification",order:1.31}})}run(e,t){return k(this,void 0,void 0,(function*(){if(!t.hasModel())return;const i=e.get(w.TG),o=t.getModel(),s=t.getSelections().map(e=>e.isEmpty()?new c.e(e.startLineNumber,1,e.startLineNumber,o.getLineMaxColumn(e.startLineNumber)):e),r=e.get(y.ek);yield r.showWhile(i.invokeFunction(m.x$,t,s,1,y.Ex.None,n.T.None),250)}))}}(0,d._K)(x.ID,x),(0,d._K)(M.ID,M),(0,d.Qr)(D),(0,d.Qr)(I),v.P0.registerCommand("editor.action.format",e=>k(void 0,void 0,void 0,(function*(){const t=e.get(l.$).getFocusedCodeEditor();if(!t||!t.hasModel())return;const i=e.get(v.Hy);t.getSelection().isEmpty()?yield i.executeCommand("editor.action.formatDocument"):yield i.executeCommand("editor.action.formatSelection")})))},69939:(e,t,i)=>{i.d(t,{V:()=>s});var o=i(69386),n=i(24314);class s{static _handleEolEdits(e,t){let i=void 0,o=[];for(let e of t)"number"==typeof e.eol&&(i=e.eol),e.range&&"string"==typeof e.text&&o.push(e);return"number"==typeof i&&e.hasModel()&&e.getModel().pushEOL(i),o}static _isFullModelReplaceEdit(e,t){if(!e.hasModel())return!1;const i=e.getModel(),o=i.validateRange(t.range);return i.getFullModelRange().equalsRange(o)}static execute(e,t,i){i&&e.pushUndoStop();const r=s._handleEolEdits(e,t);1===r.length&&s._isFullModelReplaceEdit(e,r[0])?e.executeEdits("formatEditsCommand",r.map(e=>o.h.replace(n.e.lift(e.range),e.text))):e.executeEdits("formatEditsCommand",r.map(e=>o.h.replaceMove(n.e.lift(e.range),e.text))),i&&e.pushUndoStop()}}},57160:(e,t,i)=>{i.r(t),i.d(t,{ModesHoverController:()=>bn});var o=i(22258),n=i(9917),s=i(16830),r=i(24314),a=i(29102),d=i(71531),l=i(15393),h=i(17301),c=i(59365),u=i(98401),g=i(39925),p=i(50187),m=i(44101),f=i(88216),_=i(4669),v=i(1432);function C(e,t){return!!e[t]}class w{constructor(e,t){this.target=e.target,this.hasTriggerModifier=C(e.event,t.triggerModifier),this.hasSideBySideModifier=C(e.event,t.triggerSideBySideModifier),this.isNoneOrSingleMouseDown=e.event.detail<=1}}class y{constructor(e,t){this.keyCodeIsTriggerKey=e.keyCode===t.triggerKey,this.keyCodeIsSideBySideKey=e.keyCode===t.triggerSideBySideKey,this.hasTriggerModifier=C(e,t.triggerModifier)}}class b{constructor(e,t,i,o){this.triggerKey=e,this.triggerModifier=t,this.triggerSideBySideKey=i,this.triggerSideBySideModifier=o}equals(e){return this.triggerKey===e.triggerKey&&this.triggerModifier===e.triggerModifier&&this.triggerSideBySideKey===e.triggerSideBySideKey&&this.triggerSideBySideModifier===e.triggerSideBySideModifier}}function S(e){return"altKey"===e?v.dz?new b(57,"metaKey",6,"altKey"):new b(5,"ctrlKey",6,"altKey"):v.dz?new b(6,"altKey",57,"metaKey"):new b(6,"altKey",5,"ctrlKey")}class k extends n.JT{constructor(e){super(),this._onMouseMoveOrRelevantKeyDown=this._register(new _.Q5),this.onMouseMoveOrRelevantKeyDown=this._onMouseMoveOrRelevantKeyDown.event,this._onExecute=this._register(new _.Q5),this.onExecute=this._onExecute.event,this._onCancel=this._register(new _.Q5),this.onCancel=this._onCancel.event,this._editor=e,this._opts=S(this._editor.getOption(69)),this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._register(this._editor.onDidChangeConfiguration(e=>{if(e.hasChanged(69)){const e=S(this._editor.getOption(69));if(this._opts.equals(e))return;this._opts=e,this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._onCancel.fire()}})),this._register(this._editor.onMouseMove(e=>this._onEditorMouseMove(new w(e,this._opts)))),this._register(this._editor.onMouseDown(e=>this._onEditorMouseDown(new w(e,this._opts)))),this._register(this._editor.onMouseUp(e=>this._onEditorMouseUp(new w(e,this._opts)))),this._register(this._editor.onKeyDown(e=>this._onEditorKeyDown(new y(e,this._opts)))),this._register(this._editor.onKeyUp(e=>this._onEditorKeyUp(new y(e,this._opts)))),this._register(this._editor.onMouseDrag(()=>this._resetHandler())),this._register(this._editor.onDidChangeCursorSelection(e=>this._onDidChangeCursorSelection(e))),this._register(this._editor.onDidChangeModel(e=>this._resetHandler())),this._register(this._editor.onDidChangeModelContent(()=>this._resetHandler())),this._register(this._editor.onDidScrollChange(e=>{(e.scrollTopChanged||e.scrollLeftChanged)&&this._resetHandler()}))}_onDidChangeCursorSelection(e){e.selection&&e.selection.startColumn!==e.selection.endColumn&&this._resetHandler()}_onEditorMouseMove(e){this._lastMouseMoveEvent=e,this._onMouseMoveOrRelevantKeyDown.fire([e,null])}_onEditorMouseDown(e){this._hasTriggerKeyOnMouseDown=e.hasTriggerModifier,this._lineNumberOnMouseDown=e.target.position?e.target.position.lineNumber:0}_onEditorMouseUp(e){const t=e.target.position?e.target.position.lineNumber:0;this._hasTriggerKeyOnMouseDown&&this._lineNumberOnMouseDown&&this._lineNumberOnMouseDown===t&&this._onExecute.fire(e)}_onEditorKeyDown(e){this._lastMouseMoveEvent&&(e.keyCodeIsTriggerKey||e.keyCodeIsSideBySideKey&&e.hasTriggerModifier)?this._onMouseMoveOrRelevantKeyDown.fire([this._lastMouseMoveEvent,e]):e.hasTriggerModifier&&this._onCancel.fire()}_onEditorKeyUp(e){e.keyCodeIsTriggerKey&&this._onCancel.fire()}_resetHandler(){this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._onCancel.fire()}}var x=i(65321),M=i(90317),D=i(74741),I=i(73046),N=i(41264),R=i(36248),P=i(11640),L=i(84527),E=i(46736),T=i(63580),O=i(27628),A=i(38819),W=i(65026),F=i(72065),H=i(73910),V=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},K=function(e,t){return function(i,o){t(i,o,e)}};const B=(0,F.yh)("IPeekViewService");var G;(0,W.z)(B,class{constructor(){this._widgets=new Map}addExclusiveWidget(e,t){const i=this._widgets.get(e);i&&(i.listener.dispose(),i.widget.dispose());this._widgets.set(e,{widget:t,listener:t.onDidClose(()=>{const i=this._widgets.get(e);i&&i.widget===t&&(i.listener.dispose(),this._widgets.delete(e))})})}}),function(e){e.inPeekEditor=new A.uy("inReferenceSearchEditor",!0,T.N("inReferenceSearchEditor","Whether the current code editor is embedded inside peek")),e.notInPeekEditor=e.inPeekEditor.toNegated()}(G||(G={}));let $=class{constructor(e,t){e instanceof L.H&&G.inPeekEditor.bindTo(t)}dispose(){}};$.ID="editor.contrib.referenceController",$=V([K(1,A.i6)],$),(0,s._K)($.ID,$);const U={headerBackgroundColor:N.Il.white,primaryHeadingColor:N.Il.fromHex("#333333"),secondaryHeadingColor:N.Il.fromHex("#6c6c6cb3")};let j=class extends E.IJ{constructor(e,t,i){super(e,t),this.instantiationService=i,this._onDidClose=new _.Q5,this.onDidClose=this._onDidClose.event,R.jB(this.options,U,!1)}dispose(){this.disposed||(this.disposed=!0,super.dispose(),this._onDidClose.fire(this))}style(e){let t=this.options;e.headerBackgroundColor&&(t.headerBackgroundColor=e.headerBackgroundColor),e.primaryHeadingColor&&(t.primaryHeadingColor=e.primaryHeadingColor),e.secondaryHeadingColor&&(t.secondaryHeadingColor=e.secondaryHeadingColor),super.style(e)}_applyStyles(){super._applyStyles();let e=this.options;this._headElement&&e.headerBackgroundColor&&(this._headElement.style.backgroundColor=e.headerBackgroundColor.toString()),this._primaryHeading&&e.primaryHeadingColor&&(this._primaryHeading.style.color=e.primaryHeadingColor.toString()),this._secondaryHeading&&e.secondaryHeadingColor&&(this._secondaryHeading.style.color=e.secondaryHeadingColor.toString()),this._bodyElement&&e.frameColor&&(this._bodyElement.style.borderColor=e.frameColor.toString())}_fillContainer(e){this.setCssClass("peekview-widget"),this._headElement=x.$(".head"),this._bodyElement=x.$(".body"),this._fillHead(this._headElement),this._fillBody(this._bodyElement),e.appendChild(this._headElement),e.appendChild(this._bodyElement)}_fillHead(e,t){const i=x.$(".peekview-title");this.options.supportOnTitleClick&&(i.classList.add("clickable"),x.mu(i,"click",e=>this._onTitleClick(e))),x.R3(this._headElement,i),this._fillTitleIcon(i),this._primaryHeading=x.$("span.filename"),this._secondaryHeading=x.$("span.dirname"),this._metaHeading=x.$("span.meta"),x.R3(i,this._primaryHeading,this._secondaryHeading,this._metaHeading);const o=x.$(".peekview-actions");x.R3(this._headElement,o);const n=this._getActionBarOptions();this._actionbarWidget=new M.o(o,n),this._disposables.add(this._actionbarWidget),t||this._actionbarWidget.push(new D.aU("peekview.close",T.N("label.close","Close"),I.lA.close.classNames,!0,()=>(this.dispose(),Promise.resolve())),{label:!1,icon:!0})}_fillTitleIcon(e){}_getActionBarOptions(){return{actionViewItemProvider:O.Id.bind(void 0,this.instantiationService),orientation:0}}_onTitleClick(e){}setTitle(e,t){this._primaryHeading&&this._secondaryHeading&&(this._primaryHeading.innerText=e,this._primaryHeading.setAttribute("title",e),t?this._secondaryHeading.innerText=t:x.PO(this._secondaryHeading))}setMetaTitle(e){this._metaHeading&&(e?(this._metaHeading.innerText=e,x.$Z(this._metaHeading)):x.Cp(this._metaHeading))}_doLayout(e,t){if(!this._isShowing&&e<0)return void this.dispose();const i=Math.ceil(1.2*this.editor.getOption(58)),o=Math.round(e-(i+2));this._doLayoutHead(i,t),this._doLayoutBody(o,t)}_doLayoutHead(e,t){this._headElement&&(this._headElement.style.height=e+"px",this._headElement.style.lineHeight=this._headElement.style.height)}_doLayoutBody(e,t){this._bodyElement&&(this._bodyElement.style.height=e+"px")}};j=V([K(2,F.TG)],j);const Z=(0,H.P6G)("peekViewTitle.background",{dark:(0,H.ZnX)(H.c63,.1),light:(0,H.ZnX)(H.c63,.1),hc:null},T.N("peekViewTitleBackground","Background color of the peek view title area.")),z=(0,H.P6G)("peekViewTitleLabel.foreground",{dark:N.Il.white,light:N.Il.black,hc:N.Il.white},T.N("peekViewTitleForeground","Color of the peek view title.")),q=(0,H.P6G)("peekViewTitleDescription.foreground",{dark:"#ccccccb3",light:"#616161",hc:"#FFFFFF99"},T.N("peekViewTitleInfoForeground","Color of the peek view title info.")),Q=(0,H.P6G)("peekView.border",{dark:H.c63,light:H.c63,hc:H.lRK},T.N("peekViewBorder","Color of the peek view borders and arrow.")),X=(0,H.P6G)("peekViewResult.background",{dark:"#252526",light:"#F3F3F3",hc:N.Il.black},T.N("peekViewResultsBackground","Background color of the peek view result list.")),J=((0,H.P6G)("peekViewResult.lineForeground",{dark:"#bbbbbb",light:"#646465",hc:N.Il.white},T.N("peekViewResultsMatchForeground","Foreground color for line nodes in the peek view result list.")),(0,H.P6G)("peekViewResult.fileForeground",{dark:N.Il.white,light:"#1E1E1E",hc:N.Il.white},T.N("peekViewResultsFileForeground","Foreground color for file nodes in the peek view result list.")),(0,H.P6G)("peekViewResult.selectionBackground",{dark:"#3399ff33",light:"#3399ff33",hc:null},T.N("peekViewResultsSelectionBackground","Background color of the selected entry in the peek view result list.")),(0,H.P6G)("peekViewResult.selectionForeground",{dark:N.Il.white,light:"#6C6C6C",hc:N.Il.white},T.N("peekViewResultsSelectionForeground","Foreground color of the selected entry in the peek view result list.")),(0,H.P6G)("peekViewEditor.background",{dark:"#001F33",light:"#F2F8FC",hc:N.Il.black},T.N("peekViewEditorBackground","Background color of the peek view editor.")));(0,H.P6G)("peekViewEditorGutter.background",{dark:J,light:J,hc:J},T.N("peekViewEditorGutterBackground","Background color of the gutter in the peek view editor.")),(0,H.P6G)("peekViewResult.matchHighlightBackground",{dark:"#ea5c004d",light:"#ea5c004d",hc:null},T.N("peekViewResultsMatchHighlight","Match highlight color in the peek view result list.")),(0,H.P6G)("peekViewEditor.matchHighlightBackground",{dark:"#ff8f0099",light:"#f5d802de",hc:null},T.N("peekViewEditorMatchHighlight","Match highlight color in the peek view editor.")),(0,H.P6G)("peekViewEditor.matchHighlightBorder",{dark:null,light:null,hc:H.xL1},T.N("peekViewEditorMatchHighlightBorder","Match highlight border in the peek view editor."));var Y=i(97781),ee=i(16268),te=i(85152),ie=i(70666),oe=i(65520),ne=i(94565),se=i(33108),re=i(49989),ae=i(32414),de=i(59422),le=i(52365),he=i(44742),ce=i(43702),ue=i(95935),ge=i(97295),pe=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function a(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};class me{constructor(e,t,i,o){this.isProviderFirst=e,this.parent=t,this.link=i,this._rangeCallback=o,this.id=he.a.nextId()}get uri(){return this.link.uri}get range(){var e,t;return null!==(t=null!==(e=this._range)&&void 0!==e?e:this.link.targetSelectionRange)&&void 0!==t?t:this.link.range}set range(e){this._range=e,this._rangeCallback(this)}get ariaMessage(){var e;const t=null===(e=this.parent.getPreview(this))||void 0===e?void 0:e.preview(this.range);return t?(0,T.N)({key:"aria.oneReference.preview",comment:["Placeholders are: 0: filename, 1:line number, 2: column number, 3: preview snippet of source code"]},"symbol in {0} on line {1} at column {2}, {3}",(0,ue.EZ)(this.uri),this.range.startLineNumber,this.range.startColumn,t.value):(0,T.N)("aria.oneReference","symbol in {0} on line {1} at column {2}",(0,ue.EZ)(this.uri),this.range.startLineNumber,this.range.startColumn)}}class fe{constructor(e){this._modelReference=e}dispose(){this._modelReference.dispose()}preview(e,t=8){const i=this._modelReference.object.textEditorModel;if(!i)return;const{startLineNumber:o,startColumn:n,endLineNumber:s,endColumn:a}=e,d=i.getWordUntilPosition({lineNumber:o,column:n-t}),l=new r.e(o,d.startColumn,o,n),h=new r.e(s,a,s,1073741824),c=i.getValueInRange(l).replace(/^\s+/,""),u=i.getValueInRange(e);return{value:c+u+i.getValueInRange(h).replace(/\s+$/,""),highlight:{start:c.length,end:c.length+u.length}}}}class _e{constructor(e,t){this.parent=e,this.uri=t,this.children=[],this._previews=new ce.Y9}dispose(){(0,n.B9)(this._previews.values()),this._previews.clear()}getPreview(e){return this._previews.get(e.uri)}get ariaMessage(){const e=this.children.length;return 1===e?(0,T.N)("aria.fileReferences.1","1 symbol in {0}, full path {1}",(0,ue.EZ)(this.uri),this.uri.fsPath):(0,T.N)("aria.fileReferences.N","{0} symbols in {1}, full path {2}",e,(0,ue.EZ)(this.uri),this.uri.fsPath)}resolve(e){return pe(this,void 0,void 0,(function*(){if(0!==this._previews.size)return this;for(let t of this.children)if(!this._previews.has(t.uri))try{const i=yield e.createModelReference(t.uri);this._previews.set(t.uri,new fe(i))}catch(e){(0,h.dL)(e)}return this}))}}class ve{constructor(e,t){this.groups=[],this.references=[],this._onDidChangeReferenceRange=new _.Q5,this.onDidChangeReferenceRange=this._onDidChangeReferenceRange.event,this._links=e,this._title=t;const[i]=e;let o;e.sort(ve._compareReferences);for(let t of e)if(o&&ue.SF.isEqual(o.uri,t.uri,!0)||(o=new _e(this,t.uri),this.groups.push(o)),0===o.children.length||0!==ve._compareReferences(t,o.children[o.children.length-1])){const e=new me(i===t,o,t,e=>this._onDidChangeReferenceRange.fire(e));this.references.push(e),o.children.push(e)}}dispose(){(0,n.B9)(this.groups),this._onDidChangeReferenceRange.dispose(),this.groups.length=0}clone(){return new ve(this._links,this._title)}get title(){return this._title}get isEmpty(){return 0===this.groups.length}get ariaMessage(){return this.isEmpty?(0,T.N)("aria.result.0","No results found"):1===this.references.length?(0,T.N)("aria.result.1","Found 1 symbol in {0}",this.references[0].uri.fsPath):1===this.groups.length?(0,T.N)("aria.result.n1","Found {0} symbols in {1}",this.references.length,this.groups[0].uri.fsPath):(0,T.N)("aria.result.nm","Found {0} symbols in {1} files",this.references.length,this.groups.length)}nextOrPreviousReference(e,t){let{parent:i}=e,o=i.children.indexOf(e),n=i.children.length,s=i.parent.groups.length;return 1===s||t&&o+1<n||!t&&o>0?(o=t?(o+1)%n:(o+n-1)%n,i.children[o]):(o=i.parent.groups.indexOf(i),t?(o=(o+1)%s,i.parent.groups[o].children[0]):(o=(o+s-1)%s,i.parent.groups[o].children[i.parent.groups[o].children.length-1]))}nearestReference(e,t){const i=this.references.map((i,o)=>({idx:o,prefixLen:ge.Mh(i.uri.toString(),e.toString()),offsetDist:100*Math.abs(i.range.startLineNumber-t.lineNumber)+Math.abs(i.range.startColumn-t.column)})).sort((e,t)=>e.prefixLen>t.prefixLen?-1:e.prefixLen<t.prefixLen?1:e.offsetDist<t.offsetDist?-1:e.offsetDist>t.offsetDist?1:0)[0];if(i)return this.references[i.idx]}referenceAt(e,t){for(const i of this.references)if(i.uri.toString()===e.toString()&&r.e.containsPosition(i.range,t))return i}firstReference(){for(const e of this.references)if(e.isProviderFirst)return e;return this.references[0]}static _compareReferences(e,t){return ue.SF.compare(e.uri,t.uri)||r.e.compareRangesUsingStarts(e.range,t.range)}}var Ce=i(23937),we=i(66663),ye=i(75425),be=i(83831),Se=i(67488),ke=i(34650),xe=i(48801),Me=i(75392),De=i(68843),Ie=i(91847),Ne=i(44349),Re=i(88810),Pe=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},Le=function(e,t){return function(i,o){t(i,o,e)}};let Ee=class{constructor(e){this._resolverService=e}hasChildren(e){return e instanceof ve||e instanceof _e}getChildren(e){if(e instanceof ve)return e.groups;if(e instanceof _e)return e.resolve(this._resolverService).then(e=>e.children);throw new Error("bad tree")}};Ee=Pe([Le(0,f.S)],Ee);class Te{getHeight(){return 23}getTemplateId(e){return e instanceof _e?Fe.id:Ve.id}}let Oe=class{constructor(e){this._keybindingService=e}getKeyboardNavigationLabel(e){var t;if(e instanceof me){const i=null===(t=e.parent.getPreview(e))||void 0===t?void 0:t.preview(e.range);if(i)return i.value}return(0,ue.EZ)(e.uri)}};Oe=Pe([Le(0,Ie.d)],Oe);class Ae{getId(e){return e instanceof me?e.id:e.uri}}let We=class extends n.JT{constructor(e,t,i){super(),this._uriLabel=t;const o=document.createElement("div");o.classList.add("reference-file"),this.file=this._register(new xe.g(o,{supportHighlights:!0})),this.badge=new Se.Z(x.R3(o,x.$(".count"))),this._register((0,Re.WZ)(this.badge,i)),e.appendChild(o)}set(e,t){let i=(0,ue.XX)(e.uri);this.file.setLabel((0,De.p)(e.uri),this._uriLabel.getUriLabel(i,{relative:!0}),{title:this._uriLabel.getUriLabel(e.uri),matches:t});const o=e.children.length;this.badge.setCount(o),o>1?this.badge.setTitleFormat((0,T.N)("referencesCount","{0} references",o)):this.badge.setTitleFormat((0,T.N)("referenceCount","{0} reference",o))}};We=Pe([Le(1,Ne.e),Le(2,Y.XE)],We);let Fe=class e{constructor(t){this._instantiationService=t,this.templateId=e.id}renderTemplate(e){return this._instantiationService.createInstance(We,e)}renderElement(e,t,i){i.set(e.element,(0,Me.mB)(e.filterData))}disposeTemplate(e){e.dispose()}};Fe.id="FileReferencesRenderer",Fe=Pe([Le(0,F.TG)],Fe);class He{constructor(e){this.label=new ke.q(e)}set(e,t){var i;const o=null===(i=e.parent.getPreview(e))||void 0===i?void 0:i.preview(e.range);if(o&&o.value){const{value:e,highlight:i}=o;t&&!Me.CL.isDefault(t)?(this.label.element.classList.toggle("referenceMatch",!1),this.label.set(e,(0,Me.mB)(t))):(this.label.element.classList.toggle("referenceMatch",!0),this.label.set(e,[i]))}else this.label.set(`${(0,ue.EZ)(e.uri)}:${e.range.startLineNumber+1}:${e.range.startColumn+1}`)}}class Ve{constructor(){this.templateId=Ve.id}renderTemplate(e){return new He(e)}renderElement(e,t,i){i.set(e.element,e.filterData)}disposeTemplate(){}}Ve.id="OneReferenceRenderer";class Ke{getWidgetAriaLabel(){return(0,T.N)("treeAriaLabel","References")}getAriaLabel(e){return e.ariaMessage}}var Be=i(64862),Ge=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},$e=function(e,t){return function(i,o){t(i,o,e)}},Ue=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function a(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};class je{constructor(e,t){this._editor=e,this._model=t,this._decorations=new Map,this._decorationIgnoreSet=new Set,this._callOnDispose=new n.SL,this._callOnModelChange=new n.SL,this._callOnDispose.add(this._editor.onDidChangeModel(()=>this._onModelChanged())),this._onModelChanged()}dispose(){this._callOnModelChange.dispose(),this._callOnDispose.dispose(),this.removeDecorations()}_onModelChanged(){this._callOnModelChange.clear();const e=this._editor.getModel();if(e)for(let t of this._model.references)if(t.uri.toString()===e.uri.toString())return void this._addDecorations(t.parent)}_addDecorations(e){if(!this._editor.hasModel())return;this._callOnModelChange.add(this._editor.getModel().onDidChangeDecorations(()=>this._onDecorationChanged()));const t=[],i=[];for(let o=0,n=e.children.length;o<n;o++){let n=e.children[o];this._decorationIgnoreSet.has(n.id)||n.uri.toString()===this._editor.getModel().uri.toString()&&(t.push({range:n.range,options:je.DecorationOptions}),i.push(o))}const o=this._editor.deltaDecorations([],t);for(let t=0;t<o.length;t++)this._decorations.set(o[t],e.children[i[t]])}_onDecorationChanged(){const e=[],t=this._editor.getModel();if(t){for(let[i,o]of this._decorations){const n=t.getDecorationRange(i);if(!n)continue;let s=!1;if(!r.e.equalsRange(n,o.range)){if(r.e.spansMultipleLines(n))s=!0;else{o.range.endColumn-o.range.startColumn!==n.endColumn-n.startColumn&&(s=!0)}s?(this._decorationIgnoreSet.add(o.id),e.push(i)):o.range=n}}for(let t=0,i=e.length;t<i;t++)this._decorations.delete(e[t]);this._editor.deltaDecorations(e,[])}}removeDecorations(){this._editor.deltaDecorations([...this._decorations.keys()],[]),this._decorations.clear()}}je.DecorationOptions=ye.qx.register({description:"reference-decoration",stickiness:1,className:"reference-decoration"});class Ze extends ae.ls{}let ze=class extends j{constructor(e,t,i,o,s,r,a,d,l,h,c,u){super(e,{showFrame:!1,showArrow:!0,isResizeable:!0,isAccessible:!0,supportOnTitleClick:!0},r),this._defaultTreeKeyboardSupport=t,this.layoutData=i,this._textModelResolverService=s,this._instantiationService=r,this._peekViewService=a,this._uriLabel=d,this._undoRedoService=l,this._keybindingService=h,this._modeService=c,this._languageConfigurationService=u,this._disposeOnNewModel=new n.SL,this._callOnDispose=new n.SL,this._onDidSelectReference=new _.Q5,this.onDidSelectReference=this._onDidSelectReference.event,this._dim=new x.Ro(0,0),this._applyTheme(o.getColorTheme()),this._callOnDispose.add(o.onDidColorThemeChange(this._applyTheme.bind(this))),this._peekViewService.addExclusiveWidget(e,this),this.create()}dispose(){this.setModel(void 0),this._callOnDispose.dispose(),this._disposeOnNewModel.dispose(),(0,n.B9)(this._preview),(0,n.B9)(this._previewNotAvailableMessage),(0,n.B9)(this._tree),(0,n.B9)(this._previewModelReference),this._splitView.dispose(),super.dispose()}_applyTheme(e){const t=e.getColor(Q)||N.Il.transparent;this.style({arrowColor:t,frameColor:t,headerBackgroundColor:e.getColor(Z)||N.Il.transparent,primaryHeadingColor:e.getColor(z),secondaryHeadingColor:e.getColor(q)})}show(e){this.editor.revealRangeInCenterIfOutsideViewport(e,0),super.show(e,this.layoutData.heightInLines||18)}focusOnReferenceTree(){this._tree.domFocus()}focusOnPreviewEditor(){this._preview.focus()}isPreviewEditorFocused(){return this._preview.hasTextFocus()}_onTitleClick(e){this._preview&&this._preview.getModel()&&this._onDidSelectReference.fire({element:this._getFocusedReference(),kind:e.ctrlKey||e.metaKey||e.altKey?"side":"open",source:"title"})}_fillBody(e){this.setCssClass("reference-zone-widget"),this._messageContainer=x.R3(e,x.$("div.messages")),x.Cp(this._messageContainer),this._splitView=new Ce.z(e,{orientation:1}),this._previewContainer=x.R3(e,x.$("div.preview.inline"));this._preview=this._instantiationService.createInstance(L.H,this._previewContainer,{scrollBeyondLastLine:!1,scrollbar:{verticalScrollbarSize:14,horizontal:"auto",useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1,alwaysConsumeMouseWheel:!1},overviewRulerLanes:2,fixedOverflowWidgets:!0,minimap:{enabled:!1}},this.editor),x.Cp(this._previewContainer),this._previewNotAvailableMessage=new ye.yO(T.N("missingPreviewMessage","no preview available"),ye.yO.DEFAULT_CREATION_OPTIONS,null,null,this._undoRedoService,this._modeService,this._languageConfigurationService),this._treeContainer=x.R3(e,x.$("div.ref-tree.inline"));const t={keyboardSupport:this._defaultTreeKeyboardSupport,accessibilityProvider:new Ke,keyboardNavigationLabelProvider:this._instantiationService.createInstance(Oe),identityProvider:new Ae,openOnSingleClick:!0,selectionNavigation:!0,overrideStyles:{listBackground:X}};this._defaultTreeKeyboardSupport&&this._callOnDispose.add(x.mu(this._treeContainer,"keydown",e=>{e.equals(9)&&(this._keybindingService.dispatchEvent(e,e.target),e.stopPropagation())},!0)),this._tree=this._instantiationService.createInstance(Ze,"ReferencesWidget",this._treeContainer,new Te,[this._instantiationService.createInstance(Fe),this._instantiationService.createInstance(Ve)],this._instantiationService.createInstance(Ee),t),this._splitView.addView({onDidChange:_.ju.None,element:this._previewContainer,minimumSize:200,maximumSize:Number.MAX_VALUE,layout:e=>{this._preview.layout({height:this._dim.height,width:e})}},Ce.M.Distribute),this._splitView.addView({onDidChange:_.ju.None,element:this._treeContainer,minimumSize:100,maximumSize:Number.MAX_VALUE,layout:e=>{this._treeContainer.style.height=this._dim.height+"px",this._treeContainer.style.width=e+"px",this._tree.layout(this._dim.height,e)}},Ce.M.Distribute),this._disposables.add(this._splitView.onDidSashChange(()=>{this._dim.width&&(this.layoutData.ratio=this._splitView.getViewSize(0)/this._dim.width)},void 0));let i=(e,t)=>{e instanceof me&&("show"===t&&this._revealReference(e,!1),this._onDidSelectReference.fire({element:e,kind:t,source:"tree"}))};this._tree.onDidOpen(e=>{e.sideBySide?i(e.element,"side"):e.editorOptions.pinned?i(e.element,"goto"):i(e.element,"show")}),x.Cp(this._treeContainer)}_onWidth(e){this._dim&&this._doLayoutBody(this._dim.height,e)}_doLayoutBody(e,t){super._doLayoutBody(e,t),this._dim=new x.Ro(t,e),this.layoutData.heightInLines=this._viewZone?this._viewZone.heightInLines:this.layoutData.heightInLines,this._splitView.layout(t),this._splitView.resizeView(0,t*this.layoutData.ratio)}setSelection(e){return this._revealReference(e,!0).then(()=>{this._model&&(this._tree.setSelection([e]),this._tree.setFocus([e]))})}setModel(e){return this._disposeOnNewModel.clear(),this._model=e,this._model?this._onNewModel():Promise.resolve()}_onNewModel(){return this._model?this._model.isEmpty?(this.setTitle(""),this._messageContainer.innerText=T.N("noResults","No results"),x.$Z(this._messageContainer),Promise.resolve(void 0)):(x.Cp(this._messageContainer),this._decorationsManager=new je(this._preview,this._model),this._disposeOnNewModel.add(this._decorationsManager),this._disposeOnNewModel.add(this._model.onDidChangeReferenceRange(e=>this._tree.rerender(e))),this._disposeOnNewModel.add(this._preview.onMouseDown(e=>{const{event:t,target:i}=e;if(2!==t.detail)return;const o=this._getFocusedReference();o&&this._onDidSelectReference.fire({element:{uri:o.uri,range:i.range},kind:t.ctrlKey||t.metaKey||t.altKey?"side":"open",source:"editor"})})),this.container.classList.add("results-loaded"),x.$Z(this._treeContainer),x.$Z(this._previewContainer),this._splitView.layout(this._dim.width),this.focusOnReferenceTree(),this._tree.setInput(1===this._model.groups.length?this._model.groups[0]:this._model)):Promise.resolve(void 0)}_getFocusedReference(){const[e]=this._tree.getFocus();return e instanceof me?e:e instanceof _e&&e.children.length>0?e.children[0]:void 0}revealReference(e){return Ue(this,void 0,void 0,(function*(){yield this._revealReference(e,!1),this._onDidSelectReference.fire({element:e,kind:"goto",source:"tree"})}))}_revealReference(e,t){return Ue(this,void 0,void 0,(function*(){if(this._revealedReference===e)return;this._revealedReference=e,e.uri.scheme!==we.lg.inMemory?this.setTitle((0,ue.Hx)(e.uri),this._uriLabel.getUriLabel((0,ue.XX)(e.uri))):this.setTitle(T.N("peekView.alternateTitle","References"));const i=this._textModelResolverService.createModelReference(e.uri);this._tree.getInput()===e.parent||(t&&this._tree.reveal(e.parent),yield this._tree.expand(e.parent)),this._tree.reveal(e);const o=yield i;if(!this._model)return void o.dispose();(0,n.B9)(this._previewModelReference);const s=o.object;if(s){const t=this._preview.getModel()===s.textEditorModel?0:1,i=r.e.lift(e.range).collapseToStart();this._previewModelReference=o,this._preview.setModel(s.textEditorModel),this._preview.setSelection(i),this._preview.revealRangeInCenter(i,t)}else this._preview.setModel(this._previewNotAvailableMessage),o.dispose()}))}};ze=Ge([$e(3,Y.XE),$e(4,f.S),$e(5,F.TG),$e(6,B),$e(7,Ne.e),$e(8,Be.tJ),$e(9,Ie.d),$e(10,d.h),$e(11,be.c_)],ze);var qe=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},Qe=function(e,t){return function(i,o){t(i,o,e)}},Xe=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function a(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};const Je=new A.uy("referenceSearchVisible",!1,T.N("referenceSearchVisible","Whether reference peek is visible, like 'Peek References' or 'Peek Definition'"));let Ye=class e{constructor(e,t,i,o,s,r,a,d){this._defaultTreeKeyboardSupport=e,this._editor=t,this._editorService=o,this._notificationService=s,this._instantiationService=r,this._storageService=a,this._configurationService=d,this._disposables=new n.SL,this._requestIdPool=0,this._ignoreModelChangeEvent=!1,this._referenceSearchVisible=Je.bindTo(i)}static get(t){return t.getContribution(e.ID)}dispose(){var e,t;this._referenceSearchVisible.reset(),this._disposables.dispose(),null===(e=this._widget)||void 0===e||e.dispose(),null===(t=this._model)||void 0===t||t.dispose(),this._widget=void 0,this._model=void 0}toggleWidget(e,t,i){let o;if(this._widget&&(o=this._widget.position),this.closeWidget(),o&&e.containsPosition(o))return;this._peekMode=i,this._referenceSearchVisible.set(!0),this._disposables.add(this._editor.onDidChangeModelLanguage(()=>{this.closeWidget()})),this._disposables.add(this._editor.onDidChangeModel(()=>{this._ignoreModelChangeEvent||this.closeWidget()}));const n=class{constructor(){this.ratio=.7,this.heightInLines=18}static fromJSON(e){let t,i;try{const o=JSON.parse(e);t=o.ratio,i=o.heightInLines}catch(e){}return{ratio:t||.7,heightInLines:i||18}}}.fromJSON(this._storageService.get("peekViewLayout",0,"{}"));this._widget=this._instantiationService.createInstance(ze,this._editor,this._defaultTreeKeyboardSupport,n),this._widget.setTitle(T.N("labelLoading","Loading...")),this._widget.show(e),this._disposables.add(this._widget.onDidClose(()=>{t.cancel(),this._widget&&(this._storageService.store("peekViewLayout",JSON.stringify(this._widget.layoutData),0,1),this._widget=void 0),this.closeWidget()})),this._disposables.add(this._widget.onDidSelectReference(e=>{let{element:t,kind:o}=e;if(t)switch(o){case"open":"editor"===e.source&&this._configurationService.getValue("editor.stablePeek")||this.openReference(t,!1,!1);break;case"side":this.openReference(t,!0,!1);break;case"goto":i?this._gotoReference(t):this.openReference(t,!1,!0)}}));const s=++this._requestIdPool;t.then(t=>{var i;if(s===this._requestIdPool&&this._widget)return null===(i=this._model)||void 0===i||i.dispose(),this._model=t,this._widget.setModel(this._model).then(()=>{if(this._widget&&this._model&&this._editor.hasModel()){this._model.isEmpty?this._widget.setMetaTitle(""):this._widget.setMetaTitle(T.N("metaTitle.N","{0} ({1})",this._model.title,this._model.references.length));let t=this._editor.getModel().uri,i=new p.L(e.startLineNumber,e.startColumn),o=this._model.nearestReference(t,i);if(o)return this._widget.setSelection(o).then(()=>{this._widget&&"editor"===this._editor.getOption(76)&&this._widget.focusOnPreviewEditor()})}});t.dispose()},e=>{this._notificationService.error(e)})}changeFocusBetweenPreviewAndReferences(){this._widget&&(this._widget.isPreviewEditorFocused()?this._widget.focusOnReferenceTree():this._widget.focusOnPreviewEditor())}goToNextOrPreviousReference(e){return Xe(this,void 0,void 0,(function*(){if(!this._editor.hasModel()||!this._model||!this._widget)return;const t=this._widget.position;if(!t)return;const i=this._model.nearestReference(this._editor.getModel().uri,t);if(!i)return;const o=this._model.nextOrPreviousReference(i,e),n=this._editor.hasTextFocus(),s=this._widget.isPreviewEditorFocused();yield this._widget.setSelection(o),yield this._gotoReference(o),n?this._editor.focus():this._widget&&s&&this._widget.focusOnPreviewEditor()}))}revealReference(e){return Xe(this,void 0,void 0,(function*(){this._editor.hasModel()&&this._model&&this._widget&&(yield this._widget.revealReference(e))}))}closeWidget(e=!0){var t,i;null===(t=this._widget)||void 0===t||t.dispose(),null===(i=this._model)||void 0===i||i.dispose(),this._referenceSearchVisible.reset(),this._disposables.clear(),this._widget=void 0,this._model=void 0,e&&this._editor.focus(),this._requestIdPool+=1}_gotoReference(t){this._widget&&this._widget.hide(),this._ignoreModelChangeEvent=!0;const i=r.e.lift(t.range).collapseToStart();return this._editorService.openCodeEditor({resource:t.uri,options:{selection:i}},this._editor).then(t=>{var o;if(this._ignoreModelChangeEvent=!1,t&&this._widget)if(this._editor===t)this._widget.show(i),this._widget.focusOnReferenceTree();else{const n=e.get(t),s=this._model.clone();this.closeWidget(),t.focus(),n.toggleWidget(i,(0,l.PG)(e=>Promise.resolve(s)),null!==(o=this._peekMode)&&void 0!==o&&o)}else this.closeWidget()},e=>{this._ignoreModelChangeEvent=!1,(0,h.dL)(e)})}openReference(e,t,i){t||this.closeWidget();const{uri:o,range:n}=e;this._editorService.openCodeEditor({resource:o,options:{selection:n,pinned:i}},this._editor,t)}};function et(e,t){const i=function(e){let t=e.get(P.$).getFocusedCodeEditor();return t instanceof L.H?t.getParentEditor():t}(e);if(!i)return;let o=Ye.get(i);o&&t(o)}Ye.ID="editor.contrib.referencesController",Ye=qe([Qe(2,A.i6),Qe(3,P.$),Qe(4,de.lT),Qe(5,F.TG),Qe(6,le.Uy),Qe(7,se.Ui)],Ye),re.W.registerCommandAndKeybindingRule({id:"togglePeekWidgetFocus",weight:100,primary:(0,o.gx)(2089,60),when:A.Ao.or(Je,G.inPeekEditor),handler(e){et(e,e=>{e.changeFocusBetweenPreviewAndReferences()})}}),re.W.registerCommandAndKeybindingRule({id:"goToNextReference",weight:90,primary:62,secondary:[70],when:A.Ao.or(Je,G.inPeekEditor),handler(e){et(e,e=>{e.goToNextOrPreviousReference(!0)})}}),re.W.registerCommandAndKeybindingRule({id:"goToPreviousReference",weight:90,primary:1086,secondary:[1094],when:A.Ao.or(Je,G.inPeekEditor),handler(e){et(e,e=>{e.goToNextOrPreviousReference(!1)})}}),ne.P0.registerCommandAlias("goToNextReferenceFromEmbeddedEditor","goToNextReference"),ne.P0.registerCommandAlias("goToPreviousReferenceFromEmbeddedEditor","goToPreviousReference"),ne.P0.registerCommandAlias("closeReferenceSearchEditor","closeReferenceSearch"),ne.P0.registerCommand("closeReferenceSearch",e=>et(e,e=>e.closeWidget())),re.W.registerKeybindingRule({id:"closeReferenceSearch",weight:-1,primary:9,secondary:[1033],when:A.Ao.and(G.inPeekEditor,A.Ao.not("config.editor.stablePeek"))}),re.W.registerKeybindingRule({id:"closeReferenceSearch",weight:250,primary:9,secondary:[1033],when:A.Ao.and(Je,A.Ao.not("config.editor.stablePeek"))}),re.W.registerCommandAndKeybindingRule({id:"revealReference",weight:200,primary:3,mac:{primary:3,secondary:[2066]},when:A.Ao.and(Je,ae.CQ),handler(e){var t;const i=null===(t=e.get(ae.Lw).lastFocusedList)||void 0===t?void 0:t.getFocus();Array.isArray(i)&&i[0]instanceof me&&et(e,e=>e.revealReference(i[0]))}}),re.W.registerCommandAndKeybindingRule({id:"openReferenceToSide",weight:100,primary:2051,mac:{primary:259},when:A.Ao.and(Je,ae.CQ),handler(e){var t;const i=null===(t=e.get(ae.Lw).lastFocusedList)||void 0===t?void 0:t.getFocus();Array.isArray(i)&&i[0]instanceof me&&et(e,e=>e.openReference(i[0],!0,!0))}}),ne.P0.registerCommand("openReference",e=>{var t;const i=null===(t=e.get(ae.Lw).lastFocusedList)||void 0===t?void 0:t.getFocus();Array.isArray(i)&&i[0]instanceof me&&et(e,e=>e.openReference(i[0],!1,!0))});var tt=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},it=function(e,t){return function(i,o){t(i,o,e)}};const ot=new A.uy("hasSymbols",!1,(0,T.N)("hasSymbols","Whether there are symbol locations that can be navigated via keyboard-only.")),nt=(0,F.yh)("ISymbolNavigationService");let st=class{constructor(e,t,i,o){this._editorService=t,this._notificationService=i,this._keybindingService=o,this._currentModel=void 0,this._currentIdx=-1,this._ignoreEditorChange=!1,this._ctxHasSymbols=ot.bindTo(e)}reset(){var e,t;this._ctxHasSymbols.reset(),null===(e=this._currentState)||void 0===e||e.dispose(),null===(t=this._currentMessage)||void 0===t||t.dispose(),this._currentModel=void 0,this._currentIdx=-1}put(e){const t=e.parent.parent;if(t.references.length<=1)return void this.reset();this._currentModel=t,this._currentIdx=t.references.indexOf(e),this._ctxHasSymbols.set(!0),this._showMessage();const i=new rt(this._editorService),o=i.onDidChange(e=>{if(this._ignoreEditorChange)return;const i=this._editorService.getActiveCodeEditor();if(!i)return;const o=i.getModel(),n=i.getPosition();if(!o||!n)return;let s=!1,a=!1;for(const e of t.references)if((0,ue.Xy)(e.uri,o.uri))s=!0,a=a||r.e.containsPosition(e.range,n);else if(s)break;s&&a||this.reset()});this._currentState=(0,n.F8)(i,o)}revealNext(e){if(!this._currentModel)return Promise.resolve();this._currentIdx+=1,this._currentIdx%=this._currentModel.references.length;const t=this._currentModel.references[this._currentIdx];return this._showMessage(),this._ignoreEditorChange=!0,this._editorService.openCodeEditor({resource:t.uri,options:{selection:r.e.collapseToStart(t.range),selectionRevealType:3}},e).finally(()=>{this._ignoreEditorChange=!1})}_showMessage(){var e;null===(e=this._currentMessage)||void 0===e||e.dispose();const t=this._keybindingService.lookupKeybinding("editor.gotoNextSymbolFromResult"),i=t?(0,T.N)("location.kb","Symbol {0} of {1}, {2} for next",this._currentIdx+1,this._currentModel.references.length,t.getLabel()):(0,T.N)("location","Symbol {0} of {1}",this._currentIdx+1,this._currentModel.references.length);this._currentMessage=this._notificationService.status(i)}};st=tt([it(0,A.i6),it(1,P.$),it(2,de.lT),it(3,Ie.d)],st),(0,W.z)(nt,st,!0),(0,s.fK)(new class extends s._l{constructor(){super({id:"editor.gotoNextSymbolFromResult",precondition:ot,kbOpts:{weight:100,primary:70}})}runEditorCommand(e,t){return e.get(nt).revealNext(t)}}),re.W.registerCommandAndKeybindingRule({id:"editor.gotoNextSymbolFromResult.cancel",weight:100,when:ot,primary:9,handler(e){e.get(nt).reset()}});let rt=class{constructor(e){this._listener=new Map,this._disposables=new n.SL,this._onDidChange=new _.Q5,this.onDidChange=this._onDidChange.event,this._disposables.add(e.onCodeEditorRemove(this._onDidRemoveEditor,this)),this._disposables.add(e.onCodeEditorAdd(this._onDidAddEditor,this)),e.listCodeEditors().forEach(this._onDidAddEditor,this)}dispose(){this._disposables.dispose(),this._onDidChange.dispose(),(0,n.B9)(this._listener.values())}_onDidAddEditor(e){this._listener.set(e,(0,n.F8)(e.onDidChangeCursorPosition(t=>this._onDidChange.fire({editor:e})),e.onDidChangeModelContent(t=>this._onDidChange.fire({editor:e}))))}_onDidRemoveEditor(e){var t;null===(t=this._listener.get(e))||void 0===t||t.dispose(),this._listener.delete(e)}};rt=tt([it(0,P.$)],rt);var at=i(82276),dt=i(84144),lt=i(90535),ht=i(71050),ct=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function a(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};function ut(e,t,i,o){const n=i.ordered(e).map(i=>Promise.resolve(o(i,e,t)).then(void 0,e=>{(0,h.Cp)(e)}));return Promise.all(n).then(e=>{const t=[];for(let i of e)Array.isArray(i)?t.push(...i):i&&t.push(i);return t})}function gt(e,t,i){return ut(e,t,m.Ct,(e,t,o)=>e.provideDefinition(t,o,i))}function pt(e,t,i){return ut(e,t,m.RN,(e,t,o)=>e.provideDeclaration(t,o,i))}function mt(e,t,i){return ut(e,t,m.vI,(e,t,o)=>e.provideImplementation(t,o,i))}function ft(e,t,i){return ut(e,t,m.tA,(e,t,o)=>e.provideTypeDefinition(t,o,i))}function _t(e,t,i,o){return ut(e,t,m.FL,(e,t,n)=>ct(this,void 0,void 0,(function*(){const s=yield e.provideReferences(t,n,{includeDeclaration:!0},o);if(!i||!s||2!==s.length)return s;const r=yield e.provideReferences(t,n,{includeDeclaration:!1},o);return r&&1===r.length?r:s})))}function vt(e){return ct(this,void 0,void 0,(function*(){const t=yield e(),i=new ve(t,""),o=i.references.map(e=>e.link);return i.dispose(),o}))}(0,s.sb)("_executeDefinitionProvider",(e,t)=>vt(()=>gt(e,t,ht.T.None))),(0,s.sb)("_executeDeclarationProvider",(e,t)=>vt(()=>pt(e,t,ht.T.None))),(0,s.sb)("_executeImplementationProvider",(e,t)=>vt(()=>mt(e,t,ht.T.None))),(0,s.sb)("_executeTypeDefinitionProvider",(e,t)=>vt(()=>ft(e,t,ht.T.None))),(0,s.sb)("_executeReferenceProvider",(e,t)=>vt(()=>_t(e,t,!1,ht.T.None)));var Ct,wt,yt,bt,St,kt,xt,Mt,Dt=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function a(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};dt.BH.appendMenuItem(dt.eH.EditorContext,{submenu:dt.eH.EditorContextPeek,title:T.N("peek.submenu","Peek"),group:"navigation",order:100});const It=new Set;function Nt(e){const t=new e;return(0,s.QG)(t),It.add(t.id),t}class Rt extends s.R6{constructor(e,t){super(t),this._configuration=e}run(e,t){if(!t.hasModel())return Promise.resolve(void 0);const i=e.get(de.lT),o=e.get(P.$),n=e.get(lt.ek),s=e.get(nt),r=t.getModel(),a=t.getPosition(),d=new g.Dl(t,5),h=(0,l.eP)(this._getLocationModel(r,a,d.token),d.token).then(e=>Dt(this,void 0,void 0,(function*(){if(!e||d.token.isCancellationRequested)return;let i;if((0,te.Z9)(e.ariaMessage),e.referenceAt(r.uri,a)){const e=this._getAlternativeCommand(t);e!==this.id&&It.has(e)&&(i=t.getAction(e))}const n=e.references.length;if(0===n){if(!this._configuration.muteMessage){const e=r.getWordAtPosition(a);at.O.get(t).showMessage(this._getNoResultFoundMessage(e),a)}}else{if(1!==n||!i)return this._onResult(o,s,t,e);i.run()}})),e=>{i.error(e)}).finally(()=>{d.dispose()});return n.showWhile(h,250),h}_onResult(e,t,i,o){return Dt(this,void 0,void 0,(function*(){const n=this._getGoToPreference(i);if(i instanceof L.H||!(this._configuration.openInPeek||"peek"===n&&o.references.length>1)){const s=o.firstReference(),r=o.references.length>1&&"gotoAndPeek"===n,a=yield this._openReference(i,e,s,this._configuration.openToSide,!r);r&&a?this._openInPeek(a,o):o.dispose(),"goto"===n&&t.put(s)}else this._openInPeek(i,o)}))}_openReference(e,t,i,o,n){return Dt(this,void 0,void 0,(function*(){let s=void 0;if((0,m.vx)(i)&&(s=i.targetSelectionRange),s||(s=i.range),!s)return;const a=yield t.openCodeEditor({resource:i.uri,options:{selection:r.e.collapseToStart(s),selectionRevealType:3}},e,o);if(a){if(n){const e=a.getModel(),t=a.deltaDecorations([],[{range:s,options:{description:"symbol-navigate-action-highlight",className:"symbolHighlight"}}]);setTimeout(()=>{a.getModel()===e&&a.deltaDecorations(t,[])},350)}return a}}))}_openInPeek(e,t){let i=Ye.get(e);i&&e.hasModel()?i.toggleWidget(e.getSelection(),(0,l.PG)(e=>Promise.resolve(t)),this._configuration.openInPeek):t.dispose()}}class Pt extends Rt{_getLocationModel(e,t,i){return Dt(this,void 0,void 0,(function*(){return new ve(yield gt(e,t,i),T.N("def.title","Definitions"))}))}_getNoResultFoundMessage(e){return e&&e.word?T.N("noResultWord","No definition found for '{0}'",e.word):T.N("generic.noResults","No definition found")}_getAlternativeCommand(e){return e.getOption(50).alternativeDefinitionCommand}_getGoToPreference(e){return e.getOption(50).multipleDefinitions}}const Lt=v.$L&&!ee.isStandalone?2118:70;Nt(((Ct=class e extends Pt{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:e.id,label:T.N("actions.goToDecl.label","Go to Definition"),alias:"Go to Definition",precondition:A.Ao.and(a.u.hasDefinitionProvider,a.u.isInWalkThroughSnippet.toNegated()),kbOpts:{kbExpr:a.u.editorTextFocus,primary:Lt,weight:100},contextMenuOpts:{group:"navigation",order:1.1}}),ne.P0.registerCommandAlias("editor.action.goToDeclaration",e.id)}}).id="editor.action.revealDefinition",Ct)),Nt(((wt=class e extends Pt{constructor(){super({openToSide:!0,openInPeek:!1,muteMessage:!1},{id:e.id,label:T.N("actions.goToDeclToSide.label","Open Definition to the Side"),alias:"Open Definition to the Side",precondition:A.Ao.and(a.u.hasDefinitionProvider,a.u.isInWalkThroughSnippet.toNegated()),kbOpts:{kbExpr:a.u.editorTextFocus,primary:(0,o.gx)(2089,Lt),weight:100}}),ne.P0.registerCommandAlias("editor.action.openDeclarationToTheSide",e.id)}}).id="editor.action.revealDefinitionAside",wt)),Nt(((yt=class e extends Pt{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:e.id,label:T.N("actions.previewDecl.label","Peek Definition"),alias:"Peek Definition",precondition:A.Ao.and(a.u.hasDefinitionProvider,G.notInPeekEditor,a.u.isInWalkThroughSnippet.toNegated()),kbOpts:{kbExpr:a.u.editorTextFocus,primary:582,linux:{primary:3140},weight:100},contextMenuOpts:{menuId:dt.eH.EditorContextPeek,group:"peek",order:2}}),ne.P0.registerCommandAlias("editor.action.previewDeclaration",e.id)}}).id="editor.action.peekDefinition",yt));class Et extends Rt{_getLocationModel(e,t,i){return Dt(this,void 0,void 0,(function*(){return new ve(yield pt(e,t,i),T.N("decl.title","Declarations"))}))}_getNoResultFoundMessage(e){return e&&e.word?T.N("decl.noResultWord","No declaration found for '{0}'",e.word):T.N("decl.generic.noResults","No declaration found")}_getAlternativeCommand(e){return e.getOption(50).alternativeDeclarationCommand}_getGoToPreference(e){return e.getOption(50).multipleDeclarations}}Nt(((bt=class e extends Et{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:e.id,label:T.N("actions.goToDeclaration.label","Go to Declaration"),alias:"Go to Declaration",precondition:A.Ao.and(a.u.hasDeclarationProvider,a.u.isInWalkThroughSnippet.toNegated()),contextMenuOpts:{group:"navigation",order:1.3}})}_getNoResultFoundMessage(e){return e&&e.word?T.N("decl.noResultWord","No declaration found for '{0}'",e.word):T.N("decl.generic.noResults","No declaration found")}}).id="editor.action.revealDeclaration",bt)),Nt(class extends Et{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:"editor.action.peekDeclaration",label:T.N("actions.peekDecl.label","Peek Declaration"),alias:"Peek Declaration",precondition:A.Ao.and(a.u.hasDeclarationProvider,G.notInPeekEditor,a.u.isInWalkThroughSnippet.toNegated()),contextMenuOpts:{menuId:dt.eH.EditorContextPeek,group:"peek",order:3}})}});class Tt extends Rt{_getLocationModel(e,t,i){return Dt(this,void 0,void 0,(function*(){return new ve(yield ft(e,t,i),T.N("typedef.title","Type Definitions"))}))}_getNoResultFoundMessage(e){return e&&e.word?T.N("goToTypeDefinition.noResultWord","No type definition found for '{0}'",e.word):T.N("goToTypeDefinition.generic.noResults","No type definition found")}_getAlternativeCommand(e){return e.getOption(50).alternativeTypeDefinitionCommand}_getGoToPreference(e){return e.getOption(50).multipleTypeDefinitions}}Nt(((St=class e extends Tt{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:e.ID,label:T.N("actions.goToTypeDefinition.label","Go to Type Definition"),alias:"Go to Type Definition",precondition:A.Ao.and(a.u.hasTypeDefinitionProvider,a.u.isInWalkThroughSnippet.toNegated()),kbOpts:{kbExpr:a.u.editorTextFocus,primary:0,weight:100},contextMenuOpts:{group:"navigation",order:1.4}})}}).ID="editor.action.goToTypeDefinition",St)),Nt(((kt=class e extends Tt{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:e.ID,label:T.N("actions.peekTypeDefinition.label","Peek Type Definition"),alias:"Peek Type Definition",precondition:A.Ao.and(a.u.hasTypeDefinitionProvider,G.notInPeekEditor,a.u.isInWalkThroughSnippet.toNegated()),contextMenuOpts:{menuId:dt.eH.EditorContextPeek,group:"peek",order:4}})}}).ID="editor.action.peekTypeDefinition",kt));class Ot extends Rt{_getLocationModel(e,t,i){return Dt(this,void 0,void 0,(function*(){return new ve(yield mt(e,t,i),T.N("impl.title","Implementations"))}))}_getNoResultFoundMessage(e){return e&&e.word?T.N("goToImplementation.noResultWord","No implementation found for '{0}'",e.word):T.N("goToImplementation.generic.noResults","No implementation found")}_getAlternativeCommand(e){return e.getOption(50).alternativeImplementationCommand}_getGoToPreference(e){return e.getOption(50).multipleImplementations}}Nt(((xt=class e extends Ot{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:e.ID,label:T.N("actions.goToImplementation.label","Go to Implementations"),alias:"Go to Implementations",precondition:A.Ao.and(a.u.hasImplementationProvider,a.u.isInWalkThroughSnippet.toNegated()),kbOpts:{kbExpr:a.u.editorTextFocus,primary:2118,weight:100},contextMenuOpts:{group:"navigation",order:1.45}})}}).ID="editor.action.goToImplementation",xt)),Nt(((Mt=class e extends Ot{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:e.ID,label:T.N("actions.peekImplementation.label","Peek Implementations"),alias:"Peek Implementations",precondition:A.Ao.and(a.u.hasImplementationProvider,G.notInPeekEditor,a.u.isInWalkThroughSnippet.toNegated()),kbOpts:{kbExpr:a.u.editorTextFocus,primary:3142,weight:100},contextMenuOpts:{menuId:dt.eH.EditorContextPeek,group:"peek",order:5}})}}).ID="editor.action.peekImplementation",Mt));class At extends Rt{_getNoResultFoundMessage(e){return e?T.N("references.no","No references found for '{0}'",e.word):T.N("references.noGeneric","No references found")}_getAlternativeCommand(e){return e.getOption(50).alternativeReferenceCommand}_getGoToPreference(e){return e.getOption(50).multipleReferences}}Nt(class extends At{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:"editor.action.goToReferences",label:T.N("goToReferences.label","Go to References"),alias:"Go to References",precondition:A.Ao.and(a.u.hasReferenceProvider,G.notInPeekEditor,a.u.isInWalkThroughSnippet.toNegated()),kbOpts:{kbExpr:a.u.editorTextFocus,primary:1094,weight:100},contextMenuOpts:{group:"navigation",order:1.45}})}_getLocationModel(e,t,i){return Dt(this,void 0,void 0,(function*(){return new ve(yield _t(e,t,!0,i),T.N("ref.title","References"))}))}}),Nt(class extends At{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:"editor.action.referenceSearch.trigger",label:T.N("references.action.label","Peek References"),alias:"Peek References",precondition:A.Ao.and(a.u.hasReferenceProvider,G.notInPeekEditor,a.u.isInWalkThroughSnippet.toNegated()),contextMenuOpts:{menuId:dt.eH.EditorContextPeek,group:"peek",order:6}})}_getLocationModel(e,t,i){return Dt(this,void 0,void 0,(function*(){return new ve(yield _t(e,t,!1,i),T.N("ref.title","References"))}))}});class Wt extends Rt{constructor(e,t,i){super(e,{id:"editor.action.goToLocation",label:T.N("label.generic","Go to Any Symbol"),alias:"Go to Any Symbol",precondition:A.Ao.and(G.notInPeekEditor,a.u.isInWalkThroughSnippet.toNegated())}),this._references=t,this._gotoMultipleBehaviour=i}_getLocationModel(e,t,i){return Dt(this,void 0,void 0,(function*(){return new ve(this._references,T.N("generic.title","Locations"))}))}_getNoResultFoundMessage(e){return e&&T.N("generic.noResult","No results for '{0}'",e.word)||""}_getGoToPreference(e){var t;return null!==(t=this._gotoMultipleBehaviour)&&void 0!==t?t:e.getOption(50).multipleReferences}_getAlternativeCommand(){return""}}ne.P0.registerCommand({id:"editor.action.goToLocations",description:{description:"Go to locations from a position in a file",args:[{name:"uri",description:"The text document in which to start",constraint:ie.o},{name:"position",description:"The position at which to start",constraint:p.L.isIPosition},{name:"locations",description:"An array of locations.",constraint:Array},{name:"multiple",description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto"},{name:"noResultsMessage",description:"Human readable message that shows when locations is empty."}]},handler:(e,t,i,o,n,s,r)=>Dt(void 0,void 0,void 0,(function*(){(0,u.p_)(ie.o.isUri(t)),(0,u.p_)(p.L.isIPosition(i)),(0,u.p_)(Array.isArray(o)),(0,u.p_)(void 0===n||"string"==typeof n),(0,u.p_)(void 0===r||"boolean"==typeof r);const a=e.get(P.$),d=yield a.openCodeEditor({resource:t},a.getFocusedCodeEditor());if((0,oe.CL)(d))return d.setPosition(i),d.revealPositionInCenterIfOutsideViewport(i,0),d.invokeWithinContext(e=>{const t=new class extends Wt{_getNoResultFoundMessage(e){return s||super._getNoResultFoundMessage(e)}}({muteMessage:!Boolean(s),openInPeek:Boolean(r),openToSide:!1},o,n);e.get(F.TG).invokeFunction(t.run.bind(t),d)})}))}),ne.P0.registerCommand({id:"editor.action.peekLocations",description:{description:"Peek locations from a position in a file",args:[{name:"uri",description:"The text document in which to start",constraint:ie.o},{name:"position",description:"The position at which to start",constraint:p.L.isIPosition},{name:"locations",description:"An array of locations.",constraint:Array},{name:"multiple",description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto"}]},handler:(e,t,i,o,n)=>Dt(void 0,void 0,void 0,(function*(){e.get(ne.Hy).executeCommand("editor.action.goToLocations",t,i,o,n,void 0,!0)}))}),ne.P0.registerCommand({id:"editor.action.findReferences",handler:(e,t,i)=>{(0,u.p_)(ie.o.isUri(t)),(0,u.p_)(p.L.isIPosition(i));const o=e.get(P.$);return o.openCodeEditor({resource:t},o.getFocusedCodeEditor()).then(e=>{if(!(0,oe.CL)(e)||!e.hasModel())return;const t=Ye.get(e);if(!t)return;const o=(0,l.PG)(t=>_t(e.getModel(),p.L.lift(i),!1,t).then(e=>new ve(e,T.N("ref.title","References")))),n=new r.e(i.lineNumber,i.column,i.lineNumber,i.column);return Promise.resolve(t.toggleWidget(n,o,!1))})}}),ne.P0.registerCommandAlias("editor.action.showReferences","editor.action.peekLocations"),dt.BH.appendMenuItems([{id:dt.eH.MenubarGoMenu,item:{command:{id:"editor.action.revealDefinition",title:T.N({key:"miGotoDefinition",comment:["&& denotes a mnemonic"]},"Go to &&Definition")},group:"4_symbol_nav",order:2}},{id:dt.eH.MenubarGoMenu,item:{command:{id:"editor.action.revealDeclaration",title:T.N({key:"miGotoDeclaration",comment:["&& denotes a mnemonic"]},"Go to &&Declaration")},group:"4_symbol_nav",order:3}},{id:dt.eH.MenubarGoMenu,item:{command:{id:"editor.action.goToTypeDefinition",title:T.N({key:"miGotoTypeDefinition",comment:["&& denotes a mnemonic"]},"Go to &&Type Definition")},group:"4_symbol_nav",order:3}},{id:dt.eH.MenubarGoMenu,item:{command:{id:"editor.action.goToImplementation",title:T.N({key:"miGotoImplementation",comment:["&& denotes a mnemonic"]},"Go to &&Implementations")},group:"4_symbol_nav",order:4}},{id:dt.eH.MenubarGoMenu,item:{command:{id:"editor.action.goToReferences",title:T.N({key:"miGotoReference",comment:["&& denotes a mnemonic"]},"Go to &&References")},group:"4_symbol_nav",order:5}}]);var Ft=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},Ht=function(e,t){return function(i,o){t(i,o,e)}};let Vt=class e{constructor(e,t,i){this.textModelResolverService=t,this.modeService=i,this.toUnhook=new n.SL,this.toUnhookForKeyboard=new n.SL,this.linkDecorations=[],this.currentWordAtPosition=null,this.previousPromise=null,this.editor=e;let o=new k(e);this.toUnhook.add(o),this.toUnhook.add(o.onMouseMoveOrRelevantKeyDown(([e,t])=>{this.startFindDefinitionFromMouse(e,(0,u.f6)(t))})),this.toUnhook.add(o.onExecute(e=>{this.isEnabled(e)&&this.gotoDefinition(e.target.position,e.hasSideBySideModifier).then(()=>{this.removeLinkDecorations()},e=>{this.removeLinkDecorations(),(0,h.dL)(e)})})),this.toUnhook.add(o.onCancel(()=>{this.removeLinkDecorations(),this.currentWordAtPosition=null}))}static get(t){return t.getContribution(e.ID)}startFindDefinitionFromCursor(e){return this.startFindDefinition(e).then(()=>{this.toUnhookForKeyboard.add(this.editor.onDidChangeCursorPosition(()=>{this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear()})),this.toUnhookForKeyboard.add(this.editor.onKeyDown(e=>{e&&(this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear())}))})}startFindDefinitionFromMouse(e,t){if(9===e.target.type&&this.linkDecorations.length>0)return;if(!this.editor.hasModel()||!this.isEnabled(e,t))return this.currentWordAtPosition=null,void this.removeLinkDecorations();const i=e.target.position;this.startFindDefinition(i)}startFindDefinition(e){var t;this.toUnhookForKeyboard.clear();const i=e?null===(t=this.editor.getModel())||void 0===t?void 0:t.getWordAtPosition(e):null;if(!i)return this.currentWordAtPosition=null,this.removeLinkDecorations(),Promise.resolve(0);if(this.currentWordAtPosition&&this.currentWordAtPosition.startColumn===i.startColumn&&this.currentWordAtPosition.endColumn===i.endColumn&&this.currentWordAtPosition.word===i.word)return Promise.resolve(0);this.currentWordAtPosition=i;let o=new g.yy(this.editor,15);return this.previousPromise&&(this.previousPromise.cancel(),this.previousPromise=null),this.previousPromise=(0,l.PG)(t=>this.findDefinition(e,t)),this.previousPromise.then(t=>{if(t&&t.length&&o.validate(this.editor))if(t.length>1)this.addDecoration(new r.e(e.lineNumber,i.startColumn,e.lineNumber,i.endColumn),(new c.W5).appendText(T.N("multipleResults","Click to show {0} definitions.",t.length)));else{let o=t[0];if(!o.uri)return;this.textModelResolverService.createModelReference(o.uri).then(t=>{if(!t.object||!t.object.textEditorModel)return void t.dispose();const{object:{textEditorModel:n}}=t,{startLineNumber:s}=o.range;if(s<1||s>n.getLineCount())return void t.dispose();const a=this.getPreviewValue(n,s,o);let d;d=o.originSelectionRange?r.e.lift(o.originSelectionRange):new r.e(e.lineNumber,i.startColumn,e.lineNumber,i.endColumn);const l=this.modeService.getModeIdByFilepathOrFirstLine(n.uri);this.addDecoration(d,(new c.W5).appendCodeblock(l||"",a)),t.dispose()})}else this.removeLinkDecorations()}).then(void 0,h.dL)}getPreviewValue(t,i,o){let n=o.targetSelectionRange?o.range:this.getPreviewRangeBasedOnBrackets(t,i);n.endLineNumber-n.startLineNumber>=e.MAX_SOURCE_PREVIEW_LINES&&(n=this.getPreviewRangeBasedOnIndentation(t,i));return this.stripIndentationFromPreviewRange(t,i,n)}stripIndentationFromPreviewRange(e,t,i){let o=e.getLineFirstNonWhitespaceColumn(t);for(let n=t+1;n<i.endLineNumber;n++){const t=e.getLineFirstNonWhitespaceColumn(n);o=Math.min(o,t)}return e.getValueInRange(i).replace(new RegExp(`^\\s{${o-1}}`,"gm"),"").trim()}getPreviewRangeBasedOnIndentation(t,i){const o=t.getLineFirstNonWhitespaceColumn(i),n=Math.min(t.getLineCount(),i+e.MAX_SOURCE_PREVIEW_LINES);let s=i+1;for(;s<n;s++){if(o===t.getLineFirstNonWhitespaceColumn(s))break}return new r.e(i,1,s+1,1)}getPreviewRangeBasedOnBrackets(t,i){const o=Math.min(t.getLineCount(),i+e.MAX_SOURCE_PREVIEW_LINES),n=[];let s=!0,a=t.bracketPairs.findNextBracket(new p.L(i,1));for(;null!==a;){if(0===n.length)n.push(a);else{const e=n[n.length-1];if(e.open[0]===a.open[0]&&e.isOpen&&!a.isOpen?n.pop():n.push(a),0===n.length){if(!s)return new r.e(i,1,a.range.endLineNumber+1,1);s=!1}}const e=t.getLineMaxColumn(i);let d=a.range.endLineNumber,l=a.range.endColumn;if(e===a.range.endColumn&&(d++,l=1),d>o)return new r.e(i,1,o+1,1);a=t.bracketPairs.findNextBracket(new p.L(d,l))}return new r.e(i,1,o+1,1)}addDecoration(e,t){const i={range:e,options:{description:"goto-definition-link",inlineClassName:"goto-definition-link",hoverMessage:t}};this.linkDecorations=this.editor.deltaDecorations(this.linkDecorations,[i])}removeLinkDecorations(){this.linkDecorations.length>0&&(this.linkDecorations=this.editor.deltaDecorations(this.linkDecorations,[]))}isEnabled(e,t){return this.editor.hasModel()&&e.isNoneOrSingleMouseDown&&6===e.target.type&&(e.hasTriggerModifier||!!t&&t.keyCodeIsTriggerKey)&&m.Ct.has(this.editor.getModel())}findDefinition(e,t){const i=this.editor.getModel();return i?gt(i,e,t):Promise.resolve(null)}gotoDefinition(e,t){return this.editor.setPosition(e),this.editor.invokeWithinContext(e=>{const i=!t&&this.editor.getOption(77)&&!this.isInPeekEditor(e);return new Pt({openToSide:t,openInPeek:i,muteMessage:!0},{alias:"",label:"",id:"",precondition:void 0}).run(e,this.editor)})}isInPeekEditor(e){const t=e.get(A.i6);return G.inPeekEditor.getValue(t)}dispose(){this.toUnhook.dispose()}};Vt.ID="editor.contrib.gotodefinitionatposition",Vt.MAX_SOURCE_PREVIEW_LINES=8,Vt=Ft([Ht(1,f.S),Ht(2,d.h)],Vt),(0,s._K)(Vt.ID,Vt),(0,Y.Ic)((e,t)=>{const i=e.getColor(H._Yy);i&&t.addRule(`.monaco-editor .goto-definition-link { color: ${i} !important; }`)});var Kt=i(30986),Bt=i(93794),Gt=i(9488),$t=i(83308),Ut=i(64494),jt=i(94789),Zt=i(77862),zt=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},qt=function(e,t){return function(i,o){t(i,o,e)}},Qt=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function a(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};class Xt{constructor(e,t,i,o){this.owner=e,this.range=t,this.model=i,this.provider=o,this.forceShowAtRange=!0}isValidForHoverAnchor(e){return 1===e.type&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}}let Jt=class{constructor(e,t,i){this._editor=e,this._hover=t,this._themeService=i}computeSync(e,t){return[]}computeAsync(e,t,i){return l.Aq.fromPromise(this._computeAsync(e,t,i))}_computeAsync(e,t,i){return Qt(this,void 0,void 0,(function*(){if(!this._editor.hasModel())return[];const e=Ut.i.get(this._editor);for(const i of t){if(!e.isColorDecorationId(i.id))continue;const t=e.getColorData(i.range.getStartPosition());if(t){return[yield this._createColorHover(this._editor.getModel(),t.colorInfo,t.provider)]}}return[]}))}_createColorHover(e,t,i){return Qt(this,void 0,void 0,(function*(){const o=e.getValueInRange(t.range),{red:n,green:s,blue:a,alpha:d}=t.color,l=new N.VS(Math.round(255*n),Math.round(255*s),Math.round(255*a),d),h=new N.Il(l),c=yield(0,$t.R)(e,t,i,ht.T.None),u=new jt.A(h,[],0);return u.colorPresentations=c||[],u.guessColorPresentation(h,o),new Xt(this,r.e.lift(t.range),u,i)}))}renderHoverParts(e,t,i){if(0===e.length||!this._editor.hasModel())return n.JT.None;const o=new n.SL,s=e[0],a=this._editor.getModel(),d=s.model,l=o.add(new Zt.YW(t,d,this._editor.getOption(128),this._themeService));let h=new r.e(s.range.startLineNumber,s.range.startColumn,s.range.endLineNumber,s.range.endColumn);const c=()=>{let e,t;if(d.presentation.textEdit){e=[d.presentation.textEdit],t=new r.e(d.presentation.textEdit.range.startLineNumber,d.presentation.textEdit.range.startColumn,d.presentation.textEdit.range.endLineNumber,d.presentation.textEdit.range.endColumn);const i=this._editor.getModel()._setTrackedRange(null,t,3);this._editor.pushUndoStop(),this._editor.executeEdits("colorpicker",e),t=this._editor.getModel()._getTrackedRange(i)||t}else e=[{identifier:null,range:h,text:d.presentation.label,forceMoveMarkers:!1}],t=h.setEndPosition(h.endLineNumber,h.startColumn+d.presentation.label.length),this._editor.pushUndoStop(),this._editor.executeEdits("colorpicker",e);d.presentation.additionalTextEdits&&(e=[...d.presentation.additionalTextEdits],this._editor.executeEdits("colorpicker",e),this._hover.hide()),this._editor.pushUndoStop(),h=t},u=e=>(0,$t.R)(a,{range:h,color:{red:e.rgba.r/255,green:e.rgba.g/255,blue:e.rgba.b/255,alpha:e.rgba.a}},s.provider,ht.T.None).then(e=>{d.colorPresentations=e||[]});return o.add(d.onColorFlushed(e=>{u(e).then(c)})),o.add(d.onDidChangeColor(u)),this._hover.setColorPicker(l),o}};Jt=zt([qt(2,Y.XE)],Jt);var Yt=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function a(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))},ei=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(i){t[i]=e[i]&&function(t){return new Promise((function(o,n){(function(e,t,i,o){Promise.resolve(o).then((function(t){e({value:t,done:i})}),t)})(o,n,(t=e[i](t)).done,t.value)}))}}};class ti{constructor(e,t,i,o,n){this._computer=e,this._state=0,this._hoverTime=n,this._firstWaitScheduler=new l.pY(()=>this._triggerAsyncComputation(),0),this._secondWaitScheduler=new l.pY(()=>this._triggerSyncComputation(),0),this._loadingMessageScheduler=new l.pY(()=>this._showLoadingMessage(),0),this._asyncIterable=null,this._asyncIterableDone=!1,this._completeCallback=t,this._errorCallback=i,this._progressCallback=o}setHoverTime(e){this._hoverTime=e}_firstWaitTime(){return this._hoverTime/2}_secondWaitTime(){return this._hoverTime/2}_loadingMessageTime(){return 3*this._hoverTime}_triggerAsyncComputation(){this._state=2,this._secondWaitScheduler.schedule(this._secondWaitTime()),this._computer.computeAsync?(this._asyncIterableDone=!1,this._asyncIterable=(0,l.zS)(e=>this._computer.computeAsync(e)),(()=>{Yt(this,void 0,void 0,(function*(){var e,t;try{try{for(var i,o=ei(this._asyncIterable);!(i=yield o.next()).done;){const e=i.value;e&&(this._computer.onResult([e],!1),this._onProgress())}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&(yield t.call(o))}finally{if(e)throw e.error}}this._asyncIterableDone=!0,this._withAsyncResult()}catch(e){this._onError(e)}}))})()):this._asyncIterableDone=!0}_triggerSyncComputation(){this._computer.computeSync&&this._computer.onResult(this._computer.computeSync(),!0),this._asyncIterableDone?(this._state=0,this._onComplete()):(this._state=3,this._onProgress())}_showLoadingMessage(){3===this._state&&(this._state=4,this._onProgress())}_withAsyncResult(){3!==this._state&&4!==this._state||(this._state=0,this._onComplete())}_onComplete(){this._completeCallback(this._computer.getResult())}_onError(e){this._errorCallback?this._errorCallback(e):(0,h.dL)(e)}_onProgress(){4===this._state?this._progressCallback(this._computer.getResultWithLoadingMessage()):this._progressCallback(this._computer.getResult())}start(e){if(0===e)0===this._state&&(this._state=1,this._firstWaitScheduler.schedule(this._firstWaitTime()),this._loadingMessageScheduler.schedule(this._loadingMessageTime()));else switch(this._state){case 0:this._triggerAsyncComputation(),this._secondWaitScheduler.cancel(),this._triggerSyncComputation();break;case 2:this._secondWaitScheduler.cancel(),this._triggerSyncComputation()}}cancel(){this._firstWaitScheduler.cancel(),this._secondWaitScheduler.cancel(),this._loadingMessageScheduler.cancel(),this._asyncIterable&&(this._asyncIterable.cancel(),this._asyncIterable=null),this._state=0}}class ii{constructor(e,t){this.priority=e,this.range=t,this.type=1}equals(e){return 1===e.type&&this.range.equalsRange(e.range)}canAdoptVisibleHover(e,t){return 1===e.type&&t.lineNumber===this.range.startLineNumber}}class oi{constructor(e,t,i){this.priority=e,this.owner=t,this.range=i,this.type=2}equals(e){return 2===e.type&&this.owner===e.owner}canAdoptVisibleHover(e,t){return 2===e.type&&this.owner===e.owner}}var ni=i(83056),si=i(26479),ri=i(31907),ai=i(59471),di=i(89532),li=i(91741),hi=i(98674),ci=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},ui=function(e,t){return function(i,o){t(i,o,e)}};class gi{constructor(e,t,i){this.marker=e,this.index=t,this.total=i}}let pi=class{constructor(e,t,i){this._markerService=t,this._configService=i,this._onDidChange=new _.Q5,this.onDidChange=this._onDidChange.event,this._dispoables=new n.SL,this._markers=[],this._nextIdx=-1,ie.o.isUri(e)?this._resourceFilter=t=>t.toString()===e.toString():e&&(this._resourceFilter=e);const o=this._configService.getValue("problems.sortOrder"),s=(e,t)=>{let i=(0,ge.qu)(e.resource.toString(),t.resource.toString());return i="position"===o?r.e.compareRangesUsingStarts(e,t)||hi.ZL.compare(e.severity,t.severity):hi.ZL.compare(e.severity,t.severity)||r.e.compareRangesUsingStarts(e,t),i},a=()=>{this._markers=this._markerService.read({resource:ie.o.isUri(e)?e:void 0,severities:hi.ZL.Error|hi.ZL.Warning|hi.ZL.Info}),"function"==typeof e&&(this._markers=this._markers.filter(e=>this._resourceFilter(e.resource))),this._markers.sort(s)};a(),this._dispoables.add(t.onMarkerChanged(e=>{this._resourceFilter&&!e.some(e=>this._resourceFilter(e))||(a(),this._nextIdx=-1,this._onDidChange.fire())}))}dispose(){this._dispoables.dispose(),this._onDidChange.dispose()}matches(e){return!this._resourceFilter&&!e||!(!this._resourceFilter||!e)&&this._resourceFilter(e)}get selected(){const e=this._markers[this._nextIdx];return e&&new gi(e,this._nextIdx+1,this._markers.length)}_initIdx(e,t,i){let o=!1,n=this._markers.findIndex(t=>t.resource.toString()===e.uri.toString());n<0&&(n=(0,Gt.ry)(this._markers,{resource:e.uri},(e,t)=>(0,ge.qu)(e.resource.toString(),t.resource.toString())),n<0&&(n=~n));for(let i=n;i<this._markers.length;i++){let n=r.e.lift(this._markers[i]);if(n.isEmpty()){const t=e.getWordAtPosition(n.getStartPosition());t&&(n=new r.e(n.startLineNumber,t.startColumn,n.startLineNumber,t.endColumn))}if(t&&(n.containsPosition(t)||t.isBeforeOrEqual(n.getStartPosition()))){this._nextIdx=i,o=!0;break}if(this._markers[i].resource.toString()!==e.uri.toString())break}o||(this._nextIdx=i?0:this._markers.length-1),this._nextIdx<0&&(this._nextIdx=this._markers.length-1)}resetIndex(){this._nextIdx=-1}move(e,t,i){if(0===this._markers.length)return!1;let o=this._nextIdx;return-1===this._nextIdx?this._initIdx(t,i,e):e?this._nextIdx=(this._nextIdx+1)%this._markers.length:e||(this._nextIdx=(this._nextIdx-1+this._markers.length)%this._markers.length),o!==this._nextIdx}find(e,t){let i=this._markers.findIndex(t=>t.resource.toString()===e.toString());if(!(i<0))for(;i<this._markers.length;i++)if(r.e.containsPosition(this._markers[i],t))return new gi(this._markers[i],i+1,this._markers.length)}};pi=ci([ui(1,hi.lT),ui(2,se.Ui)],pi);const mi=(0,F.yh)("IMarkerNavigationService");let fi=class{constructor(e,t){this._markerService=e,this._configService=t,this._provider=new li.S}getMarkerList(e){for(let t of this._provider){const i=t.getMarkerList(e);if(i)return i}return new pi(e,this._markerService,this._configService)}};fi=ci([ui(0,hi.lT),ui(1,se.Ui)],fi),(0,W.z)(mi,fi,!0);var _i=i(59554),vi=i(9802),Ci=i(50988),wi=i(41967),yi=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},bi=function(e,t){return function(i,o){t(i,o,e)}};class Si{constructor(e,t,i,o,s){this._openerService=o,this._labelService=s,this._lines=0,this._longestLineLength=0,this._relatedDiagnostics=new WeakMap,this._disposables=new n.SL,this._editor=t;const r=document.createElement("div");r.className="descriptioncontainer",this._messageBlock=document.createElement("div"),this._messageBlock.classList.add("message"),this._messageBlock.setAttribute("aria-live","assertive"),this._messageBlock.setAttribute("role","alert"),r.appendChild(this._messageBlock),this._relatedBlock=document.createElement("div"),r.appendChild(this._relatedBlock),this._disposables.add(x.mu(this._relatedBlock,"click",e=>{e.preventDefault();const t=this._relatedDiagnostics.get(e.target);t&&i(t)})),this._scrollable=new vi.NB(r,{horizontal:1,vertical:1,useShadows:!1,horizontalScrollbarSize:6,verticalScrollbarSize:6}),e.appendChild(this._scrollable.getDomNode()),this._disposables.add(this._scrollable.onScroll(e=>{r.style.left=`-${e.scrollLeft}px`,r.style.top=`-${e.scrollTop}px`})),this._disposables.add(this._scrollable)}dispose(){(0,n.B9)(this._disposables)}update(e){const{source:t,message:i,relatedInformation:o,code:n}=e;let s=((null==t?void 0:t.length)||0)+"()".length;n&&(s+="string"==typeof n?n.length:n.value.length);const r=(0,ge.uq)(i);this._lines=r.length,this._longestLineLength=0;for(const e of r)this._longestLineLength=Math.max(e.length+s,this._longestLineLength);x.PO(this._messageBlock),this._messageBlock.setAttribute("aria-label",this.getAriaLabel(e)),this._editor.applyFontInfo(this._messageBlock);let a=this._messageBlock;for(const e of r)a=document.createElement("div"),a.innerText=e,""===e&&(a.style.height=this._messageBlock.style.lineHeight),this._messageBlock.appendChild(a);if(t||n){const e=document.createElement("span");if(e.classList.add("details"),a.appendChild(e),t){const i=document.createElement("span");i.innerText=t,i.classList.add("source"),e.appendChild(i)}if(n)if("string"==typeof n){const t=document.createElement("span");t.innerText=`(${n})`,t.classList.add("code"),e.appendChild(t)}else{this._codeLink=x.$("a.code-link"),this._codeLink.setAttribute("href",""+n.target.toString()),this._codeLink.onclick=e=>{this._openerService.open(n.target,{allowCommands:!0}),e.preventDefault(),e.stopPropagation()};x.R3(this._codeLink,x.$("span")).innerText=n.value,e.appendChild(this._codeLink)}}if(x.PO(this._relatedBlock),this._editor.applyFontInfo(this._relatedBlock),(0,Gt.Of)(o)){const e=this._relatedBlock.appendChild(document.createElement("div"));e.style.paddingTop=Math.floor(.66*this._editor.getOption(58))+"px",this._lines+=1;for(const t of o){let i=document.createElement("div"),o=document.createElement("a");o.classList.add("filename"),o.innerText=`${(0,De.p)(t.resource)}(${t.startLineNumber}, ${t.startColumn}): `,o.title=this._labelService.getUriLabel(t.resource),this._relatedDiagnostics.set(o,t);let n=document.createElement("span");n.innerText=t.message,i.appendChild(o),i.appendChild(n),this._lines+=1,e.appendChild(i)}}const d=this._editor.getOption(43),l=Math.ceil(d.typicalFullwidthCharacterWidth*this._longestLineLength*.75),h=d.lineHeight*this._lines;this._scrollable.setScrollDimensions({scrollWidth:l,scrollHeight:h})}layout(e,t){this._scrollable.getDomNode().style.height=e+"px",this._scrollable.getDomNode().style.width=t+"px",this._scrollable.setScrollDimensions({width:t,height:e})}getHeightInLines(){return Math.min(17,this._lines)}getAriaLabel(e){let t="";switch(e.severity){case hi.ZL.Error:t=T.N("Error","Error");break;case hi.ZL.Warning:t=T.N("Warning","Warning");break;case hi.ZL.Info:t=T.N("Info","Info");break;case hi.ZL.Hint:t=T.N("Hint","Hint")}let i=T.N("marker aria","{0} at {1}. ",t,e.startLineNumber+":"+e.startColumn);const o=this._editor.getModel();if(o&&e.startLineNumber<=o.getLineCount()&&e.startLineNumber>=1){i=`${o.getLineContent(e.startLineNumber)}, ${i}`}return i}}let ki=class e extends j{constructor(e,t,i,o,s,r,a){super(e,{showArrow:!0,showFrame:!0,isAccessible:!0,frameWidth:1},s),this._themeService=t,this._openerService=i,this._menuService=o,this._contextKeyService=r,this._labelService=a,this._callOnDispose=new n.SL,this._onDidSelectRelatedInformation=new _.Q5,this.onDidSelectRelatedInformation=this._onDidSelectRelatedInformation.event,this._severity=hi.ZL.Warning,this._backgroundColor=N.Il.white,this._applyTheme(t.getColorTheme()),this._callOnDispose.add(t.onDidColorThemeChange(this._applyTheme.bind(this))),this.create()}_applyTheme(e){this._backgroundColor=e.getColor(Ti);let t=Ii,i=Ni;this._severity===hi.ZL.Warning?(t=Ri,i=Pi):this._severity===hi.ZL.Info&&(t=Li,i=Ei);const o=e.getColor(t),n=e.getColor(i);this.style({arrowColor:o,frameColor:o,headerBackgroundColor:n,primaryHeadingColor:e.getColor(z),secondaryHeadingColor:e.getColor(q)})}_applyStyles(){this._parentContainer&&(this._parentContainer.style.backgroundColor=this._backgroundColor?this._backgroundColor.toString():""),super._applyStyles()}dispose(){this._callOnDispose.dispose(),super.dispose()}_fillHead(t){super._fillHead(t),this._disposables.add(this._actionbarWidget.actionRunner.onBeforeRun(e=>this.editor.focus()));const i=[],o=this._menuService.createMenu(e.TitleMenu,this._contextKeyService);(0,O.vr)(o,void 0,i),this._actionbarWidget.push(i,{label:!1,icon:!0,index:0}),o.dispose()}_fillTitleIcon(e){this._icon=x.R3(e,x.$(""))}_fillBody(e){this._parentContainer=e,e.classList.add("marker-widget"),this._parentContainer.tabIndex=0,this._parentContainer.setAttribute("role","tooltip"),this._container=document.createElement("div"),e.appendChild(this._container),this._message=new Si(this._container,this.editor,e=>this._onDidSelectRelatedInformation.fire(e),this._openerService,this._labelService),this._disposables.add(this._message)}show(){throw new Error("call showAtMarker")}showAtMarker(e,t,i){this._container.classList.remove("stale"),this._message.update(e),this._severity=e.severity,this._applyTheme(this._themeService.getColorTheme());let o=r.e.lift(e);const n=this.editor.getPosition();let s=n&&o.containsPosition(n)?n:o.getStartPosition();super.show(s,this.computeRequiredHeight());const a=this.editor.getModel();if(a){const e=i>1?T.N("problems","{0} of {1} problems",t,i):T.N("change","{0} of {1} problem",t,i);this.setTitle((0,ue.EZ)(a.uri),e)}this._icon.className="codicon "+wi.j.className(hi.ZL.toSeverity(this._severity)),this.editor.revealPositionNearTop(s,0),this.editor.focus()}updateMarker(e){this._container.classList.remove("stale"),this._message.update(e)}showStale(){this._container.classList.add("stale"),this._relayout()}_doLayoutBody(e,t){super._doLayoutBody(e,t),this._heightInPixel=e,this._message.layout(e,t),this._container.style.height=e+"px"}_onWidth(e){this._message.layout(this._heightInPixel,e)}_relayout(){super._relayout(this.computeRequiredHeight())}computeRequiredHeight(){return 3+this._message.getHeightInLines()}};ki.TitleMenu=new dt.eH("gotoErrorTitleMenu"),ki=yi([bi(1,Y.XE),bi(2,Ci.v4),bi(3,dt.co),bi(4,F.TG),bi(5,A.i6),bi(6,Ne.e)],ki);let xi=(0,H.kwl)(H.lXJ,H.b6y),Mi=(0,H.kwl)(H.uoC,H.pW3),Di=(0,H.kwl)(H.c63,H.T83);const Ii=(0,H.P6G)("editorMarkerNavigationError.background",{dark:xi,light:xi,hc:H.lRK},T.N("editorMarkerNavigationError","Editor marker navigation widget error color.")),Ni=(0,H.P6G)("editorMarkerNavigationError.headerBackground",{dark:(0,H.ZnX)(Ii,.1),light:(0,H.ZnX)(Ii,.1),hc:null},T.N("editorMarkerNavigationErrorHeaderBackground","Editor marker navigation widget error heading background.")),Ri=(0,H.P6G)("editorMarkerNavigationWarning.background",{dark:Mi,light:Mi,hc:H.lRK},T.N("editorMarkerNavigationWarning","Editor marker navigation widget warning color.")),Pi=(0,H.P6G)("editorMarkerNavigationWarning.headerBackground",{dark:(0,H.ZnX)(Ri,.1),light:(0,H.ZnX)(Ri,.1),hc:"#0C141F"},T.N("editorMarkerNavigationWarningBackground","Editor marker navigation widget warning heading background.")),Li=(0,H.P6G)("editorMarkerNavigationInfo.background",{dark:Di,light:Di,hc:H.lRK},T.N("editorMarkerNavigationInfo","Editor marker navigation widget info color.")),Ei=(0,H.P6G)("editorMarkerNavigationInfo.headerBackground",{dark:(0,H.ZnX)(Li,.1),light:(0,H.ZnX)(Li,.1),hc:null},T.N("editorMarkerNavigationInfoHeaderBackground","Editor marker navigation widget info heading background.")),Ti=(0,H.P6G)("editorMarkerNavigation.background",{dark:H.cvW,light:H.cvW,hc:H.cvW},T.N("editorMarkerNavigationBackground","Editor marker navigation widget background."));var Oi=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},Ai=function(e,t){return function(i,o){t(i,o,e)}},Wi=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function a(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};let Fi=class e{constructor(e,t,i,o,s){this._markerNavigationService=t,this._contextKeyService=i,this._editorService=o,this._instantiationService=s,this._sessionDispoables=new n.SL,this._editor=e,this._widgetVisible=Bi.bindTo(this._contextKeyService)}static get(t){return t.getContribution(e.ID)}dispose(){this._cleanUp(),this._sessionDispoables.dispose()}_cleanUp(){this._widgetVisible.reset(),this._sessionDispoables.clear(),this._widget=void 0,this._model=void 0}_getOrCreateModel(e){if(this._model&&this._model.matches(e))return this._model;let t=!1;return this._model&&(t=!0,this._cleanUp()),this._model=this._markerNavigationService.getMarkerList(e),t&&this._model.move(!0,this._editor.getModel(),this._editor.getPosition()),this._widget=this._instantiationService.createInstance(ki,this._editor),this._widget.onDidClose(()=>this.close(),this,this._sessionDispoables),this._widgetVisible.set(!0),this._sessionDispoables.add(this._model),this._sessionDispoables.add(this._widget),this._sessionDispoables.add(this._editor.onDidChangeCursorPosition(e=>{var t,i,o;(null===(t=this._model)||void 0===t?void 0:t.selected)&&r.e.containsPosition(null===(i=this._model)||void 0===i?void 0:i.selected.marker,e.position)||null===(o=this._model)||void 0===o||o.resetIndex()})),this._sessionDispoables.add(this._model.onDidChange(()=>{if(!this._widget||!this._widget.position||!this._model)return;const e=this._model.find(this._editor.getModel().uri,this._widget.position);e?this._widget.updateMarker(e.marker):this._widget.showStale()})),this._sessionDispoables.add(this._widget.onDidSelectRelatedInformation(e=>{this._editorService.openCodeEditor({resource:e.resource,options:{pinned:!0,revealIfOpened:!0,selection:r.e.lift(e).collapseToStart()}},this._editor),this.close(!1)})),this._sessionDispoables.add(this._editor.onDidChangeModel(()=>this._cleanUp())),this._model}close(e=!0){this._cleanUp(),e&&this._editor.focus()}showAtMarker(e){if(this._editor.hasModel()){const t=this._getOrCreateModel(this._editor.getModel().uri);t.resetIndex(),t.move(!0,this._editor.getModel(),new p.L(e.startLineNumber,e.startColumn)),t.selected&&this._widget.showAtMarker(t.selected.marker,t.selected.index,t.selected.total)}}nagivate(t,i){return Wi(this,void 0,void 0,(function*(){if(this._editor.hasModel()){const o=this._getOrCreateModel(i?void 0:this._editor.getModel().uri);if(o.move(t,this._editor.getModel(),this._editor.getPosition()),!o.selected)return;if(o.selected.marker.resource.toString()!==this._editor.getModel().uri.toString()){this._cleanUp();const n=yield this._editorService.openCodeEditor({resource:o.selected.marker.resource,options:{pinned:!1,revealIfOpened:!0,selectionRevealType:2,selection:o.selected.marker}},this._editor);n&&(e.get(n).close(),e.get(n).nagivate(t,i))}else this._widget.showAtMarker(o.selected.marker,o.selected.index,o.selected.total)}}))}};Fi.ID="editor.contrib.markerController",Fi=Oi([Ai(1,mi),Ai(2,A.i6),Ai(3,P.$),Ai(4,F.TG)],Fi);class Hi extends s.R6{constructor(e,t,i){super(i),this._next=e,this._multiFile=t}run(e,t){return Wi(this,void 0,void 0,(function*(){t.hasModel()&&Fi.get(t).nagivate(this._next,this._multiFile)}))}}class Vi extends Hi{constructor(){super(!0,!1,{id:Vi.ID,label:Vi.LABEL,alias:"Go to Next Problem (Error, Warning, Info)",precondition:void 0,kbOpts:{kbExpr:a.u.focus,primary:578,weight:100},menuOpts:{menuId:ki.TitleMenu,title:Vi.LABEL,icon:(0,_i.q5)("marker-navigation-next",I.lA.arrowDown,T.N("nextMarkerIcon","Icon for goto next marker.")),group:"navigation",order:1}})}}Vi.ID="editor.action.marker.next",Vi.LABEL=T.N("markerAction.next.label","Go to Next Problem (Error, Warning, Info)");class Ki extends Hi{constructor(){super(!1,!1,{id:Ki.ID,label:Ki.LABEL,alias:"Go to Previous Problem (Error, Warning, Info)",precondition:void 0,kbOpts:{kbExpr:a.u.focus,primary:1602,weight:100},menuOpts:{menuId:ki.TitleMenu,title:Vi.LABEL,icon:(0,_i.q5)("marker-navigation-previous",I.lA.arrowUp,T.N("previousMarkerIcon","Icon for goto previous marker.")),group:"navigation",order:2}})}}Ki.ID="editor.action.marker.prev",Ki.LABEL=T.N("markerAction.previous.label","Go to Previous Problem (Error, Warning, Info)");(0,s._K)(Fi.ID,Fi),(0,s.Qr)(Vi),(0,s.Qr)(Ki),(0,s.Qr)(class extends Hi{constructor(){super(!0,!0,{id:"editor.action.marker.nextInFiles",label:T.N("markerAction.nextInFiles.label","Go to Next Problem in Files (Error, Warning, Info)"),alias:"Go to Next Problem in Files (Error, Warning, Info)",precondition:void 0,kbOpts:{kbExpr:a.u.focus,primary:66,weight:100},menuOpts:{menuId:dt.eH.MenubarGoMenu,title:T.N({key:"miGotoNextProblem",comment:["&& denotes a mnemonic"]},"Next &&Problem"),group:"6_problem_nav",order:1}})}}),(0,s.Qr)(class extends Hi{constructor(){super(!1,!0,{id:"editor.action.marker.prevInFiles",label:T.N("markerAction.previousInFiles.label","Go to Previous Problem in Files (Error, Warning, Info)"),alias:"Go to Previous Problem in Files (Error, Warning, Info)",precondition:void 0,kbOpts:{kbExpr:a.u.focus,primary:1090,weight:100},menuOpts:{menuId:dt.eH.MenubarGoMenu,title:T.N({key:"miGotoPreviousProblem",comment:["&& denotes a mnemonic"]},"Previous &&Problem"),group:"6_problem_nav",order:2}})}});const Bi=new A.uy("markersNavigationVisible",!1),Gi=s._l.bindToContribution(Fi.get);(0,s.fK)(new Gi({id:"closeMarkersNavigation",precondition:Bi,handler:e=>e.close(),kbOpts:{weight:150,kbExpr:a.u.focus,primary:9,secondary:[1033]}}));var $i=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},Ui=function(e,t){return function(i,o){t(i,o,e)}};const ji=x.$;class Zi{constructor(e,t,i){this.owner=e,this.range=t,this.marker=i}isValidForHoverAnchor(e){return 1===e.type&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}}const zi={type:1,filter:{include:di.yN.QuickFix}};let qi=class{constructor(e,t,i,o){this._editor=e,this._hover=t,this._markerDecorationsService=i,this._openerService=o,this.recentMarkerCodeActionsInfo=void 0}computeSync(e,t){if(!this._editor.hasModel()||1!==e.type)return[];const i=this._editor.getModel(),o=e.range.startLineNumber,n=i.getLineMaxColumn(o),s=[];for(const a of t){const t=a.range.startLineNumber===o?a.range.startColumn:1,d=a.range.endLineNumber===o?a.range.endColumn:n,l=this._markerDecorationsService.getMarker(i.uri,a);if(!l)continue;const h=new r.e(e.range.startLineNumber,t,e.range.startLineNumber,d);s.push(new Zi(this,h,l))}return s}renderHoverParts(e,t,i){if(!e.length)return n.JT.None;const o=new n.SL;e.forEach(e=>t.appendChild(this.renderMarkerHover(e,o)));const s=1===e.length?e[0]:e.sort((e,t)=>hi.ZL.compare(e.marker.severity,t.marker.severity))[0];return this.renderMarkerStatusbar(s,i,o),o}renderMarkerHover(e,t){const i=ji("div.hover-row"),o=x.R3(i,ji("div.marker.hover-contents")),{source:n,message:s,code:r,relatedInformation:a}=e.marker;this._editor.applyFontInfo(o);const d=x.R3(o,ji("span"));if(d.style.whiteSpace="pre-wrap",d.innerText=s,n||r)if(r&&"string"!=typeof r){const e=ji("span");if(n){x.R3(e,ji("span")).innerText=n}const i=x.R3(e,ji("a.code-link"));i.setAttribute("href",r.target.toString()),t.add(x.nm(i,"click",e=>{this._openerService.open(r.target,{allowCommands:!0}),e.preventDefault(),e.stopPropagation()}));x.R3(i,ji("span")).innerText=r.value;const s=x.R3(o,e);s.style.opacity="0.6",s.style.paddingLeft="6px"}else{const e=x.R3(o,ji("span"));e.style.opacity="0.6",e.style.paddingLeft="6px",e.innerText=n&&r?`${n}(${r})`:n||`(${r})`}if((0,Gt.Of)(a))for(const{message:e,resource:i,startLineNumber:n,startColumn:s}of a){const r=x.R3(o,ji("div"));r.style.marginTop="8px";const a=x.R3(r,ji("a"));a.innerText=`${(0,ue.EZ)(i)}(${n}, ${s}): `,a.style.cursor="pointer",t.add(x.nm(a,"click",e=>{e.stopPropagation(),e.preventDefault(),this._openerService&&this._openerService.open(i,{fromUserGesture:!0,editorOptions:{selection:{startLineNumber:n,startColumn:s}}}).catch(h.dL)}));const d=x.R3(r,ji("span"));d.innerText=e,this._editor.applyFontInfo(d)}return i}renderMarkerStatusbar(e,t,i){if(e.marker.severity!==hi.ZL.Error&&e.marker.severity!==hi.ZL.Warning&&e.marker.severity!==hi.ZL.Info||t.addAction({label:T.N("view problem","View Problem"),commandId:Vi.ID,run:()=>{this._hover.hide(),Fi.get(this._editor).showAtMarker(e.marker),this._editor.focus()}}),!this._editor.getOption(80)){const o=t.append(ji("div"));this.recentMarkerCodeActionsInfo&&(hi.H0.makeKey(this.recentMarkerCodeActionsInfo.marker)===hi.H0.makeKey(e.marker)?this.recentMarkerCodeActionsInfo.hasCodeActions||(o.textContent=T.N("noQuickFixes","No quick fixes available")):this.recentMarkerCodeActionsInfo=void 0);const s=this.recentMarkerCodeActionsInfo&&!this.recentMarkerCodeActionsInfo.hasCodeActions?n.JT.None:i.add((0,l.Vg)(()=>o.textContent=T.N("checkingForQuickFixes","Checking for quick fixes..."),200));o.textContent||(o.textContent=String.fromCharCode(160));const r=this.getCodeActions(e.marker);i.add((0,n.OF)(()=>r.cancel())),r.then(r=>{if(s.dispose(),this.recentMarkerCodeActionsInfo={marker:e.marker,hasCodeActions:r.validActions.length>0},!this.recentMarkerCodeActionsInfo.hasCodeActions)return r.dispose(),void(o.textContent=T.N("noQuickFixes","No quick fixes available"));o.style.display="none";let a=!1;i.add((0,n.OF)(()=>{a||r.dispose()})),t.addAction({label:T.N("quick fixes","Quick Fix..."),commandId:ai.E7.Id,run:e=>{a=!0;const t=ai.pY.get(this._editor),i=x.i(e);this._hover.hide(),t.showCodeActions(zi,r,{x:i.left+6,y:i.top+i.height+6})}})},h.dL)}}getCodeActions(e){return(0,l.PG)(t=>(0,ri.aI)(this._editor.getModel(),new r.e(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn),zi,lt.Ex.None,t))}};qi=$i([Ui(2,si.i),Ui(3,Ci.v4)],qi),(0,Y.Ic)((e,t)=>{const i=e.getColor(H.url);i&&t.addRule(`.monaco-hover .hover-contents a.code-link span { color: ${i}; }`);const o=e.getColor(H.sgC);o&&t.addRule(`.monaco-hover .hover-contents a.code-link span:hover { color: ${o}; }`)});var Qi=i(88527),Xi=i(47707);var Ji=i(71513),Yi=i(69386);class eo{constructor(e,t,i=0){this.lineNumber=e,this.parts=t,this.additionalReservedLineCount=i}renderForScreenReader(e){if(0===this.parts.length)return"";const t=this.parts[this.parts.length-1];return function(e,t){const i=new to(e),o=t.map(e=>{const t=r.e.lift(e.range);return{startOffset:i.getOffset(t.getStartPosition()),endOffset:i.getOffset(t.getEndPosition()),text:e.text}});o.sort((e,t)=>t.startOffset-e.startOffset);for(const t of o)e=e.substring(0,t.startOffset)+t.text+e.substring(t.endOffset);return e}(e.substr(0,t.column-1),this.parts.map(e=>({range:{startLineNumber:1,endLineNumber:1,startColumn:e.column,endColumn:e.column},text:e.lines.join("\n")}))).substring(this.parts[0].column-1)}}class to{constructor(e){this.lineStartOffsetByLineIdx=[],this.lineStartOffsetByLineIdx.push(0);for(let t=0;t<e.length;t++)"\n"===e.charAt(t)&&this.lineStartOffsetByLineIdx.push(t+1)}getOffset(e){return this.lineStartOffsetByLineIdx[e.lineNumber-1]+e.column-1}}class io{constructor(e,t,i){this.column=e,this.lines=t,this.preview=i}}class oo extends n.JT{constructor(e){super(),this.editor=e,this._expanded=void 0,this.onDidChangeEmitter=new _.Q5,this.onDidChange=this.onDidChangeEmitter.event,this._register(e.onDidChangeConfiguration(e=>{e.hasChanged(105)&&void 0===this._expanded&&this.onDidChangeEmitter.fire()}))}setExpanded(e){this._expanded=!0,this.onDidChangeEmitter.fire()}}var no=i(2484);function so(e,t,i,o,n=0){if(e.range.startLineNumber!==e.range.endLineNumber)return;const s=t.getLineContent(e.range.startLineNumber),a=ge.V8(s).length;if(e.range.startColumn-1<=a){const t=ge.V8(e.text).length,i=s.substring(e.range.startColumn-1,a),o=r.e.fromPositions(e.range.getStartPosition().delta(0,i.length),e.range.getEndPosition()),n=e.text.startsWith(i)?e.text.substring(i.length):e.text.substring(t);e={range:o,text:n,command:e.command}}const d=t.getValueInRange(e.range),l=function(e,t){if((null==ro?void 0:ro.originalValue)===e&&(null==ro?void 0:ro.newValue)===t)return null==ro?void 0:ro.changes;{const i=function(e,t){if(e.length>5e3||t.length>5e3)return;function i(e){let t=0;for(let i=0,o=e.length;i<o;i++){const o=e.charCodeAt(i);o>t&&(t=o)}return t}const o=Math.max(i(e),i(t));function n(e){if(e<0)throw new Error("unexpected");return o+e+1}function s(e){let t=0,i=0;const o=new Int32Array(e.length);for(let s=0,r=e.length;s<r;s++){const r=100*i+t;"("===e[s]?(o[s]=n(2*r),t++):")"===e[s]?(o[s]=n(2*r+1),1===t&&i++,t=Math.max(t-1,0)):o[s]=e.charCodeAt(s)}return o}const r=s(e),a=s(t);return new no.Hs({getElements:()=>r},{getElements:()=>a}).ComputeDiff(!1).changes}(e,t);return ro={originalValue:e,newValue:t,changes:i},i}}(d,e.text);if(!l)return;const h=e.range.startLineNumber,c=new Array;if("prefix"===i){const e=l.filter(e=>0===e.originalLength);if(e.length>1||1===e.length&&e[0].originalStart!==d.length)return}const u=e.text.length-n;for(const t of l){const n=e.range.startColumn+t.originalStart+t.originalLength;if("subwordSmart"===i&&o&&o.lineNumber===e.range.startLineNumber&&n<o.column)return;if(t.originalLength>0)return;if(0===t.modifiedLength)continue;const s=t.modifiedStart+t.modifiedLength,r=Math.max(t.modifiedStart,Math.min(s,u)),a=e.text.substring(t.modifiedStart,r),d=e.text.substring(r,Math.max(t.modifiedStart,s));if(a.length>0){const e=ge.uq(a);c.push(new io(n,e,!1))}if(d.length>0){const e=ge.uq(d);c.push(new io(n,e,!0))}}return new eo(h,c,0)}let ro=void 0;var ao=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},lo=function(e,t){return function(i,o){t(i,o,e)}},ho=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function a(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};let co=class extends n.JT{constructor(e,t,i){super(),this.editor=e,this.cache=t,this.commandService=i,this.onDidChangeEmitter=new _.Q5,this.onDidChange=this.onDidChangeEmitter.event,this.completionSession=this._register(new n.XK),this.active=!1,this.disposed=!1,this._register(i.onDidExecuteCommand(t=>{new Set([Ji.wk.Tab.id,Ji.wk.DeleteLeft.id,Ji.wk.DeleteRight.id,"editor.action.inlineSuggest.commit","acceptSelectedSuggestion"]).has(t.commandId)&&e.hasTextFocus()&&this.handleUserInput()})),this._register(this.editor.onDidType(e=>{this.handleUserInput()})),this._register(this.editor.onDidChangeCursorPosition(e=>{this.session&&!this.session.isValid&&this.hide()})),this._register((0,n.OF)(()=>{this.disposed=!0})),this._register(this.editor.onDidBlurEditorWidget(()=>{this.hide()}))}handleUserInput(){this.session&&!this.session.isValid&&this.hide(),setTimeout(()=>{this.disposed||this.startSessionIfTriggered()},0)}get session(){return this.completionSession.value}get ghostText(){var e;return null===(e=this.session)||void 0===e?void 0:e.ghostText}get minReservedLineCount(){return this.session?this.session.minReservedLineCount:0}setExpanded(e){var t;null===(t=this.session)||void 0===t||t.setExpanded(e)}setActive(e){var t;this.active=e,e&&(null===(t=this.session)||void 0===t||t.scheduleAutomaticUpdate())}startSessionIfTriggered(){this.editor.getOption(54).enabled&&(this.session&&this.session.isValid||this.trigger(m.bw.Automatic))}trigger(e){this.completionSession.value?e===m.bw.Explicit&&this.completionSession.value.ensureUpdateWithExplicitContext():(this.completionSession.value=new uo(this.editor,this.editor.getPosition(),()=>this.active,this.commandService,this.cache,e),this.completionSession.value.takeOwnership(this.completionSession.value.onDidChange(()=>{this.onDidChangeEmitter.fire()})))}hide(){this.completionSession.clear(),this.onDidChangeEmitter.fire()}commitCurrentSuggestion(){var e;null===(e=this.session)||void 0===e||e.commitCurrentCompletion()}showNext(){var e;null===(e=this.session)||void 0===e||e.showNextInlineCompletion()}showPrevious(){var e;null===(e=this.session)||void 0===e||e.showPreviousInlineCompletion()}hasMultipleInlineCompletions(){var e;return ho(this,void 0,void 0,(function*(){const t=yield null===(e=this.session)||void 0===e?void 0:e.hasMultipleInlineCompletions();return void 0!==t&&t}))}};co=ao([lo(2,ne.Hy)],co);class uo extends oo{constructor(e,t,i,o,s,r){super(e),this.triggerPosition=t,this.shouldUpdate=i,this.commandService=o,this.cache=s,this.initialTriggerKind=r,this.minReservedLineCount=0,this.updateOperation=this._register(new n.XK),this.updateSoon=this._register(new l.pY(()=>{let e=this.initialTriggerKind;return this.initialTriggerKind=m.bw.Automatic,this.update(e)},50)),this.currentlySelectedCompletionId=void 0;let a=void 0;this._register(this.onDidChange(()=>{const e=this.currentCompletion;if(e&&e.sourceInlineCompletion!==a){a=e.sourceInlineCompletion;const t=e.sourceProvider;t.handleItemDidShow&&t.handleItemDidShow(e.sourceInlineCompletions,a)}})),this._register((0,n.OF)(()=>{this.cache.clear()})),this._register(this.editor.onDidChangeCursorPosition(e=>{this.cache.value&&this.onDidChangeEmitter.fire()})),this._register(this.editor.onDidChangeModelContent(e=>{this.scheduleAutomaticUpdate()})),this._register(m.zu.onDidChange(()=>{this.updateSoon.schedule()})),this.scheduleAutomaticUpdate()}fixAndGetIndexOfCurrentSelection(){if(!this.currentlySelectedCompletionId||!this.cache.value)return 0;if(0===this.cache.value.completions.length)return 0;const e=this.cache.value.completions.findIndex(e=>e.semanticId===this.currentlySelectedCompletionId);return-1===e?(this.currentlySelectedCompletionId=void 0,0):e}get currentCachedCompletion(){if(this.cache.value)return this.cache.value.completions[this.fixAndGetIndexOfCurrentSelection()]}showNextInlineCompletion(){var e;return ho(this,void 0,void 0,(function*(){yield this.ensureUpdateWithExplicitContext();const t=(null===(e=this.cache.value)||void 0===e?void 0:e.completions)||[];if(t.length>0){const e=(this.fixAndGetIndexOfCurrentSelection()+1)%t.length;this.currentlySelectedCompletionId=t[e].semanticId}else this.currentlySelectedCompletionId=void 0;this.onDidChangeEmitter.fire()}))}showPreviousInlineCompletion(){var e;return ho(this,void 0,void 0,(function*(){yield this.ensureUpdateWithExplicitContext();const t=(null===(e=this.cache.value)||void 0===e?void 0:e.completions)||[];if(t.length>0){const e=(this.fixAndGetIndexOfCurrentSelection()+t.length-1)%t.length;this.currentlySelectedCompletionId=t[e].semanticId}else this.currentlySelectedCompletionId=void 0;this.onDidChangeEmitter.fire()}))}ensureUpdateWithExplicitContext(){var e;return ho(this,void 0,void 0,(function*(){this.updateOperation.value?this.updateOperation.value.triggerKind===m.bw.Explicit?yield this.updateOperation.value.promise:yield this.update(m.bw.Explicit):(null===(e=this.cache.value)||void 0===e?void 0:e.triggerKind)!==m.bw.Explicit&&(yield this.update(m.bw.Explicit))}))}hasMultipleInlineCompletions(){var e;return ho(this,void 0,void 0,(function*(){return yield this.ensureUpdateWithExplicitContext(),((null===(e=this.cache.value)||void 0===e?void 0:e.completions.length)||0)>1}))}get ghostText(){const e=this.currentCompletion,t=this.editor.getOptions().get(54).mode;return e?so(e,this.editor.getModel(),t,this.editor.getPosition()):void 0}get currentCompletion(){const e=this.currentCachedCompletion;if(e)return e.toLiveInlineCompletion()}get isValid(){return this.editor.getPosition().lineNumber===this.triggerPosition.lineNumber}scheduleAutomaticUpdate(){this.updateOperation.clear(),this.updateSoon.schedule()}update(e){return ho(this,void 0,void 0,(function*(){if(!this.shouldUpdate())return;const t=this.editor.getPosition(),i=(0,l.PG)(i=>ho(this,void 0,void 0,(function*(){let o;try{o=yield fo(t,this.editor.getModel(),{triggerKind:e,selectedSuggestionInfo:void 0},i)}catch(e){return void(0,h.dL)(e)}i.isCancellationRequested||(this.cache.setValue(this.editor,o,e),this.onDidChangeEmitter.fire())}))),o=new go(i,e);this.updateOperation.value=o,yield i,this.updateOperation.value===o&&this.updateOperation.clear()}))}takeOwnership(e){this._register(e)}commitCurrentCompletion(){if(!this.ghostText)return;const e=this.currentCompletion;e&&this.commit(e)}commit(e){const t=this.cache.clearAndLeak();this.editor.executeEdits("inlineSuggestion.accept",[Yi.h.replaceMove(e.range,e.text)]),e.command?this.commandService.executeCommand(e.command.id,...e.command.arguments||[]).finally(()=>{null==t||t.dispose()}).then(void 0,h.Cp):null==t||t.dispose(),this.onDidChangeEmitter.fire()}}class go{constructor(e,t){this.promise=e,this.triggerKind=t}dispose(){this.promise.cancel()}}class po extends n.JT{constructor(e,t,i,o){super(),this.triggerKind=o;const s=e.deltaDecorations([],t.items.map(e=>({range:e.range,options:{description:"inline-completion-tracking-range"}})));this._register((0,n.OF)(()=>{e.deltaDecorations(s,[])})),this.completions=t.items.map((e,t)=>new mo(e,s[t])),this._register(e.onDidChangeModelContent(()=>{let t=!1;const o=e.getModel();for(const e of this.completions){const i=o.getDecorationRange(e.decorationId);i?e.synchronizedRange.equalsRange(i)||(t=!0,e.synchronizedRange=i):(0,h.dL)(new Error("Decoration has no range"))}t&&i()})),this._register(t)}}class mo{constructor(e,t){this.inlineCompletion=e,this.decorationId=t,this.semanticId=JSON.stringify({text:this.inlineCompletion.text,startLine:this.inlineCompletion.range.startLineNumber,startColumn:this.inlineCompletion.range.startColumn,command:this.inlineCompletion.command}),this.synchronizedRange=e.range}toLiveInlineCompletion(){return{text:this.inlineCompletion.text,range:this.synchronizedRange,command:this.inlineCompletion.command,sourceProvider:this.inlineCompletion.sourceProvider,sourceInlineCompletions:this.inlineCompletion.sourceInlineCompletions,sourceInlineCompletion:this.inlineCompletion.sourceInlineCompletion}}}function fo(e,t,i,o=ht.T.None){return ho(this,void 0,void 0,(function*(){const n=function(e,t){const i=t.getWordAtPosition(e),o=t.getLineMaxColumn(e.lineNumber);return i?new r.e(e.lineNumber,i.startColumn,e.lineNumber,o):r.e.fromPositions(e,e.with(void 0,o))}(e,t),s=m.zu.all(t),a=yield Promise.all(s.map(n=>ho(this,void 0,void 0,(function*(){const s=yield n.provideInlineCompletions(t,e,i,o);return{completions:s,provider:n,dispose:()=>{s&&n.freeInlineCompletions(s)}}})))),d=new Map;for(const e of a){const t=e.completions;if(t)for(const i of t.items.map(i=>({text:i.text,range:i.range?r.e.lift(i.range):n,command:i.command,sourceProvider:e.provider,sourceInlineCompletions:t,sourceInlineCompletion:i})))i.range.startLineNumber===i.range.endLineNumber&&d.set(JSON.stringify({text:i.text,range:i.range}),i)}return{items:[...d.values()],dispose:()=>{for(const e of a)e.dispose()}}}))}function _o(e,t){if(!t)return t;const i=e.getValueInRange(t.range),o=(0,ge.Mh)(i,t.text),n=e.getOffsetAt(t.range.getStartPosition())+o,s=e.getPositionAt(n),a=i.substr(o),d=(0,ge.P1)(a,t.text),l=e.getPositionAt(Math.max(n,e.getOffsetAt(t.range.getEndPosition())-d));return{range:r.e.fromPositions(s,l),text:t.text.substr(o,t.text.length-o-d)}}var vo=i(63472),Co=i(22470),wo=i(94791);class yo extends n.JT{constructor(e,t){super(),this.editor=e,this.suggestControllerPreselector=t,this.isSuggestWidgetVisible=!1,this.isShiftKeyPressed=!1,this._isActive=!1,this._currentSuggestItemInfo=void 0,this.onDidChangeEmitter=new _.Q5,this.onDidChange=this.onDidChangeEmitter.event,this.setInactiveDelayed=this._register(new l.pY(()=>{this.isSuggestWidgetVisible||this._isActive&&(this._isActive=!1,this.onDidChangeEmitter.fire())},100)),this._register(e.onKeyDown(e=>{e.shiftKey&&!this.isShiftKeyPressed&&(this.isShiftKeyPressed=!0,this.update(this._isActive))})),this._register(e.onKeyUp(e=>{e.shiftKey&&this.isShiftKeyPressed&&(this.isShiftKeyPressed=!1,this.update(this._isActive))}));const i=wo.n.get(this.editor);if(i){this._register(i.registerSelector({priority:100,select:(e,t,o)=>{const n=this.editor.getModel(),s=_o(n,this.suggestControllerPreselector());if(!s)return-1;const r=p.L.lift(t),a=function(e,t){let i=void 0;for(const o of e)(void 0===i||t(o,i)>0)&&(i=o);return i}(o.map((e,t)=>{const o=bo(i,r,e,this.isShiftKeyPressed),a=_o(n,null==o?void 0:o.normalizedInlineCompletion);if(!a)return;var d,l;return{index:t,valid:(d=s.range,(l=a.range).startLineNumber===d.startLineNumber&&l.startColumn===d.startColumn&&(l.endLineNumber<d.endLineNumber||l.endLineNumber===d.endLineNumber&&l.endColumn<=d.endColumn)&&s.text.startsWith(a.text)),prefixLength:a.text.length,suggestItem:e}}).filter(e=>e&&e.valid),(d=e=>e.prefixLength,l=(e,t)=>e-t,(e,t)=>l(d(e),d(t))));var d,l;return a?a.index:-1}}));let e=!1;const t=()=>{e||(e=!0,this._register(i.widget.value.onDidShow(()=>{this.isSuggestWidgetVisible=!0,this.update(!0)})),this._register(i.widget.value.onDidHide(()=>{this.isSuggestWidgetVisible=!1,this.setInactiveDelayed.schedule(),this.update(this._isActive)})),this._register(i.widget.value.onDidFocus(()=>{this.isSuggestWidgetVisible=!0,this.update(!0)})))};this._register(_.ju.once(i.model.onDidTrigger)(e=>{t()}))}this.update(this._isActive)}get state(){if(this._isActive)return{selectedItem:this._currentSuggestItemInfo}}update(e){const t=this.getSuggestItemInfo();let i=!1;(function(e,t){if(e===t)return!0;if(!e||!t)return!1;return e.completionItemKind===t.completionItemKind&&e.isSnippetText===t.isSnippetText&&function(e,t){return e===t||!(!e||!t)&&(e.range.equalsRange(t.range)&&e.text===t.text&&e.command===t.command)}(e.normalizedInlineCompletion,t.normalizedInlineCompletion)})(this._currentSuggestItemInfo,t)||(this._currentSuggestItemInfo=t,i=!0),this._isActive!==e&&(this._isActive=e,i=!0),i&&this.onDidChangeEmitter.fire()}getSuggestItemInfo(){const e=wo.n.get(this.editor);if(!e)return;if(!this.isSuggestWidgetVisible)return;const t=e.widget.value.getFocusedItem();return t?bo(e,this.editor.getPosition(),t.item,this.isShiftKeyPressed):void 0}stopForceRenderingAbove(){const e=wo.n.get(this.editor);e&&e.stopForceRenderingAbove()}forceRenderingAbove(){const e=wo.n.get(this.editor);e&&e.forceRenderingAbove()}}function bo(e,t,i,o){if(Array.isArray(i.completion.additionalTextEdits)&&i.completion.additionalTextEdits.length>0)return{completionItemKind:i.completion.kind,isSnippetText:!1,normalizedInlineCompletion:{range:r.e.fromPositions(t,t),text:""}};let{insertText:n}=i.completion,s=!1;if(4&i.completion.insertTextRules){const i=(new vo.Yj).parse(n),o=e.editor.getModel();if(i.children.length>100)return;Co.l.adjustWhitespace(o,t,i,!0,!0),n=i.toString(),s=!0}const a=e.getOverwriteInfo(i,o);return{isSnippetText:s,completionItemKind:i.completion.kind,normalizedInlineCompletion:{text:n,range:r.e.fromPositions(t.delta(0,-a.overwriteBefore),t.delta(0,Math.max(a.overwriteAfter,0)))}}}var So=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function a(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};class ko extends oo{constructor(e,t){super(e),this.cache=t,this.suggestionInlineCompletionSource=this._register(new yo(this.editor,()=>{var e,t;return null===(t=null===(e=this.cache.value)||void 0===e?void 0:e.completions[0])||void 0===t?void 0:t.toLiveInlineCompletion()})),this.updateOperation=this._register(new n.XK),this.updateCacheSoon=this._register(new l.pY(()=>this.updateCache(),50)),this.minReservedLineCount=0,this._register(this.suggestionInlineCompletionSource.onDidChange(()=>{this.updateCacheSoon.schedule();this.suggestionInlineCompletionSource.state||(this.minReservedLineCount=0);const e=this.ghostText;e&&(this.minReservedLineCount=Math.max(this.minReservedLineCount,e.parts.map(e=>e.lines.length-1).reduce((e,t)=>e+t,0))),this.minReservedLineCount>=1?this.suggestionInlineCompletionSource.forceRenderingAbove():this.suggestionInlineCompletionSource.stopForceRenderingAbove(),this.onDidChangeEmitter.fire()})),this._register(this.cache.onDidChange(()=>{this.onDidChangeEmitter.fire()})),this._register(this.editor.onDidChangeCursorPosition(e=>{this.minReservedLineCount=0,this.updateCacheSoon.schedule(),this.onDidChangeEmitter.fire()})),this._register((0,n.OF)(()=>this.suggestionInlineCompletionSource.stopForceRenderingAbove()))}get isActive(){return void 0!==this.suggestionInlineCompletionSource.state}isSuggestionPreviewEnabled(){return this.editor.getOption(105).preview}updateCache(){return So(this,void 0,void 0,(function*(){const e=this.suggestionInlineCompletionSource.state;if(!e||!e.selectedItem)return;const t={text:e.selectedItem.normalizedInlineCompletion.text,range:e.selectedItem.normalizedInlineCompletion.range,isSnippetText:e.selectedItem.isSnippetText,completionKind:e.selectedItem.completionItemKind},i=this.editor.getPosition(),o=(0,l.PG)(e=>So(this,void 0,void 0,(function*(){let o;try{o=yield fo(i,this.editor.getModel(),{triggerKind:m.bw.Automatic,selectedSuggestionInfo:t},e)}catch(e){return void(0,h.dL)(e)}e.isCancellationRequested||(this.cache.setValue(this.editor,o,m.bw.Automatic),this.onDidChangeEmitter.fire())}))),n=new go(o,m.bw.Automatic);this.updateOperation.value=n,yield o,this.updateOperation.value===n&&this.updateOperation.clear()}))}get ghostText(){var e,t,i;const o=this.isSuggestionPreviewEnabled(),n=_o(this.editor.getModel(),null===(t=null===(e=this.cache.value)||void 0===e?void 0:e.completions[0])||void 0===t?void 0:t.toLiveInlineCompletion()),s=this.suggestionInlineCompletionSource.state,r=_o(this.editor.getModel(),null===(i=null==s?void 0:s.selectedItem)||void 0===i?void 0:i.normalizedInlineCompletion),a=n&&r&&n.text.startsWith(r.text)&&n.range.equalsRange(r.range);if(!o&&!a)return;const d=a?n:r||n,l=a?d.text.length-r.text.length:0;return this.toGhostText(d,l)}toGhostText(e,t){const i=this.editor.getOptions().get(105).previewMode;return e?so(e,this.editor.getModel(),i,this.editor.getPosition(),t)||new eo(e.range.endLineNumber,[],this.minReservedLineCount):void 0}}var xo=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},Mo=function(e,t){return function(i,o){t(i,o,e)}},Do=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function a(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};class Io extends n.JT{constructor(){super(...arguments),this.onDidChangeEmitter=new _.Q5,this.onDidChange=this.onDidChangeEmitter.event,this.hasCachedGhostText=!1,this.currentModelRef=this._register(new n.XK)}get targetModel(){var e;return null===(e=this.currentModelRef.value)||void 0===e?void 0:e.object}setTargetModel(e){var t,i,o;(null===(t=this.currentModelRef.value)||void 0===t?void 0:t.object)!==e&&(this.currentModelRef.clear(),this.currentModelRef.value=e?(i=e,o=e.onDidChange(()=>{this.hasCachedGhostText=!1,this.onDidChangeEmitter.fire()}),{object:i,dispose:()=>null==o?void 0:o.dispose()}):void 0,this.hasCachedGhostText=!1,this.onDidChangeEmitter.fire())}get ghostText(){var e,t;return this.hasCachedGhostText||(this.cachedGhostText=null===(t=null===(e=this.currentModelRef.value)||void 0===e?void 0:e.object)||void 0===t?void 0:t.ghostText,this.hasCachedGhostText=!0),this.cachedGhostText}setExpanded(e){var t;null===(t=this.targetModel)||void 0===t||t.setExpanded(e)}get minReservedLineCount(){return this.targetModel?this.targetModel.minReservedLineCount:0}}let No=class extends Io{constructor(e,t){super(),this.editor=e,this.commandService=t,this.sharedCache=this._register(new Ro),this.suggestWidgetAdapterModel=this._register(new ko(this.editor,this.sharedCache)),this.inlineCompletionsModel=this._register(new co(this.editor,this.sharedCache,this.commandService)),this._register(this.suggestWidgetAdapterModel.onDidChange(()=>{this.updateModel()})),this.updateModel()}get activeInlineCompletionsModel(){if(this.targetModel===this.inlineCompletionsModel)return this.inlineCompletionsModel}updateModel(){this.setTargetModel(this.suggestWidgetAdapterModel.isActive?this.suggestWidgetAdapterModel:this.inlineCompletionsModel),this.inlineCompletionsModel.setActive(this.targetModel===this.inlineCompletionsModel)}shouldShowHoverAt(e){var t;const i=null===(t=this.activeInlineCompletionsModel)||void 0===t?void 0:t.ghostText;return!!i&&i.parts.some(t=>e.containsPosition(new p.L(i.lineNumber,t.column)))}triggerInlineCompletion(){var e;null===(e=this.activeInlineCompletionsModel)||void 0===e||e.trigger(m.bw.Explicit)}commitInlineCompletion(){var e;null===(e=this.activeInlineCompletionsModel)||void 0===e||e.commitCurrentSuggestion()}hideInlineCompletion(){var e;null===(e=this.activeInlineCompletionsModel)||void 0===e||e.hide()}showNextInlineCompletion(){var e;null===(e=this.activeInlineCompletionsModel)||void 0===e||e.showNext()}showPreviousInlineCompletion(){var e;null===(e=this.activeInlineCompletionsModel)||void 0===e||e.showPrevious()}hasMultipleInlineCompletions(){var e;return Do(this,void 0,void 0,(function*(){const t=yield null===(e=this.activeInlineCompletionsModel)||void 0===e?void 0:e.hasMultipleInlineCompletions();return void 0!==t&&t}))}};No=xo([Mo(1,ne.Hy)],No);class Ro extends n.JT{constructor(){super(...arguments),this.onDidChangeEmitter=new _.Q5,this.onDidChange=this.onDidChangeEmitter.event,this.cache=this._register(new n.XK)}get value(){return this.cache.value}setValue(e,t,i){this.cache.value=new po(e,t,()=>this.onDidChangeEmitter.fire(),i)}clearAndLeak(){return this.cache.clearAndLeak()}clear(){this.cache.clear()}}var Po,Lo=i(89052),Eo=i(64141),To=i(78411),Oo=i(50072),Ao=i(27869),Wo=i(92550),Fo=i(77736),Ho=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},Vo=function(e,t){return function(i,o){t(i,o,e)}};const Ko=null===(Po=window.trustedTypes)||void 0===Po?void 0:Po.createPolicy("editorGhostText",{createHTML:e=>e});let Bo=class extends n.JT{constructor(e,t,i,o){super(),this.editor=e,this.model=t,this.instantiationService=i,this.modeService=o,this.disposed=!1,this.partsWidget=this._register(this.instantiationService.createInstance(Go,this.editor)),this.additionalLinesWidget=this._register(new $o(this.editor,this.modeService.languageIdCodec)),this.viewMoreContentWidget=void 0,this._register(this.editor.onDidChangeConfiguration(e=>{(e.hasChanged(29)||e.hasChanged(104)||e.hasChanged(87)||e.hasChanged(82)||e.hasChanged(44)||e.hasChanged(43)||e.hasChanged(58))&&this.update()})),this._register((0,n.OF)(()=>{var e;this.disposed=!0,this.update(),null===(e=this.viewMoreContentWidget)||void 0===e||e.dispose(),this.viewMoreContentWidget=void 0})),this._register(t.onDidChange(()=>{this.update()})),this.update()}shouldShowHoverAtViewZone(e){return this.additionalLinesWidget.viewZoneId===e}update(){var e;const t=this.model.ghostText;if(!this.editor.hasModel()||!t||this.disposed)return this.partsWidget.clear(),void this.additionalLinesWidget.clear();const i=new Array,o=new Array;function n(e,t){if(o.length>0){const i=o[o.length-1];t&&i.decorations.push(new Wo.Kp(i.content.length+1,i.content.length+1+e[0].length,t,0)),i.content+=e[0],e=e.slice(1)}for(const i of e)o.push({content:i,decorations:t?[new Wo.Kp(1,i.length+1,t,0)]:[]})}const s=this.editor.getModel().getLineContent(t.lineNumber);this.editor.getModel().getLineTokens(t.lineNumber);let r=void 0,a=0;for(const e of t.parts){let t=e.lines;void 0===r?(i.push({column:e.column,text:t[0],preview:e.preview}),t=t.slice(1)):n([s.substring(a,e.column-1)],void 0),t.length>0&&(n(t,"ghost-text"),void 0===r&&e.column<=s.length&&(r=e.column)),a=e.column-1}void 0!==r&&n([s.substring(a)],void 0),this.partsWidget.setParts(t.lineNumber,i,void 0!==r?{column:r,length:s.length+1-r}:void 0),this.additionalLinesWidget.updateLines(t.lineNumber,o,t.additionalReservedLineCount),t.parts.some(e=>e.lines.length<0)?this.viewMoreContentWidget=this.renderViewMoreLines(new p.L(t.lineNumber,this.editor.getModel().getLineMaxColumn(t.lineNumber)),"",0):(null===(e=this.viewMoreContentWidget)||void 0===e||e.dispose(),this.viewMoreContentWidget=void 0)}renderViewMoreLines(e,t,i){const o=this.editor.getOption(43),s=document.createElement("div");s.className="suggest-preview-additional-widget",Lo.V.applyFontInfoSlow(s,o);const r=document.createElement("span");r.className="content-spacer",r.append(t),s.append(r);const a=document.createElement("span");a.className="content-newline suggest-preview-text",a.append("⏎  "),s.append(a);const d=new n.SL,l=document.createElement("div");return l.className="button suggest-preview-text",l.append(`+${i} lines…`),d.add(x.mu(l,"mousedown",e=>{var t;null===(t=this.model)||void 0===t||t.setExpanded(!0),e.preventDefault(),this.editor.focus()})),s.append(l),new Uo(this.editor,e,s,d)}};Bo=Ho([Vo(2,F.TG),Vo(3,d.h)],Bo);class Go{constructor(e){this.editor=e,this.decorationIds=[],this.disposableStore=new n.SL}dispose(){this.clear(),this.disposableStore.dispose()}clear(){this.editor.deltaDecorations(this.decorationIds,[]),this.disposableStore.clear()}setParts(e,t,i){this.disposableStore.clear();if(!this.editor.getModel())return;const o=new Array;i&&o.push({range:r.e.fromPositions(new p.L(e,i.column),new p.L(e,i.column+i.length)),options:{inlineClassName:"ghost-text-hidden",description:"ghost-text-hidden"}}),this.decorationIds=this.editor.deltaDecorations(this.decorationIds,t.map(t=>({range:r.e.fromPositions(new p.L(e,t.column)),options:{description:"ghost-text",after:{content:t.text,inlineClassName:t.preview?"ghost-text-decoration-preview":"ghost-text-decoration"},showIfCollapsed:!0}})).concat(o))}}class $o{constructor(e,t){this.editor=e,this.languageIdCodec=t,this._viewZoneId=void 0}get viewZoneId(){return this._viewZoneId}dispose(){this.clear()}clear(){this.editor.changeViewZones(e=>{this._viewZoneId&&(e.removeZone(this._viewZoneId),this._viewZoneId=void 0)})}updateLines(e,t,i){const o=this.editor.getModel();if(!o)return;const{tabSize:n}=o.getOptions();this.editor.changeViewZones(o=>{this._viewZoneId&&(o.removeZone(this._viewZoneId),this._viewZoneId=void 0);const s=Math.max(t.length,i);if(s>0){const i=document.createElement("div");!function(e,t,i,o,n){const s=o.get(29),r=o.get(104),a=o.get(82),d=o.get(44),l=o.get(43),h=o.get(58),c=(0,Oo.l$)(1e4);c.appendASCIIString('<div class="suggest-preview-text">');for(let e=0,o=i.length;e<o;e++){const o=i[e],u=o.content;c.appendASCIIString('<div class="view-line'),c.appendASCIIString('" style="top:'),c.appendASCIIString(String(e*h)),c.appendASCIIString('px;width:1000000px;">');const g=ge.$i(u),p=ge.Ut(u),m=To.A.createEmpty(u,n);(0,Fo.d1)(new Fo.IJ(l.isMonospace&&!s,l.canUseHalfwidthRightwardsArrow,u,!1,g,p,0,m,o.decorations,t,0,l.spaceWidth,l.middotWidth,l.wsmiddotWidth,r,"none",a,d!==Eo.n0.OFF,null),c),c.appendASCIIString("</div>")}c.appendASCIIString("</div>"),Lo.V.applyFontInfoSlow(e,l);const u=c.build(),g=Ko?Ko.createHTML(u):u;e.innerHTML=g}(i,n,t,this.editor.getOptions(),this.languageIdCodec),this._viewZoneId=o.addZone({afterLineNumber:e,heightInLines:s,domNode:i})}})}}class Uo extends n.JT{constructor(e,t,i,o){super(),this.editor=e,this.position=t,this.domNode=i,this.allowEditorOverflow=!1,this.suppressMouseDown=!1,this._register(o),this._register((0,n.OF)(()=>{this.editor.removeContentWidget(this)})),this.editor.addContentWidget(this)}getId(){return"editor.widget.viewMoreLinesWidget"}getDomNode(){return this.domNode}getPosition(){return{position:this.position,preference:[0]}}}(0,Y.Ic)((e,t)=>{const i=e.getColor(Ao.N5);i&&(t.addRule(`.monaco-editor .ghost-text-decoration { color: ${i.toString()} !important; }`),t.addRule(`.monaco-editor .ghost-text-decoration-preview { color: ${i.toString()} !important; }`),t.addRule(`.monaco-editor .suggest-preview-text .ghost-text { color: ${i.toString()} !important; }`));const o=e.getColor(Ao.IO);o&&(t.addRule(`.monaco-editor .ghost-text-decoration { background-color: ${o.toString()}; }`),t.addRule(`.monaco-editor .ghost-text-decoration-preview { background-color: ${o.toString()}; }`),t.addRule(`.monaco-editor .suggest-preview-text .ghost-text { background-color: ${o.toString()}; }`));const n=e.getColor(Ao.x3);n&&(t.addRule(`.monaco-editor .suggest-preview-text .ghost-text { border: 1px solid ${n}; }`),t.addRule(`.monaco-editor .ghost-text-decoration { border: 1px solid ${n}; }`),t.addRule(`.monaco-editor .ghost-text-decoration-preview { border: 1px solid ${n}; }`))});var jo=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},Zo=function(e,t){return function(i,o){t(i,o,e)}},zo=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function a(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};let qo=class e extends n.JT{constructor(e,t){super(),this.editor=e,this.instantiationService=t,this.triggeredExplicitly=!1,this.activeController=this._register(new n.XK),this._register(this.editor.onDidChangeModel(()=>{this.updateModelController()})),this._register(this.editor.onDidChangeConfiguration(e=>{e.hasChanged(105)&&this.updateModelController(),e.hasChanged(54)&&this.updateModelController()})),this.updateModelController()}static get(t){return t.getContribution(e.ID)}get activeModel(){var e;return null===(e=this.activeController.value)||void 0===e?void 0:e.model}updateModelController(){const e=this.editor.getOption(105),t=this.editor.getOption(54);this.activeController.value=void 0,this.activeController.value=this.editor.hasModel()&&(e.preview||t.enabled||this.triggeredExplicitly)?this.instantiationService.createInstance(Xo,this.editor):void 0}shouldShowHoverAt(e){var t;return(null===(t=this.activeModel)||void 0===t?void 0:t.shouldShowHoverAt(e))||!1}shouldShowHoverAtViewZone(e){var t,i;return(null===(i=null===(t=this.activeController.value)||void 0===t?void 0:t.widget)||void 0===i?void 0:i.shouldShowHoverAtViewZone(e))||!1}trigger(){var e;this.triggeredExplicitly=!0,this.activeController.value||this.updateModelController(),null===(e=this.activeModel)||void 0===e||e.triggerInlineCompletion()}commit(){var e;null===(e=this.activeModel)||void 0===e||e.commitInlineCompletion()}hide(){var e;null===(e=this.activeModel)||void 0===e||e.hideInlineCompletion()}showNextInlineCompletion(){var e;null===(e=this.activeModel)||void 0===e||e.showNextInlineCompletion()}showPreviousInlineCompletion(){var e;null===(e=this.activeModel)||void 0===e||e.showPreviousInlineCompletion()}hasMultipleInlineCompletions(){var e;return zo(this,void 0,void 0,(function*(){const t=yield null===(e=this.activeModel)||void 0===e?void 0:e.hasMultipleInlineCompletions();return void 0!==t&&t}))}};qo.inlineSuggestionVisible=new A.uy("inlineSuggestionVisible",!1,T.N("inlineSuggestionVisible","Whether an inline suggestion is visible")),qo.inlineSuggestionHasIndentation=new A.uy("inlineSuggestionHasIndentation",!1,T.N("inlineSuggestionHasIndentation","Whether the inline suggestion starts with whitespace")),qo.inlineSuggestionHasIndentationLessThanTabSize=new A.uy("inlineSuggestionHasIndentationLessThanTabSize",!0,T.N("inlineSuggestionHasIndentationLessThanTabSize","Whether the inline suggestion starts with whitespace that is less than what would be inserted by tab")),qo.ID="editor.contrib.ghostTextController",qo=jo([Zo(1,F.TG)],qo);class Qo{constructor(e){this.contextKeyService=e,this.inlineCompletionVisible=qo.inlineSuggestionVisible.bindTo(this.contextKeyService),this.inlineCompletionSuggestsIndentation=qo.inlineSuggestionHasIndentation.bindTo(this.contextKeyService),this.inlineCompletionSuggestsIndentationLessThanTabSize=qo.inlineSuggestionHasIndentationLessThanTabSize.bindTo(this.contextKeyService)}}let Xo=class extends n.JT{constructor(e,t,i){super(),this.editor=e,this.instantiationService=t,this.contextKeyService=i,this.contextKeys=new Qo(this.contextKeyService),this.model=this._register(this.instantiationService.createInstance(No,this.editor)),this.widget=this._register(this.instantiationService.createInstance(Bo,this.editor,this.model)),this._register((0,n.OF)(()=>{this.contextKeys.inlineCompletionVisible.set(!1),this.contextKeys.inlineCompletionSuggestsIndentation.set(!1),this.contextKeys.inlineCompletionSuggestsIndentationLessThanTabSize.set(!0)})),this._register(this.model.onDidChange(()=>{this.updateContextKeys()})),this.updateContextKeys()}updateContextKeys(){var e;this.contextKeys.inlineCompletionVisible.set(void 0!==(null===(e=this.model.activeInlineCompletionsModel)||void 0===e?void 0:e.ghostText));let t=!1,i=!0;const o=this.model.inlineCompletionsModel.ghostText;if(this.model.activeInlineCompletionsModel&&o&&o.parts.length>0){const{column:e,lines:n}=o.parts[0],s=n[0];if(e<=this.editor.getModel().getLineIndentColumn(o.lineNumber)){let e=(0,ge.LC)(s);-1===e&&(e=s.length-1),t=e>0;const o=this.editor.getModel().getOptions().tabSize;i=Xi.i.visibleColumnFromColumn(s,e+1,o)<o}}this.contextKeys.inlineCompletionSuggestsIndentation.set(t),this.contextKeys.inlineCompletionSuggestsIndentationLessThanTabSize.set(i)}};Xo=jo([Zo(1,F.TG),Zo(2,A.i6)],Xo);const Jo=s._l.bindToContribution(qo.get),Yo=new Jo({id:"editor.action.inlineSuggest.commit",precondition:qo.inlineSuggestionVisible,handler(e){e.commit(),e.editor.focus()}});(0,s.fK)(Yo),re.W.registerKeybindingRule({primary:2,weight:200,id:Yo.id,when:A.Ao.and(Yo.precondition,a.u.tabMovesFocus.toNegated(),qo.inlineSuggestionHasIndentationLessThanTabSize)}),(0,s.fK)(new Jo({id:"editor.action.inlineSuggest.hide",precondition:qo.inlineSuggestionVisible,kbOpts:{weight:100,primary:9},handler(e){e.hide()}}));class en extends s.R6{constructor(){super({id:en.ID,label:T.N("action.inlineSuggest.showNext","Show Next Inline Suggestion"),alias:"Show Next Inline Suggestion",precondition:A.Ao.and(a.u.writable,qo.inlineSuggestionVisible),kbOpts:{weight:100,primary:601}})}run(e,t){return zo(this,void 0,void 0,(function*(){const e=qo.get(t);e&&(e.showNextInlineCompletion(),t.focus())}))}}en.ID="editor.action.inlineSuggest.showNext";class tn extends s.R6{constructor(){super({id:tn.ID,label:T.N("action.inlineSuggest.showPrevious","Show Previous Inline Suggestion"),alias:"Show Previous Inline Suggestion",precondition:A.Ao.and(a.u.writable,qo.inlineSuggestionVisible),kbOpts:{weight:100,primary:599}})}run(e,t){return zo(this,void 0,void 0,(function*(){const e=qo.get(t);e&&(e.showPreviousInlineCompletion(),t.focus())}))}}tn.ID="editor.action.inlineSuggest.showPrevious";class on extends s.R6{constructor(){super({id:"editor.action.inlineSuggest.trigger",label:T.N("action.inlineSuggest.trigger","Trigger Inline Suggestion"),alias:"Trigger Inline Suggestion",precondition:a.u.writable})}run(e,t){return zo(this,void 0,void 0,(function*(){const e=qo.get(t);e&&e.trigger()}))}}(0,s._K)(qo.ID,qo),(0,s.Qr)(on),(0,s.Qr)(en),(0,s.Qr)(tn);var nn=i(31106),sn=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},rn=function(e,t){return function(i,o){t(i,o,e)}};class an{constructor(e,t,i){this.owner=e,this.range=t,this.controller=i}isValidForHoverAnchor(e){return 1===e.type&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}hasMultipleSuggestions(){return this.controller.hasMultipleInlineCompletions()}}let dn=class{constructor(e,t,i,o,n,s,r,a){this._editor=e,this._hover=t,this._commandService=i,this._menuService=o,this._contextKeyService=n,this._modeService=s,this._openerService=r,this.accessibilityService=a}suggestHoverAnchor(e){const t=qo.get(this._editor);if(!t)return null;if(8===e.target.type){const i=e.target.detail;if(t.shouldShowHoverAtViewZone(i.viewZoneId))return new oi(1e3,this,r.e.fromPositions(i.positionBefore||i.position,i.positionBefore||i.position))}if(7===e.target.type&&e.target.range&&t.shouldShowHoverAt(e.target.range))return new oi(1e3,this,e.target.range);if(6===e.target.type&&e.target.range&&e.target.detail){if(e.target.detail.mightBeForeignElement&&t.shouldShowHoverAt(e.target.range))return new oi(1e3,this,e.target.range)}return null}computeSync(e,t){const i=qo.get(this._editor);return i&&i.shouldShowHoverAt(e.range)?[new an(this,e.range,i)]:[]}renderHoverParts(e,t,i){const o=new n.SL,s=e[0];this.accessibilityService.isScreenReaderOptimized()&&this.renderScreenReaderText(s,t,o);const r=o.add(this._menuService.createMenu(dt.eH.InlineCompletionsActions,this._contextKeyService)),a=i.addAction({label:T.N("showNextInlineSuggestion","Next"),commandId:en.ID,run:()=>this._commandService.executeCommand(en.ID)}),d=i.addAction({label:T.N("showPreviousInlineSuggestion","Previous"),commandId:tn.ID,run:()=>this._commandService.executeCommand(tn.ID)});i.addAction({label:T.N("acceptInlineSuggestion","Accept"),commandId:Yo.id,run:()=>this._commandService.executeCommand(Yo.id)});const l=[a,d];for(const e of l)e.setEnabled(!1);s.hasMultipleSuggestions().then(e=>{for(const t of l)t.setEnabled(e)});for(const[e,t]of r.getActions())for(const e of t)e instanceof dt.U8&&i.addAction({label:e.label,commandId:e.item.id,run:()=>this._commandService.executeCommand(e.item.id)});return o}renderScreenReaderText(e,t,i){var o,n;const s=x.$,r=s("div.hover-row.markdown-hover"),a=x.R3(r,s("div.hover-contents")),d=i.add(new Qi.$({editor:this._editor},this._modeService,this._openerService)),l=e=>{i.add(d.onDidRenderAsync(()=>{a.className="hover-contents code-hover-contents",this._hover.onContentsChanged()}));const t=T.N("inlineSuggestionFollows","Suggestion:"),o=i.add(d.render((new c.W5).appendText(t).appendCodeblock("text",e)));a.replaceChildren(o.element)},h=null===(n=null===(o=e.controller.activeModel)||void 0===o?void 0:o.inlineCompletionsModel)||void 0===n?void 0:n.ghostText;if(h){const e=this._editor.getModel().getLineContent(h.lineNumber);l(h.renderForScreenReader(e))}t.appendChild(r)}};dn=sn([rn(2,ne.Hy),rn(3,dt.co),rn(4,A.i6),rn(5,d.h),rn(6,Ci.v4),rn(7,nn.F)],dn);var ln=i(79599),hn=i(89682),cn=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},un=function(e,t){return function(i,o){t(i,o,e)}};const gn=x.$;let pn=class extends n.JT{constructor(e){super(),this._keybindingService=e,this._hasContent=!1,this.hoverElement=gn("div.hover-row.status-bar"),this.actionsElement=x.R3(this.hoverElement,gn("div.actions"))}get hasContent(){return this._hasContent}addAction(e){const t=this._keybindingService.lookupKeybinding(e.commandId),i=t?t.getLabel():null;return this._hasContent=!0,this._register(Kt.S.render(this.actionsElement,e,i))}append(e){const t=x.R3(this.actionsElement,e);return this._hasContent=!0,t}};pn=cn([un(0,Ie.d)],pn);class mn{constructor(e,t){this._participants=t,this._editor=e,this._result=[],this._anchor=null}setAnchor(e){this._anchor=e,this._result=[]}clearResult(){this._result=[]}static _getLineDecorations(e,t){if(1!==t.type)return[];const i=e.getModel(),o=t.range.startLineNumber,n=i.getLineMaxColumn(o);return e.getLineDecorations(o).filter(e=>{if(e.options.isWholeLine)return!0;const i=e.range.startLineNumber===o?e.range.startColumn:1,s=e.range.endLineNumber===o?e.range.endColumn:n;if(e.options.showIfCollapsed){if(i>t.range.startColumn+1||t.range.endColumn-1>s)return!1}else if(i>t.range.startColumn||t.range.endColumn>s)return!1;return!0})}computeAsync(e){const t=this._anchor;if(!this._editor.hasModel()||!t)return l.Aq.EMPTY;const i=mn._getLineDecorations(this._editor,t);return l.Aq.merge(this._participants.map(o=>this._computeAsync(o,i,t,e)))}_computeAsync(e,t,i,o){return e.computeAsync?e.computeAsync(i,t,o):l.Aq.EMPTY}computeSync(){if(!this._editor.hasModel()||!this._anchor)return[];const e=mn._getLineDecorations(this._editor,this._anchor);let t=[];for(const i of this._participants)t=t.concat(i.computeSync(this._anchor,e));return(0,Gt.kX)(t)}onResult(e,t){this._result=t?e.concat(this._result):this._result.concat(e)}getResult(){return this._result.slice(0)}getResultWithLoadingMessage(){if(this._anchor)for(const e of this._participants)if(e.createLoadingMessage){const t=e.createLoadingMessage(this._anchor);if(t)return this._result.slice(0).concat([t])}return this._result.slice(0)}}let fn=class e extends Bt.${constructor(e,t,i,o,n){super(),this._hoverVisibleKey=t,this._keybindingService=o,this._contextKeyService=n,this.allowEditorOverflow=!0,this._participants=[i.createInstance(Jt,e,this),i.createInstance(ni.D5,e,this),i.createInstance(dn,e,this),i.createInstance(hn.HG,e,this),i.createInstance(qi,e,this)],this._editor=e,this._isVisible=!1,this._stoleFocus=!1,this._renderDisposable=null,this._hover=this._register(new Kt.c),this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible),this.onkeydown(this._hover.containerDomNode,e=>{e.equals(9)&&this.hide()}),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(43)&&this._updateFont()})),this._editor.onDidLayoutChange(()=>this.layout()),this.layout(),this._editor.addContentWidget(this),this._showAtPosition=null,this._showAtRange=null,this._stoleFocus=!1,this._messages=[],this._messagesAreComplete=!1,this._lastAnchor=null,this._computer=new mn(this._editor,this._participants),this._highlightDecorations=[],this._isChangingDecorations=!1,this._shouldFocus=!1,this._colorPicker=null,this._preferAbove=this._editor.getOption(52).above,this._hoverOperation=new ti(this._computer,e=>this._withResult(e,!0),null,e=>this._withResult(e,!1),this._editor.getOption(52).delay),this._register(x.mu(this.getDomNode(),x.tw.FOCUS,()=>{this._colorPicker&&this.getDomNode().classList.add("colorpicker-hover")})),this._register(x.mu(this.getDomNode(),x.tw.BLUR,()=>{this.getDomNode().classList.remove("colorpicker-hover")})),this._register(e.onDidChangeConfiguration(()=>{this._hoverOperation.setHoverTime(this._editor.getOption(52).delay),this._preferAbove=this._editor.getOption(52).above})),this._register(m.RW.onDidChange(()=>{this._isVisible&&this._lastAnchor&&this._messages.length>0&&(this._hover.contentsDomNode.textContent="",this._renderMessages(this._lastAnchor,this._messages))}))}dispose(){this._hoverOperation.cancel(),this._editor.removeContentWidget(this),super.dispose()}getId(){return e.ID}getDomNode(){return this._hover.containerDomNode}_shouldShowAt(e){const t=e.target.type;if(6===t)return!0;if(7===t){const t=this._editor.getOption(43).typicalHalfwidthCharacterWidth/2,i=e.target.detail;if(i&&!i.isAfterLines&&"number"==typeof i.horizontalDistanceToText&&i.horizontalDistanceToText<t)return!0}return!1}maybeShowAt(e){var t;const i=[];for(const t of this._participants)if("function"==typeof t.suggestHoverAnchor){const o=t.suggestHoverAnchor(e);o&&i.push(o)}if(this._shouldShowAt(e)&&e.target.range){const o=[...(null===(t=e.target.element)||void 0===t?void 0:t.classList.values())||[]].find(e=>e.startsWith("ced-colorBox"))&&e.target.range.endColumn-e.target.range.startColumn==1?new r.e(e.target.range.startLineNumber,e.target.range.startColumn+1,e.target.range.endLineNumber,e.target.range.endColumn+1):e.target.range;i.push(new ii(0,o))}return 0!==i.length&&(i.sort((e,t)=>t.priority-e.priority),this._startShowingAt(i[0],0,!1),!0)}_showAt(e,t,i){this._showAtPosition=e,this._showAtRange=t,this._hoverVisibleKey.set(!0),this._isVisible=!0,this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible),this._editor.layoutContentWidget(this),this._editor.render(),this._stoleFocus=i,i&&this._hover.containerDomNode.focus()}getPosition(){if(this._isVisible){let e=this._preferAbove;return!e&&this._contextKeyService.getContextKeyValue(ln._y.Visible.key)&&(e=!0),{position:this._showAtPosition,range:this._showAtRange,preference:e?[1,2]:[2,1]}}return null}_updateFont(){Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName("code")).forEach(e=>this._editor.applyFontInfo(e))}_updateContents(e){this._hover.contentsDomNode.textContent="",this._hover.contentsDomNode.appendChild(e),this._updateFont(),this._editor.layoutContentWidget(this),this._hover.onContentsChanged()}layout(){const e=Math.max(this._editor.getLayoutInfo().height/4,250),{fontSize:t,lineHeight:i}=this._editor.getOption(43);this._hover.contentsDomNode.style.fontSize=t+"px",this._hover.contentsDomNode.style.lineHeight=""+i/t,this._hover.contentsDomNode.style.maxHeight=e+"px",this._hover.contentsDomNode.style.maxWidth=Math.max(.66*this._editor.getLayoutInfo().width,500)+"px"}onModelDecorationsChanged(){this._isChangingDecorations||this._isVisible&&(this._hoverOperation.cancel(),this._computer.clearResult(),this._colorPicker||this._hoverOperation.start(0))}startShowingAtRange(e,t,i){this._startShowingAt(new ii(0,e),t,i)}_startShowingAt(e,t,i){if(!this._lastAnchor||!this._lastAnchor.equals(e)){if(this._hoverOperation.cancel(),this._isVisible)if(this._showAtPosition&&this._lastAnchor&&e.canAdoptVisibleHover(this._lastAnchor,this._showAtPosition)){const t=this._messages.filter(t=>t.isValidForHoverAnchor(e));if(0===t.length)this.hide();else{if(t.length===this._messages.length&&this._messagesAreComplete)return;this._renderMessages(e,t)}}else this.hide();this._lastAnchor=e,this._computer.setAnchor(e),this._shouldFocus=i,this._hoverOperation.start(t)}}hide(){this._lastAnchor=null,this._hoverOperation.cancel(),this._isVisible&&(setTimeout(()=>{this._isVisible||this._hoverVisibleKey.set(!1)},0),this._isVisible=!1,this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible),this._editor.layoutContentWidget(this),this._stoleFocus&&this._editor.focus()),this._isChangingDecorations=!0,this._highlightDecorations=this._editor.deltaDecorations(this._highlightDecorations,[]),this._isChangingDecorations=!1,this._renderDisposable&&(this._renderDisposable.dispose(),this._renderDisposable=null),this._colorPicker=null}isColorPickerVisible(){return!!this._colorPicker}setColorPicker(e){this._colorPicker=e}onContentsChanged(){this._hover.onContentsChanged()}_withResult(e,t){this._messages=e,this._messagesAreComplete=t,this._lastAnchor&&this._messages.length>0?this._renderMessages(this._lastAnchor,this._messages):t&&this.hide()}_renderMessages(t,i){this._renderDisposable&&(this._renderDisposable.dispose(),this._renderDisposable=null),this._colorPicker=null;let o=1073741824,s=i[0].range,a=null,d=document.createDocumentFragment();const l=new n.SL,h=new Map;for(const e of i){o=Math.min(o,e.range.startColumn),s=r.e.plusRange(s,e.range),e.forceShowAtRange&&(a=e.range),h.has(e.owner)||h.set(e.owner,[]);h.get(e.owner).push(e)}const c=l.add(new pn(this._keybindingService));for(const e of this._participants)if(h.has(e)){const t=h.get(e);l.add(e.renderHoverParts(t,d,c))}c.hasContent&&d.appendChild(c.hoverElement),this._renderDisposable=l,d.hasChildNodes()&&(a?this._showAt(a.getStartPosition(),a,this._shouldFocus):this._showAt(new p.L(t.range.startLineNumber,o),s,this._shouldFocus),this._updateContents(d)),this._colorPicker&&this._colorPicker.layout(),this._isChangingDecorations=!0,this._highlightDecorations=this._editor.deltaDecorations(this._highlightDecorations,s?[{range:s,options:e._DECORATION_OPTIONS}]:[]),this._isChangingDecorations=!1}};fn.ID="editor.contrib.modesContentHoverWidget",fn._DECORATION_OPTIONS=ye.qx.register({description:"content-hover-highlight",className:"hoverHighlight"}),fn=cn([un(2,F.TG),un(3,Ie.d),un(4,A.i6)],fn);const _n=x.$;class vn{constructor(e){this._editor=e,this._lineNumber=-1,this._result=[]}setLineNumber(e){this._lineNumber=e,this._result=[]}clearResult(){this._result=[]}computeSync(){const e=e=>({value:e}),t=this._editor.getLineDecorations(this._lineNumber),i=[];if(!t)return i;for(const o of t){if(!o.options.glyphMarginClassName)continue;const t=o.options.glyphMarginHoverMessage;t&&!(0,c.CP)(t)&&i.push(...(0,Gt._2)(t).map(e))}return i}onResult(e,t){this._result=this._result.concat(e)}getResult(){return this._result}getResultWithLoadingMessage(){return this.getResult()}}class Cn extends Bt.${constructor(e,t,i=Ci.SW){super(),this._renderDisposeables=this._register(new n.SL),this._editor=e,this._isVisible=!1,this._messages=[],this._lastLineNumber=-1,this._hover=this._register(new Kt.c),this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible),this._markdownRenderer=this._register(new Qi.$({editor:this._editor},t,i)),this._computer=new vn(this._editor),this._hoverOperation=new ti(this._computer,e=>this._withResult(e),void 0,e=>this._withResult(e),300),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(43)&&this._updateFont()})),this._editor.addOverlayWidget(this)}dispose(){this._hoverOperation.cancel(),this._editor.removeOverlayWidget(this),super.dispose()}getId(){return Cn.ID}getDomNode(){return this._hover.containerDomNode}getPosition(){return null}_showAt(e){this._isVisible||(this._isVisible=!0,this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible));const t=this._editor.getLayoutInfo(),i=this._editor.getTopForLineNumber(e),o=this._editor.getScrollTop(),n=this._editor.getOption(58),s=i-o-(this._hover.containerDomNode.clientHeight-n)/2;this._hover.containerDomNode.style.left=t.glyphMarginLeft+t.glyphMarginWidth+"px",this._hover.containerDomNode.style.top=Math.max(Math.round(s),0)+"px"}_updateFont(){Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName("code")).forEach(e=>this._editor.applyFontInfo(e))}_updateContents(e){this._hover.contentsDomNode.textContent="",this._hover.contentsDomNode.appendChild(e),this._updateFont()}onModelDecorationsChanged(){this._isVisible&&(this._hoverOperation.cancel(),this._computer.clearResult(),this._hoverOperation.start(0))}startShowingAt(e){this._lastLineNumber!==e&&(this._hoverOperation.cancel(),this.hide(),this._lastLineNumber=e,this._computer.setLineNumber(e),this._hoverOperation.start(0))}hide(){this._lastLineNumber=-1,this._hoverOperation.cancel(),this._isVisible&&(this._isVisible=!1,this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible))}_withResult(e){this._messages=e,this._messages.length>0?this._renderMessages(this._lastLineNumber,this._messages):this.hide()}_renderMessages(e,t){this._renderDisposeables.clear();const i=document.createDocumentFragment();for(const e of t){const t=_n("div.hover-row.markdown-hover"),o=x.R3(t,_n("div.hover-contents")),n=this._renderDisposeables.add(this._markdownRenderer.render(e.value));o.appendChild(n.element),i.appendChild(t)}this._updateContents(i),this._showAt(e)}}Cn.ID="editor.contrib.modesGlyphHoverWidget";var wn=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},yn=function(e,t){return function(i,o){t(i,o,e)}};let bn=class e{constructor(e,t,i,o,s){this._editor=e,this._instantiationService=t,this._openerService=i,this._modeService=o,this._toUnhook=new n.SL,this._isMouseDown=!1,this._hoverClicked=!1,this._contentWidget=null,this._glyphWidget=null,this._hookEvents(),this._didChangeConfigurationHandler=this._editor.onDidChangeConfiguration(e=>{e.hasChanged(52)&&(this._unhookEvents(),this._hookEvents())}),this._hoverVisibleKey=a.u.hoverVisible.bindTo(s)}static get(t){return t.getContribution(e.ID)}_hookEvents(){const e=()=>this._hideWidgets(),t=this._editor.getOption(52);this._isHoverEnabled=t.enabled,this._isHoverSticky=t.sticky,this._isHoverEnabled?(this._toUnhook.add(this._editor.onMouseDown(e=>this._onEditorMouseDown(e))),this._toUnhook.add(this._editor.onMouseUp(e=>this._onEditorMouseUp(e))),this._toUnhook.add(this._editor.onMouseMove(e=>this._onEditorMouseMove(e))),this._toUnhook.add(this._editor.onKeyDown(e=>this._onKeyDown(e))),this._toUnhook.add(this._editor.onDidChangeModelDecorations(()=>this._onModelDecorationsChanged()))):(this._toUnhook.add(this._editor.onMouseMove(e=>this._onEditorMouseMove(e))),this._toUnhook.add(this._editor.onKeyDown(e=>this._onKeyDown(e)))),this._toUnhook.add(this._editor.onMouseLeave(e)),this._toUnhook.add(this._editor.onDidChangeModel(e)),this._toUnhook.add(this._editor.onDidScrollChange(e=>this._onEditorScrollChanged(e)))}_unhookEvents(){this._toUnhook.clear()}_onModelDecorationsChanged(){var e,t;null===(e=this._contentWidget)||void 0===e||e.onModelDecorationsChanged(),null===(t=this._glyphWidget)||void 0===t||t.onModelDecorationsChanged()}_onEditorScrollChanged(e){(e.scrollTopChanged||e.scrollLeftChanged)&&this._hideWidgets()}_onEditorMouseDown(e){this._isMouseDown=!0;const t=e.target.type;9!==t||e.target.detail!==fn.ID?12===t&&e.target.detail===Cn.ID||(12!==t&&e.target.detail!==Cn.ID&&(this._hoverClicked=!1),this._hideWidgets()):this._hoverClicked=!0}_onEditorMouseUp(e){this._isMouseDown=!1}_onEditorMouseMove(e){var t,i,o,n,s;let r=e.target.type;if(this._isMouseDown&&this._hoverClicked)return;if(this._isHoverSticky&&9===r&&e.target.detail===fn.ID)return;if(this._isHoverSticky&&!(null===(i=null===(t=e.event.browserEvent.view)||void 0===t?void 0:t.getSelection())||void 0===i?void 0:i.isCollapsed))return;if(!this._isHoverSticky&&9===r&&e.target.detail===fn.ID&&(null===(o=this._contentWidget)||void 0===o?void 0:o.isColorPickerVisible()))return;if(this._isHoverSticky&&12===r&&e.target.detail===Cn.ID)return;if(!this._isHoverEnabled)return void this._hideWidgets();if(!this._getOrCreateContentWidget().maybeShowAt(e))return 2===r&&e.target.position?(null===(s=this._contentWidget)||void 0===s||s.hide(),this._glyphWidget||(this._glyphWidget=new Cn(this._editor,this._modeService,this._openerService)),void this._glyphWidget.startShowingAt(e.target.position.lineNumber)):void this._hideWidgets();null===(n=this._glyphWidget)||void 0===n||n.hide()}_onKeyDown(e){5!==e.keyCode&&6!==e.keyCode&&57!==e.keyCode&&4!==e.keyCode&&this._hideWidgets()}_hideWidgets(){var e,t,i;this._isMouseDown&&this._hoverClicked&&(null===(e=this._contentWidget)||void 0===e?void 0:e.isColorPickerVisible())||(this._hoverClicked=!1,null===(t=this._glyphWidget)||void 0===t||t.hide(),null===(i=this._contentWidget)||void 0===i||i.hide())}_getOrCreateContentWidget(){return this._contentWidget||(this._contentWidget=this._instantiationService.createInstance(fn,this._editor,this._hoverVisibleKey)),this._contentWidget}isColorPickerVisible(){var e;return(null===(e=this._contentWidget)||void 0===e?void 0:e.isColorPickerVisible())||!1}showContentHover(e,t,i){this._getOrCreateContentWidget().startShowingAtRange(e,t,i)}dispose(){var e,t;this._unhookEvents(),this._toUnhook.dispose(),this._didChangeConfigurationHandler.dispose(),null===(e=this._glyphWidget)||void 0===e||e.dispose(),null===(t=this._contentWidget)||void 0===t||t.dispose()}};bn.ID="editor.contrib.hover",bn=wn([yn(1,F.TG),yn(2,Ci.v4),yn(3,d.h),yn(4,A.i6)],bn);class Sn extends s.R6{constructor(){super({id:"editor.action.showHover",label:T.N({key:"showHover",comment:["Label for action that will trigger the showing of a hover in the editor.","This allows for users to show the hover without using the mouse."]},"Show Hover"),alias:"Show Hover",precondition:void 0,kbOpts:{kbExpr:a.u.editorTextFocus,primary:(0,o.gx)(2089,2087),weight:100}})}run(e,t){if(!t.hasModel())return;let i=bn.get(t);if(!i)return;const o=t.getPosition(),n=new r.e(o.lineNumber,o.column,o.lineNumber,o.column),s=2===t.getOption(2);i.showContentHover(n,1,s)}}class kn extends s.R6{constructor(){super({id:"editor.action.showDefinitionPreviewHover",label:T.N({key:"showDefinitionPreviewHover",comment:["Label for action that will trigger the showing of definition preview hover in the editor.","This allows for users to show the definition preview hover without using the mouse."]},"Show Definition Preview Hover"),alias:"Show Definition Preview Hover",precondition:void 0})}run(e,t){let i=bn.get(t);if(!i)return;const o=t.getPosition();if(!o)return;const n=new r.e(o.lineNumber,o.column,o.lineNumber,o.column);Vt.get(t).startFindDefinitionFromCursor(o).then(()=>{i.showContentHover(n,1,!0)})}}(0,s._K)(bn.ID,bn),(0,s.Qr)(Sn),(0,s.Qr)(kn),(0,Y.Ic)((e,t)=>{const i=e.getColor(H.ptc);i&&t.addRule(`.monaco-editor .hoverHighlight { background-color: ${i}; }`);const o=e.getColor(H.yJx);o&&t.addRule(`.monaco-editor .monaco-hover { background-color: ${o}; }`);const n=e.getColor(H.CNo);n&&(t.addRule(`.monaco-editor .monaco-hover { border: 1px solid ${n}; }`),t.addRule(`.monaco-editor .monaco-hover .hover-row:not(:first-child):not(:empty) { border-top: 1px solid ${n.transparent(.5)}; }`),t.addRule(`.monaco-editor .monaco-hover hr { border-top: 1px solid ${n.transparent(.5)}; }`),t.addRule(`.monaco-editor .monaco-hover hr { border-bottom: 0px solid ${n.transparent(.5)}; }`));const s=e.getColor(H.url);s&&t.addRule(`.monaco-editor .monaco-hover a { color: ${s}; }`);const r=e.getColor(H.sgC);r&&t.addRule(`.monaco-editor .monaco-hover a:hover { color: ${r}; }`);const a=e.getColor(H.Sbf);a&&t.addRule(`.monaco-editor .monaco-hover { color: ${a}; }`);const d=e.getColor(H.LoV);d&&t.addRule(`.monaco-editor .monaco-hover .hover-row .actions { background-color: ${d}; }`);const l=e.getColor(H.SwI);l&&t.addRule(`.monaco-editor .monaco-hover code { background-color: ${l}; }`)})},83056:(e,t,i)=>{i.d(t,{hU:()=>x,D5:()=>M,c:()=>D});var o=i(65321),n=i(9488),s=i(15393),r=i(59365),a=i(9917),d=i(88527),l=i(50187),h=i(24314),c=i(44101),u=i(71531),g=i(71050),p=i(17301),m=i(16830),f=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function a(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};class _{constructor(e,t,i){this.provider=e,this.hover=t,this.ordinal=i}}function v(e,t,i){const o=c.xp.ordered(e).map((o,n)=>function(e,t,i,o,n){return f(this,void 0,void 0,(function*(){try{const s=yield Promise.resolve(e.provideHover(i,o,n));if(s&&function(e){const t=void 0!==e.range,i=void 0!==e.contents&&e.contents&&e.contents.length>0;return t&&i}(s))return new _(e,s,t)}catch(e){(0,p.Cp)(e)}}))}(o,n,e,t,i));return s.Aq.fromPromises(o).coalesce()}(0,m.sb)("_executeHoverProvider",(e,t)=>function(e,t,i){return v(e,t,i).map(e=>e.hover).toPromise()}(e,t,g.T.None));var C=i(63580),w=i(33108),y=i(50988),b=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},S=function(e,t){return function(i,o){t(i,o,e)}};const k=o.$;class x{constructor(e,t,i,o){this.owner=e,this.range=t,this.contents=i,this.ordinal=o}isValidForHoverAnchor(e){return 1===e.type&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}}let M=class{constructor(e,t,i,o,n){this._editor=e,this._hover=t,this._modeService=i,this._openerService=o,this._configurationService=n}createLoadingMessage(e){return new x(this,e.range,[(new r.W5).appendText(C.N("modesContentHover.loading","Loading..."))],2e3)}computeSync(e,t){if(!this._editor.hasModel()||1!==e.type)return[];const i=this._editor.getModel(),o=e.range.startLineNumber,s=i.getLineMaxColumn(o),a=[];let d=1e3;const l=i.getLineLength(o),c=i.getLanguageIdAtPosition(e.range.startLineNumber,e.range.startColumn),u=this._configurationService.getValue("editor.maxTokenizationLineLength",{overrideIdentifier:c});"number"==typeof u&&l>=u&&a.push(new x(this,e.range,[{value:C.N("too many characters","Tokenization is skipped for long lines for performance reasons. This can be configured via `editor.maxTokenizationLineLength`.")}],d++));for(const i of t){const t=i.range.startLineNumber===o?i.range.startColumn:1,l=i.range.endLineNumber===o?i.range.endColumn:s,c=i.options.hoverMessage;if(!c||(0,r.CP)(c))continue;const u=new h.e(e.range.startLineNumber,t,e.range.startLineNumber,l);a.push(new x(this,u,(0,n._2)(c),d++))}return a}computeAsync(e,t,i){if(!this._editor.hasModel()||1!==e.type)return s.Aq.EMPTY;const o=this._editor.getModel();if(!c.xp.has(o))return s.Aq.EMPTY;return v(o,new l.L(e.range.startLineNumber,e.range.startColumn),i).filter(e=>!(0,r.CP)(e.hover.contents)).map(t=>{const i=t.hover.range?h.e.lift(t.hover.range):e.range;return new x(this,i,t.hover.contents,t.ordinal)})}renderHoverParts(e,t,i){return D(e,t,this._editor,this._hover,this._modeService,this._openerService)}};function D(e,t,i,n,s,l){e.sort((e,t)=>e.ordinal-t.ordinal);const h=new a.SL;for(const a of e)for(const e of a.contents){if((0,r.CP)(e))continue;const a=k("div.hover-row.markdown-hover"),c=o.R3(a,k("div.hover-contents")),u=h.add(new d.$({editor:i},s,l));h.add(u.onDidRenderAsync(()=>{c.className="hover-contents code-hover-contents",n.onContentsChanged()}));const g=h.add(u.render(e));c.appendChild(g.element),t.appendChild(a)}return h}M=b([S(2,u.h),S(3,y.v4),S(4,w.Ui)],M)},82276:(e,t,i)=>{i.d(t,{O:()=>u});var o=i(85152),n=i(15393),s=i(9917),r=i(16830),a=i(24314),d=i(63580),l=i(38819),h=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},c=function(e,t){return function(i,o){t(i,o,e)}};let u=class e{constructor(t,i){this._messageWidget=new s.XK,this._messageListeners=new s.SL,this._editor=t,this._visible=e.MESSAGE_VISIBLE.bindTo(i),this._editorListener=this._editor.onDidAttemptReadOnlyEdit(()=>this._onDidAttemptReadOnlyEdit())}static get(t){return t.getContribution(e.ID)}dispose(){this._editorListener.dispose(),this._messageListeners.dispose(),this._messageWidget.dispose(),this._visible.reset()}showMessage(e,t){let i;(0,o.Z9)(e),this._visible.set(!0),this._messageWidget.clear(),this._messageListeners.clear(),this._messageWidget.value=new p(this._editor,t,e),this._messageListeners.add(this._editor.onDidBlurEditorText(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidChangeCursorPosition(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidDispose(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidChangeModel(()=>this.closeMessage())),this._messageListeners.add(new n._F(()=>this.closeMessage(),3e3)),this._messageListeners.add(this._editor.onMouseMove(e=>{e.target.position&&(i?i.containsPosition(e.target.position)||this.closeMessage():i=new a.e(t.lineNumber-3,1,e.target.position.lineNumber+3,1))}))}closeMessage(){this._visible.reset(),this._messageListeners.clear(),this._messageWidget.value&&this._messageListeners.add(p.fadeOut(this._messageWidget.value))}_onDidAttemptReadOnlyEdit(){this._editor.hasModel()&&this.showMessage(d.N("editor.readonly","Cannot edit in read-only editor"),this._editor.getPosition())}};u.ID="editor.contrib.messageController",u.MESSAGE_VISIBLE=new l.uy("messageVisible",!1,d.N("messageVisible","Whether the editor is currently showing an inline message")),u=h([c(1,l.i6)],u);const g=r._l.bindToContribution(u.get);(0,r.fK)(new g({id:"leaveEditorMessage",precondition:u.MESSAGE_VISIBLE,handler:e=>e.closeMessage(),kbOpts:{weight:130,primary:9}}));class p{constructor(e,{lineNumber:t,column:i},o){this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._editor=e,this._editor.revealLinesInCenterIfOutsideViewport(t,t,0),this._position={lineNumber:t,column:i-1},this._domNode=document.createElement("div"),this._domNode.classList.add("monaco-editor-overlaymessage");const n=document.createElement("div");n.classList.add("anchor","top"),this._domNode.appendChild(n);const s=document.createElement("div");s.classList.add("message"),s.textContent=o,this._domNode.appendChild(s);const r=document.createElement("div");r.classList.add("anchor","below"),this._domNode.appendChild(r),this._editor.addContentWidget(this),this._domNode.classList.add("fadeIn")}static fadeOut(e){let t;const i=()=>{e.dispose(),clearTimeout(t),e.getDomNode().removeEventListener("animationend",i)};return t=setTimeout(i,110),e.getDomNode().addEventListener("animationend",i),e.getDomNode().classList.add("fadeOut"),{dispose:i}}dispose(){this._editor.removeContentWidget(this)}getId(){return"messageoverlay"}getDomNode(){return this._domNode}getPosition(){return{position:this._position,preference:[1,2]}}afterRender(e){this._domNode.classList.toggle("below",2===e)}}(0,r._K)(u.ID,u)},40517:(e,t,i)=>{i.r(t),i.d(t,{TriggerParameterHintsAction:()=>q});var o=i(9917),n=i(16830),s=i(29102),r=i(44101),a=i(71050),d=i(17301),l=i(98401),h=i(70666),c=i(50187),u=i(88216),g=i(94565),p=i(38819),m=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function a(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};const f={Visible:new p.uy("parameterHintsVisible",!1),MultipleSignatures:new p.uy("parameterHintsMultipleSignatures",!1)};function _(e,t,i,o){return m(this,void 0,void 0,(function*(){const n=r.nD.ordered(e);for(const s of n)try{const n=yield s.provideSignatureHelp(e,t,o,i);if(n)return n}catch(e){(0,d.Cp)(e)}}))}g.P0.registerCommand("_executeSignatureHelpProvider",(e,...t)=>m(void 0,void 0,void 0,(function*(){const[i,o,n]=t;(0,l.p_)(h.o.isUri(i)),(0,l.p_)(c.L.isIPosition(o)),(0,l.p_)("string"==typeof n||!n);const s=yield e.get(u.S).createModelReference(i);try{const e=yield _(s.object.textEditorModel,c.L.lift(o),{triggerKind:r.WW.Invoke,isRetrigger:!1,triggerCharacter:n},a.T.None);if(!e)return;return setTimeout(()=>e.dispose(),0),e.value}finally{s.dispose()}})));var v,C=i(63580),w=i(72065),y=i(65321),b=i(85152),S=i(9802),k=i(73046),x=i(4669),M=i(97295),D=i(88527),I=i(71531),N=i(15393),R=i(44906),P=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function a(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((o=o.apply(e,t||[])).next())}))};!function(e){e.Default={type:0};e.Pending=class{constructor(e,t){this.request=e,this.previouslyActiveHints=t,this.type=2}};e.Active=class{constructor(e){this.hints=e,this.type=1}}}(v||(v={}));class L extends o.JT{constructor(e,t=L.DEFAULT_DELAY){super(),this._onChangedHints=this._register(new x.Q5),this.onChangedHints=this._onChangedHints.event,this.triggerOnType=!1,this._state=v.Default,this._pendingTriggers=[],this._lastSignatureHelpResult=this._register(new o.XK),this.triggerChars=new R.q,this.retriggerChars=new R.q,this.triggerId=0,this.editor=e,this.throttledDelayer=new N.vp(t),this._register(this.editor.onDidBlurEditorWidget(()=>this.cancel())),this._register(this.editor.onDidChangeConfiguration(()=>this.onEditorConfigurationChange())),this._register(this.editor.onDidChangeModel(e=>this.onModelChanged())),this._register(this.editor.onDidChangeModelLanguage(e=>this.onModelChanged())),this._register(this.editor.onDidChangeCursorSelection(e=>this.onCursorChange(e))),this._register(this.editor.onDidChangeModelContent(e=>this.onModelContentChange())),this._register(r.nD.onDidChange(this.onModelChanged,this)),this._register(this.editor.onDidType(e=>this.onDidType(e))),this.onEditorConfigurationChange(),this.onModelChanged()}get state(){return this._state}set state(e){2===this._state.type&&this._state.request.cancel(),this._state=e}cancel(e=!1){this.state=v.Default,this.throttledDelayer.cancel(),e||this._onChangedHints.fire(void 0)}trigger(e,t){const i=this.editor.getModel();if(!i||!r.nD.has(i))return;const o=++this.triggerId;this._pendingTriggers.push(e),this.throttledDelayer.trigger(()=>this.doTrigger(o),t).catch(d.dL)}next(){if(1!==this.state.type)return;const e=this.state.hints.signatures.length,t=this.state.hints.activeSignature,i=t%e==e-1,o=this.editor.getOption(75).cycle;!(e<2||i)||o?this.updateActiveSignature(i&&o?0:t+1):this.cancel()}previous(){if(1!==this.state.type)return;const e=this.state.hints.signatures.length,t=this.state.hints.activeSignature,i=0===t,o=this.editor.getOption(75).cycle;!(e<2||i)||o?this.updateActiveSignature(i&&o?e-1:t-1):this.cancel()}updateActiveSignature(e){1===this.state.type&&(this.state=new v.Active(Object.assign(Object.assign({},this.state.hints),{activeSignature:e})),this._onChangedHints.fire(this.state.hints))}doTrigger(e){return P(this,void 0,void 0,(function*(){const t=1===this.state.type||2===this.state.type,i=this.getLastActiveHints();if(this.cancel(!0),0===this._pendingTriggers.length)return!1;const o=this._pendingTriggers.reduce(E);this._pendingTriggers=[];const n={triggerKind:o.triggerKind,triggerCharacter:o.triggerCharacter,isRetrigger:t,activeSignatureHelp:i};if(!this.editor.hasModel())return!1;const s=this.editor.getModel(),r=this.editor.getPosition();this.state=new v.Pending((0,N.PG)(e=>_(s,r,n,e)),i);try{const t=yield this.state.request;return e!==this.triggerId?(null==t||t.dispose(),!1):t&&t.value.signatures&&0!==t.value.signatures.length?(this.state=new v.Active(t.value),this._lastSignatureHelpResult.value=t,this._onChangedHints.fire(this.state.hints),!0):(null==t||t.dispose(),this._lastSignatureHelpResult.clear(),this.cancel(),!1)}catch(t){return e===this.triggerId&&(this.state=v.Default),(0,d.dL)(t),!1}}))}getLastActiveHints(){switch(this.state.type){case 1:return this.state.hints;case 2:return this.state.previouslyActiveHints;default:return}}get isTriggered(){return 1===this.state.type||2===this.state.type||this.throttledDelayer.isTriggered()}onModelChanged(){this.cancel(),this.triggerChars=new R.q,this.retriggerChars=new R.q;const e=this.editor.getModel();if(e)for(const t of r.nD.ordered(e)){for(const e of t.signatureHelpTriggerCharacters||[])this.triggerChars.add(e.charCodeAt(0)),this.retriggerChars.add(e.charCodeAt(0));for(const e of t.signatureHelpRetriggerCharacters||[])this.retriggerChars.add(e.charCodeAt(0))}}onDidType(e){if(!this.triggerOnType)return;const t=e.length-1,i=e.charCodeAt(t);(this.triggerChars.has(i)||this.isTriggered&&this.retriggerChars.has(i))&&this.trigger({triggerKind:r.WW.TriggerCharacter,triggerCharacter:e.charAt(t)})}onCursorChange(e){"mouse"===e.source?this.cancel():this.isTriggered&&this.trigger({triggerKind:r.WW.ContentChange})}onModelContentChange(){this.isTriggered&&this.trigger({triggerKind:r.WW.ContentChange})}onEditorConfigurationChange(){this.triggerOnType=this.editor.getOption(75).enabled,this.triggerOnType||this.cancel()}dispose(){this.cancel(!0),super.dispose()}}function E(e,t){switch(t.triggerKind){case r.WW.Invoke:return t;case r.WW.ContentChange:return e;case r.WW.TriggerCharacter:default:return t}}L.DEFAULT_DELAY=120;var T=i(50988),O=i(73910),A=i(59554),W=i(92321),F=i(97781),H=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},V=function(e,t){return function(i,o){t(i,o,e)}};const K=y.$,B=(0,A.q5)("parameter-hints-next",k.lA.chevronDown,C.N("parameterHintsNextIcon","Icon for show next parameter hint.")),G=(0,A.q5)("parameter-hints-previous",k.lA.chevronUp,C.N("parameterHintsPreviousIcon","Icon for show previous parameter hint."));let $=class e extends o.JT{constructor(e,t,i,n){super(),this.editor=e,this.renderDisposeables=this._register(new o.SL),this.visible=!1,this.announcedLabel=null,this.allowEditorOverflow=!0,this.markdownRenderer=this._register(new D.$({editor:e},n,i)),this.model=this._register(new L(e)),this.keyVisible=f.Visible.bindTo(t),this.keyMultipleSignatures=f.MultipleSignatures.bindTo(t),this._register(this.model.onChangedHints(e=>{e?(this.show(),this.render(e)):this.hide()}))}createParameterHintDOMNodes(){const e=K(".editor-widget.parameter-hints-widget"),t=y.R3(e,K(".phwrapper"));t.tabIndex=-1;const i=y.R3(t,K(".controls")),o=y.R3(i,K(".button"+F.kS.asCSSSelector(G))),n=y.R3(i,K(".overloads")),s=y.R3(i,K(".button"+F.kS.asCSSSelector(B)));this._register(y.nm(o,"click",e=>{y.zB.stop(e),this.previous()})),this._register(y.nm(s,"click",e=>{y.zB.stop(e),this.next()}));const r=K(".body"),a=new S.s$(r,{});this._register(a),t.appendChild(a.getDomNode());const d=y.R3(r,K(".signature")),l=y.R3(r,K(".docs"));e.style.userSelect="text",this.domNodes={element:e,signature:d,overloads:n,docs:l,scrollbar:a},this.editor.addContentWidget(this),this.hide(),this._register(this.editor.onDidChangeCursorSelection(e=>{this.visible&&this.editor.layoutContentWidget(this)}));const h=()=>{if(!this.domNodes)return;const e=this.editor.getOption(43);this.domNodes.element.style.fontSize=e.fontSize+"px",this.domNodes.element.style.lineHeight=""+e.lineHeight/e.fontSize};h(),this._register(x.ju.chain(this.editor.onDidChangeConfiguration.bind(this.editor)).filter(e=>e.hasChanged(43)).on(h,null)),this._register(this.editor.onDidLayoutChange(e=>this.updateMaxHeight())),this.updateMaxHeight()}show(){this.visible||(this.domNodes||this.createParameterHintDOMNodes(),this.keyVisible.set(!0),this.visible=!0,setTimeout(()=>{this.domNodes&&this.domNodes.element.classList.add("visible")},100),this.editor.layoutContentWidget(this))}hide(){this.renderDisposeables.clear(),this.visible&&(this.keyVisible.reset(),this.visible=!1,this.announcedLabel=null,this.domNodes&&this.domNodes.element.classList.remove("visible"),this.editor.layoutContentWidget(this))}getPosition(){return this.visible?{position:this.editor.getPosition(),preference:[1,2]}:null}render(e){var t;if(this.renderDisposeables.clear(),!this.domNodes)return;const i=e.signatures.length>1;this.domNodes.element.classList.toggle("multiple",i),this.keyMultipleSignatures.set(i),this.domNodes.signature.innerText="",this.domNodes.docs.innerText="";const o=e.signatures[e.activeSignature];if(!o)return;const n=y.R3(this.domNodes.signature,K(".code")),s=this.editor.getOption(43);n.style.fontSize=s.fontSize+"px",n.style.fontFamily=s.fontFamily;const r=o.parameters.length>0,a=null!==(t=o.activeParameter)&&void 0!==t?t:e.activeParameter;if(r)this.renderParameters(n,o,a);else{y.R3(n,K("span")).textContent=o.label}const d=o.parameters[a];if(null==d?void 0:d.documentation){const e=K("span.documentation");if("string"==typeof d.documentation)e.textContent=d.documentation;else{const t=this.renderMarkdownDocs(d.documentation);e.appendChild(t.element)}y.R3(this.domNodes.docs,K("p",{},e))}if(void 0===o.documentation);else if("string"==typeof o.documentation)y.R3(this.domNodes.docs,K("p",{},o.documentation));else{const e=this.renderMarkdownDocs(o.documentation);y.R3(this.domNodes.docs,e.element)}const l=this.hasDocs(o,d);if(this.domNodes.signature.classList.toggle("has-docs",l),this.domNodes.docs.classList.toggle("empty",!l),this.domNodes.overloads.textContent=String(e.activeSignature+1).padStart(e.signatures.length.toString().length,"0")+"/"+e.signatures.length,d){let e="";const t=o.parameters[a];e=Array.isArray(t.label)?o.label.substring(t.label[0],t.label[1]):t.label,t.documentation&&(e+="string"==typeof t.documentation?", "+t.documentation:", "+t.documentation.value),o.documentation&&(e+="string"==typeof o.documentation?", "+o.documentation:", "+o.documentation.value),this.announcedLabel!==e&&(b.Z9(C.N("hint","{0}, hint",e)),this.announcedLabel=e)}this.editor.layoutContentWidget(this),this.domNodes.scrollbar.scanDomNode()}renderMarkdownDocs(e){const t=this.renderDisposeables.add(this.markdownRenderer.render(e,{asyncRenderCallback:()=>{var e;null===(e=this.domNodes)||void 0===e||e.scrollbar.scanDomNode()}}));return t.element.classList.add("markdown-docs"),t}hasDocs(e,t){return!!(t&&"string"==typeof t.documentation&&(0,l.cW)(t.documentation).length>0)||(!!(t&&"object"==typeof t.documentation&&(0,l.cW)(t.documentation).value.length>0)||(!!(e.documentation&&"string"==typeof e.documentation&&(0,l.cW)(e.documentation).length>0)||!!(e.documentation&&"object"==typeof e.documentation&&(0,l.cW)(e.documentation.value).length>0)))}renderParameters(e,t,i){const[o,n]=this.getParameterLabelOffsets(t,i),s=document.createElement("span");s.textContent=t.label.substring(0,o);const r=document.createElement("span");r.textContent=t.label.substring(o,n),r.className="parameter active";const a=document.createElement("span");a.textContent=t.label.substring(n),y.R3(e,s,r,a)}getParameterLabelOffsets(e,t){const i=e.parameters[t];if(i){if(Array.isArray(i.label))return i.label;if(i.label.length){const t=new RegExp(`(\\W|^)${(0,M.ec)(i.label)}(?=\\W|$)`,"g");t.test(e.label);const o=t.lastIndex-i.label.length;return o>=0?[o,t.lastIndex]:[0,0]}return[0,0]}return[0,0]}next(){this.editor.focus(),this.model.next()}previous(){this.editor.focus(),this.model.previous()}cancel(){this.model.cancel()}getDomNode(){return this.domNodes||this.createParameterHintDOMNodes(),this.domNodes.element}getId(){return e.ID}trigger(e){this.model.trigger(e,0)}updateMaxHeight(){if(!this.domNodes)return;const e=Math.max(this.editor.getLayoutInfo().height/4,250)+"px";this.domNodes.element.style.maxHeight=e;const t=this.domNodes.element.getElementsByClassName("phwrapper");t.length&&(t[0].style.maxHeight=e)}};$.ID="editor.widget.parameterHintsWidget",$=H([V(1,p.i6),V(2,T.v4),V(3,I.h)],$);const U=(0,O.P6G)("editorHoverWidget.highlightForeground",{dark:O.Gwp,light:O.Gwp,hc:O.Gwp},C.N("editorHoverWidgetHighlightForeground","Foreground color of the active item in the parameter hint."));(0,F.Ic)((e,t)=>{const i=e.getColor(O.CNo);if(i){const o=e.type===W.e.HIGH_CONTRAST?2:1;t.addRule(`.monaco-editor .parameter-hints-widget { border: ${o}px solid ${i}; }`),t.addRule(`.monaco-editor .parameter-hints-widget.multiple .body { border-left: 1px solid ${i.transparent(.5)}; }`),t.addRule(`.monaco-editor .parameter-hints-widget .signature.has-docs { border-bottom: 1px solid ${i.transparent(.5)}; }`)}const o=e.getColor(O.yJx);o&&t.addRule(`.monaco-editor .parameter-hints-widget { background-color: ${o}; }`);const n=e.getColor(O.url);n&&t.addRule(`.monaco-editor .parameter-hints-widget a { color: ${n}; }`);const s=e.getColor(O.sgC);s&&t.addRule(`.monaco-editor .parameter-hints-widget a:hover { color: ${s}; }`);const r=e.getColor(O.Sbf);r&&t.addRule(`.monaco-editor .parameter-hints-widget { color: ${r}; }`);const a=e.getColor(O.SwI);a&&t.addRule(`.monaco-editor .parameter-hints-widget code { background-color: ${a}; }`);const d=e.getColor(U);d&&t.addRule(`.monaco-editor .parameter-hints-widget .parameter.active { color: ${d}}`)});var j=function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},Z=function(e,t){return function(i,o){t(i,o,e)}};let z=class e extends o.JT{constructor(e,t){super(),this.editor=e,this.widget=this._register(t.createInstance($,this.editor))}static get(t){return t.getContribution(e.ID)}cancel(){this.widget.cancel()}previous(){this.widget.previous()}next(){this.widget.next()}trigger(e){this.widget.trigger(e)}};z.ID="editor.controller.parameterHints",z=j([Z(1,w.TG)],z);class q extends n.R6{constructor(){super({id:"editor.action.triggerParameterHints",label:C.N("parameterHints.trigger.label","Trigger Parameter Hints"),alias:"Trigger Parameter Hints",precondition:s.u.hasSignatureHelpProvider,kbOpts:{kbExpr:s.u.editorTextFocus,primary:3082,weight:100}})}run(e,t){const i=z.get(t);i&&i.trigger({triggerKind:r.WW.Invoke})}}(0,n._K)(z.ID,z),(0,n.Qr)(q);const Q=n._l.bindToContribution(z.get);(0,n.fK)(new Q({id:"closeParameterHints",precondition:f.Visible,handler:e=>e.cancel(),kbOpts:{weight:175,kbExpr:s.u.focus,primary:9,secondary:[1033]}})),(0,n.fK)(new Q({id:"showPrevParameterHint",precondition:p.Ao.and(f.Visible,f.MultipleSignatures),handler:e=>e.previous(),kbOpts:{weight:175,kbExpr:s.u.focus,primary:16,secondary:[528],mac:{primary:16,secondary:[528,302]}}})),(0,n.fK)(new Q({id:"showNextParameterHint",precondition:p.Ao.and(f.Visible,f.MultipleSignatures),handler:e=>e.next(),kbOpts:{weight:175,kbExpr:s.u.focus,primary:18,secondary:[530],mac:{primary:18,secondary:[530,300]}}}))}}]);