"use strict";(self.webpackChunkdt_em_front=self.webpackChunkdt_em_front||[]).push([[6928],{29981:(e,t,n)=>{n.d(t,{v:()=>o});var i=n(97295),s=n(50187),r=n(3544);class o{constructor(e,t,n,i){this._uri=e,this._lines=t,this._eol=n,this._versionId=i,this._lineStarts=null,this._cachedTextValue=null}dispose(){this._lines.length=0}get version(){return this._versionId}getText(){return null===this._cachedTextValue&&(this._cachedTextValue=this._lines.join(this._eol)),this._cachedTextValue}onEvents(e){e.eol&&e.eol!==this._eol&&(this._eol=e.eol,this._lineStarts=null);const t=e.changes;for(const e of t)this._acceptDeleteRange(e.range),this._acceptInsertText(new s.L(e.range.startLineNumber,e.range.startColumn),e.text);this._versionId=e.versionId,this._cachedTextValue=null}_ensureLineStarts(){if(!this._lineStarts){const e=this._eol.length,t=this._lines.length,n=new Uint32Array(t);for(let i=0;i<t;i++)n[i]=this._lines[i].length+e;this._lineStarts=new r.oQ(n)}}_setLineText(e,t){this._lines[e]=t,this._lineStarts&&this._lineStarts.setValue(e,this._lines[e].length+this._eol.length)}_acceptDeleteRange(e){if(e.startLineNumber!==e.endLineNumber)this._setLineText(e.startLineNumber-1,this._lines[e.startLineNumber-1].substring(0,e.startColumn-1)+this._lines[e.endLineNumber-1].substring(e.endColumn-1)),this._lines.splice(e.startLineNumber,e.endLineNumber-e.startLineNumber),this._lineStarts&&this._lineStarts.removeValues(e.startLineNumber,e.endLineNumber-e.startLineNumber);else{if(e.startColumn===e.endColumn)return;this._setLineText(e.startLineNumber-1,this._lines[e.startLineNumber-1].substring(0,e.startColumn-1)+this._lines[e.startLineNumber-1].substring(e.endColumn-1))}}_acceptInsertText(e,t){if(0===t.length)return;let n=(0,i.uq)(t);if(1===n.length)return void this._setLineText(e.lineNumber-1,this._lines[e.lineNumber-1].substring(0,e.column-1)+n[0]+this._lines[e.lineNumber-1].substring(e.column-1));n[n.length-1]+=this._lines[e.lineNumber-1].substring(e.column-1),this._setLineText(e.lineNumber-1,this._lines[e.lineNumber-1].substring(0,e.column-1)+n[0]);let s=new Uint32Array(n.length-1);for(let t=1;t<n.length;t++)this._lines.splice(e.lineNumber+t-1,0,n[t]),s[t-1]=n[t].length+this._eol.length;this._lineStarts&&this._lineStarts.insertValues(e.lineNumber,s)}}},60962:(e,t,n)=>{n.d(t,{b:()=>a,q:()=>o});var i=n(53060),s=n(50072);function r(e){return e.replace(/\n/g,"\\n").replace(/\r/g,"\\r")}class o{constructor(e,t,n,i){this.oldPosition=e,this.oldText=t,this.newPosition=n,this.newText=i}get oldLength(){return this.oldText.length}get oldEnd(){return this.oldPosition+this.oldText.length}get newLength(){return this.newText.length}get newEnd(){return this.newPosition+this.newText.length}toString(){return 0===this.oldText.length?`(insert@${this.oldPosition} "${r(this.newText)}")`:0===this.newText.length?`(delete@${this.oldPosition} "${r(this.oldText)}")`:`(replace@${this.oldPosition} "${r(this.oldText)}" with "${r(this.newText)}")`}static _writeStringSize(e){return 4+2*e.length}static _writeString(e,t,n){const s=t.length;i.T4(e,s,n),n+=4;for(let r=0;r<s;r++)i.oq(e,t.charCodeAt(r),n),n+=2;return n}static _readString(e,t){const n=i.Ag(e,t);return t+=4,(0,s.kH)(e,t,n)}writeSize(){return 8+o._writeStringSize(this.oldText)+o._writeStringSize(this.newText)}write(e,t){return i.T4(e,this.oldPosition,t),t+=4,i.T4(e,this.newPosition,t),t+=4,t=o._writeString(e,this.oldText,t),t=o._writeString(e,this.newText,t)}static read(e,t,n){const s=i.Ag(e,t);t+=4;const r=i.Ag(e,t);t+=4;const a=o._readString(e,t);t+=o._writeStringSize(a);const l=o._readString(e,t);return t+=o._writeStringSize(l),n.push(new o(s,a,r,l)),t}}function a(e,t){if(null===e||0===e.length)return t;return new l(e,t).compress()}class l{constructor(e,t){this._prevEdits=e,this._currEdits=t,this._result=[],this._resultLen=0,this._prevLen=this._prevEdits.length,this._prevDeltaOffset=0,this._currLen=this._currEdits.length,this._currDeltaOffset=0}compress(){let e=0,t=0,n=this._getPrev(e),i=this._getCurr(t);for(;e<this._prevLen||t<this._currLen;){if(null===n){this._acceptCurr(i),i=this._getCurr(++t);continue}if(null===i){this._acceptPrev(n),n=this._getPrev(++e);continue}if(i.oldEnd<=n.newPosition){this._acceptCurr(i),i=this._getCurr(++t);continue}if(n.newEnd<=i.oldPosition){this._acceptPrev(n),n=this._getPrev(++e);continue}if(i.oldPosition<n.newPosition){const[e,t]=l._splitCurr(i,n.newPosition-i.oldPosition);this._acceptCurr(e),i=t;continue}if(n.newPosition<i.oldPosition){const[e,t]=l._splitPrev(n,i.oldPosition-n.newPosition);this._acceptPrev(e),n=t;continue}let s,r;if(i.oldEnd===n.newEnd)s=n,r=i,n=this._getPrev(++e),i=this._getCurr(++t);else if(i.oldEnd<n.newEnd){const[e,o]=l._splitPrev(n,i.oldLength);s=e,r=i,n=o,i=this._getCurr(++t)}else{const[t,o]=l._splitCurr(i,n.newLength);s=n,r=t,n=this._getPrev(++e),i=o}this._result[this._resultLen++]=new o(s.oldPosition,s.oldText,r.newPosition,r.newText),this._prevDeltaOffset+=s.newLength-s.oldLength,this._currDeltaOffset+=r.newLength-r.oldLength}const s=l._merge(this._result);return l._removeNoOps(s)}_acceptCurr(e){this._result[this._resultLen++]=l._rebaseCurr(this._prevDeltaOffset,e),this._currDeltaOffset+=e.newLength-e.oldLength}_getCurr(e){return e<this._currLen?this._currEdits[e]:null}_acceptPrev(e){this._result[this._resultLen++]=l._rebasePrev(this._currDeltaOffset,e),this._prevDeltaOffset+=e.newLength-e.oldLength}_getPrev(e){return e<this._prevLen?this._prevEdits[e]:null}static _rebaseCurr(e,t){return new o(t.oldPosition-e,t.oldText,t.newPosition,t.newText)}static _rebasePrev(e,t){return new o(t.oldPosition,t.oldText,t.newPosition+e,t.newText)}static _splitPrev(e,t){const n=e.newText.substr(0,t),i=e.newText.substr(t);return[new o(e.oldPosition,e.oldText,e.newPosition,n),new o(e.oldEnd,"",e.newPosition+t,i)]}static _splitCurr(e,t){const n=e.oldText.substr(0,t),i=e.oldText.substr(t);return[new o(e.oldPosition,n,e.newPosition,e.newText),new o(e.oldPosition+t,i,e.newEnd,"")]}static _merge(e){if(0===e.length)return e;let t=[],n=0,i=e[0];for(let s=1;s<e.length;s++){const r=e[s];i.oldEnd===r.oldPosition?i=new o(i.oldPosition,i.oldText+r.oldText,i.newPosition,i.newText+r.newText):(t[n++]=i,i=r)}return t[n++]=i,t}static _removeNoOps(e){if(0===e.length)return e;let t=[],n=0;for(let i=0;i<e.length;i++){const s=e[i];s.oldText!==s.newText&&(t[n++]=s)}return t}}},75425:(e,t,n)=>{n.d(t,{WE:()=>_e,qx:()=>xe,yO:()=>ge});var i=n(17301),s=n(4669),r=n(9917),o=n(97295),a=n(70666),l=n(64141),h=n(50187),u=n(24314),c=n(3860),f=n(84973),d=n(95215),g=n(13434),_=n(43465);class p{constructor(e,t){this.piece=e,this.color=t,this.size_left=0,this.lf_left=0,this.parent=this,this.left=this,this.right=this}next(){if(this.right!==m)return L(this.right);let e=this;for(;e.parent!==m&&e.parent.left!==e;)e=e.parent;return e.parent===m?m:e.parent}prev(){if(this.left!==m)return C(this.left);let e=this;for(;e.parent!==m&&e.parent.right!==e;)e=e.parent;return e.parent===m?m:e.parent}detach(){this.parent=null,this.left=null,this.right=null}}const m=new p(null,0);function L(e){for(;e.left!==m;)e=e.left;return e}function C(e){for(;e.right!==m;)e=e.right;return e}function b(e){return e===m?0:e.size_left+e.piece.length+b(e.right)}function I(e){return e===m?0:e.lf_left+e.piece.lineFeedCnt+I(e.right)}function N(){m.parent=m}function v(e,t){let n=t.right;n.size_left+=t.size_left+(t.piece?t.piece.length:0),n.lf_left+=t.lf_left+(t.piece?t.piece.lineFeedCnt:0),t.right=n.left,n.left!==m&&(n.left.parent=t),n.parent=t.parent,t.parent===m?e.root=n:t.parent.left===t?t.parent.left=n:t.parent.right=n,n.left=t,t.parent=n}function x(e,t){let n=t.left;t.left=n.right,n.right!==m&&(n.right.parent=t),n.parent=t.parent,t.size_left-=n.size_left+(n.piece?n.piece.length:0),t.lf_left-=n.lf_left+(n.piece?n.piece.lineFeedCnt:0),t.parent===m?e.root=n:t===t.parent.right?t.parent.right=n:t.parent.left=n,n.right=t,t.parent=n}function T(e,t){let n,i;if(t.left===m?(i=t,n=i.right):t.right===m?(i=t,n=i.left):(i=L(t.right),n=i.right),i===e.root)return e.root=n,n.color=0,t.detach(),N(),void(e.root.parent=m);let s,r=1===i.color;if(i===i.parent.left?i.parent.left=n:i.parent.right=n,i===t?(n.parent=i.parent,S(e,n)):(i.parent===t?n.parent=i:n.parent=i.parent,S(e,n),i.left=t.left,i.right=t.right,i.parent=t.parent,i.color=t.color,t===e.root?e.root=i:t===t.parent.left?t.parent.left=i:t.parent.right=i,i.left!==m&&(i.left.parent=i),i.right!==m&&(i.right.parent=i),i.size_left=t.size_left,i.lf_left=t.lf_left,S(e,i)),t.detach(),n.parent.left===n){let t=b(n),i=I(n);if(t!==n.parent.size_left||i!==n.parent.lf_left){let s=t-n.parent.size_left,r=i-n.parent.lf_left;n.parent.size_left=t,n.parent.lf_left=i,k(e,n.parent,s,r)}}if(S(e,n.parent),r)N();else{for(;n!==e.root&&0===n.color;)n===n.parent.left?(s=n.parent.right,1===s.color&&(s.color=0,n.parent.color=1,v(e,n.parent),s=n.parent.right),0===s.left.color&&0===s.right.color?(s.color=1,n=n.parent):(0===s.right.color&&(s.left.color=0,s.color=1,x(e,s),s=n.parent.right),s.color=n.parent.color,n.parent.color=0,s.right.color=0,v(e,n.parent),n=e.root)):(s=n.parent.left,1===s.color&&(s.color=0,n.parent.color=1,x(e,n.parent),s=n.parent.left),0===s.left.color&&0===s.right.color?(s.color=1,n=n.parent):(0===s.left.color&&(s.right.color=0,s.color=1,v(e,s),s=n.parent.left),s.color=n.parent.color,n.parent.color=0,s.left.color=0,x(e,n.parent),n=e.root));n.color=0,N()}}function w(e,t){for(S(e,t);t!==e.root&&1===t.parent.color;)if(t.parent===t.parent.parent.left){const n=t.parent.parent.right;1===n.color?(t.parent.color=0,n.color=0,t.parent.parent.color=1,t=t.parent.parent):(t===t.parent.right&&v(e,t=t.parent),t.parent.color=0,t.parent.parent.color=1,x(e,t.parent.parent))}else{const n=t.parent.parent.left;1===n.color?(t.parent.color=0,n.color=0,t.parent.parent.color=1,t=t.parent.parent):(t===t.parent.left&&x(e,t=t.parent),t.parent.color=0,t.parent.parent.color=1,v(e,t.parent.parent))}e.root.color=0}function k(e,t,n,i){for(;t!==e.root&&t!==m;)t.parent.left===t&&(t.parent.size_left+=n,t.parent.lf_left+=i),t=t.parent}function S(e,t){let n=0,i=0;if(t!==e.root){for(;t!==e.root&&t===t.parent.right;)t=t.parent;if(t!==e.root)for(n=b((t=t.parent).left)-t.size_left,i=I(t.left)-t.lf_left,t.size_left+=n,t.lf_left+=i;t!==e.root&&(0!==n||0!==i);)t.parent.left===t&&(t.parent.size_left+=n,t.parent.lf_left+=i),t=t.parent}}m.parent=m,m.left=m,m.right=m,m.color=0;var E=n(77277);function D(e){let t;return t=e[e.length-1]<65536?new Uint16Array(e.length):new Uint32Array(e.length),t.set(e,0),t}class A{constructor(e,t,n,i,s){this.lineStarts=e,this.cr=t,this.lf=n,this.crlf=i,this.isBasicASCII=s}}function O(e,t=!0){let n=[0],i=1;for(let t=0,s=e.length;t<s;t++){const r=e.charCodeAt(t);13===r?t+1<s&&10===e.charCodeAt(t+1)?(n[i++]=t+2,t++):n[i++]=t+1:10===r&&(n[i++]=t+1)}return t?D(n):n}class R{constructor(e,t,n,i,s){this.bufferIndex=e,this.start=t,this.end=n,this.lineFeedCnt=i,this.length=s}}class M{constructor(e,t){this.buffer=e,this.lineStarts=t}}class z{constructor(e,t){this._pieces=[],this._tree=e,this._BOM=t,this._index=0,e.root!==m&&e.iterate(e.root,e=>(e!==m&&this._pieces.push(e.piece),!0))}read(){return 0===this._pieces.length?0===this._index?(this._index++,this._BOM):null:this._index>this._pieces.length-1?null:0===this._index?this._BOM+this._tree.getPieceContent(this._pieces[this._index++]):this._tree.getPieceContent(this._pieces[this._index++])}}class B{constructor(e){this._limit=e,this._cache=[]}get(e){for(let t=this._cache.length-1;t>=0;t--){let n=this._cache[t];if(n.nodeStartOffset<=e&&n.nodeStartOffset+n.node.piece.length>=e)return n}return null}get2(e){for(let t=this._cache.length-1;t>=0;t--){let n=this._cache[t];if(n.nodeStartLineNumber&&n.nodeStartLineNumber<e&&n.nodeStartLineNumber+n.node.piece.lineFeedCnt>=e)return n}return null}set(e){this._cache.length>=this._limit&&this._cache.shift(),this._cache.push(e)}validate(e){let t=!1,n=this._cache;for(let i=0;i<n.length;i++){let s=n[i];(null===s.node.parent||s.nodeStartOffset>=e)&&(n[i]=null,t=!0)}if(t){let e=[];for(const t of n)null!==t&&e.push(t);this._cache=e}}}class P{constructor(e,t,n){this.create(e,t,n)}create(e,t,n){this._buffers=[new M("",[0])],this._lastChangeBufferPos={line:0,column:0},this.root=m,this._lineCnt=1,this._length=0,this._EOL=t,this._EOLLength=t.length,this._EOLNormalized=n;let i=null;for(let t=0,n=e.length;t<n;t++)if(e[t].buffer.length>0){e[t].lineStarts||(e[t].lineStarts=O(e[t].buffer));let n=new R(t+1,{line:0,column:0},{line:e[t].lineStarts.length-1,column:e[t].buffer.length-e[t].lineStarts[e[t].lineStarts.length-1]},e[t].lineStarts.length-1,e[t].buffer.length);this._buffers.push(e[t]),i=this.rbInsertRight(i,n)}this._searchCache=new B(1),this._lastVisitedLine={lineNumber:0,value:""},this.computeBufferMetadata()}normalizeEOL(e){let t=65535-Math.floor(21845),n=2*t,i="",s=0,r=[];if(this.iterate(this.root,o=>{let a=this.getNodeContent(o),l=a.length;if(s<=t||s+l<n)return i+=a,s+=l,!0;let h=i.replace(/\r\n|\r|\n/g,e);return r.push(new M(h,O(h))),i=a,s=l,!0}),s>0){let t=i.replace(/\r\n|\r|\n/g,e);r.push(new M(t,O(t)))}this.create(r,e,!0)}getEOL(){return this._EOL}setEOL(e){this._EOL=e,this._EOLLength=this._EOL.length,this.normalizeEOL(e)}createSnapshot(e){return new z(this,e)}getOffsetAt(e,t){let n=0,i=this.root;for(;i!==m;)if(i.left!==m&&i.lf_left+1>=e)i=i.left;else{if(i.lf_left+i.piece.lineFeedCnt+1>=e){return n+=i.size_left,n+(this.getAccumulatedValue(i,e-i.lf_left-2)+t-1)}e-=i.lf_left+i.piece.lineFeedCnt,n+=i.size_left+i.piece.length,i=i.right}return n}getPositionAt(e){e=Math.floor(e),e=Math.max(0,e);let t=this.root,n=0,i=e;for(;t!==m;)if(0!==t.size_left&&t.size_left>=e)t=t.left;else{if(t.size_left+t.piece.length>=e){let s=this.getIndexOf(t,e-t.size_left);if(n+=t.lf_left+s.index,0===s.index){let e=i-this.getOffsetAt(n+1,1);return new h.L(n+1,e+1)}return new h.L(n+1,s.remainder+1)}if(e-=t.size_left+t.piece.length,n+=t.lf_left+t.piece.lineFeedCnt,t.right===m){let t=i-e-this.getOffsetAt(n+1,1);return new h.L(n+1,t+1)}t=t.right}return new h.L(1,1)}getValueInRange(e,t){if(e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn)return"";let n=this.nodeAt2(e.startLineNumber,e.startColumn),i=this.nodeAt2(e.endLineNumber,e.endColumn),s=this.getValueInRange2(n,i);return t?t===this._EOL&&this._EOLNormalized&&t===this.getEOL()&&this._EOLNormalized?s:s.replace(/\r\n|\r|\n/g,t):s}getValueInRange2(e,t){if(e.node===t.node){let n=e.node,i=this._buffers[n.piece.bufferIndex].buffer,s=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);return i.substring(s+e.remainder,s+t.remainder)}let n=e.node,i=this._buffers[n.piece.bufferIndex].buffer,s=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start),r=i.substring(s+e.remainder,s+n.piece.length);for(n=n.next();n!==m;){let e=this._buffers[n.piece.bufferIndex].buffer,i=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);if(n===t.node){r+=e.substring(i,i+t.remainder);break}r+=e.substr(i,n.piece.length),n=n.next()}return r}getLinesContent(){let e=[],t=0,n="",i=!1;return this.iterate(this.root,s=>{if(s===m)return!0;const r=s.piece;let o=r.length;if(0===o)return!0;const a=this._buffers[r.bufferIndex].buffer,l=this._buffers[r.bufferIndex].lineStarts,h=r.start.line,u=r.end.line;let c=l[h]+r.start.column;if(i&&(10===a.charCodeAt(c)&&(c++,o--),e[t++]=n,n="",i=!1,0===o))return!0;if(h===u)return this._EOLNormalized||13!==a.charCodeAt(c+o-1)?n+=a.substr(c,o):(i=!0,n+=a.substr(c,o-1)),!0;n+=this._EOLNormalized?a.substring(c,Math.max(c,l[h+1]-this._EOLLength)):a.substring(c,l[h+1]).replace(/(\r\n|\r|\n)$/,""),e[t++]=n;for(let i=h+1;i<u;i++)n=this._EOLNormalized?a.substring(l[i],l[i+1]-this._EOLLength):a.substring(l[i],l[i+1]).replace(/(\r\n|\r|\n)$/,""),e[t++]=n;return this._EOLNormalized||13!==a.charCodeAt(l[u]+r.end.column-1)?n=a.substr(l[u],r.end.column):(i=!0,0===r.end.column?t--:n=a.substr(l[u],r.end.column-1)),!0}),i&&(e[t++]=n,n=""),e[t++]=n,e}getLength(){return this._length}getLineCount(){return this._lineCnt}getLineContent(e){return this._lastVisitedLine.lineNumber===e||(this._lastVisitedLine.lineNumber=e,e===this._lineCnt?this._lastVisitedLine.value=this.getLineRawContent(e):this._EOLNormalized?this._lastVisitedLine.value=this.getLineRawContent(e,this._EOLLength):this._lastVisitedLine.value=this.getLineRawContent(e).replace(/(\r\n|\r|\n)$/,"")),this._lastVisitedLine.value}_getCharCode(e){if(e.remainder===e.node.piece.length){let t=e.node.next();if(!t)return 0;let n=this._buffers[t.piece.bufferIndex],i=this.offsetInBuffer(t.piece.bufferIndex,t.piece.start);return n.buffer.charCodeAt(i)}{let t=this._buffers[e.node.piece.bufferIndex],n=this.offsetInBuffer(e.node.piece.bufferIndex,e.node.piece.start)+e.remainder;return t.buffer.charCodeAt(n)}}getLineCharCode(e,t){let n=this.nodeAt2(e,t+1);return this._getCharCode(n)}getLineLength(e){if(e===this.getLineCount()){let t=this.getOffsetAt(e,1);return this.getLength()-t}return this.getOffsetAt(e+1,1)-this.getOffsetAt(e,1)-this._EOLLength}findMatchesInNode(e,t,n,i,s,r,o,a,l,h,c){let f,d,g,_=this._buffers[e.piece.bufferIndex],p=this.offsetInBuffer(e.piece.bufferIndex,e.piece.start),m=this.offsetInBuffer(e.piece.bufferIndex,s),L=this.offsetInBuffer(e.piece.bufferIndex,r),C={line:0,column:0};t._wordSeparators?(d=_.buffer.substring(m,L),g=e=>e+m,t.reset(0)):(d=_.buffer,g=e=>e,t.reset(m));do{if(f=t.next(d),f){if(g(f.index)>=L)return h;this.positionInBuffer(e,g(f.index)-p,C);let t=this.getLineFeedCnt(e.piece.bufferIndex,s,C),r=C.line===s.line?C.column-s.column+i:C.column+1,o=r+f[0].length;if(c[h++]=(0,E.iE)(new u.e(n+t,r,n+t,o),f,a),g(f.index)+f[0].length>=L)return h;if(h>=l)return h}}while(f);return h}findMatchesLineByLine(e,t,n,i){const s=[];let r=0;const o=new E.sz(t.wordSeparators,t.regex);let a=this.nodeAt2(e.startLineNumber,e.startColumn);if(null===a)return[];let l=this.nodeAt2(e.endLineNumber,e.endColumn);if(null===l)return[];let h=this.positionInBuffer(a.node,a.remainder),u=this.positionInBuffer(l.node,l.remainder);if(a.node===l.node)return this.findMatchesInNode(a.node,o,e.startLineNumber,e.startColumn,h,u,t,n,i,r,s),s;let c=e.startLineNumber,f=a.node;for(;f!==l.node;){let l=this.getLineFeedCnt(f.piece.bufferIndex,h,f.piece.end);if(l>=1){let a=this._buffers[f.piece.bufferIndex].lineStarts,u=this.offsetInBuffer(f.piece.bufferIndex,f.piece.start),d=a[h.line+l],g=c===e.startLineNumber?e.startColumn:1;if(r=this.findMatchesInNode(f,o,c,g,h,this.positionInBuffer(f,d-u),t,n,i,r,s),r>=i)return s;c+=l}let u=c===e.startLineNumber?e.startColumn-1:0;if(c===e.endLineNumber){const a=this.getLineContent(c).substring(u,e.endColumn-1);return r=this._findMatchesInLine(t,o,a,e.endLineNumber,u,r,s,n,i),s}if(r=this._findMatchesInLine(t,o,this.getLineContent(c).substr(u),c,u,r,s,n,i),r>=i)return s;c++,a=this.nodeAt2(c,1),f=a.node,h=this.positionInBuffer(a.node,a.remainder)}if(c===e.endLineNumber){let a=c===e.startLineNumber?e.startColumn-1:0;const l=this.getLineContent(c).substring(a,e.endColumn-1);return r=this._findMatchesInLine(t,o,l,e.endLineNumber,a,r,s,n,i),s}let d=c===e.startLineNumber?e.startColumn:1;return r=this.findMatchesInNode(l.node,o,c,d,h,u,t,n,i,r,s),s}_findMatchesInLine(e,t,n,i,s,r,o,a,l){const h=e.wordSeparators;if(!a&&e.simpleSearch){const t=e.simpleSearch,a=t.length,c=n.length;let d=-a;for(;-1!==(d=n.indexOf(t,d+a));)if((!h||(0,E.cM)(h,n,c,d,a))&&(o[r++]=new f.tk(new u.e(i,d+1+s,i,d+1+a+s),null),r>=l))return r;return r}let c;t.reset(0);do{if(c=t.next(n),c&&(o[r++]=(0,E.iE)(new u.e(i,c.index+1+s,i,c.index+1+c[0].length+s),c,a),r>=l))return r}while(c);return r}insert(e,t,n=!1){if(this._EOLNormalized=this._EOLNormalized&&n,this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",this.root!==m){let{node:n,remainder:i,nodeStartOffset:s}=this.nodeAt(e),r=n.piece,o=r.bufferIndex,a=this.positionInBuffer(n,i);if(0===n.piece.bufferIndex&&r.end.line===this._lastChangeBufferPos.line&&r.end.column===this._lastChangeBufferPos.column&&s+r.length===e&&t.length<65535)return this.appendToNode(n,t),void this.computeBufferMetadata();if(s===e)this.insertContentToNodeLeft(t,n),this._searchCache.validate(e);else if(s+n.piece.length>e){let e=[],s=new R(r.bufferIndex,a,r.end,this.getLineFeedCnt(r.bufferIndex,a,r.end),this.offsetInBuffer(o,r.end)-this.offsetInBuffer(o,a));if(this.shouldCheckCRLF()&&this.endWithCR(t)){if(10===this.nodeCharCodeAt(n,i)){let e={line:s.start.line+1,column:0};s=new R(s.bufferIndex,e,s.end,this.getLineFeedCnt(s.bufferIndex,e,s.end),s.length-1),t+="\n"}}if(this.shouldCheckCRLF()&&this.startWithLF(t)){if(13===this.nodeCharCodeAt(n,i-1)){let s=this.positionInBuffer(n,i-1);this.deleteNodeTail(n,s),t="\r"+t,0===n.piece.length&&e.push(n)}else this.deleteNodeTail(n,a)}else this.deleteNodeTail(n,a);let l=this.createNewPieces(t);s.length>0&&this.rbInsertRight(n,s);let h=n;for(let e=0;e<l.length;e++)h=this.rbInsertRight(h,l[e]);this.deleteNodes(e)}else this.insertContentToNodeRight(t,n)}else{let e=this.createNewPieces(t),n=this.rbInsertLeft(null,e[0]);for(let t=1;t<e.length;t++)n=this.rbInsertRight(n,e[t])}this.computeBufferMetadata()}delete(e,t){if(this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",t<=0||this.root===m)return;let n=this.nodeAt(e),i=this.nodeAt(e+t),s=n.node,r=i.node;if(s===r){let r=this.positionInBuffer(s,n.remainder),o=this.positionInBuffer(s,i.remainder);if(n.nodeStartOffset===e){if(t===s.piece.length){let e=s.next();return T(this,s),this.validateCRLFWithPrevNode(e),void this.computeBufferMetadata()}return this.deleteNodeHead(s,o),this._searchCache.validate(e),this.validateCRLFWithPrevNode(s),void this.computeBufferMetadata()}return n.nodeStartOffset+s.piece.length===e+t?(this.deleteNodeTail(s,r),this.validateCRLFWithNextNode(s),void this.computeBufferMetadata()):(this.shrinkNode(s,r,o),void this.computeBufferMetadata())}let o=[],a=this.positionInBuffer(s,n.remainder);this.deleteNodeTail(s,a),this._searchCache.validate(e),0===s.piece.length&&o.push(s);let l=this.positionInBuffer(r,i.remainder);this.deleteNodeHead(r,l),0===r.piece.length&&o.push(r);for(let e=s.next();e!==m&&e!==r;e=e.next())o.push(e);let h=0===s.piece.length?s.prev():s;this.deleteNodes(o),this.validateCRLFWithNextNode(h),this.computeBufferMetadata()}insertContentToNodeLeft(e,t){let n=[];if(this.shouldCheckCRLF()&&this.endWithCR(e)&&this.startWithLF(t)){let i=t.piece,s={line:i.start.line+1,column:0},r=new R(i.bufferIndex,s,i.end,this.getLineFeedCnt(i.bufferIndex,s,i.end),i.length-1);t.piece=r,e+="\n",k(this,t,-1,-1),0===t.piece.length&&n.push(t)}let i=this.createNewPieces(e),s=this.rbInsertLeft(t,i[i.length-1]);for(let e=i.length-2;e>=0;e--)s=this.rbInsertLeft(s,i[e]);this.validateCRLFWithPrevNode(s),this.deleteNodes(n)}insertContentToNodeRight(e,t){this.adjustCarriageReturnFromNext(e,t)&&(e+="\n");let n=this.createNewPieces(e),i=this.rbInsertRight(t,n[0]),s=i;for(let e=1;e<n.length;e++)s=this.rbInsertRight(s,n[e]);this.validateCRLFWithPrevNode(i)}positionInBuffer(e,t,n){let i=e.piece,s=e.piece.bufferIndex,r=this._buffers[s].lineStarts,o=r[i.start.line]+i.start.column+t,a=i.start.line,l=i.end.line,h=0,u=0,c=0;for(;a<=l&&(h=a+(l-a)/2|0,c=r[h],h!==l);)if(u=r[h+1],o<c)l=h-1;else{if(!(o>=u))break;a=h+1}return n?(n.line=h,n.column=o-c,null):{line:h,column:o-c}}getLineFeedCnt(e,t,n){if(0===n.column)return n.line-t.line;let i=this._buffers[e].lineStarts;if(n.line===i.length-1)return n.line-t.line;let s=i[n.line+1],r=i[n.line]+n.column;if(s>r+1)return n.line-t.line;let o=r-1;return 13===this._buffers[e].buffer.charCodeAt(o)?n.line-t.line+1:n.line-t.line}offsetInBuffer(e,t){return this._buffers[e].lineStarts[t.line]+t.column}deleteNodes(e){for(let t=0;t<e.length;t++)T(this,e[t])}createNewPieces(e){if(e.length>65535){let t=[];for(;e.length>65535;){const n=e.charCodeAt(65534);let i;13===n||n>=55296&&n<=56319?(i=e.substring(0,65534),e=e.substring(65534)):(i=e.substring(0,65535),e=e.substring(65535));let s=O(i);t.push(new R(this._buffers.length,{line:0,column:0},{line:s.length-1,column:i.length-s[s.length-1]},s.length-1,i.length)),this._buffers.push(new M(i,s))}let n=O(e);return t.push(new R(this._buffers.length,{line:0,column:0},{line:n.length-1,column:e.length-n[n.length-1]},n.length-1,e.length)),this._buffers.push(new M(e,n)),t}let t=this._buffers[0].buffer.length;const n=O(e,!1);let i=this._lastChangeBufferPos;if(this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-1]===t&&0!==t&&this.startWithLF(e)&&this.endWithCR(this._buffers[0].buffer)){this._lastChangeBufferPos={line:this._lastChangeBufferPos.line,column:this._lastChangeBufferPos.column+1},i=this._lastChangeBufferPos;for(let e=0;e<n.length;e++)n[e]+=t+1;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(n.slice(1)),this._buffers[0].buffer+="_"+e,t+=1}else{if(0!==t)for(let e=0;e<n.length;e++)n[e]+=t;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(n.slice(1)),this._buffers[0].buffer+=e}const s=this._buffers[0].buffer.length;let r=this._buffers[0].lineStarts.length-1,o={line:r,column:s-this._buffers[0].lineStarts[r]},a=new R(0,i,o,this.getLineFeedCnt(0,i,o),s-t);return this._lastChangeBufferPos=o,[a]}getLineRawContent(e,t=0){let n=this.root,i="",s=this._searchCache.get2(e);if(s){n=s.node;let r=this.getAccumulatedValue(n,e-s.nodeStartLineNumber-1),o=this._buffers[n.piece.bufferIndex].buffer,a=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);if(s.nodeStartLineNumber+n.piece.lineFeedCnt!==e){let i=this.getAccumulatedValue(n,e-s.nodeStartLineNumber);return o.substring(a+r,a+i-t)}i=o.substring(a+r,a+n.piece.length)}else{let s=0;const r=e;for(;n!==m;)if(n.left!==m&&n.lf_left>=e-1)n=n.left;else{if(n.lf_left+n.piece.lineFeedCnt>e-1){let i=this.getAccumulatedValue(n,e-n.lf_left-2),o=this.getAccumulatedValue(n,e-n.lf_left-1),a=this._buffers[n.piece.bufferIndex].buffer,l=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);return s+=n.size_left,this._searchCache.set({node:n,nodeStartOffset:s,nodeStartLineNumber:r-(e-1-n.lf_left)}),a.substring(l+i,l+o-t)}if(n.lf_left+n.piece.lineFeedCnt===e-1){let t=this.getAccumulatedValue(n,e-n.lf_left-2),s=this._buffers[n.piece.bufferIndex].buffer,r=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);i=s.substring(r+t,r+n.piece.length);break}e-=n.lf_left+n.piece.lineFeedCnt,s+=n.size_left+n.piece.length,n=n.right}}for(n=n.next();n!==m;){let e=this._buffers[n.piece.bufferIndex].buffer;if(n.piece.lineFeedCnt>0){let s=this.getAccumulatedValue(n,0),r=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);return i+=e.substring(r,r+s-t),i}{let t=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);i+=e.substr(t,n.piece.length)}n=n.next()}return i}computeBufferMetadata(){let e=this.root,t=1,n=0;for(;e!==m;)t+=e.lf_left+e.piece.lineFeedCnt,n+=e.size_left+e.piece.length,e=e.right;this._lineCnt=t,this._length=n,this._searchCache.validate(this._length)}getIndexOf(e,t){let n=e.piece,i=this.positionInBuffer(e,t),s=i.line-n.start.line;if(this.offsetInBuffer(n.bufferIndex,n.end)-this.offsetInBuffer(n.bufferIndex,n.start)===t){let t=this.getLineFeedCnt(e.piece.bufferIndex,n.start,i);if(t!==s)return{index:t,remainder:0}}return{index:s,remainder:i.column}}getAccumulatedValue(e,t){if(t<0)return 0;let n=e.piece,i=this._buffers[n.bufferIndex].lineStarts,s=n.start.line+t+1;return s>n.end.line?i[n.end.line]+n.end.column-i[n.start.line]-n.start.column:i[s]-i[n.start.line]-n.start.column}deleteNodeTail(e,t){const n=e.piece,i=n.lineFeedCnt,s=this.offsetInBuffer(n.bufferIndex,n.end),r=t,o=this.offsetInBuffer(n.bufferIndex,r),a=this.getLineFeedCnt(n.bufferIndex,n.start,r),l=a-i,h=o-s,u=n.length+h;e.piece=new R(n.bufferIndex,n.start,r,a,u),k(this,e,h,l)}deleteNodeHead(e,t){const n=e.piece,i=n.lineFeedCnt,s=this.offsetInBuffer(n.bufferIndex,n.start),r=t,o=this.getLineFeedCnt(n.bufferIndex,r,n.end),a=o-i,l=s-this.offsetInBuffer(n.bufferIndex,r),h=n.length+l;e.piece=new R(n.bufferIndex,r,n.end,o,h),k(this,e,l,a)}shrinkNode(e,t,n){const i=e.piece,s=i.start,r=i.end,o=i.length,a=i.lineFeedCnt,l=t,h=this.getLineFeedCnt(i.bufferIndex,i.start,l),u=this.offsetInBuffer(i.bufferIndex,t)-this.offsetInBuffer(i.bufferIndex,s);e.piece=new R(i.bufferIndex,i.start,l,h,u),k(this,e,u-o,h-a);let c=new R(i.bufferIndex,n,r,this.getLineFeedCnt(i.bufferIndex,n,r),this.offsetInBuffer(i.bufferIndex,r)-this.offsetInBuffer(i.bufferIndex,n)),f=this.rbInsertRight(e,c);this.validateCRLFWithPrevNode(f)}appendToNode(e,t){this.adjustCarriageReturnFromNext(t,e)&&(t+="\n");const n=this.shouldCheckCRLF()&&this.startWithLF(t)&&this.endWithCR(e),i=this._buffers[0].buffer.length;this._buffers[0].buffer+=t;const s=O(t,!1);for(let e=0;e<s.length;e++)s[e]+=i;if(n){let e=this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-2];this._buffers[0].lineStarts.pop(),this._lastChangeBufferPos={line:this._lastChangeBufferPos.line-1,column:i-e}}this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(s.slice(1));const r=this._buffers[0].lineStarts.length-1,o={line:r,column:this._buffers[0].buffer.length-this._buffers[0].lineStarts[r]},a=e.piece.length+t.length,l=e.piece.lineFeedCnt,h=this.getLineFeedCnt(0,e.piece.start,o),u=h-l;e.piece=new R(e.piece.bufferIndex,e.piece.start,o,h,a),this._lastChangeBufferPos=o,k(this,e,t.length,u)}nodeAt(e){let t=this.root,n=this._searchCache.get(e);if(n)return{node:n.node,nodeStartOffset:n.nodeStartOffset,remainder:e-n.nodeStartOffset};let i=0;for(;t!==m;)if(t.size_left>e)t=t.left;else{if(t.size_left+t.piece.length>=e){i+=t.size_left;let n={node:t,remainder:e-t.size_left,nodeStartOffset:i};return this._searchCache.set(n),n}e-=t.size_left+t.piece.length,i+=t.size_left+t.piece.length,t=t.right}return null}nodeAt2(e,t){let n=this.root,i=0;for(;n!==m;)if(n.left!==m&&n.lf_left>=e-1)n=n.left;else{if(n.lf_left+n.piece.lineFeedCnt>e-1){let s=this.getAccumulatedValue(n,e-n.lf_left-2),r=this.getAccumulatedValue(n,e-n.lf_left-1);return i+=n.size_left,{node:n,remainder:Math.min(s+t-1,r),nodeStartOffset:i}}if(n.lf_left+n.piece.lineFeedCnt===e-1){let s=this.getAccumulatedValue(n,e-n.lf_left-2);if(s+t-1<=n.piece.length)return{node:n,remainder:s+t-1,nodeStartOffset:i};t-=n.piece.length-s;break}e-=n.lf_left+n.piece.lineFeedCnt,i+=n.size_left+n.piece.length,n=n.right}for(n=n.next();n!==m;){if(n.piece.lineFeedCnt>0){let e=this.getAccumulatedValue(n,0),i=this.offsetOfNode(n);return{node:n,remainder:Math.min(t-1,e),nodeStartOffset:i}}if(n.piece.length>=t-1){return{node:n,remainder:t-1,nodeStartOffset:this.offsetOfNode(n)}}t-=n.piece.length,n=n.next()}return null}nodeCharCodeAt(e,t){if(e.piece.lineFeedCnt<1)return-1;let n=this._buffers[e.piece.bufferIndex],i=this.offsetInBuffer(e.piece.bufferIndex,e.piece.start)+t;return n.buffer.charCodeAt(i)}offsetOfNode(e){if(!e)return 0;let t=e.size_left;for(;e!==this.root;)e.parent.right===e&&(t+=e.parent.size_left+e.parent.piece.length),e=e.parent;return t}shouldCheckCRLF(){return!(this._EOLNormalized&&"\n"===this._EOL)}startWithLF(e){if("string"==typeof e)return 10===e.charCodeAt(0);if(e===m||0===e.piece.lineFeedCnt)return!1;let t=e.piece,n=this._buffers[t.bufferIndex].lineStarts,i=t.start.line,s=n[i]+t.start.column;return i!==n.length-1&&(!(n[i+1]>s+1)&&10===this._buffers[t.bufferIndex].buffer.charCodeAt(s))}endWithCR(e){return"string"==typeof e?13===e.charCodeAt(e.length-1):e!==m&&0!==e.piece.lineFeedCnt&&13===this.nodeCharCodeAt(e,e.piece.length-1)}validateCRLFWithPrevNode(e){if(this.shouldCheckCRLF()&&this.startWithLF(e)){let t=e.prev();this.endWithCR(t)&&this.fixCRLF(t,e)}}validateCRLFWithNextNode(e){if(this.shouldCheckCRLF()&&this.endWithCR(e)){let t=e.next();this.startWithLF(t)&&this.fixCRLF(e,t)}}fixCRLF(e,t){let n,i=[],s=this._buffers[e.piece.bufferIndex].lineStarts;n=0===e.piece.end.column?{line:e.piece.end.line-1,column:s[e.piece.end.line]-s[e.piece.end.line-1]-1}:{line:e.piece.end.line,column:e.piece.end.column-1};const r=e.piece.length-1,o=e.piece.lineFeedCnt-1;e.piece=new R(e.piece.bufferIndex,e.piece.start,n,o,r),k(this,e,-1,-1),0===e.piece.length&&i.push(e);let a={line:t.piece.start.line+1,column:0};const l=t.piece.length-1,h=this.getLineFeedCnt(t.piece.bufferIndex,a,t.piece.end);t.piece=new R(t.piece.bufferIndex,a,t.piece.end,h,l),k(this,t,-1,-1),0===t.piece.length&&i.push(t);let u=this.createNewPieces("\r\n");this.rbInsertRight(e,u[0]);for(let e=0;e<i.length;e++)T(this,i[e])}adjustCarriageReturnFromNext(e,t){if(this.shouldCheckCRLF()&&this.endWithCR(e)){let n=t.next();if(this.startWithLF(n)){if(e+="\n",1===n.piece.length)T(this,n);else{const e=n.piece,t={line:e.start.line+1,column:0},i=e.length-1,s=this.getLineFeedCnt(e.bufferIndex,t,e.end);n.piece=new R(e.bufferIndex,t,e.end,s,i),k(this,n,-1,-1)}return!0}}return!1}iterate(e,t){if(e===m)return t(m);let n=this.iterate(e.left,t);return n?t(e)&&this.iterate(e.right,t):n}getNodeContent(e){if(e===m)return"";let t,n=this._buffers[e.piece.bufferIndex],i=e.piece,s=this.offsetInBuffer(i.bufferIndex,i.start),r=this.offsetInBuffer(i.bufferIndex,i.end);return t=n.buffer.substring(s,r),t}getPieceContent(e){let t=this._buffers[e.bufferIndex],n=this.offsetInBuffer(e.bufferIndex,e.start),i=this.offsetInBuffer(e.bufferIndex,e.end);return t.buffer.substring(n,i)}rbInsertRight(e,t){let n=new p(t,1);if(n.left=m,n.right=m,n.parent=m,n.size_left=0,n.lf_left=0,this.root===m)this.root=n,n.color=0;else if(e.right===m)e.right=n,n.parent=e;else{let t=L(e.right);t.left=n,n.parent=t}return w(this,n),n}rbInsertLeft(e,t){let n=new p(t,1);if(n.left=m,n.right=m,n.parent=m,n.size_left=0,n.lf_left=0,this.root===m)this.root=n,n.color=0;else if(e.left===m)e.left=n,n.parent=e;else{let t=C(e.left);t.right=n,n.parent=t}return w(this,n),n}}var F=n(58409),y=n(60962);class V extends r.JT{constructor(e,t,n,i,r,o,a){super(),this._onDidChangeContent=this._register(new s.Q5),this._BOM=t,this._mightContainNonBasicASCII=!o,this._mightContainRTL=i,this._mightContainUnusualLineTerminators=r,this._pieceTree=new P(e,n,a)}mightContainRTL(){return this._mightContainRTL}mightContainUnusualLineTerminators(){return this._mightContainUnusualLineTerminators}resetMightContainUnusualLineTerminators(){this._mightContainUnusualLineTerminators=!1}mightContainNonBasicASCII(){return this._mightContainNonBasicASCII}getBOM(){return this._BOM}getEOL(){return this._pieceTree.getEOL()}createSnapshot(e){return this._pieceTree.createSnapshot(e?this._BOM:"")}getOffsetAt(e,t){return this._pieceTree.getOffsetAt(e,t)}getPositionAt(e){return this._pieceTree.getPositionAt(e)}getRangeAt(e,t){let n=e+t;const i=this.getPositionAt(e),s=this.getPositionAt(n);return new u.e(i.lineNumber,i.column,s.lineNumber,s.column)}getValueInRange(e,t=0){if(e.isEmpty())return"";const n=this._getEndOfLine(t);return this._pieceTree.getValueInRange(e,n)}getValueLengthInRange(e,t=0){if(e.isEmpty())return 0;if(e.startLineNumber===e.endLineNumber)return e.endColumn-e.startColumn;let n=this.getOffsetAt(e.startLineNumber,e.startColumn);return this.getOffsetAt(e.endLineNumber,e.endColumn)-n}getCharacterCountInRange(e,t=0){if(this._mightContainNonBasicASCII){let n=0;const i=e.startLineNumber,s=e.endLineNumber;for(let t=i;t<=s;t++){const r=this.getLineContent(t),a=t===i?e.startColumn-1:0,l=t===s?e.endColumn-1:r.length;for(let e=a;e<l;e++)o.ZG(r.charCodeAt(e))?(n+=1,e+=1):n+=1}return n+=this._getEndOfLine(t).length*(s-i),n}return this.getValueLengthInRange(e,t)}getLength(){return this._pieceTree.getLength()}getLineCount(){return this._pieceTree.getLineCount()}getLinesContent(){return this._pieceTree.getLinesContent()}getLineContent(e){return this._pieceTree.getLineContent(e)}getLineCharCode(e,t){return this._pieceTree.getLineCharCode(e,t)}getLineLength(e){return this._pieceTree.getLineLength(e)}getLineFirstNonWhitespaceColumn(e){const t=o.LC(this.getLineContent(e));return-1===t?0:t+1}getLineLastNonWhitespaceColumn(e){const t=o.ow(this.getLineContent(e));return-1===t?0:t+2}_getEndOfLine(e){switch(e){case 1:return"\n";case 2:return"\r\n";case 0:return this.getEOL();default:throw new Error("Unknown EOL preference")}}setEOL(e){this._pieceTree.setEOL(e)}applyEdits(e,t,n){let i=this._mightContainRTL,s=this._mightContainUnusualLineTerminators,r=this._mightContainNonBasicASCII,a=!0,l=[];for(let t=0;t<e.length;t++){let n=e[t];a&&n._isTracked&&(a=!1);let h=n.range;if(n.text){let e=!0;r||(e=!o.$i(n.text),r=e),!i&&e&&(i=o.Ut(n.text)),!s&&e&&(s=o.ab(n.text))}let u="",c=0,f=0,d=0;if(n.text){let e;[c,f,d,e]=(0,F.QZ)(n.text);const t=this.getEOL(),i="\r\n"===t?2:1;u=0===e||e===i?n.text:n.text.replace(/\r\n|\r|\n/g,t)}l[t]={sortIndex:t,identifier:n.identifier||null,range:h,rangeOffset:this.getOffsetAt(h.startLineNumber,h.startColumn),rangeLength:this.getValueLengthInRange(h),text:u,eolCount:c,firstLineLength:f,lastLineLength:d,forceMoveMarkers:Boolean(n.forceMoveMarkers),isAutoWhitespaceEdit:n.isAutoWhitespaceEdit||!1}}l.sort(V._sortOpsAscending);let h=!1;for(let e=0,t=l.length-1;e<t;e++){let t=l[e].range.getEndPosition(),n=l[e+1].range.getStartPosition();if(n.isBeforeOrEqual(t)){if(n.isBefore(t))throw new Error("Overlapping ranges are not allowed!");h=!0}}a&&(l=this._reduceOperations(l));let u=n||t?V._getInverseEditRanges(l):[],c=[];if(t)for(let e=0;e<l.length;e++){let t=l[e],n=u[e];if(t.isAutoWhitespaceEdit&&t.range.isEmpty())for(let e=n.startLineNumber;e<=n.endLineNumber;e++){let i="";e===n.startLineNumber&&(i=this.getLineContent(t.range.startLineNumber),-1!==o.LC(i))||c.push({lineNumber:e,oldContent:i})}}let d=null;if(n){let e=0;d=[];for(let t=0;t<l.length;t++){const n=l[t],i=u[t],s=this.getValueInRange(n.range),r=n.rangeOffset+e;e+=n.text.length-s.length,d[t]={sortIndex:n.sortIndex,identifier:n.identifier,range:i,text:s,textChange:new y.q(n.rangeOffset,s,r,n.text)}}h||d.sort((e,t)=>e.sortIndex-t.sortIndex)}this._mightContainRTL=i,this._mightContainUnusualLineTerminators=s,this._mightContainNonBasicASCII=r;const g=this._doApplyEdits(l);let _=null;if(t&&c.length>0){c.sort((e,t)=>t.lineNumber-e.lineNumber),_=[];for(let e=0,t=c.length;e<t;e++){let t=c[e].lineNumber;if(e>0&&c[e-1].lineNumber===t)continue;let n=c[e].oldContent,i=this.getLineContent(t);0!==i.length&&i!==n&&-1===o.LC(i)&&_.push(t)}}return this._onDidChangeContent.fire(),new f.je(d,g,_)}_reduceOperations(e){return e.length<1e3?e:[this._toSingleEditOperation(e)]}_toSingleEditOperation(e){let t=!1;const n=e[0].range,i=e[e.length-1].range,s=new u.e(n.startLineNumber,n.startColumn,i.endLineNumber,i.endColumn);let r=n.startLineNumber,o=n.startColumn;const a=[];for(let n=0,i=e.length;n<i;n++){const i=e[n],s=i.range;t=t||i.forceMoveMarkers,a.push(this.getValueInRange(new u.e(r,o,s.startLineNumber,s.startColumn))),i.text.length>0&&a.push(i.text),r=s.endLineNumber,o=s.endColumn}const l=a.join(""),[h,c,f]=(0,F.QZ)(l);return{sortIndex:0,identifier:e[0].identifier,range:s,rangeOffset:this.getOffsetAt(s.startLineNumber,s.startColumn),rangeLength:this.getValueLengthInRange(s,0),text:l,eolCount:h,firstLineLength:c,lastLineLength:f,forceMoveMarkers:t,isAutoWhitespaceEdit:!1}}_doApplyEdits(e){e.sort(V._sortOpsDescending);let t=[];for(let n=0;n<e.length;n++){let i=e[n];const s=i.range.startLineNumber,r=i.range.startColumn,o=i.range.endLineNumber,a=i.range.endColumn;if(s===o&&r===a&&0===i.text.length)continue;i.text?(this._pieceTree.delete(i.rangeOffset,i.rangeLength),this._pieceTree.insert(i.rangeOffset,i.text,!0)):this._pieceTree.delete(i.rangeOffset,i.rangeLength);const l=new u.e(s,r,o,a);t.push({range:l,rangeLength:i.rangeLength,text:i.text,rangeOffset:i.rangeOffset,forceMoveMarkers:i.forceMoveMarkers})}return t}findMatchesLineByLine(e,t,n,i){return this._pieceTree.findMatchesLineByLine(e,t,n,i)}static _getInverseEditRanges(e){let t=[],n=0,i=0,s=null;for(let r=0,o=e.length;r<o;r++){let o,a,l,h=e[r];if(s?s.range.endLineNumber===h.range.startLineNumber?(o=n,a=i+(h.range.startColumn-s.range.endColumn)):(o=n+(h.range.startLineNumber-s.range.endLineNumber),a=h.range.startColumn):(o=h.range.startLineNumber,a=h.range.startColumn),h.text.length>0){const e=h.eolCount+1;l=1===e?new u.e(o,a,o,a+h.firstLineLength):new u.e(o,a,o+e-1,h.lastLineLength+1)}else l=new u.e(o,a,o,a);n=l.endLineNumber,i=l.endColumn,t.push(l),s=h}return t}static _sortOpsAscending(e,t){let n=u.e.compareRangesUsingEnds(e.range,t.range);return 0===n?e.sortIndex-t.sortIndex:n}static _sortOpsDescending(e,t){let n=u.e.compareRangesUsingEnds(e.range,t.range);return 0===n?t.sortIndex-e.sortIndex:-n}}class W{constructor(e,t,n,i,s,r,o,a,l){this._chunks=e,this._bom=t,this._cr=n,this._lf=i,this._crlf=s,this._containsRTL=r,this._containsUnusualLineTerminators=o,this._isBasicASCII=a,this._normalizeEOL=l}_getEOL(e){const t=this._cr+this._lf+this._crlf,n=this._cr+this._crlf;return 0===t?1===e?"\n":"\r\n":n>t/2?"\r\n":"\n"}create(e){const t=this._getEOL(e);let n=this._chunks;if(this._normalizeEOL&&("\r\n"===t&&(this._cr>0||this._lf>0)||"\n"===t&&(this._cr>0||this._crlf>0)))for(let e=0,i=n.length;e<i;e++){let i=n[e].buffer.replace(/\r\n|\r|\n/g,t),s=O(i);n[e]=new M(i,s)}const i=new V(n,this._bom,t,this._containsRTL,this._containsUnusualLineTerminators,this._isBasicASCII,this._normalizeEOL);return{textBuffer:i,disposable:i}}}class U{constructor(){this.chunks=[],this.BOM="",this._hasPreviousChar=!1,this._previousChar=0,this._tmpLineStarts=[],this.cr=0,this.lf=0,this.crlf=0,this.containsRTL=!1,this.containsUnusualLineTerminators=!1,this.isBasicASCII=!0}acceptChunk(e){if(0===e.length)return;0===this.chunks.length&&o.uS(e)&&(this.BOM=o.c1,e=e.substr(1));const t=e.charCodeAt(e.length-1);13===t||t>=55296&&t<=56319?(this._acceptChunk1(e.substr(0,e.length-1),!1),this._hasPreviousChar=!0,this._previousChar=t):(this._acceptChunk1(e,!1),this._hasPreviousChar=!1,this._previousChar=t)}_acceptChunk1(e,t){(t||0!==e.length)&&(this._hasPreviousChar?this._acceptChunk2(String.fromCharCode(this._previousChar)+e):this._acceptChunk2(e))}_acceptChunk2(e){const t=function(e,t){e.length=0,e[0]=0;let n=1,i=0,s=0,r=0,o=!0;for(let a=0,l=t.length;a<l;a++){const h=t.charCodeAt(a);13===h?a+1<l&&10===t.charCodeAt(a+1)?(r++,e[n++]=a+2,a++):(i++,e[n++]=a+1):10===h?(s++,e[n++]=a+1):o&&9!==h&&(h<32||h>126)&&(o=!1)}const a=new A(D(e),i,s,r,o);return e.length=0,a}(this._tmpLineStarts,e);this.chunks.push(new M(e,t.lineStarts)),this.cr+=t.cr,this.lf+=t.lf,this.crlf+=t.crlf,this.isBasicASCII&&(this.isBasicASCII=t.isBasicASCII),this.isBasicASCII||this.containsRTL||(this.containsRTL=o.Ut(e)),this.isBasicASCII||this.containsUnusualLineTerminators||(this.containsUnusualLineTerminators=o.ab(e))}finish(e=!0){return this._finish(),new W(this.chunks,this.BOM,this.cr,this.lf,this.crlf,this.containsRTL,this.containsUnusualLineTerminators,this.isBasicASCII,e)}_finish(){if(0===this.chunks.length&&this._acceptChunk1("",!0),this._hasPreviousChar){this._hasPreviousChar=!1;let e=this.chunks[this.chunks.length-1];e.buffer+=String.fromCharCode(this._previousChar);let t=O(e.buffer);e.lineStarts=t,13===this._previousChar&&this.cr++}}}var j=n(83256),H=n(9488),Q=n(78411),Z=n(44101),q=n(28111),G=n(84013),$=n(1432);class J{constructor(){this._beginState=[],this._valid=[],this._len=0,this._invalidLineStartIndex=0}_reset(e){this._beginState=[],this._valid=[],this._len=0,this._invalidLineStartIndex=0,e&&this._setBeginState(0,e)}flush(e){this._reset(e)}get invalidLineStartIndex(){return this._invalidLineStartIndex}_invalidateLine(e){e<this._len&&(this._valid[e]=!1),e<this._invalidLineStartIndex&&(this._invalidLineStartIndex=e)}_isValid(e){return e<this._len&&this._valid[e]}getBeginState(e){return e<this._len?this._beginState[e]:null}_ensureLine(e){for(;e>=this._len;)this._beginState[this._len]=null,this._valid[this._len]=!1,this._len++}_deleteLines(e,t){0!==t&&(e+t>this._len&&(t=this._len-e),this._beginState.splice(e,t),this._valid.splice(e,t),this._len-=t)}_insertLines(e,t){if(0===t)return;const n=[],i=[];for(let e=0;e<t;e++)n[e]=null,i[e]=!1;this._beginState=H.Zv(this._beginState,e,n),this._valid=H.Zv(this._valid,e,i),this._len+=t}_setValid(e,t){this._ensureLine(e),this._valid[e]=t}_setBeginState(e,t){this._ensureLine(e),this._beginState[e]=t}setEndState(e,t,n){if(this._setValid(t,!0),this._invalidLineStartIndex=t+1,t===e-1)return;const i=this.getBeginState(t+1);if(null===i||!n.equals(i))return this._setBeginState(t+1,n),void this._invalidateLine(t+1);let s=t+1;for(;s<e&&this._isValid(s);)s++;this._invalidLineStartIndex=s}setFakeTokens(e){this._setValid(e,!1)}applyEdits(e,t){const n=e.endLineNumber-e.startLineNumber,i=t;for(let t=Math.min(n,i);t>=0;t--)this._invalidateLine(e.startLineNumber+t-1);this._acceptDeleteRange(e),this._acceptInsertText(new h.L(e.startLineNumber,e.startColumn),t)}_acceptDeleteRange(e){e.startLineNumber-1>=this._len||this._deleteLines(e.startLineNumber,e.endLineNumber-e.startLineNumber)}_acceptInsertText(e,t){e.lineNumber-1>=this._len||this._insertLines(e.lineNumber,t)}}class Y extends r.JT{constructor(e,t){super(),this._textModel=e,this._languageIdCodec=t,this._isScheduled=!1,this._isDisposed=!1,this._tokenizationStateStore=new J,this._tokenizationSupport=null,this._register(Z.RW.onDidChange(e=>{const t=this._textModel.getLanguageId();-1!==e.changedLanguages.indexOf(t)&&(this._resetTokenizationState(),this._textModel.clearTokens())})),this._register(this._textModel.onDidChangeContentFast(e=>{if(e.isFlush)this._resetTokenizationState();else{for(let t=0,n=e.changes.length;t<n;t++){const n=e.changes[t],[i]=(0,F.QZ)(n.text);this._tokenizationStateStore.applyEdits(n.range,i)}this._beginBackgroundTokenization()}})),this._register(this._textModel.onDidChangeAttached(()=>{this._beginBackgroundTokenization()})),this._register(this._textModel.onDidChangeLanguage(()=>{this._resetTokenizationState(),this._textModel.clearTokens()})),this._resetTokenizationState()}dispose(){this._isDisposed=!0,super.dispose()}_resetTokenizationState(){const[e,t]=function(e){const t=e.getLanguageId();let n=e.isTooLargeForTokenization()?null:Z.RW.get(t),s=null;if(n)try{s=n.getInitialState()}catch(e){(0,i.dL)(e),n=null}return[n,s]}(this._textModel);this._tokenizationSupport=e,this._tokenizationStateStore.flush(t),this._beginBackgroundTokenization()}_beginBackgroundTokenization(){!this._isScheduled&&this._textModel.isAttachedToEditor()&&this._hasLinesToTokenize()&&(this._isScheduled=!0,(0,$.xS)(()=>{this._isScheduled=!1,this._isDisposed||this._revalidateTokensNow()}))}_revalidateTokensNow(){const e=this._textModel.getLineCount(),t=new F.DA,n=G.G.create(!1);let i=-1;do{if(n.elapsed()>1)break;if(i=this._tokenizeOneInvalidLine(t),i>=e)break}while(this._hasLinesToTokenize());this._beginBackgroundTokenization(),this._textModel.setTokens(t.tokens,!this._hasLinesToTokenize())}tokenizeViewport(e,t){const n=new F.DA;this._tokenizeViewport(n,e,t),this._textModel.setTokens(n.tokens,!this._hasLinesToTokenize())}reset(){this._resetTokenizationState(),this._textModel.clearTokens()}forceTokenization(e){const t=new F.DA;this._updateTokensUntilLine(t,e),this._textModel.setTokens(t.tokens,!this._hasLinesToTokenize())}getTokenTypeIfInsertingCharacter(e,t){if(!this._tokenizationSupport)return 0;this.forceTokenization(e.lineNumber);const n=this._tokenizationStateStore.getBeginState(e.lineNumber-1);if(!n)return 0;const i=this._textModel.getLanguageId(),s=this._textModel.getLineContent(e.lineNumber),r=s.substring(0,e.column-1)+t+s.substring(e.column-1),o=X(this._languageIdCodec,i,this._tokenizationSupport,r,!0,n),a=new Q.A(o.tokens,r,this._languageIdCodec);if(0===a.getCount())return 0;const l=a.findTokenIndexAtOffset(e.column-1);return a.getStandardTokenType(l)}isCheapToTokenize(e){if(!this._tokenizationSupport)return!0;const t=this._tokenizationStateStore.invalidLineStartIndex+1;return!(e>t)&&(e<t||this._textModel.getLineLength(e)<2048)}_hasLinesToTokenize(){return!!this._tokenizationSupport&&this._tokenizationStateStore.invalidLineStartIndex<this._textModel.getLineCount()}_tokenizeOneInvalidLine(e){if(!this._hasLinesToTokenize())return this._textModel.getLineCount()+1;const t=this._tokenizationStateStore.invalidLineStartIndex+1;return this._updateTokensUntilLine(e,t),t}_updateTokensUntilLine(e,t){if(!this._tokenizationSupport)return;const n=this._textModel.getLanguageId(),i=this._textModel.getLineCount(),s=t-1;for(let t=this._tokenizationStateStore.invalidLineStartIndex;t<=s;t++){const s=this._textModel.getLineContent(t+1),r=this._tokenizationStateStore.getBeginState(t),o=X(this._languageIdCodec,n,this._tokenizationSupport,s,!0,r);e.add(t+1,o.tokens),this._tokenizationStateStore.setEndState(i,t,o.endState),t=this._tokenizationStateStore.invalidLineStartIndex-1}}_tokenizeViewport(e,t,n){if(!this._tokenizationSupport)return;if(n<=this._tokenizationStateStore.invalidLineStartIndex)return;if(t<=this._tokenizationStateStore.invalidLineStartIndex)return void this._updateTokensUntilLine(e,n);let i=this._textModel.getLineFirstNonWhitespaceColumn(t);const s=[];let r=null;for(let e=t-1;i>1&&e>=1;e--){const t=this._textModel.getLineFirstNonWhitespaceColumn(e);if(0!==t&&t<i){if(r=this._tokenizationStateStore.getBeginState(e-1),r)break;s.push(this._textModel.getLineContent(e)),i=t}}r||(r=this._tokenizationSupport.getInitialState());const o=this._textModel.getLanguageId();let a=r;for(let e=s.length-1;e>=0;e--){a=X(this._languageIdCodec,o,this._tokenizationSupport,s[e],!1,a).endState}for(let i=t;i<=n;i++){const t=this._textModel.getLineContent(i),n=X(this._languageIdCodec,o,this._tokenizationSupport,t,!0,a);e.add(i,n.tokens),this._tokenizationStateStore.setFakeTokens(i-1),a=n.endState}}}function X(e,t,n,s,r,o){let a=null;if(n)try{a=n.tokenize2(s,r,o.clone(),0)}catch(e){(0,i.dL)(e)}return a||(a=(0,q.mh)(e.encodeLanguageId(t),s,o,0)),Q.A.convertToEndOffset(a.tokens,s.length),a}var K=n(97461),ee=n(83831),te=n(41264),ne=n(64862),ie=n(10544),se=n(62490),re=n(47707),oe=n(71531),ae=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o},le=function(e,t){return function(n,i){t(n,i,e)}};function he(e){const t=new U;return t.acceptChunk(e),t.finish()}function ue(e,t){return("string"==typeof e?he(e):e).create(t)}let ce=0;class fe{constructor(e){this._source=e,this._eos=!1}read(){if(this._eos)return null;let e=[],t=0,n=0;for(;;){let i=this._source.read();if(null===i)return this._eos=!0,0===t?null:e.join("");if(i.length>0&&(e[t++]=i,n+=i.length),n>=65536)return e.join("")}}}const de=()=>{throw new Error("Invalid change accessor")};let ge=class e extends r.JT{constructor(t,n,i,r=null,l,h,c){super(),this._undoRedoService=l,this._modeService=h,this._languageConfigurationService=c,this._onWillDispose=this._register(new s.Q5),this.onWillDispose=this._onWillDispose.event,this._onDidChangeDecorations=this._register(new ke(e=>this.handleBeforeFireDecorationsChangedEvent(e))),this.onDidChangeDecorations=this._onDidChangeDecorations.event,this._onDidChangeLanguage=this._register(new s.Q5),this.onDidChangeLanguage=this._onDidChangeLanguage.event,this._onDidChangeLanguageConfiguration=this._register(new s.Q5),this.onDidChangeLanguageConfiguration=this._onDidChangeLanguageConfiguration.event,this._onDidChangeTokens=this._register(new s.Q5),this.onDidChangeTokens=this._onDidChangeTokens.event,this._onDidChangeOptions=this._register(new s.Q5),this.onDidChangeOptions=this._onDidChangeOptions.event,this._onDidChangeAttached=this._register(new s.Q5),this.onDidChangeAttached=this._onDidChangeAttached.event,this._onDidChangeContentOrInjectedText=this._register(new s.Q5),this.onDidChangeContentOrInjectedText=this._onDidChangeContentOrInjectedText.event,this._eventEmitter=this._register(new Se),this._backgroundTokenizationState=0,this._onBackgroundTokenizationStateChanged=this._register(new s.Q5),this.onBackgroundTokenizationStateChanged=this._onBackgroundTokenizationStateChanged.event,this._register(this._eventEmitter.fastEvent(e=>{this._onDidChangeContentOrInjectedText.fire(e.rawContentChangedEvent)})),ce++,this.id="$model"+ce,this.isForSimpleWidget=n.isForSimpleWidget,this._associatedResource=null==r?a.o.parse("inmemory://model/"+ce):r,this._attachedEditorCount=0;const{textBuffer:f,disposable:g}=ue(t,n.defaultEOL);this._buffer=f,this._bufferDisposable=g,this._options=e.resolveOptions(this._buffer,n);const _=this._buffer.getLineCount(),p=this._buffer.getValueLengthInRange(new u.e(1,1,_,this._buffer.getLineLength(_)+1),0);n.largeFileOptimizations?this._isTooLargeForTokenization=p>e.LARGE_FILE_SIZE_THRESHOLD||_>e.LARGE_FILE_LINE_COUNT_THRESHOLD:this._isTooLargeForTokenization=!1,this._isTooLargeForSyncing=p>e.MODEL_SYNC_LIMIT,this._versionId=1,this._alternativeVersionId=1,this._initialUndoRedoSnapshot=null,this._isDisposed=!1,this._isDisposing=!1,this._languageId=i||q.TG,this._languageRegistryListener=this._languageConfigurationService.onDidChange(e=>{e.affects(this._languageId)&&this._onDidChangeLanguageConfiguration.fire({})}),this._instanceId=o.PJ(ce),this._lastDecorationId=0,this._decorations=Object.create(null),this._decorationsTree=new Le,this._commandManager=new d.NL(this,this._undoRedoService),this._isUndoing=!1,this._isRedoing=!1,this._trimAutoWhitespaceLines=null,this._tokens=new F.Rl(this._modeService.languageIdCodec),this._tokens2=new F.cx(this._modeService.languageIdCodec),this._tokenization=new Y(this,this._modeService.languageIdCodec),this._bracketPairColorizer=this._register(new ie.w(this,this._languageConfigurationService)),this._decorationProvider=this._register(new se.z(this)),this._register(this._decorationProvider.onDidChange(()=>{this._onDidChangeDecorations.beginDeferredEmit(),this._onDidChangeDecorations.fire(),this._onDidChangeDecorations.endDeferredEmit()}))}static resolveOptions(e,t){if(t.detectIndentation){const n=(0,g.L)(e,t.tabSize,t.insertSpaces);return new f.dJ({tabSize:n.tabSize,indentSize:n.tabSize,insertSpaces:n.insertSpaces,trimAutoWhitespace:t.trimAutoWhitespace,defaultEOL:t.defaultEOL,bracketPairColorizationOptions:t.bracketPairColorizationOptions})}return new f.dJ({tabSize:t.tabSize,indentSize:t.indentSize,insertSpaces:t.insertSpaces,trimAutoWhitespace:t.trimAutoWhitespace,defaultEOL:t.defaultEOL,bracketPairColorizationOptions:t.bracketPairColorizationOptions})}onDidChangeContentFast(e){return this._eventEmitter.fastEvent(t=>e(t.contentChangedEvent))}onDidChangeContent(e){return this._eventEmitter.slowEvent(t=>e(t.contentChangedEvent))}get bracketPairs(){return this._bracketPairColorizer}get backgroundTokenizationState(){return this._backgroundTokenizationState}handleTokenizationProgress(e){if(2===this._backgroundTokenizationState)return;const t=e?2:1;this._backgroundTokenizationState!==t&&(this._backgroundTokenizationState=t,this._onBackgroundTokenizationStateChanged.fire())}dispose(){this._isDisposing=!0,this._onWillDispose.fire(),this._languageRegistryListener.dispose(),this._tokenization.dispose(),this._isDisposed=!0,super.dispose(),this._bufferDisposable.dispose(),this._isDisposing=!1;const e=new V([],"","\n",!1,!1,!0,!0);e.dispose(),this._buffer=e}_assertNotDisposed(){if(this._isDisposed)throw new Error("Model is disposed!")}_emitContentChangedEvent(e,t){this._bracketPairColorizer.handleContentChanged(t),this._isDisposing||this._eventEmitter.fire(new j.fV(e,t))}setValue(e){if(this._assertNotDisposed(),null===e)return;const{textBuffer:t,disposable:n}=ue(e,this._options.defaultEOL);this._setValueFromTextBuffer(t,n)}_createContentChanged2(e,t,n,i,s,r,o){return{changes:[{range:e,rangeOffset:t,rangeLength:n,text:i}],eol:this._buffer.getEOL(),versionId:this.getVersionId(),isUndoing:s,isRedoing:r,isFlush:o}}_setValueFromTextBuffer(e,t){this._assertNotDisposed();const n=this.getFullModelRange(),i=this.getValueLengthInRange(n),s=this.getLineCount(),r=this.getLineMaxColumn(s);this._buffer=e,this._bufferDisposable.dispose(),this._bufferDisposable=t,this._increaseVersionId(),this._tokens.flush(),this._tokens2.flush(),this._decorations=Object.create(null),this._decorationsTree=new Le,this._commandManager.clear(),this._trimAutoWhitespaceLines=null,this._emitContentChangedEvent(new j.dQ([new j.Jx],this._versionId,!1,!1),this._createContentChanged2(new u.e(1,1,s,r),0,i,this.getValue(),!1,!1,!0))}setEOL(e){this._assertNotDisposed();const t=1===e?"\r\n":"\n";if(this._buffer.getEOL()===t)return;const n=this.getFullModelRange(),i=this.getValueLengthInRange(n),s=this.getLineCount(),r=this.getLineMaxColumn(s);this._onBeforeEOLChange(),this._buffer.setEOL(t),this._increaseVersionId(),this._onAfterEOLChange(),this._emitContentChangedEvent(new j.dQ([new j.CZ],this._versionId,!1,!1),this._createContentChanged2(new u.e(1,1,s,r),0,i,this.getValue(),!1,!1,!1))}_onBeforeEOLChange(){this._decorationsTree.ensureAllNodesHaveRanges(this)}_onAfterEOLChange(){const e=this.getVersionId(),t=this._decorationsTree.collectNodesPostOrder();for(let n=0,i=t.length;n<i;n++){const i=t[n],s=i.range,r=i.cachedAbsoluteStart-i.start,o=this._buffer.getOffsetAt(s.startLineNumber,s.startColumn),a=this._buffer.getOffsetAt(s.endLineNumber,s.endColumn);i.cachedAbsoluteStart=o,i.cachedAbsoluteEnd=a,i.cachedVersionId=e,i.start=o-r,i.end=a-r,(0,_.sR)(i)}}onBeforeAttached(){this._attachedEditorCount++,1===this._attachedEditorCount&&this._onDidChangeAttached.fire(void 0)}onBeforeDetached(){this._attachedEditorCount--,0===this._attachedEditorCount&&this._onDidChangeAttached.fire(void 0)}isAttachedToEditor(){return this._attachedEditorCount>0}getAttachedEditorCount(){return this._attachedEditorCount}isTooLargeForSyncing(){return this._isTooLargeForSyncing}isTooLargeForTokenization(){return this._isTooLargeForTokenization}isDisposed(){return this._isDisposed}isDominatedByLongLines(){if(this._assertNotDisposed(),this.isTooLargeForTokenization())return!1;let e=0,t=0;const n=this._buffer.getLineCount();for(let i=1;i<=n;i++){const n=this._buffer.getLineLength(i);n>=1e4?t+=n:e+=n}return t>e}get uri(){return this._associatedResource}getOptions(){return this._assertNotDisposed(),this._options}getFormattingOptions(){return{tabSize:this._options.indentSize,insertSpaces:this._options.insertSpaces}}updateOptions(e){this._assertNotDisposed();let t=void 0!==e.tabSize?e.tabSize:this._options.tabSize,n=void 0!==e.indentSize?e.indentSize:this._options.indentSize,i=void 0!==e.insertSpaces?e.insertSpaces:this._options.insertSpaces,s=void 0!==e.trimAutoWhitespace?e.trimAutoWhitespace:this._options.trimAutoWhitespace,r=void 0!==e.bracketColorizationOptions?e.bracketColorizationOptions:this._options.bracketPairColorizationOptions,o=new f.dJ({tabSize:t,indentSize:n,insertSpaces:i,defaultEOL:this._options.defaultEOL,trimAutoWhitespace:s,bracketPairColorizationOptions:r});if(this._options.equals(o))return;let a=this._options.createChangeEvent(o);this._options=o,this._onDidChangeOptions.fire(a)}detectIndentation(e,t){this._assertNotDisposed();let n=(0,g.L)(this._buffer,t,e);this.updateOptions({insertSpaces:n.insertSpaces,tabSize:n.tabSize,indentSize:n.tabSize})}static _normalizeIndentationFromWhitespace(e,t,n){let i=0;for(let n=0;n<e.length;n++)"\t"===e.charAt(n)?i+=t:i++;let s="";if(!n){let e=Math.floor(i/t);i%=t;for(let t=0;t<e;t++)s+="\t"}for(let e=0;e<i;e++)s+=" ";return s}static normalizeIndentation(t,n,i){let s=o.LC(t);return-1===s&&(s=t.length),e._normalizeIndentationFromWhitespace(t.substring(0,s),n,i)+t.substring(s)}normalizeIndentation(t){return this._assertNotDisposed(),e.normalizeIndentation(t,this._options.indentSize,this._options.insertSpaces)}getVersionId(){return this._assertNotDisposed(),this._versionId}mightContainRTL(){return this._buffer.mightContainRTL()}mightContainUnusualLineTerminators(){return this._buffer.mightContainUnusualLineTerminators()}removeUnusualLineTerminators(e=null){const t=this.findMatches(o.Qe.source,!1,!0,!1,null,!1,1073741824);this._buffer.resetMightContainUnusualLineTerminators(),this.pushEditOperations(e,t.map(e=>({range:e.range,text:null})),()=>null)}mightContainNonBasicASCII(){return this._buffer.mightContainNonBasicASCII()}getAlternativeVersionId(){return this._assertNotDisposed(),this._alternativeVersionId}getInitialUndoRedoSnapshot(){return this._assertNotDisposed(),this._initialUndoRedoSnapshot}getOffsetAt(e){this._assertNotDisposed();let t=this._validatePosition(e.lineNumber,e.column,0);return this._buffer.getOffsetAt(t.lineNumber,t.column)}getPositionAt(e){this._assertNotDisposed();let t=Math.min(this._buffer.getLength(),Math.max(0,e));return this._buffer.getPositionAt(t)}_increaseVersionId(){this._versionId=this._versionId+1,this._alternativeVersionId=this._versionId}_overwriteVersionId(e){this._versionId=e}_overwriteAlternativeVersionId(e){this._alternativeVersionId=e}_overwriteInitialUndoRedoSnapshot(e){this._initialUndoRedoSnapshot=e}getValue(e,t=!1){this._assertNotDisposed();const n=this.getFullModelRange(),i=this.getValueInRange(n,e);return t?this._buffer.getBOM()+i:i}createSnapshot(e=!1){return new fe(this._buffer.createSnapshot(e))}getValueLength(e,t=!1){this._assertNotDisposed();const n=this.getFullModelRange(),i=this.getValueLengthInRange(n,e);return t?this._buffer.getBOM().length+i:i}getValueInRange(e,t=0){return this._assertNotDisposed(),this._buffer.getValueInRange(this.validateRange(e),t)}getValueLengthInRange(e,t=0){return this._assertNotDisposed(),this._buffer.getValueLengthInRange(this.validateRange(e),t)}getCharacterCountInRange(e,t=0){return this._assertNotDisposed(),this._buffer.getCharacterCountInRange(this.validateRange(e),t)}getLineCount(){return this._assertNotDisposed(),this._buffer.getLineCount()}getLineContent(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineContent(e)}getLineLength(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineLength(e)}getLinesContent(){return this._assertNotDisposed(),this._buffer.getLinesContent()}getEOL(){return this._assertNotDisposed(),this._buffer.getEOL()}getEndOfLineSequence(){return this._assertNotDisposed(),"\n"===this._buffer.getEOL()?0:1}getLineMinColumn(e){return this._assertNotDisposed(),1}getLineMaxColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineLength(e)+1}getLineFirstNonWhitespaceColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineFirstNonWhitespaceColumn(e)}getLineLastNonWhitespaceColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineLastNonWhitespaceColumn(e)}_validateRangeRelaxedNoAllocations(e){const t=this._buffer.getLineCount(),n=e.startLineNumber,i=e.startColumn;let s=Math.floor("number"!=typeof n||isNaN(n)?1:n),r=Math.floor("number"!=typeof i||isNaN(i)?1:i);if(s<1)s=1,r=1;else if(s>t)s=t,r=this.getLineMaxColumn(s);else if(r<=1)r=1;else{const e=this.getLineMaxColumn(s);r>=e&&(r=e)}const o=e.endLineNumber,a=e.endColumn;let l=Math.floor("number"!=typeof o||isNaN(o)?1:o),h=Math.floor("number"!=typeof a||isNaN(a)?1:a);if(l<1)l=1,h=1;else if(l>t)l=t,h=this.getLineMaxColumn(l);else if(h<=1)h=1;else{const e=this.getLineMaxColumn(l);h>=e&&(h=e)}return n===s&&i===r&&o===l&&a===h&&e instanceof u.e&&!(e instanceof c.Y)?e:new u.e(s,r,l,h)}_isValidPosition(e,t,n){if("number"!=typeof e||"number"!=typeof t)return!1;if(isNaN(e)||isNaN(t))return!1;if(e<1||t<1)return!1;if((0|e)!==e||(0|t)!==t)return!1;if(e>this._buffer.getLineCount())return!1;if(1===t)return!0;if(t>this.getLineMaxColumn(e))return!1;if(1===n){const n=this._buffer.getLineCharCode(e,t-2);if(o.ZG(n))return!1}return!0}_validatePosition(e,t,n){const i=Math.floor("number"!=typeof e||isNaN(e)?1:e),s=Math.floor("number"!=typeof t||isNaN(t)?1:t),r=this._buffer.getLineCount();if(i<1)return new h.L(1,1);if(i>r)return new h.L(r,this.getLineMaxColumn(r));if(s<=1)return new h.L(i,1);const a=this.getLineMaxColumn(i);if(s>=a)return new h.L(i,a);if(1===n){const e=this._buffer.getLineCharCode(i,s-2);if(o.ZG(e))return new h.L(i,s-1)}return new h.L(i,s)}validatePosition(e){return this._assertNotDisposed(),e instanceof h.L&&this._isValidPosition(e.lineNumber,e.column,1)?e:this._validatePosition(e.lineNumber,e.column,1)}_isValidRange(e,t){const n=e.startLineNumber,i=e.startColumn,s=e.endLineNumber,r=e.endColumn;if(!this._isValidPosition(n,i,0))return!1;if(!this._isValidPosition(s,r,0))return!1;if(1===t){const e=i>1?this._buffer.getLineCharCode(n,i-2):0,t=r>1&&r<=this._buffer.getLineLength(s)?this._buffer.getLineCharCode(s,r-2):0,a=o.ZG(e),l=o.ZG(t);return!a&&!l}return!0}validateRange(e){if(this._assertNotDisposed(),e instanceof u.e&&!(e instanceof c.Y)&&this._isValidRange(e,1))return e;const t=this._validatePosition(e.startLineNumber,e.startColumn,0),n=this._validatePosition(e.endLineNumber,e.endColumn,0),i=t.lineNumber,s=t.column,r=n.lineNumber,a=n.column;{const e=s>1?this._buffer.getLineCharCode(i,s-2):0,t=a>1&&a<=this._buffer.getLineLength(r)?this._buffer.getLineCharCode(r,a-2):0,n=o.ZG(e),l=o.ZG(t);return n||l?i===r&&s===a?new u.e(i,s-1,r,a-1):n&&l?new u.e(i,s-1,r,a+1):n?new u.e(i,s-1,r,a):new u.e(i,s,r,a+1):new u.e(i,s,r,a)}}modifyPosition(e,t){this._assertNotDisposed();let n=this.getOffsetAt(e)+t;return this.getPositionAt(Math.min(this._buffer.getLength(),Math.max(0,n)))}getFullModelRange(){this._assertNotDisposed();const e=this.getLineCount();return new u.e(1,1,e,this.getLineMaxColumn(e))}findMatchesLineByLine(e,t,n,i){return this._buffer.findMatchesLineByLine(e,t,n,i)}findMatches(e,t,n,i,s,r,o=999){this._assertNotDisposed();let a=null;null!==t&&(Array.isArray(t)||(t=[t]),t.every(e=>u.e.isIRange(e))&&(a=t.map(e=>this.validateRange(e)))),null===a&&(a=[this.getFullModelRange()]),a=a.sort((e,t)=>e.startLineNumber-t.startLineNumber||e.startColumn-t.startColumn);const l=[];let h;if(l.push(a.reduce((e,t)=>u.e.areIntersecting(e,t)?e.plusRange(t):(l.push(e),t))),!n&&e.indexOf("\n")<0){const t=new E.bc(e,n,i,s).parseSearchRequest();if(!t)return[];h=e=>this.findMatchesLineByLine(e,t,r,o)}else h=t=>E.pM.findMatches(this,new E.bc(e,n,i,s),t,r,o);return l.map(h).reduce((e,t)=>e.concat(t),[])}findNextMatch(e,t,n,i,s,r){this._assertNotDisposed();const o=this.validatePosition(t);if(!n&&e.indexOf("\n")<0){const t=new E.bc(e,n,i,s).parseSearchRequest();if(!t)return null;const a=this.getLineCount();let l=new u.e(o.lineNumber,o.column,a,this.getLineMaxColumn(a)),h=this.findMatchesLineByLine(l,t,r,1);return E.pM.findNextMatch(this,new E.bc(e,n,i,s),o,r),h.length>0?h[0]:(l=new u.e(1,1,o.lineNumber,this.getLineMaxColumn(o.lineNumber)),h=this.findMatchesLineByLine(l,t,r,1),h.length>0?h[0]:null)}return E.pM.findNextMatch(this,new E.bc(e,n,i,s),o,r)}findPreviousMatch(e,t,n,i,s,r){this._assertNotDisposed();const o=this.validatePosition(t);return E.pM.findPreviousMatch(this,new E.bc(e,n,i,s),o,r)}pushStackElement(){this._commandManager.pushStackElement()}popStackElement(){this._commandManager.popStackElement()}pushEOL(e){if(("\n"===this.getEOL()?0:1)!==e)try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),null===this._initialUndoRedoSnapshot&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEOL(e)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_validateEditOperation(e){return e instanceof f.Qi?e:new f.Qi(e.identifier||null,this.validateRange(e.range),e.text,e.forceMoveMarkers||!1,e.isAutoWhitespaceEdit||!1,e._isTracked||!1)}_validateEditOperations(e){const t=[];for(let n=0,i=e.length;n<i;n++)t[n]=this._validateEditOperation(e[n]);return t}pushEditOperations(e,t,n){try{return this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._pushEditOperations(e,this._validateEditOperations(t),n)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_pushEditOperations(e,t,n){if(this._options.trimAutoWhitespace&&this._trimAutoWhitespaceLines){let n=t.map(e=>({range:this.validateRange(e.range),text:e.text})),i=!0;if(e)for(let t=0,s=e.length;t<s;t++){let s=e[t],r=!1;for(let e=0,t=n.length;e<t;e++){let t=n[e].range,i=t.startLineNumber>s.endLineNumber,o=s.startLineNumber>t.endLineNumber;if(!i&&!o){r=!0;break}}if(!r){i=!1;break}}if(i)for(let e=0,i=this._trimAutoWhitespaceLines.length;e<i;e++){let i=this._trimAutoWhitespaceLines[e],s=this.getLineMaxColumn(i),r=!0;for(let e=0,t=n.length;e<t;e++){let t=n[e].range,o=n[e].text;if(!(i<t.startLineNumber||i>t.endLineNumber)&&!(i===t.startLineNumber&&t.startColumn===s&&t.isEmpty()&&o&&o.length>0&&"\n"===o.charAt(0)||i===t.startLineNumber&&1===t.startColumn&&t.isEmpty()&&o&&o.length>0&&"\n"===o.charAt(o.length-1))){r=!1;break}}if(r){const e=new u.e(i,1,i,s);t.push(new f.Qi(null,e,null,!1,!1,!1))}}this._trimAutoWhitespaceLines=null}return null===this._initialUndoRedoSnapshot&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEditOperation(e,t,n)}_applyUndo(e,t,n,i){const s=e.map(e=>{const t=this.getPositionAt(e.newPosition),n=this.getPositionAt(e.newEnd);return{range:new u.e(t.lineNumber,t.column,n.lineNumber,n.column),text:e.oldText}});this._applyUndoRedoEdits(s,t,!0,!1,n,i)}_applyRedo(e,t,n,i){const s=e.map(e=>{const t=this.getPositionAt(e.oldPosition),n=this.getPositionAt(e.oldEnd);return{range:new u.e(t.lineNumber,t.column,n.lineNumber,n.column),text:e.newText}});this._applyUndoRedoEdits(s,t,!1,!0,n,i)}_applyUndoRedoEdits(e,t,n,i,s,r){try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._isUndoing=n,this._isRedoing=i,this.applyEdits(e,!1),this.setEOL(t),this._overwriteAlternativeVersionId(s)}finally{this._isUndoing=!1,this._isRedoing=!1,this._eventEmitter.endDeferredEmit(r),this._onDidChangeDecorations.endDeferredEmit()}}applyEdits(e,t=!1){try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit();const n=this._validateEditOperations(e);return this._doApplyEdits(n,t)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_doApplyEdits(e,t){const n=this._buffer.getLineCount(),i=this._buffer.applyEdits(e,this._options.trimAutoWhitespace,t),s=this._buffer.getLineCount(),r=i.changes;if(this._trimAutoWhitespaceLines=i.trimAutoWhitespaceLineNumbers,0!==r.length){for(let e=0,t=r.length;e<t;e++){const t=r[e],[n,i,s]=(0,F.QZ)(t.text);this._tokens.acceptEdit(t.range,n,i),this._tokens2.acceptEdit(t.range,n,i,s,t.text.length>0?t.text.charCodeAt(0):0),this._decorationsTree.acceptReplace(t.rangeOffset,t.rangeLength,t.text.length,t.forceMoveMarkers)}let e=[];this._increaseVersionId();let t=n;for(let n=0,i=r.length;n<i;n++){const i=r[n],[o]=(0,F.QZ)(i.text);this._onDidChangeDecorations.fire();const a=i.range.startLineNumber,l=i.range.endLineNumber,u=l-a,c=o,f=Math.min(u,c),d=c-u,g=s-t-d+a,_=g,p=g+c,m=this._decorationsTree.getInjectedTextInInterval(this,this.getOffsetAt(new h.L(_,1)),this.getOffsetAt(new h.L(p,this.getLineMaxColumn(p))),0),L=j.gk.fromDecorations(m),C=new H.H9(L);for(let t=f;t>=0;t--){const n=a+t,i=g+t;C.takeFromEndWhile(e=>e.lineNumber>i);const s=C.takeFromEndWhile(e=>e.lineNumber===i);e.push(new j.rU(n,this.getLineContent(i),s))}if(f<u){const t=a+f;e.push(new j.lN(t+1,l))}if(f<c){const n=new H.H9(L),i=a+f,r=c-f,o=s-t-r+i+1;let l=[],h=[];for(let e=0;e<r;e++){let t=o+e;h[e]=this.getLineContent(t),n.takeWhile(e=>e.lineNumber<t),l[e]=n.takeWhile(e=>e.lineNumber===t)}e.push(new j.Tx(i+1,a+c,h,l))}t+=d}this._emitContentChangedEvent(new j.dQ(e,this.getVersionId(),this._isUndoing,this._isRedoing),{changes:r,eol:this._buffer.getEOL(),versionId:this.getVersionId(),isUndoing:this._isUndoing,isRedoing:this._isRedoing,isFlush:!1})}return null===i.reverseEdits?void 0:i.reverseEdits}undo(){return this._undoRedoService.undo(this.uri)}canUndo(){return this._undoRedoService.canUndo(this.uri)}redo(){return this._undoRedoService.redo(this.uri)}canRedo(){return this._undoRedoService.canRedo(this.uri)}handleBeforeFireDecorationsChangedEvent(e){if(null===e||0===e.size)return;const t=[...e].map(e=>new j.rU(e,this.getLineContent(e),this._getInjectedTextInLine(e)));this._onDidChangeContentOrInjectedText.fire(new j.D8(t))}changeDecorations(e,t=0){this._assertNotDisposed();try{return this._onDidChangeDecorations.beginDeferredEmit(),this._changeDecorations(t,e)}finally{this._onDidChangeDecorations.endDeferredEmit()}}_changeDecorations(e,t){let n={addDecoration:(t,n)=>this._deltaDecorationsImpl(e,[],[{range:t,options:n}])[0],changeDecoration:(e,t)=>{this._changeDecorationImpl(e,t)},changeDecorationOptions:(e,t)=>{this._changeDecorationOptionsImpl(e,we(t))},removeDecoration:t=>{this._deltaDecorationsImpl(e,[t],[])},deltaDecorations:(t,n)=>0===t.length&&0===n.length?[]:this._deltaDecorationsImpl(e,t,n)},s=null;try{s=t(n)}catch(e){(0,i.dL)(e)}return n.addDecoration=de,n.changeDecoration=de,n.changeDecorationOptions=de,n.removeDecoration=de,n.deltaDecorations=de,s}deltaDecorations(e,t,n=0){if(this._assertNotDisposed(),e||(e=[]),0===e.length&&0===t.length)return[];try{return this._onDidChangeDecorations.beginDeferredEmit(),this._deltaDecorationsImpl(n,e,t)}finally{this._onDidChangeDecorations.endDeferredEmit()}}_getTrackedRange(e){return this.getDecorationRange(e)}_setTrackedRange(e,t,n){const i=e?this._decorations[e]:null;if(!i)return t?this._deltaDecorationsImpl(0,[],[{range:t,options:Te[n]}])[0]:null;if(!t)return this._decorationsTree.delete(i),delete this._decorations[i.id],null;const s=this._validateRangeRelaxedNoAllocations(t),r=this._buffer.getOffsetAt(s.startLineNumber,s.startColumn),o=this._buffer.getOffsetAt(s.endLineNumber,s.endColumn);return this._decorationsTree.delete(i),i.reset(this.getVersionId(),r,o,s),i.setOptions(Te[n]),this._decorationsTree.insert(i),i.id}removeAllDecorationsWithOwnerId(e){if(this._isDisposed)return;const t=this._decorationsTree.collectNodesFromOwner(e);for(let e=0,n=t.length;e<n;e++){const n=t[e];this._decorationsTree.delete(n),delete this._decorations[n.id]}}getDecorationOptions(e){const t=this._decorations[e];return t?t.options:null}getDecorationRange(e){const t=this._decorations[e];return t?this._decorationsTree.getNodeRange(this,t):null}getLineDecorations(e,t=0,n=!1){return e<1||e>this.getLineCount()?[]:this.getLinesDecorations(e,e,t,n)}getLinesDecorations(e,t,n=0,i=!1){let s=this.getLineCount(),r=Math.min(s,Math.max(1,e)),o=Math.min(s,Math.max(1,t)),a=this.getLineMaxColumn(o);const l=new u.e(r,1,o,a),h=this._getDecorationsInRange(l,n,i);return h.push(...this._decorationProvider.getDecorationsInRange(l,n,i)),h}getDecorationsInRange(e,t=0,n=!1){let i=this.validateRange(e);const s=this._getDecorationsInRange(i,t,n);return s.push(...this._decorationProvider.getDecorationsInRange(i,t,n)),s}getOverviewRulerDecorations(e=0,t=!1){return this._decorationsTree.getAll(this,e,t,!0)}getInjectedTextDecorations(e=0){return this._decorationsTree.getAllInjectedText(this,e)}_getInjectedTextInLine(e){const t=this._buffer.getOffsetAt(e,1),n=t+this._buffer.getLineLength(e),i=this._decorationsTree.getInjectedTextInInterval(this,t,n,0);return j.gk.fromDecorations(i).filter(t=>t.lineNumber===e)}getAllDecorations(e=0,t=!1){let n=this._decorationsTree.getAll(this,e,t,!1);return n=n.concat(this._decorationProvider.getAllDecorations(e,t)),n}_getDecorationsInRange(e,t,n){const i=this._buffer.getOffsetAt(e.startLineNumber,e.startColumn),s=this._buffer.getOffsetAt(e.endLineNumber,e.endColumn);return this._decorationsTree.getAllInInterval(this,i,s,t,n)}getRangeAt(e,t){return this._buffer.getRangeAt(e,t-e)}_changeDecorationImpl(e,t){const n=this._decorations[e];if(!n)return;if(n.options.after){const t=this.getDecorationRange(e);this._onDidChangeDecorations.recordLineAffectedByInjectedText(t.endLineNumber)}if(n.options.before){const t=this.getDecorationRange(e);this._onDidChangeDecorations.recordLineAffectedByInjectedText(t.startLineNumber)}const i=this._validateRangeRelaxedNoAllocations(t),s=this._buffer.getOffsetAt(i.startLineNumber,i.startColumn),r=this._buffer.getOffsetAt(i.endLineNumber,i.endColumn);this._decorationsTree.delete(n),n.reset(this.getVersionId(),s,r,i),this._decorationsTree.insert(n),this._onDidChangeDecorations.checkAffectedAndFire(n.options),n.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(i.endLineNumber),n.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(i.startLineNumber)}_changeDecorationOptionsImpl(e,t){const n=this._decorations[e];if(!n)return;const i=!(!n.options.overviewRuler||!n.options.overviewRuler.color),s=!(!t.overviewRuler||!t.overviewRuler.color);if(this._onDidChangeDecorations.checkAffectedAndFire(n.options),this._onDidChangeDecorations.checkAffectedAndFire(t),n.options.after||t.after){const e=this._decorationsTree.getNodeRange(this,n);this._onDidChangeDecorations.recordLineAffectedByInjectedText(e.endLineNumber)}if(n.options.before||t.before){const e=this._decorationsTree.getNodeRange(this,n);this._onDidChangeDecorations.recordLineAffectedByInjectedText(e.startLineNumber)}i!==s?(this._decorationsTree.delete(n),n.setOptions(t),this._decorationsTree.insert(n)):n.setOptions(t)}_deltaDecorationsImpl(e,t,n){const i=this.getVersionId(),s=t.length;let r=0;const o=n.length;let a=0,l=new Array(o);for(;r<s||a<o;){let h=null;if(r<s){do{h=this._decorations[t[r++]]}while(!h&&r<s);if(h){if(h.options.after){const e=this._decorationsTree.getNodeRange(this,h);this._onDidChangeDecorations.recordLineAffectedByInjectedText(e.endLineNumber)}if(h.options.before){const e=this._decorationsTree.getNodeRange(this,h);this._onDidChangeDecorations.recordLineAffectedByInjectedText(e.startLineNumber)}this._decorationsTree.delete(h),this._onDidChangeDecorations.checkAffectedAndFire(h.options)}}if(a<o){if(!h){const e=++this._lastDecorationId,t=`${this._instanceId};${e}`;h=new _.fL(t,0,0),this._decorations[t]=h}const t=n[a],s=this._validateRangeRelaxedNoAllocations(t.range),r=we(t.options),o=this._buffer.getOffsetAt(s.startLineNumber,s.startColumn),u=this._buffer.getOffsetAt(s.endLineNumber,s.endColumn);h.ownerId=e,h.reset(i,o,u,s),h.setOptions(r),h.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(s.endLineNumber),h.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(s.startLineNumber),this._onDidChangeDecorations.checkAffectedAndFire(r),this._decorationsTree.insert(h),l[a]=h.id,a++}else h&&delete this._decorations[h.id]}return l}setTokens(e,t=!1){if(0!==e.length){let t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];let s=0,r=0,o=!1;for(let e=0,t=i.tokens.length;e<t;e++){const t=i.startLineNumber+e;if(o)this._tokens.setTokens(this._languageId,t-1,this._buffer.getLineLength(t),i.tokens[e],!1),r=t;else{this._tokens.setTokens(this._languageId,t-1,this._buffer.getLineLength(t),i.tokens[e],!0)&&(o=!0,s=t,r=t)}}o&&t.push({fromLineNumber:s,toLineNumber:r})}t.length>0&&this._emitModelTokensChangedEvent({tokenizationSupportChanged:!1,semanticTokensApplied:!1,ranges:t})}this.handleTokenizationProgress(t)}setSemanticTokens(e,t){this._tokens2.set(e,t),this._emitModelTokensChangedEvent({tokenizationSupportChanged:!1,semanticTokensApplied:null!==e,ranges:[{fromLineNumber:1,toLineNumber:this.getLineCount()}]})}hasCompleteSemanticTokens(){return this._tokens2.isComplete()}hasSomeSemanticTokens(){return!this._tokens2.isEmpty()}setPartialSemanticTokens(e,t){if(this.hasCompleteSemanticTokens())return;const n=this._tokens2.setPartial(e,t);this._emitModelTokensChangedEvent({tokenizationSupportChanged:!1,semanticTokensApplied:!0,ranges:[{fromLineNumber:n.startLineNumber,toLineNumber:n.endLineNumber}]})}tokenizeViewport(e,t){e=Math.max(1,e),t=Math.min(this._buffer.getLineCount(),t),this._tokenization.tokenizeViewport(e,t)}clearTokens(){this._tokens.flush(),this._emitModelTokensChangedEvent({tokenizationSupportChanged:!0,semanticTokensApplied:!1,ranges:[{fromLineNumber:1,toLineNumber:this._buffer.getLineCount()}]})}_emitModelTokensChangedEvent(e){this._isDisposing||this._onDidChangeTokens.fire(e)}resetTokenization(){this._tokenization.reset()}forceTokenization(e){if(e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");this._tokenization.forceTokenization(e)}isCheapToTokenize(e){return this._tokenization.isCheapToTokenize(e)}tokenizeIfCheap(e){this.isCheapToTokenize(e)&&this.forceTokenization(e)}getLineTokens(e){if(e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._getLineTokens(e)}_getLineTokens(e){const t=this.getLineContent(e),n=this._tokens.getTokens(this._languageId,e-1,t);return this._tokens2.addSemanticTokens(e,n)}getLanguageId(){return this._languageId}setMode(e){if(this._languageId===e)return;let t={oldLanguage:this._languageId,newLanguage:e};this._languageId=e,this._onDidChangeLanguage.fire(t),this._onDidChangeLanguageConfiguration.fire({})}getLanguageIdAtPosition(e,t){const n=this.validatePosition(new h.L(e,t)),i=this.getLineTokens(n.lineNumber);return i.getLanguageId(i.findTokenIndexAtOffset(n.column-1))}getTokenTypeIfInsertingCharacter(e,t,n){const i=this.validatePosition(new h.L(e,t));return this._tokenization.getTokenTypeIfInsertingCharacter(i,n)}getLanguageConfiguration(e){return this._languageConfigurationService.getLanguageConfiguration(e)}getWordAtPosition(t){this._assertNotDisposed();const n=this.validatePosition(t),i=this.getLineContent(n.lineNumber),s=this._getLineTokens(n.lineNumber),r=s.findTokenIndexAtOffset(n.column-1),[o,a]=e._findLanguageBoundaries(s,r),l=(0,K.t2)(n.column,this.getLanguageConfiguration(s.getLanguageId(r)).getWordDefinition(),i.substring(o,a),o);if(l&&l.startColumn<=t.column&&t.column<=l.endColumn)return l;if(r>0&&o===n.column-1){const[o,a]=e._findLanguageBoundaries(s,r-1),l=(0,K.t2)(n.column,this.getLanguageConfiguration(s.getLanguageId(r-1)).getWordDefinition(),i.substring(o,a),o);if(l&&l.startColumn<=t.column&&t.column<=l.endColumn)return l}return null}static _findLanguageBoundaries(e,t){const n=e.getLanguageId(t);let i=0;for(let s=t;s>=0&&e.getLanguageId(s)===n;s--)i=e.getStartOffset(s);let s=e.getLineContent().length;for(let i=t,r=e.getCount();i<r&&e.getLanguageId(i)===n;i++)s=e.getEndOffset(i);return[i,s]}getWordUntilPosition(e){const t=this.getWordAtPosition(e);return t?{word:t.word.substr(0,e.column-t.startColumn),startColumn:t.startColumn,endColumn:e.column}:{word:"",startColumn:e.column,endColumn:e.column}}static computeIndentLevel(e,t){let n=0,i=0,s=e.length;for(;i<s;){let s=e.charCodeAt(i);if(32===s)n++;else{if(9!==s)break;n=n-n%t+t}i++}return i===s?-1:n}_computeIndentLevel(t){return e.computeIndentLevel(this._buffer.getLineContent(t+1),this._options.tabSize)}getActiveIndentGuide(e,t,n){this._assertNotDisposed();const i=this.getLineCount();if(e<1||e>i)throw new Error("Illegal value for lineNumber");const s=this.getLanguageConfiguration(this._languageId).foldingRules,r=Boolean(s&&s.offSide);let o=-2,a=-1,l=-2,h=-1;const u=e=>{if(-1!==o&&(-2===o||o>e-1)){o=-1,a=-1;for(let t=e-2;t>=0;t--){let e=this._computeIndentLevel(t);if(e>=0){o=t,a=e;break}}}if(-2===l){l=-1,h=-1;for(let t=e;t<i;t++){let e=this._computeIndentLevel(t);if(e>=0){l=t,h=e;break}}}};let c=-2,f=-1,d=-2,g=-1;const _=e=>{if(-2===c){c=-1,f=-1;for(let t=e-2;t>=0;t--){let e=this._computeIndentLevel(t);if(e>=0){c=t,f=e;break}}}if(-1!==d&&(-2===d||d<e-1)){d=-1,g=-1;for(let t=e;t<i;t++){let e=this._computeIndentLevel(t);if(e>=0){d=t,g=e;break}}}};let p=0,m=!0,L=0,C=!0,b=0,I=0;for(let s=0;m||C;s++){const o=e-s,d=e+s;s>1&&(o<1||o<t)&&(m=!1),s>1&&(d>i||d>n)&&(C=!1),s>5e4&&(m=!1,C=!1);let N=-1;if(m){const e=this._computeIndentLevel(o-1);e>=0?(l=o-1,h=e,N=Math.ceil(e/this._options.indentSize)):(u(o),N=this._getIndentLevelForWhitespaceLine(r,a,h))}let v=-1;if(C){const e=this._computeIndentLevel(d-1);e>=0?(c=d-1,f=e,v=Math.ceil(e/this._options.indentSize)):(_(d),v=this._getIndentLevelForWhitespaceLine(r,f,g))}if(0!==s){if(1===s){if(d<=i&&v>=0&&I+1===v){m=!1,p=d,L=d,b=v;continue}if(o>=1&&N>=0&&N-1===I){C=!1,p=o,L=o,b=N;continue}if(p=e,L=e,b=I,0===b)return{startLineNumber:p,endLineNumber:L,indent:b}}m&&(N>=b?p=o:m=!1),C&&(v>=b?L=d:C=!1)}else I=N}return{startLineNumber:p,endLineNumber:L,indent:b}}getLinesBracketGuides(e,t,n,i){var s,r,a,l,h;const c=[],d=this._bracketPairColorizer.getBracketPairsInRangeWithMinIndentation(new u.e(e,1,t,this.getLineMaxColumn(t)));let g=void 0;if(n&&d.length>0){const i=e<=n.lineNumber&&n.lineNumber<=t?d.filter(e=>u.e.strictContainsPosition(e.range,n)):this._bracketPairColorizer.getBracketPairsInRange(u.e.fromPositions(n));g=null===(s=(0,H.dF)(i,e=>e.range.startLineNumber!==e.range.endLineNumber))||void 0===s?void 0:s.range}const _=new H.H9(d),p=new Array,m=new Array,L=new _e;for(let n=e;n<=t;n++){let e=new Array;m.length>0&&(e=e.concat(m),m.length=0),c.push(e);for(const e of _.takeWhile(e=>e.openingBracketRange.startLineNumber<=n)||[]){if(e.range.startLineNumber===e.range.endLineNumber)continue;const t=Math.min(this.getVisibleColumnFromPosition(e.openingBracketRange.getStartPosition()),this.getVisibleColumnFromPosition(null!==(a=null===(r=e.closingBracketRange)||void 0===r?void 0:r.getStartPosition())&&void 0!==a?a:e.range.getEndPosition()),e.minVisibleColumnIndentation+1);let n=!1;if(e.closingBracketRange){o.LC(this.getLineContent(e.closingBracketRange.startLineNumber))<e.closingBracketRange.startColumn-1&&(n=!0)}const i=e.openingBracketRange.getStartPosition(),s=null!==(h=null===(l=e.closingBracketRange)||void 0===l?void 0:l.getStartPosition())&&void 0!==h?h:e.range.getEndPosition();void 0===e.closingBracketRange?p[e.nestingLevel]=null:p[e.nestingLevel]={nestingLevel:e.nestingLevel,guideVisibleColumn:t,start:i,visibleStartColumn:this.getVisibleColumnFromPosition(i),end:s,visibleEndColumn:this.getVisibleColumnFromPosition(s),bracketPair:e,renderHorizontalEndLineAtTheBottom:n}}for(const t of p){if(!t)continue;const s=g&&t.bracketPair.range.equalsRange(g),r=L.getInlineClassNameOfLevel(t.nestingLevel)+(i.highlightActive&&s?" "+L.activeClassName:"");(s&&i.horizontalGuides!==f.s6.Disabled||i.includeInactive&&i.horizontalGuides===f.s6.Enabled)&&(t.start.lineNumber===n&&t.guideVisibleColumn<t.visibleStartColumn&&e.push(new f.UO(t.guideVisibleColumn,r,new f.vW(!1,t.start.column))),t.end.lineNumber===n+1&&t.guideVisibleColumn<t.visibleEndColumn&&m.push(new f.UO(t.guideVisibleColumn,r,new f.vW(!t.renderHorizontalEndLineAtTheBottom,t.end.column))))}let t=Number.MAX_SAFE_INTEGER;for(let s=p.length-1;s>=0;s--){const r=p[s];if(!r)continue;const o=i.highlightActive&&g&&r.bracketPair.range.equalsRange(g),a=L.getInlineClassNameOfLevel(r.nestingLevel)+(o?" "+L.activeClassName:"");(o||i.includeInactive)&&r.renderHorizontalEndLineAtTheBottom&&r.end.lineNumber===n+1&&m.push(new f.UO(r.guideVisibleColumn,a,null)),r.end.lineNumber<=n||r.start.lineNumber>=n||(r.guideVisibleColumn>=t&&!o||(t=r.guideVisibleColumn,(o||i.includeInactive)&&e.push(new f.UO(r.guideVisibleColumn,a,null))))}e.sort((e,t)=>e.visibleColumn-t.visibleColumn)}return c}getVisibleColumnFromPosition(e){return re.i.visibleColumnFromColumn(this.getLineContent(e.lineNumber),e.column,this._options.tabSize)+1}getLinesIndentGuides(e,t){this._assertNotDisposed();const n=this.getLineCount();if(e<1||e>n)throw new Error("Illegal value for startLineNumber");if(t<1||t>n)throw new Error("Illegal value for endLineNumber");const i=this.getLanguageConfiguration(this._languageId).foldingRules,s=Boolean(i&&i.offSide);let r=new Array(t-e+1),o=-2,a=-1,l=-2,h=-1;for(let i=e;i<=t;i++){let t=i-e;const u=this._computeIndentLevel(i-1);if(u>=0)o=i-1,a=u,r[t]=Math.ceil(u/this._options.indentSize);else{if(-2===o){o=-1,a=-1;for(let e=i-2;e>=0;e--){let t=this._computeIndentLevel(e);if(t>=0){o=e,a=t;break}}}if(-1!==l&&(-2===l||l<i-1)){l=-1,h=-1;for(let e=i;e<n;e++){let t=this._computeIndentLevel(e);if(t>=0){l=e,h=t;break}}}r[t]=this._getIndentLevelForWhitespaceLine(s,a,h)}}return r}_getIndentLevelForWhitespaceLine(e,t,n){return-1===t||-1===n?0:t<n?1+Math.floor(t/this._options.indentSize):t===n||e?Math.ceil(n/this._options.indentSize):1+Math.floor(n/this._options.indentSize)}normalizePosition(e,t){return e}getLineIndentColumn(e){return function(e){let t=0;for(const n of e){if(" "!==n&&"\t"!==n)break;t++}return t}(this.getLineContent(e))+1}};ge.MODEL_SYNC_LIMIT=52428800,ge.LARGE_FILE_SIZE_THRESHOLD=20971520,ge.LARGE_FILE_LINE_COUNT_THRESHOLD=3e5,ge.DEFAULT_CREATION_OPTIONS={isForSimpleWidget:!1,tabSize:l.DB.tabSize,indentSize:l.DB.indentSize,insertSpaces:l.DB.insertSpaces,detectIndentation:!1,defaultEOL:1,trimAutoWhitespace:l.DB.trimAutoWhitespace,largeFileOptimizations:l.DB.largeFileOptimizations,bracketPairColorizationOptions:l.DB.bracketPairColorizationOptions},ge=ae([le(4,ne.tJ),le(5,oe.h),le(6,ee.c_)],ge);class _e{constructor(){this.activeClassName="indent-active"}getInlineClassNameOfLevel(e){return"bracket-indent-guide lvl-"+e%30}}function pe(e){return!(!e.options.overviewRuler||!e.options.overviewRuler.color)}function me(e){return!!e.options.after||!!e.options.before}class Le{constructor(){this._decorationsTree0=new _.IF,this._decorationsTree1=new _.IF,this._injectedTextDecorationsTree=new _.IF}ensureAllNodesHaveRanges(e){this.getAll(e,0,!1,!1)}_ensureNodesHaveRanges(e,t){for(const n of t)null===n.range&&(n.range=e.getRangeAt(n.cachedAbsoluteStart,n.cachedAbsoluteEnd));return t}getAllInInterval(e,t,n,i,s){const r=e.getVersionId(),o=this._intervalSearch(t,n,i,s,r);return this._ensureNodesHaveRanges(e,o)}_intervalSearch(e,t,n,i,s){const r=this._decorationsTree0.intervalSearch(e,t,n,i,s),o=this._decorationsTree1.intervalSearch(e,t,n,i,s),a=this._injectedTextDecorationsTree.intervalSearch(e,t,n,i,s);return r.concat(o).concat(a)}getInjectedTextInInterval(e,t,n,i){const s=e.getVersionId(),r=this._injectedTextDecorationsTree.intervalSearch(t,n,i,!1,s);return this._ensureNodesHaveRanges(e,r).filter(e=>e.options.showIfCollapsed||!e.range.isEmpty())}getAllInjectedText(e,t){const n=e.getVersionId(),i=this._injectedTextDecorationsTree.search(t,!1,n);return this._ensureNodesHaveRanges(e,i).filter(e=>e.options.showIfCollapsed||!e.range.isEmpty())}getAll(e,t,n,i){const s=e.getVersionId(),r=this._search(t,n,i,s);return this._ensureNodesHaveRanges(e,r)}_search(e,t,n,i){if(n)return this._decorationsTree1.search(e,t,i);{const n=this._decorationsTree0.search(e,t,i),s=this._decorationsTree1.search(e,t,i),r=this._injectedTextDecorationsTree.search(e,t,i);return n.concat(s).concat(r)}}collectNodesFromOwner(e){const t=this._decorationsTree0.collectNodesFromOwner(e),n=this._decorationsTree1.collectNodesFromOwner(e),i=this._injectedTextDecorationsTree.collectNodesFromOwner(e);return t.concat(n).concat(i)}collectNodesPostOrder(){const e=this._decorationsTree0.collectNodesPostOrder(),t=this._decorationsTree1.collectNodesPostOrder(),n=this._injectedTextDecorationsTree.collectNodesPostOrder();return e.concat(t).concat(n)}insert(e){me(e)?this._injectedTextDecorationsTree.insert(e):pe(e)?this._decorationsTree1.insert(e):this._decorationsTree0.insert(e)}delete(e){me(e)?this._injectedTextDecorationsTree.delete(e):pe(e)?this._decorationsTree1.delete(e):this._decorationsTree0.delete(e)}getNodeRange(e,t){const n=e.getVersionId();return t.cachedVersionId!==n&&this._resolveNode(t,n),null===t.range&&(t.range=e.getRangeAt(t.cachedAbsoluteStart,t.cachedAbsoluteEnd)),t.range}_resolveNode(e,t){me(e)?this._injectedTextDecorationsTree.resolveNode(e,t):pe(e)?this._decorationsTree1.resolveNode(e,t):this._decorationsTree0.resolveNode(e,t)}acceptReplace(e,t,n,i){this._decorationsTree0.acceptReplace(e,t,n,i),this._decorationsTree1.acceptReplace(e,t,n,i),this._injectedTextDecorationsTree.acceptReplace(e,t,n,i)}}function Ce(e){return e.replace(/[^a-z0-9\-_]/gi," ")}class be{constructor(e){this.color=e.color||"",this.darkColor=e.darkColor||""}}class Ie extends be{constructor(e){super(e),this._resolvedColor=null,this.position="number"==typeof e.position?e.position:f.sh.Center}getColor(e){return this._resolvedColor||("light"!==e.type&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,e):this._resolvedColor=this._resolveColor(this.color,e)),this._resolvedColor}invalidateCachedColor(){this._resolvedColor=null}_resolveColor(e,t){if("string"==typeof e)return e;let n=e?t.getColor(e.id):null;return n?n.toString():""}}class Ne extends be{constructor(e){super(e),this.position=e.position}getColor(e){return this._resolvedColor||("light"!==e.type&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,e):this._resolvedColor=this._resolveColor(this.color,e)),this._resolvedColor}invalidateCachedColor(){this._resolvedColor=void 0}_resolveColor(e,t){return"string"==typeof e?te.Il.fromHex(e):t.getColor(e.id)}}class ve{constructor(e){this.content=e.content||"",this.inlineClassName=e.inlineClassName||null,this.inlineClassNameAffectsLetterSpacing=e.inlineClassNameAffectsLetterSpacing||!1}static from(e){return e instanceof ve?e:new ve(e)}}class xe{constructor(e){var t;this.description=e.description,this.stickiness=e.stickiness||0,this.zIndex=e.zIndex||0,this.className=e.className?Ce(e.className):null,this.hoverMessage=e.hoverMessage||null,this.glyphMarginHoverMessage=e.glyphMarginHoverMessage||null,this.isWholeLine=e.isWholeLine||!1,this.showIfCollapsed=e.showIfCollapsed||!1,this.collapseOnReplaceEdit=e.collapseOnReplaceEdit||!1,this.overviewRuler=e.overviewRuler?new Ie(e.overviewRuler):null,this.minimap=e.minimap?new Ne(e.minimap):null,this.glyphMarginClassName=e.glyphMarginClassName?Ce(e.glyphMarginClassName):null,this.linesDecorationsClassName=e.linesDecorationsClassName?Ce(e.linesDecorationsClassName):null,this.firstLineDecorationClassName=e.firstLineDecorationClassName?Ce(e.firstLineDecorationClassName):null,this.marginClassName=e.marginClassName?Ce(e.marginClassName):null,this.inlineClassName=e.inlineClassName?Ce(e.inlineClassName):null,this.inlineClassNameAffectsLetterSpacing=e.inlineClassNameAffectsLetterSpacing||!1,this.beforeContentClassName=e.beforeContentClassName?Ce(e.beforeContentClassName):null,this.afterContentClassName=e.afterContentClassName?Ce(e.afterContentClassName):null,this.after=e.after?ve.from(e.after):null,this.before=e.before?ve.from(e.before):null,this.hideInCommentTokens=null!==(t=e.hideInCommentTokens)&&void 0!==t&&t}static register(e){return new xe(e)}static createDynamic(e){return new xe(e)}}xe.EMPTY=xe.register({description:"empty"});const Te=[xe.register({description:"tracked-range-always-grows-when-typing-at-edges",stickiness:0}),xe.register({description:"tracked-range-never-grows-when-typing-at-edges",stickiness:1}),xe.register({description:"tracked-range-grows-only-when-typing-before",stickiness:2}),xe.register({description:"tracked-range-grows-only-when-typing-after",stickiness:3})];function we(e){return e instanceof xe?e:xe.createDynamic(e)}class ke extends r.JT{constructor(e){super(),this.handleBeforeFire=e,this._actual=this._register(new s.Q5),this.event=this._actual.event,this._affectedInjectedTextLines=null,this._deferredCnt=0,this._shouldFire=!1,this._affectsMinimap=!1,this._affectsOverviewRuler=!1}beginDeferredEmit(){this._deferredCnt++}endDeferredEmit(){var e;if(this._deferredCnt--,0===this._deferredCnt){if(this._shouldFire){this.handleBeforeFire(this._affectedInjectedTextLines);const e={affectsMinimap:this._affectsMinimap,affectsOverviewRuler:this._affectsOverviewRuler};this._shouldFire=!1,this._affectsMinimap=!1,this._affectsOverviewRuler=!1,this._actual.fire(e)}null===(e=this._affectedInjectedTextLines)||void 0===e||e.clear(),this._affectedInjectedTextLines=null}}recordLineAffectedByInjectedText(e){this._affectedInjectedTextLines||(this._affectedInjectedTextLines=new Set),this._affectedInjectedTextLines.add(e)}checkAffectedAndFire(e){this._affectsMinimap||(this._affectsMinimap=!(!e.minimap||!e.minimap.position)),this._affectsOverviewRuler||(this._affectsOverviewRuler=!(!e.overviewRuler||!e.overviewRuler.color)),this._shouldFire=!0}fire(){this._affectsMinimap=!0,this._affectsOverviewRuler=!0,this._shouldFire=!0}}class Se extends r.JT{constructor(){super(),this._fastEmitter=this._register(new s.Q5),this.fastEvent=this._fastEmitter.event,this._slowEmitter=this._register(new s.Q5),this.slowEvent=this._slowEmitter.event,this._deferredCnt=0,this._deferredEvent=null}beginDeferredEmit(){this._deferredCnt++}endDeferredEmit(e=null){if(this._deferredCnt--,0===this._deferredCnt&&null!==this._deferredEvent){this._deferredEvent.rawContentChangedEvent.resultingSelection=e;const t=this._deferredEvent;this._deferredEvent=null,this._fastEmitter.fire(t),this._slowEmitter.fire(t)}}fire(e){this._deferredCnt>0?this._deferredEvent?this._deferredEvent=this._deferredEvent.merge(e):this._deferredEvent=e:(this._fastEmitter.fire(e),this._slowEmitter.fire(e))}}},83256:(e,t,n)=>{n.d(t,{CZ:()=>l,D8:()=>u,Jx:()=>i,Tx:()=>a,dQ:()=>h,fV:()=>c,gk:()=>s,lN:()=>o,rU:()=>r});class i{constructor(){this.changeType=1}}class s{constructor(e,t,n,i,s){this.ownerId=e,this.lineNumber=t,this.column=n,this.options=i,this.order=s}static applyInjectedText(e,t){if(!t||0===t.length)return e;let n="",i=0;for(const s of t)n+=e.substring(i,s.column-1),i=s.column-1,n+=s.options.content;return n+=e.substring(i),n}static fromDecorations(e){const t=[];for(const n of e)n.options.before&&n.options.before.content.length>0&&t.push(new s(n.ownerId,n.range.startLineNumber,n.range.startColumn,n.options.before,0)),n.options.after&&n.options.after.content.length>0&&t.push(new s(n.ownerId,n.range.endLineNumber,n.range.endColumn,n.options.after,1));return t.sort((e,t)=>e.lineNumber===t.lineNumber?e.column===t.column?e.order-t.order:e.column-t.column:e.lineNumber-t.lineNumber),t}}class r{constructor(e,t,n){this.changeType=2,this.lineNumber=e,this.detail=t,this.injectedText=n}}class o{constructor(e,t){this.changeType=3,this.fromLineNumber=e,this.toLineNumber=t}}class a{constructor(e,t,n,i){this.changeType=4,this.injectedTexts=i,this.fromLineNumber=e,this.toLineNumber=t,this.detail=n}}class l{constructor(){this.changeType=5}}class h{constructor(e,t,n,i){this.changes=e,this.versionId=t,this.isUndoing=n,this.isRedoing=i,this.resultingSelection=null}containsEvent(e){for(let t=0,n=this.changes.length;t<n;t++){if(this.changes[t].changeType===e)return!0}return!1}static merge(e,t){const n=[].concat(e.changes).concat(t.changes),i=t.versionId,s=e.isUndoing||t.isUndoing,r=e.isRedoing||t.isRedoing;return new h(n,i,s,r)}}class u{constructor(e){this.changes=e}}class c{constructor(e,t){this.rawContentChangedEvent=e,this.contentChangedEvent=t}merge(e){const t=h.merge(this.rawContentChangedEvent,e.rawContentChangedEvent),n=c._mergeChangeEvents(this.contentChangedEvent,e.contentChangedEvent);return new c(t,n)}static _mergeChangeEvents(e,t){return{changes:[].concat(e.changes).concat(t.changes),eol:t.eol,versionId:t.versionId,isUndoing:e.isUndoing||t.isUndoing,isRedoing:e.isRedoing||t.isRedoing,isFlush:e.isFlush||t.isFlush}}}},77277:(e,t,n)=>{n.d(t,{bc:()=>l,cM:()=>d,iE:()=>u,pM:()=>f,sz:()=>g});var i=n(97295),s=n(59410),r=n(50187),o=n(24314),a=n(84973);class l{constructor(e,t,n,i){this.searchString=e,this.isRegex=t,this.matchCase=n,this.wordSeparators=i}parseSearchRequest(){if(""===this.searchString)return null;let e;e=this.isRegex?function(e){if(!e||0===e.length)return!1;for(let t=0,n=e.length;t<n;t++){if(92===e.charCodeAt(t)){if(t++,t>=n)break;const i=e.charCodeAt(t);if(110===i||114===i||87===i)return!0}}return!1}(this.searchString):this.searchString.indexOf("\n")>=0;let t=null;try{t=i.GF(this.searchString,this.isRegex,{matchCase:this.matchCase,wholeWord:!1,multiline:e,global:!0,unicode:!0})}catch(e){return null}if(!t)return null;let n=!this.isRegex&&!e;return n&&this.searchString.toLowerCase()!==this.searchString.toUpperCase()&&(n=this.matchCase),new h(t,this.wordSeparators?(0,s.u)(this.wordSeparators):null,n?this.searchString:null)}}class h{constructor(e,t,n){this.regex=e,this.wordSeparators=t,this.simpleSearch=n}}function u(e,t,n){if(!n)return new a.tk(e,null);let i=[];for(let e=0,n=t.length;e<n;e++)i[e]=t[e];return new a.tk(e,i)}class c{constructor(e){let t=[],n=0;for(let i=0,s=e.length;i<s;i++)10===e.charCodeAt(i)&&(t[n++]=i);this._lineFeedsOffsets=t}findLineFeedCountBeforeOffset(e){const t=this._lineFeedsOffsets;let n=0,i=t.length-1;if(-1===i)return 0;if(e<=t[0])return 0;for(;n<i;){const s=n+((i-n)/2>>0);t[s]>=e?i=s-1:t[s+1]>=e?(n=s,i=s):n=s+1}return n+1}}class f{static findMatches(e,t,n,i,s){const r=t.parseSearchRequest();return r?r.regex.multiline?this._doFindMatchesMultiline(e,n,new g(r.wordSeparators,r.regex),i,s):this._doFindMatchesLineByLine(e,n,r,i,s):[]}static _getMultilineMatchRange(e,t,n,i,s,r){let a,l,h=0;if(i?(h=i.findLineFeedCountBeforeOffset(s),a=t+s+h):a=t+s,i){let e=i.findLineFeedCountBeforeOffset(s+r.length)-h;l=a+r.length+e}else l=a+r.length;const u=e.getPositionAt(a),c=e.getPositionAt(l);return new o.e(u.lineNumber,u.column,c.lineNumber,c.column)}static _doFindMatchesMultiline(e,t,n,i,s){const r=e.getOffsetAt(t.getStartPosition()),o=e.getValueInRange(t,1),a="\r\n"===e.getEOL()?new c(o):null,l=[];let h,f=0;for(n.reset(0);h=n.next(o);)if(l[f++]=u(this._getMultilineMatchRange(e,r,o,a,h.index,h[0]),h,i),f>=s)return l;return l}static _doFindMatchesLineByLine(e,t,n,i,s){const r=[];let o=0;if(t.startLineNumber===t.endLineNumber){const a=e.getLineContent(t.startLineNumber).substring(t.startColumn-1,t.endColumn-1);return o=this._findMatchesInLine(n,a,t.startLineNumber,t.startColumn-1,o,r,i,s),r}const a=e.getLineContent(t.startLineNumber).substring(t.startColumn-1);o=this._findMatchesInLine(n,a,t.startLineNumber,t.startColumn-1,o,r,i,s);for(let a=t.startLineNumber+1;a<t.endLineNumber&&o<s;a++)o=this._findMatchesInLine(n,e.getLineContent(a),a,0,o,r,i,s);if(o<s){const a=e.getLineContent(t.endLineNumber).substring(0,t.endColumn-1);o=this._findMatchesInLine(n,a,t.endLineNumber,0,o,r,i,s)}return r}static _findMatchesInLine(e,t,n,i,s,r,l,h){const c=e.wordSeparators;if(!l&&e.simpleSearch){const l=e.simpleSearch,u=l.length,f=t.length;let g=-u;for(;-1!==(g=t.indexOf(l,g+u));)if((!c||d(c,t,f,g,u))&&(r[s++]=new a.tk(new o.e(n,g+1+i,n,g+1+u+i),null),s>=h))return s;return s}const f=new g(e.wordSeparators,e.regex);let _;f.reset(0);do{if(_=f.next(t),_&&(r[s++]=u(new o.e(n,_.index+1+i,n,_.index+1+_[0].length+i),_,l),s>=h))return s}while(_);return s}static findNextMatch(e,t,n,i){const s=t.parseSearchRequest();if(!s)return null;const r=new g(s.wordSeparators,s.regex);return s.regex.multiline?this._doFindNextMatchMultiline(e,n,r,i):this._doFindNextMatchLineByLine(e,n,r,i)}static _doFindNextMatchMultiline(e,t,n,i){const s=new r.L(t.lineNumber,1),a=e.getOffsetAt(s),l=e.getLineCount(),h=e.getValueInRange(new o.e(s.lineNumber,s.column,l,e.getLineMaxColumn(l)),1),f="\r\n"===e.getEOL()?new c(h):null;n.reset(t.column-1);let d=n.next(h);return d?u(this._getMultilineMatchRange(e,a,h,f,d.index,d[0]),d,i):1!==t.lineNumber||1!==t.column?this._doFindNextMatchMultiline(e,new r.L(1,1),n,i):null}static _doFindNextMatchLineByLine(e,t,n,i){const s=e.getLineCount(),r=t.lineNumber,o=e.getLineContent(r),a=this._findFirstMatchInLine(n,o,r,t.column,i);if(a)return a;for(let t=1;t<=s;t++){const o=(r+t-1)%s,a=e.getLineContent(o+1),l=this._findFirstMatchInLine(n,a,o+1,1,i);if(l)return l}return null}static _findFirstMatchInLine(e,t,n,i,s){e.reset(i-1);const r=e.next(t);return r?u(new o.e(n,r.index+1,n,r.index+1+r[0].length),r,s):null}static findPreviousMatch(e,t,n,i){const s=t.parseSearchRequest();if(!s)return null;const r=new g(s.wordSeparators,s.regex);return s.regex.multiline?this._doFindPreviousMatchMultiline(e,n,r,i):this._doFindPreviousMatchLineByLine(e,n,r,i)}static _doFindPreviousMatchMultiline(e,t,n,i){const s=this._doFindMatchesMultiline(e,new o.e(1,1,t.lineNumber,t.column),n,i,9990);if(s.length>0)return s[s.length-1];const a=e.getLineCount();return t.lineNumber!==a||t.column!==e.getLineMaxColumn(a)?this._doFindPreviousMatchMultiline(e,new r.L(a,e.getLineMaxColumn(a)),n,i):null}static _doFindPreviousMatchLineByLine(e,t,n,i){const s=e.getLineCount(),r=t.lineNumber,o=e.getLineContent(r).substring(0,t.column-1),a=this._findLastMatchInLine(n,o,r,i);if(a)return a;for(let t=1;t<=s;t++){const o=(s+r-t-1)%s,a=e.getLineContent(o+1),l=this._findLastMatchInLine(n,a,o+1,i);if(l)return l}return null}static _findLastMatchInLine(e,t,n,i){let s,r=null;for(e.reset(0);s=e.next(t);)r=u(new o.e(n,s.index+1,n,s.index+1+s[0].length),s,i);return r}}function d(e,t,n,i,s){return function(e,t,n,i,s){if(0===i)return!0;const r=t.charCodeAt(i-1);if(0!==e.get(r))return!0;if(13===r||10===r)return!0;if(s>0){const n=t.charCodeAt(i);if(0!==e.get(n))return!0}return!1}(e,t,0,i,s)&&function(e,t,n,i,s){if(i+s===n)return!0;const r=t.charCodeAt(i+s);if(0!==e.get(r))return!0;if(13===r||10===r)return!0;if(s>0){const n=t.charCodeAt(i+s-1);if(0!==e.get(n))return!0}return!1}(e,t,n,i,s)}class g{constructor(e,t){this._wordSeparators=e,this._searchRegex=t,this._prevMatchStartIndex=-1,this._prevMatchLength=0}reset(e){this._searchRegex.lastIndex=e,this._prevMatchStartIndex=-1,this._prevMatchLength=0}next(e){const t=e.length;let n;do{if(this._prevMatchStartIndex+this._prevMatchLength===t)return null;if(n=this._searchRegex.exec(e),!n)return null;const s=n.index,r=n[0].length;if(s===this._prevMatchStartIndex&&r===this._prevMatchLength){if(0===r){i.ZH(e,t,this._searchRegex.lastIndex)>65535?this._searchRegex.lastIndex+=2:this._searchRegex.lastIndex+=1;continue}return null}if(this._prevMatchStartIndex=s,this._prevMatchLength=r,!this._wordSeparators||d(this._wordSeparators,e,t,s,r))return n}while(n);return null}}},58409:(e,t,n)=>{n.d(t,{DA:()=>c,OU:()=>f,QZ:()=>l,Rl:()=>L,Wz:()=>g,cx:()=>m});var i=n(9488),s=n(78411),r=n(50187),o=n(24314),a=n(44101);function l(e){let t=0,n=0,i=0,s=0;for(let r=0,o=e.length;r<o;r++){const a=e.charCodeAt(r);13===a?(0===t&&(n=r),t++,r+1<o&&10===e.charCodeAt(r+1)?(s|=2,r++):s|=3,i=r+1):10===a&&(s|=1,0===t&&(n=r),t++,i=r+1)}return 0===t&&(n=e.length),[t,n,e.length-i,s]}function h(e){return(16384|e<<0|2<<23)>>>0}const u=new Uint32Array(0).buffer;class c{constructor(){this.tokens=[]}add(e,t){if(this.tokens.length>0){const n=this.tokens[this.tokens.length-1];if(n.startLineNumber+n.tokens.length-1+1===e)return void n.tokens.push(t)}this.tokens.push(new _(e,[t]))}}class f{constructor(e){this._tokens=e,this._tokenCount=e.length/4}toString(e){let t=[];for(let n=0;n<this._tokenCount;n++)t.push(`(${this._getDeltaLine(n)+e},${this._getStartCharacter(n)}-${this._getEndCharacter(n)})`);return`[${t.join(",")}]`}getMaxDeltaLine(){const e=this._getTokenCount();return 0===e?-1:this._getDeltaLine(e-1)}getRange(){const e=this._getTokenCount();if(0===e)return null;const t=this._getStartCharacter(0),n=this._getDeltaLine(e-1),i=this._getEndCharacter(e-1);return new o.e(0,t+1,n,i+1)}_getTokenCount(){return this._tokenCount}_getDeltaLine(e){return this._tokens[4*e]}_getStartCharacter(e){return this._tokens[4*e+1]}_getEndCharacter(e){return this._tokens[4*e+2]}isEmpty(){return 0===this._getTokenCount()}getLineTokens(e){let t=0,n=this._getTokenCount()-1;for(;t<n;){const i=t+Math.floor((n-t)/2),s=this._getDeltaLine(i);if(s<e)t=i+1;else{if(!(s>e)){let s=i;for(;s>t&&this._getDeltaLine(s-1)===e;)s--;let r=i;for(;r<n&&this._getDeltaLine(r+1)===e;)r++;return new d(this._tokens.subarray(4*s,4*r+4))}n=i-1}}return this._getDeltaLine(t)===e?new d(this._tokens.subarray(4*t,4*t+4)):null}clear(){this._tokenCount=0}removeTokens(e,t,n,i){const s=this._tokens,r=this._tokenCount;let o=0,a=!1,l=0;for(let h=0;h<r;h++){const r=4*h,u=s[r],c=s[r+1],f=s[r+2],d=s[r+3];if((u>e||u===e&&f>=t)&&(u<n||u===n&&c<=i))a=!0;else{if(0===o&&(l=u),a){const e=4*o;s[e]=u-l,s[e+1]=c,s[e+2]=f,s[e+3]=d}o++}}return this._tokenCount=o,l}split(e,t,n,i){const s=this._tokens,r=this._tokenCount;let o=[],a=[],l=o,h=0,u=0;for(let o=0;o<r;o++){const r=4*o,c=s[r],f=s[r+1],d=s[r+2],g=s[r+3];if(c>e||c===e&&d>=t){if(c<n||c===n&&f<=i)continue;l!==a&&(l=a,h=0,u=c)}l[h++]=c-u,l[h++]=f,l[h++]=d,l[h++]=g}return[new f(new Uint32Array(o)),new f(new Uint32Array(a)),u]}acceptDeleteRange(e,t,n,i,s){const r=this._tokens,o=this._tokenCount,a=i-t;let l=0,h=!1;for(let u=0;u<o;u++){const c=4*u;let f=r[c],d=r[c+1],g=r[c+2];const _=r[c+3];if(f<t||f===t&&g<=n){l++;continue}if(f===t&&d<n)f===i&&g>s?g-=s-n:g=n;else if(f===t&&d===n){if(!(f===i&&g>s)){h=!0;continue}g-=s-n}else if(f<i||f===i&&d<s){if(!(f===i&&g>s)){h=!0;continue}f===t?(d=n,g=d+(g-s)):(d=0,g=d+(g-s))}else if(f>i){if(0===a&&!h){l=o;break}f-=a}else{if(!(f===i&&d>=s))throw new Error("Not possible!");e&&0===f&&(d+=e,g+=e),f-=a,d-=s-n,g-=s-n}const p=4*l;r[p]=f,r[p+1]=d,r[p+2]=g,r[p+3]=_,l++}this._tokenCount=l}acceptInsertText(e,t,n,i,s,r){const o=0===n&&1===i&&(r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122),a=this._tokens,l=this._tokenCount;for(let r=0;r<l;r++){const l=4*r;let h=a[l],u=a[l+1],c=a[l+2];if(!(h<e||h===e&&c<t)){if(h===e&&c===t){if(!o)continue;c+=1}else if(h===e&&u<t&&t<c)0===n?c+=i:c=t;else{if(h===e&&u===t&&o)continue;if(h===e)if(h+=n,0===n)u+=i,c+=i;else{const e=c-u;u=s+(u-t),c=u+e}else h+=n}a[l]=h,a[l+1]=u,a[l+2]=c}}}}class d{constructor(e){this._tokens=e}getCount(){return this._tokens.length/4}getStartCharacter(e){return this._tokens[4*e+1]}getEndCharacter(e){return this._tokens[4*e+2]}getMetadata(e){return this._tokens[4*e+3]}}class g{constructor(e,t){this.startLineNumber=e,this.tokens=t,this.endLineNumber=this.startLineNumber+this.tokens.getMaxDeltaLine()}toString(){return this.tokens.toString(this.startLineNumber)}_updateEndLineNumber(){this.endLineNumber=this.startLineNumber+this.tokens.getMaxDeltaLine()}isEmpty(){return this.tokens.isEmpty()}getLineTokens(e){return this.startLineNumber<=e&&e<=this.endLineNumber?this.tokens.getLineTokens(e-this.startLineNumber):null}getRange(){const e=this.tokens.getRange();return e?new o.e(this.startLineNumber+e.startLineNumber,e.startColumn,this.startLineNumber+e.endLineNumber,e.endColumn):e}removeTokens(e){const t=e.startLineNumber-this.startLineNumber,n=e.endLineNumber-this.startLineNumber;this.startLineNumber+=this.tokens.removeTokens(t,e.startColumn-1,n,e.endColumn-1),this._updateEndLineNumber()}split(e){const t=e.startLineNumber-this.startLineNumber,n=e.endLineNumber-this.startLineNumber,[i,s,r]=this.tokens.split(t,e.startColumn-1,n,e.endColumn-1);return[new g(this.startLineNumber,i),new g(this.startLineNumber+r,s)]}applyEdit(e,t){const[n,i,s]=l(t);this.acceptEdit(e,n,i,s,t.length>0?t.charCodeAt(0):0)}acceptEdit(e,t,n,i,s){this._acceptDeleteRange(e),this._acceptInsertText(new r.L(e.startLineNumber,e.startColumn),t,n,i,s),this._updateEndLineNumber()}_acceptDeleteRange(e){if(e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn)return;const t=e.startLineNumber-this.startLineNumber,n=e.endLineNumber-this.startLineNumber;if(n<0){const e=n-t;return void(this.startLineNumber-=e)}const i=this.tokens.getMaxDeltaLine();if(!(t>=i+1)){if(t<0&&n>=i+1)return this.startLineNumber=0,void this.tokens.clear();if(t<0){const i=-t;this.startLineNumber-=i,this.tokens.acceptDeleteRange(e.startColumn-1,0,0,n,e.endColumn-1)}else this.tokens.acceptDeleteRange(0,t,e.startColumn-1,n,e.endColumn-1)}}_acceptInsertText(e,t,n,i,s){if(0===t&&0===n)return;const r=e.lineNumber-this.startLineNumber;if(r<0)return void(this.startLineNumber+=t);r>=this.tokens.getMaxDeltaLine()+1||this.tokens.acceptInsertText(r,e.column-1,t,n,i,s)}}class _{constructor(e,t){this.startLineNumber=e,this.tokens=t}}function p(e){return e instanceof Uint32Array?e:new Uint32Array(e)}class m{constructor(e){this._pieces=[],this._isComplete=!1,this._languageIdCodec=e}flush(){this._pieces=[],this._isComplete=!1}isEmpty(){return 0===this._pieces.length}set(e,t){this._pieces=e||[],this._isComplete=t}setPartial(e,t){let n=e;if(t.length>0){const i=t[0].getRange(),s=t[t.length-1].getRange();if(!i||!s)return e;n=e.plusRange(i).plusRange(s)}let s=null;for(let e=0,t=this._pieces.length;e<t;e++){const i=this._pieces[e];if(i.endLineNumber<n.startLineNumber)continue;if(i.startLineNumber>n.endLineNumber){s=s||{index:e};break}if(i.removeTokens(n),i.isEmpty()){this._pieces.splice(e,1),e--,t--;continue}if(i.endLineNumber<n.startLineNumber)continue;if(i.startLineNumber>n.endLineNumber){s=s||{index:e};continue}const[r,o]=i.split(n);r.isEmpty()?s=s||{index:e}:o.isEmpty()||(this._pieces.splice(e,1,r,o),e++,t++,s=s||{index:e})}return s=s||{index:this._pieces.length},t.length>0&&(this._pieces=i.Zv(this._pieces,s.index,t)),n}isComplete(){return this._isComplete}addSemanticTokens(e,t){const n=this._pieces;if(0===n.length)return t;const i=n[m._findFirstPieceWithLine(n,e)].getLineTokens(e);if(!i)return t;const r=t.getCount(),o=i.getCount();let a=0,l=[],h=0,u=0;const c=(e,t)=>{e!==u&&(u=e,l[h++]=e,l[h++]=t)};for(let e=0;e<o;e++){const n=i.getStartCharacter(e),s=i.getEndCharacter(e),o=i.getMetadata(e),l=((1&o?2048:0)|(2&o?4096:0)|(4&o?8192:0)|(8&o?8372224:0)|(16&o?4286578688:0))>>>0,h=~l>>>0;for(;a<r&&t.getEndOffset(a)<=n;)c(t.getEndOffset(a),t.getMetadata(a)),a++;for(a<r&&t.getStartOffset(a)<n&&c(n,t.getMetadata(a));a<r&&t.getEndOffset(a)<s;)c(t.getEndOffset(a),t.getMetadata(a)&h|o&l),a++;if(a<r)c(s,t.getMetadata(a)&h|o&l),t.getEndOffset(a)===s&&a++;else{const e=Math.min(Math.max(0,a-1),r-1);c(s,t.getMetadata(e)&h|o&l)}}for(;a<r;)c(t.getEndOffset(a),t.getMetadata(a)),a++;return new s.A(new Uint32Array(l),t.getLineContent(),this._languageIdCodec)}static _findFirstPieceWithLine(e,t){let n=0,i=e.length-1;for(;n<i;){let s=n+Math.floor((i-n)/2);if(e[s].endLineNumber<t)n=s+1;else{if(!(e[s].startLineNumber>t)){for(;s>n&&e[s-1].startLineNumber<=t&&t<=e[s-1].endLineNumber;)s--;return s}i=s-1}}return n}acceptEdit(e,t,n,i,s){for(const r of this._pieces)r.acceptEdit(e,t,n,i,s)}}class L{constructor(e){this._lineTokens=[],this._len=0,this._languageIdCodec=e}flush(){this._lineTokens=[],this._len=0}getTokens(e,t,n){let i=null;if(t<this._len&&(i=this._lineTokens[t]),null!==i&&i!==u)return new s.A(p(i),n,this._languageIdCodec);const r=new Uint32Array(2);return r[0]=n.length,r[1]=h(this._languageIdCodec.encodeLanguageId(e)),new s.A(r,n,this._languageIdCodec)}static _massageTokens(e,t,n){const i=n?p(n):null;if(0===t){let t=!1;if(i&&i.length>1&&(t=a.NX.getLanguageId(i[1])!==e),!t)return u}if(!i||0===i.length){const n=new Uint32Array(2);return n[0]=t,n[1]=h(e),n.buffer}return i[i.length-2]=t,0===i.byteOffset&&i.byteLength===i.buffer.byteLength?i.buffer:i}_ensureLine(e){for(;e>=this._len;)this._lineTokens[this._len]=null,this._len++}_deleteLines(e,t){0!==t&&(e+t>this._len&&(t=this._len-e),this._lineTokens.splice(e,t),this._len-=t)}_insertLines(e,t){if(0===t)return;let n=[];for(let e=0;e<t;e++)n[e]=null;this._lineTokens=i.Zv(this._lineTokens,e,n),this._len+=t}setTokens(e,t,n,i,s){const r=L._massageTokens(this._languageIdCodec.encodeLanguageId(e),n,i);this._ensureLine(t);const o=this._lineTokens[t];return this._lineTokens[t]=r,!!s&&!L._equals(o,r)}static _equals(e,t){if(!e||!t)return!e&&!t;const n=p(e),i=p(t);if(n.length!==i.length)return!1;for(let e=0,t=n.length;e<t;e++)if(n[e]!==i[e])return!1;return!0}acceptEdit(e,t,n){this._acceptDeleteRange(e),this._acceptInsertText(new r.L(e.startLineNumber,e.startColumn),t,n)}_acceptDeleteRange(e){const t=e.startLineNumber-1;if(t>=this._len)return;if(e.startLineNumber===e.endLineNumber){if(e.startColumn===e.endColumn)return;return void(this._lineTokens[t]=L._delete(this._lineTokens[t],e.startColumn-1,e.endColumn-1))}this._lineTokens[t]=L._deleteEnding(this._lineTokens[t],e.startColumn-1);const n=e.endLineNumber-1;let i=null;n<this._len&&(i=L._deleteBeginning(this._lineTokens[n],e.endColumn-1)),this._lineTokens[t]=L._append(this._lineTokens[t],i),this._deleteLines(e.startLineNumber,e.endLineNumber-e.startLineNumber)}_acceptInsertText(e,t,n){if(0===t&&0===n)return;const i=e.lineNumber-1;i>=this._len||(0!==t?(this._lineTokens[i]=L._deleteEnding(this._lineTokens[i],e.column-1),this._lineTokens[i]=L._insert(this._lineTokens[i],e.column-1,n),this._insertLines(e.lineNumber,t)):this._lineTokens[i]=L._insert(this._lineTokens[i],e.column-1,n))}static _deleteBeginning(e,t){return null===e||e===u?e:L._delete(e,0,t)}static _deleteEnding(e,t){if(null===e||e===u)return e;const n=p(e),i=n[n.length-2];return L._delete(e,t,i)}static _delete(e,t,n){if(null===e||e===u||t===n)return e;const i=p(e),r=i.length>>>1;if(0===t&&i[i.length-2]===n)return u;const o=s.A.findIndexInTokensArray(i,t),a=o>0?i[o-1<<1]:0;if(n<i[o<<1]){const s=n-t;for(let e=o;e<r;e++)i[e<<1]-=s;return e}let l,h;a!==t?(i[o<<1]=t,l=o+1<<1,h=t):(l=o<<1,h=a);const c=n-t;for(let e=o+1;e<r;e++){const t=i[e<<1]-c;t>h&&(i[l++]=t,i[l++]=i[1+(e<<1)],h=t)}if(l===i.length)return e;let f=new Uint32Array(l);return f.set(i.subarray(0,l),0),f.buffer}static _append(e,t){if(t===u)return e;if(e===u)return t;if(null===e)return e;if(null===t)return null;const n=p(e),i=p(t),s=i.length>>>1;let r=new Uint32Array(n.length+i.length);r.set(n,0);let o=n.length;const a=n[n.length-2];for(let e=0;e<s;e++)r[o++]=i[e<<1]+a,r[o++]=i[1+(e<<1)];return r.buffer}static _insert(e,t,n){if(null===e||e===u)return e;const i=p(e),r=i.length>>>1;let o=s.A.findIndexInTokensArray(i,t);if(o>0){i[o-1<<1]===t&&o--}for(let e=o;e<r;e++)i[e<<1]+=n;return e}}},97461:(e,t,n)=>{n.d(t,{Af:()=>s,eq:()=>r,t2:()=>a,vu:()=>i});const i="`~!@#$%^&*()-=+[{]}\\|;:'\",.<>/?";const s=function(e=""){let t="(-?\\d*\\.\\d\\w*)|([^";for(const n of i)e.indexOf(n)>=0||(t+="\\"+n);return t+="\\s]+)",new RegExp(t,"g")}();function r(e){let t=s;if(e&&e instanceof RegExp)if(e.global)t=e;else{let n="g";e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.unicode&&(n+="u"),t=new RegExp(e.source,n)}return t.lastIndex=0,t}const o={maxLen:1e3,windowSize:15,timeBudget:150};function a(e,t,n,i,s=o){if(n.length>s.maxLen){let r=e-s.maxLen/2;return r<0?r=0:i+=r,a(e,t,n=n.substring(r,e+s.maxLen/2),i,s)}const r=Date.now(),h=e-1-i;let u=-1,c=null;for(let e=1;!(Date.now()-r>=s.timeBudget);e++){const i=h-s.windowSize*e;t.lastIndex=Math.max(0,i);const r=l(t,n,h,u);if(!r&&c)break;if(c=r,i<=0)break;u=i}if(c){let e={word:c[0],startColumn:i+1+c.index,endColumn:i+1+c.index+c[0].length};return t.lastIndex=0,e}return null}function l(e,t,n,i){let s;for(;s=e.exec(t);){const t=s.index||0;if(t<=n&&e.lastIndex>=n)return s;if(i>0&&t>i)return null}return null}}}]);