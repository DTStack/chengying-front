"use strict";(self.webpackChunkdt_em_front=self.webpackChunkdt_em_front||[]).push([[7732],{12903:(e,t,n)=>{n.r(t),n.d(t,{getClusterList:()=>G,getClusterProductList:()=>T,getInstanceList:()=>B,getParentProductList:()=>K,getProductList:()=>A,getServiceGroupList:()=>U,setCurrentParentCluster:()=>F,setCurrentParentProduct:()=>D,setCurrentProduct:()=>O});var r=n(94198),a=n.n(r),o=n(78914),i=n.n(o),l=n(86902),s=n.n(l),u=n(94473),c=n.n(u),d=n(33032),p=n.n(d),m=n(51942),f=n.n(m),v=n(3649),h=n.n(v),_=n(66419),y=n.n(_),g=n(65420),Z=n.n(g),E=n(19996),S=n.n(E),b=n(41511),C=n.n(b),w=n(45360),P=n(19528),k=n(56466),N=n(78241),R=n(36808),L=n(18274),I=n(64143);function M(e,t){var n=void 0!==Z()&&S()(e)||e["@@iterator"];if(!n){if(C()(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return x(e,t);var r=h()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return y()(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return x(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw o}}}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var K=function(e){return function(t){P.t6.getParentProductList({limit:0}).then((function(n){if(0===(n=n.data).code){var r={name:n.data[0],list:n.dsta},o=-1;if(e){for(var i in n.data)n.data[i]===e&&(o=a()(i,10));r.name=o>-1?n.data[o]:n.data[0]}R.set("em_current_parent_product",r.name),t({type:k.kP.GET_PARENT_PROD_LIST,payload:r})}}))}},T=function(){return function(e){P.t6.getClusterProductList({limit:0}).then((function(t){if(0===(t=t.data).code){var n,r,a,o,l,u,d,m=R.get("em_current_parent_product")||"DTinsight",v=R.get("em_current_cluster_id"),h={};if(v){var _,y,g=c()(_=t.data).call(_,(function(e){return+e.clusterId==+v}));if(h=g||t.data[0],!g&&"kubernetes"===(null===(y=h)||void 0===y?void 0:y.clusterType)){var Z=w.Z.loading("正在跳转默认集群...",0);p()(Z,2500),I.Z.setNaviKey("menu_ops_center","sub_menu_service"),window.location.href="/opscenter/service"}}else h=t.data[0];var E,S,b,C=function(e,t,n){if(0===n)return R.set(L.E9.NAMESPACE,""),e||t[0];var r,a=!1;if(i()(r=s()(t)).call(r,(function(n){var r;i()(r=t[n]||[]).call(r,(function(t){a||t!==e||R.get(L.E9.NAMESPACE)||(a=!0,R.set(L.E9.NAMESPACE,n))}))})),a||R.get(L.E9.NAMESPACE))return e;var o=s()(t)[0];return R.set(L.E9.NAMESPACE,o),t[s()(t)[0]][0]}(m,(null===(n=h)||void 0===n?void 0:n.subdomain)||{},null===(r=h)||void 0===r?void 0:r.mode);if(null!==(a=h)&&void 0!==a&&a.clusterId)if(R.set("em_current_cluster_id",(null===(E=h)||void 0===E?void 0:E.clusterId)||-1),R.set("em_current_cluster_type",null===(S=h)||void 0===S?void 0:S.clusterType),R.set("em_current_parent_product",C),"kubernetes"===(null===(b=h)||void 0===b?void 0:b.clusterType)){var P,N=s()(null===(P=h)||void 0===P?void 0:P.subdomain);R.set("em_current_k8s_namespace",N[0])}e({type:k.kP.GET_PARENT_PROD_LIST,payload:f()({},{name:C||"选择产品",list:t.data,cluster:{id:(null===(o=h)||void 0===o?void 0:o.clusterId)||-1,name:(null===(l=h)||void 0===l?void 0:l.clusterName)||"选择集群",type:(null===(u=h)||void 0===u?void 0:u.clusterType)||"hosts",mode:(null===(d=h)||void 0===d?void 0:d.mode)||0}})})}}))}},A=function(){return function(e){N.get("/api/v2/product",{limit:0}).then((function(t){var n=[];if(0===(t=t.data).code){var r,a=M(t.data.list);try{for(a.s();!(r=a.n()).done;){var o=r.value;1===o.is_current_version&&n.push(o)}}catch(e){a.e(e)}finally{a.f()}e({type:k.kP.SET_PRODUCT_LIST,payload:n})}else w.Z.error(t.msg)}))}},O=function(e){return{type:k.kP.SET_CUR_PRODUCT,payload:e}},D=function(e){return{type:k.kP.SET_CUR_PARENT_PROD,payload:e}},U=function(){return function(e){N.get("/api/container/getCluster",{}).then((function(t){for(var n=(t=t.data).result.data||[],r=0,a=n.length;r<a;r++){for(var o=n[r].services,i=[],l=0,s=o.length;l<s;l++){var u=o[l],c=u.name.toLowerCase();"rabbitmq"!==c&&"mysql"!==c&&i.push(u)}n[r].services=i}e({type:k.kP.GET_S_G_LIST,payload:n})}))}},B=function(){return function(e){N.get("/api/container/queryContainer",{pageSize:200}).then((function(t){t=t.data,e({type:k.kP.GET_INSTANCE_LIST,payload:t.result.data})}))}},G=function(e){return function(e){P.t6.getClusterList({type:void 0,"sort-by":"id","sort-dir":"desc",limit:0,start:0}).then((function(t){if(0===(t=t.data).code){var n;e({type:k.kP.GET_PARENT_CLUSTER_LIST,payload:t.data.clusters});var r=t.data.clusters[0],a=R.get("em_current_cluster_id"),o=a&&c()(n=t.data.clusters).call(n,(function(e){return e.id===+a}))||r;e({type:k.kP.SET_CUR_PARENT_CLUSTER,payload:o}),R.set("em_current_cluster_id",o.id),R.set("em_current_cluster_type",o.type)}else w.Z.error(t.msg)}))}},F=function(e){return{type:k.kP.SET_CUR_PARENT_CLUSTER,payload:e}}},18274:(e,t,n)=>{n.d(t,{E9:()=>l,MD:()=>r,OY:()=>o,RI:()=>i,XN:()=>a});var r=[{text:"部署成功",value:"deployed"},{text:"部署失败",value:"deploy fail"},{text:"部署中",value:"deploying"},{text:"卸载失败",value:"undeploy fail"},{text:"卸载中",value:"undeploying"}],a=[{text:"更新成功",value:"success"},{text:"更新失败",value:"fail"},{text:"更新中",value:"update"}],o={hosts:["主机集群"],kubernetes:["Kubernetes集群（自建集群）","Kubernetes集群（导入已有集群）"]},i={hosts:{title:"主机安装会经过2个状态：管控安装-主机初始化，若某一步安装失败，请查看具体日志。",filters:[{text:"管控安装成功",value:"管控安装成功"},{text:"管控安装失败",value:"管控安装失败"},{text:"script安装成功",value:"script安装成功"},{text:"script安装失败",value:"script安装失败"},{text:"主机初始化成功",value:"主机初始化成功"},{text:"主机初始化失败",value:"主机初始化失败"}],finalStatus:3},kubernetes:{title:"Kubernetes集群主机安装会经过5个状态：管控安装-主机初始化-K8S Docker初始化-K8S Node初始化-K8S Node部署成功，若某一步安装失败，请查看具体日志",filters:[{text:"管控安装失败",value:"管控安装失败",status:-1},{text:"管控安装成功",value:"管控安装成功",status:1},{text:"主机初始化失败",value:"主机初始化失败",status:-3},{text:"主机初始化成功",value:"主机初始化成功",status:3},{text:"K8S DOCKER初始化失败",value:"K8S DOCKER初始化失败",status:-5},{text:"K8S DOCKER初始化成功",value:"K8S DOCKER初始化成功",status:5},{text:"K8S NODE初始化失败",value:"K8S NODE初始化失败",status:-6},{text:"K8S NODE初始化成功",value:"K8S NODE初始化成功",status:6},{text:"K8S NODE部署失败",value:"K8S NODE部署失败",status:-7},{text:"K8S NODE部署成功",value:"K8S NODE部署成功",status:7}],finalStatus:7}},l={NAMESPACE:"em_current_k8s_namespace"}},17732:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ve});var r={};n.r(r),n.d(r,{getAuthorityRouter:()=>j,saveUserName:()=>$,setRoleAuthorityList:()=>q});var a,o=n(1068),i=n.n(o),l=n(73126),s=n(68420),u=n(27344),c=n(5281),d=n(84441),p=n(3020),m=n(3362),f=n(44845),v=n(51942),h=n.n(v),_=n(77766),y=n.n(_),g=n(41511),Z=n.n(g),E=n(78580),S=n.n(E),b=n(94473),C=n.n(b),w=n(20116),P=n.n(w),k=n(81643),N=n.n(k),R=n(2991),L=n.n(R),I=n(67294),M=n(24300),x=n(29027),K=n(15857),T=n(97183),A=n(45360),O=n(67908),D=n(30258),U=n(71649),B=n(78914),G=n.n(B),F=n(19528),V=n(56466),H=n(57201),$=function(e){return function(t){t({type:V._j.SAVE_USER_INFO,payload:e})}},j=function e(t,n,r){return G()(n).call(n,(function(n){r[n.code]&&t.push.apply(t,(0,U.Z)(n.routers)),n.children.length&&e(t,n.children,r)})),t},q=function(){return function(e){F.bS.getRoleCodes().then((function(t){if(0===(t=t.data).code){var n,r={},a=[];Z()(t.data)&&G()(n=t.data).call(n,(function(e){r[e]=!0})),j(a,H.B,r),e({type:V._j.SET_ROLE_AUTHORITY_LIST,payload:{authorityList:r,authorityRouter:a}})}else A.Z.error(t.msg)}))}},z=n(32882),W=n(12903),Y=n(36808),J=n(42152),Q=n(64143),X=n(78241),ee=n(86902),te=n.n(ee),ne=n(14310),re=n.n(ne),ae=n(34074),oe=n.n(ae),ie=n(39649),le=n.n(ie),se=n(20368),ue=n.n(se),ce=n(63978),de=n.n(ce),pe=n(96486),me=n(99210);function fe(e,t){var n=te()(e);if(re()){var r=re()(e);t&&(r=P()(r).call(r,(function(t){return oe()(e,t).enumerable}))),n.push.apply(n,r)}return n}function ve(e){var t=function(){if("undefined"==typeof Reflect||!i())return!1;if(i().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,m.Z)(e);if(t){var a=(0,m.Z)(this).constructor;n=i()(r,arguments,a)}else n=r.apply(this,arguments);return(0,p.Z)(this,n)}}var he=me.Z.SubMenu,_e=(0,x.$j)((function(e){return{authorityList:e.UserCenterStore.authorityList}}),void 0)(a=function(e){(0,d.Z)(n,e);var t=ve(n);function n(e){var r;return(0,s.Z)(this,n),r=t.call(this,e),(0,f.Z)((0,c.Z)(r),"getMenuList",(function(e){return L()(e).call(e,(function(e){var t=e.icon,n=e.title,a=e.children,o=void 0===a?[]:a,i=e.code,s=e.level;if(!r.props.authorityList[i])return null;var u=I.createElement(I.Fragment,null,"second"===s&&I.createElement("i",{className:"emicon ".concat(t),style:{verticalAlign:"bottom",marginRight:8}}),n);return o.length?I.createElement(he,{key:i,title:u},r.getMenuList(o)):I.createElement(me.Z.Item,(0,l.Z)({key:i},e),u)}))})),(0,f.Z)((0,c.Z)(r),"handleMenuSelected",(function(e){var t,n=r.props.history,a=e.key,o=e.item;null!==(t=o.props)&&void 0!==t&&t.url&&r.setState({selectKeys:a},(function(){var e,t=sessionStorage.getItem("firstLevelNav");Q.Z.setNaviKey(t,a),n.push(null===(e=o.props)||void 0===e?void 0:e.url)}))})),r.state={openKeys:e.defaultOpenKey,selectKeys:[sessionStorage.getItem("siderLevelNav")]},r}return(0,u.Z)(n,[{key:"componentDidUpdate",value:function(e,t){var n=[sessionStorage.getItem("siderLevelNav")];null!=n&&n.length&&!(0,pe.isEqual)(t.selectKeys,n)&&this.setState({selectKeys:n})}},{key:"render",value:function(){var e=this,t=this.props,n=t.menuList,r=t.style,a=this.state,o=a.selectKeys,i=a.openKeys,l=function(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?G()(n=fe(Object(a),!0)).call(n,(function(t){(0,f.Z)(e,t,a[t])})):le()?ue()(e,le()(a)):G()(r=fe(Object(a))).call(r,(function(t){de()(e,t,oe()(a,t))}))}return e}({minHeight:"calc(100vh - 40px)",height:"100%"},r);return I.createElement("div",{className:"dt-sidemenu-dark",style:l},I.createElement(me.Z,{mode:"inline",theme:"dark",openKeys:i,onOpenChange:function(t){return e.setState({openKeys:t})},selectedKeys:o,onClick:this.handleMenuSelected,style:{width:200}},this.getMenuList(n)))}}]),n}(I.Component))||a,ye=n(44930),ge=n(63109),Ze=n.n(ge),Ee=n(80403),Se=n(60558),be=n(32969),Ce=n(31097);function we(e){var t=function(){if("undefined"==typeof Reflect||!i())return!1;if(i().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,m.Z)(e);if(t){var a=(0,m.Z)(this).constructor;n=i()(r,arguments,a)}else n=r.apply(this,arguments);return(0,p.Z)(this,n)}}var Pe=function(e){(0,d.Z)(n,e);var t=we(n);function n(){var e,r;(0,s.Z)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return r=t.call.apply(t,y()(e=[this]).call(e,o)),(0,f.Z)((0,c.Z)(r),"state",{tooltipVisible:!1,popupVisible:!1}),(0,f.Z)((0,c.Z)(r),"setOptions",(function(e){var t=[];return Z()(e)&&G()(e).call(e,(function(e){var n=e.subdomain,r=void 0===n?{}:n,a=e.mode,o=e.clusterName,i={value:o,label:o};if(0===a){var l=r.products,s=void 0===l?[]:l;i.children=L()(s).call(s,(function(e){return{value:e,label:e}}))}else{var u;i.children=[],G()(u=te()(r)).call(u,(function(e){var t;i.children.push({value:e,label:e,children:L()(t=r[e]).call(t,(function(e){return{value:e,label:e}}))})}))}t.push(i)})),t})),(0,f.Z)((0,c.Z)(r),"handleSwitchProduct",(function(e){var t=r.props.HeaderStore.parentProducts,n=C()(t).call(t,(function(t){return t.clusterName===e[0]}));0===(null==n?void 0:n.mode)?(r.props.actions.setCurrentParentProduct(e[1]),Y.set("em_current_parent_product",e[1]),Y.set("em_current_k8s_namespace","")):(r.props.actions.setCurrentParentProduct(e[2]),Y.set("em_current_parent_product",e[2]),Y.set("em_current_k8s_namespace",e[1])),Y.set("em_current_cluster_id",n.clusterId),Y.set("em_current_cluster_type",n.clusterType),Q.Z.setNaviKey("menu_ops_center","hosts"===(null==n?void 0:n.type)?"sub_menu_overview":"sub_menu_service"),window.location.href="hosts"===(null==n?void 0:n.type)?"/opscenter/overview":"/opscenter/service"})),r}return(0,u.Z)(n,[{key:"componentDidMount",value:function(){this.props.actions.getClusterProductList()}},{key:"componentWillUnmount",value:function(){this.props.actions.setCurrentParentProduct("")}},{key:"render",value:function(){var e,t,n=this,r=this.props.HeaderStore,a=this.state.popupVisible,o=r.parentProducts,i=void 0===o?[]:o,l=r.cur_parent_product,s=r.cur_parent_cluster,u=this.setOptions(i),c=Y.get("em_current_k8s_namespace"),d=y()(e=y()(t="".concat(s.name,"/")).call(t,c&&"undefined"!==c?"".concat(c,"/"):"")).call(e,l);return I.createElement(be.Z,{popupClassName:"header-cascader-pop",options:u,onChange:this.handleSwitchProduct,onPopupVisibleChange:function(e){return n.setState({popupVisible:e})}},I.createElement(Ce.Z,{title:d,placement:"bottom",visible:this.state.tooltipVisible,align:{offset:[0,-7]},onVisibleChange:function(e){return n.setState({tooltipVisible:!a&&e})}},I.createElement("span",{className:"c-text-ellipsis header-cascader-title",onClick:function(){return n.setState({tooltipVisible:!1})}},d),I.createElement(O.Z,{type:"down"})))}}]),n}(I.Component),ke=n(46103),Ne=n(77268),Re=n(4147);const Le=function(e){var t=e.visible,n=e.onClose;I.useEffect((function(){}),[]);return I.createElement(D.Z,{className:"installGuideModal",title:"部署向导",onCancel:n,visible:t,width:520,footer:I.createElement(Ne.Z,{type:"primary",onClick:function(){Q.Z.setNaviKey("menu_deploy_center","sub_menu_product_deploy"),e.history.push("/deploycenter/appmanage/installs"),n()}},"开始部署")},I.createElement("div",null,I.createElement("p",null,"欢迎适应EasyManager产品部署管家！ ",I.createElement("span",null,"(",Re.version,")")),I.createElement("div",null,"若需要对已部署组件进行 “升级” 或 “回滚” 等管理操作，请前往"," ",I.createElement("span",{onClick:function(){Q.Z.setNaviKey("menu_deploy_center","sub_menu_cluster_manage"),e.history.push("/deploycenter/cluster/list"),n()}},"部署中心"),"选择集群 → 已部署组件。")))};function Ie(e){var t=function(){if("undefined"==typeof Reflect||!i())return!1;if(i().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,m.Z)(e);if(t){var a=(0,m.Z)(this).constructor;n=i()(r,arguments,a)}else n=r.apply(this,arguments);return(0,p.Z)(this,n)}}var Me=n(51447),xe=me.Z.Item,Ke=T.Z.Header;const Te=function(e){(0,d.Z)(n,e);var t=Ie(n);function n(){var e,r;(0,s.Z)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return r=t.call.apply(t,y()(e=[this]).call(e,o)),(0,f.Z)((0,c.Z)(r),"state",{selfInfo:{},isCheckedResetPwd:!1,showModal:!1,showInstallGuide:!1}),(0,f.Z)((0,c.Z)(r),"getUserInfo",(function(){F.bS.getLoginedUserInfo().then((function(e){if(0===(e=e.data).code){var t=e.data,n=t.info,a=t.reset_password,o=0===n.reset_password_status&&a;r.setState({selfInfo:e.data.info,isCheckedResetPwd:o,showModal:o}),localStorage.setItem("em_role_id",null==n?void 0:n.role_id)}else A.Z.error(e.msg)}))})),(0,f.Z)((0,c.Z)(r),"initMenuList",(function(e){var t=r.props.authorityList;return L()(e).call(e,(function(e){var n=e.title,r=e.code,a="menu_user_manage"===r;return!t[r]||a||"first"!==e.level||"menu_deploy_guide"===r||"menu_system_configuration"===r?null:I.createElement(xe,{key:r},n)}))})),(0,f.Z)((0,c.Z)(r),"handleMenuSelected",(function(e){var t,n,a="kubernetes"===(null===(t=r.props.HeaderStore.cur_parent_cluster)||void 0===t?void 0:t.type),o=C()(H.B).call(H.B,(function(t){return t.code===e.key}))||{};if(null!=o&&o.code&&null!=o&&null!==(n=o.children)&&void 0!==n&&n.length){var i,l,s,u=o.children,c=o.code,d=u;a&&"menu_ops_center"===(null==o?void 0:o.code)&&(d=P()(d).call(d,(function(e){return a&&"sub_menu_service"===e.code})));var p=null!==(i=d[0])&&void 0!==i&&null!==(l=i.children)&&void 0!==l&&l.length?null===(s=d[0])||void 0===s?void 0:s.children[0]:d[0];Q.Z.setNaviKey(c,p.code),r.props.history.push(p.url)}else r.setState({showInstallGuide:!0})})),(0,f.Z)((0,c.Z)(r),"handleLogout",(function(){F.bS.logout().then((function(e){if(0===(e=e.data).code){try{Y.remove("em_token"),Y.remove("em_current_cluster_id")}catch(e){window.location.href="login"}window.location.href="login"}else A.Z.error(e.msg),window.location.href="login"}))})),(0,f.Z)((0,c.Z)(r),"getUserHelp",(function(e){var t=e.key;if("/logout"===t)r.handleLogout();else{var n="/usercenter/members"===t?"sub_menu_user_manage":"menu_security_audit";Q.Z.setNaviKey("",n),r.props.history.push(t)}})),(0,f.Z)((0,c.Z)(r),"initUserMenuList",(function(){var e=r.props.authorityList;return I.createElement(me.Z,{onClick:r.getUserHelp},"true"===Y.get("em_admin")&&e.sub_menu_user_manage&&I.createElement(xe,{key:"/usercenter/members"},"用户管理"),e.menu_security_audit&&I.createElement(xe,{key:"/usercenter/audit"},"安全审计"),I.createElement(xe,{key:"/logout"},"退出"))})),(0,f.Z)((0,c.Z)(r),"handleResetSubmit",function(){var e=(0,ye.Z)(Ze().mark((function e(t){var n,a,o,i,l;return Ze().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.bS.getPublicKey();case 2:if(0===(n=e.sent).data.code){e.next=5;break}return e.abrupt("return");case 5:a=n.data.data,o=a.encrypt_type,i=a.encrypt_public_key,l={old_password:"sm2"===o?(0,Se.ON)(t.oldPass,i):(0,Se.g8)(t.oldPass,i),new_password:"sm2"===o?(0,Se.ON)(t.newPass,i):(0,Se.g8)(t.newPass,i)},F.bS.resetPasswordSelf(l).then((function(e){0===(e=e.data).code?(A.Z.success("修改成功"),r.setState({showModal:!1,isCheckedResetPwd:!1})):A.Z.error(e.msg)}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,f.Z)((0,c.Z)(r),"resetPwdModalShow",(function(){r.setState({showModal:!r.state.showModal},(function(){r.state.showModal||r.handleLogout()}))})),(0,f.Z)((0,c.Z)(r),"closeInstallGuideShow",(function(){r.setState({showInstallGuide:!1})})),r}return(0,u.Z)(n,[{key:"componentDidMount",value:function(){this.getUserInfo(),"/"===this.props.location.pathname&&this.handleMenuSelected({key:"menu_deploy_center"})}},{key:"render",value:function(){var e=this,t=this.props,n=t.authorityList,r=t.history,a=this.state,o=a.selfInfo,i=a.showModal,l=a.isCheckedResetPwd,s=a.showInstallGuide,u=sessionStorage.getItem("firstLevelNav");return I.createElement(Ke,{className:"root-nav"},I.createElement("div",{className:"logo dt-header-log-wrapper"},I.createElement("img",{src:Me})),I.createElement("div",{className:"nav-container"},I.createElement("div",{className:"header-ops-namespace"},"menu_ops_center"===u&&I.createElement(Pe,this.props)),I.createElement(me.Z,{selectedKeys:[u],mode:"horizontal",theme:"dark",onClick:this.handleMenuSelected},this.initMenuList(H.B))),I.createElement("div",{className:"nav-setting"},n.menu_deploy_guide&&I.createElement("a",{className:"em-guide",onClick:function(){return e.handleMenuSelected({key:"menu_deploy_guide"})}},I.createElement("i",{className:"emicon emicon-yunhangbushuxiangdao",style:{verticalAlign:"bottom",marginRight:8}}),"运行部署向导"),"   ",n.menu_system_configuration&&I.createElement("a",{className:"em-guide",onClick:function(){return e.handleMenuSelected({key:"menu_system_configuration"})}},I.createElement(O.Z,{type:"setting",style:{marginRight:8}}),"系统配置"),window.APPCONFIG.userCenter&&I.createElement(Ee.Z,{overlayClassName:"dt-em-dropdown-black root-drop",overlay:this.initUserMenuList(),className:"dropdown"},I.createElement("a",{onClick:function(e){return e.preventDefault()}},(null==o?void 0:o.username)||Y.get("em_username"),I.createElement(O.Z,{style:{marginLeft:1},type:"down"})))),I.createElement(ke.Z,{visible:i,isCheckedResetPwd:l,onCancel:this.resetPwdModalShow,onSubmit:this.handleResetSubmit}),I.createElement(Le,{onClose:this.closeInstallGuideShow,history:r,visible:s}))}}]),n}(I.Component);var Ae,Oe=n(94184),De=n.n(Oe);function Ue(e){var t=function(){if("undefined"==typeof Reflect||!i())return!1;if(i().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,m.Z)(e);if(t){var a=(0,m.Z)(this).constructor;n=i()(r,arguments,a)}else n=r.apply(this,arguments);return(0,p.Z)(this,n)}}var Be=T.Z.Content,Ge=T.Z.Sider,Fe=(0,x.$j)((function(e){return{authorityList:e.UserCenterStore.authorityList,authorityRouter:e.UserCenterStore.authorityRouter,ServiceStore:e.ServiceStore,HeaderStore:e.HeaderStore}}),(function(e){return{actions:(0,K.DE)(h()({},r,z,W),e)}}))(Ae=function(e){(0,d.Z)(n,e);var t=Ue(n);function n(){var e,r;(0,s.Z)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return r=t.call.apply(t,y()(e=[this]).call(e,o)),(0,f.Z)((0,c.Z)(r),"state",{lookMoreVisible:!1,tooltipVisible:!1,popupVisible:!1}),(0,f.Z)((0,c.Z)(r),"getRestartService",(function(){X.get("/api/v2/cluster/restartServices",{}).then((function(e){var t,n;0===(e=e.data).code?r.props.actions.setResartServiceList({count:null===(t=e.data)||void 0===t?void 0:t.count,list:null===(n=e.data)||void 0===n?void 0:n.list}):A.Z.error(e.msg)}))})),(0,f.Z)((0,c.Z)(r),"redirectRoute",(function(){var e=r.props.authorityRouter;Z()(e)&&e.length&&!S()(e).call(e,location.pathname)&&r.props.history.push("/nopermission")})),(0,f.Z)((0,c.Z)(r),"getRoleCodes",(function(){r.props.actions.setRoleAuthorityList()})),(0,f.Z)((0,c.Z)(r),"getMenuList",(function(){var e="kubernetes"===Y.get("em_current_cluster_type"),t=r.props.location.pathname.split("/"),n=C()(H.B).call(H.B,(function(e){return e.url==="/".concat(t[1])})),a=(null==n?void 0:n.children)||[];return e&&"menu_ops_center"===(null==n?void 0:n.code)&&(a=P()(a).call(a,(function(t){return e&&"sub_menu_service"===t.code}))),a})),r}return(0,u.Z)(n,[{key:"componentDidMount",value:function(){!Y.get("em_token")&&window.APPCONFIG.userCenter&&(this.props.location.pathname="/login"),this.redirectRoute(),this.getRoleCodes();var e=new J("#J_CopyBtn");e.on("success",(function(e){A.Z.success("复制成功！")})),e.on("error",(function(e){A.Z.error("复制失败！")})),this.getRestartService()}},{key:"componentDidUpdate",value:function(e){var t,n,r=this.props.location;this.props.location.pathname!=e.location.pathname&&this.redirectRoute(),(null==r?void 0:N()(t=r.pathname).call(t,"opscenter"))>-1&&"menu_ops_center"!=sessionStorage.getItem("firstLevelNav")&&Q.Z.setNaviKey("menu_ops_center",sessionStorage.getItem("siderLevelNav")),(null==r?void 0:N()(n=r.pathname).call(n,"deploycenter"))>-1&&"menu_deploy_center"!=sessionStorage.getItem("firstLevelNav")&&Q.Z.setNaviKey("menu_deploy_center",sessionStorage.getItem("siderLevelNav"))}},{key:"componentWillUnmount",value:function(){clearTimeout(void 0)}},{key:"render",value:function(){var e,t,n=this,r=this.props,a=r.ServiceStore,o=r.authorityList,i=r.location,s=r.history,u=r.HeaderStore,c=r.actions,d=this.props.location.pathname,p=a.restartService,m=p.list&&L()(e=p.list).call(e,(function(e,t){return I.createElement("span",{className:"attention-title",key:t},e.depend_product_name,"——",e.depend_service_name,"配置变更后,相关依赖服务",I.createElement("span",{className:"red-attention"},e.product_name,"——",e.service_name),"需要重新“滚动重启”。")}));return I.createElement(T.Z,{className:"root-layout"},I.createElement(Te,{authorityList:o,location:i,HeaderStore:u,history:s,actions:c}),I.createElement(T.Z,{style:{marginTop:48,position:"fixed",width:"100%"}},"/installguide"!=d&&I.createElement(Ge,{className:"dt-layout-sider"},I.createElement(_e,(0,l.Z)({},this.props,{menuList:this.getMenuList(),style:{minHeight:"calc(100vh - 48px)",height:"100%"}}))),I.createElement(Be,{className:De()("root-content",{"has-alert__gobal":p.count>0})},this.props.children)),p.count>0&&I.createElement("div",{className:"root-attention"},I.createElement("div",{className:"service-attention"},I.createElement("div",{className:"attention-content"},I.createElement(O.Z,{type:"exclamation-circle",theme:"filled",style:{color:"#ffa941",marginRight:"8px",marginLeft:"8px"}}),I.createElement("span",{className:"attention-more"},m),p.count>=3&&I.createElement("a",{onClick:function(){n.setState({lookMoreVisible:!0})}},"查看更多")))),I.createElement(D.Z,{visible:this.state.lookMoreVisible,title:"组件变更提示",onCancel:function(){n.setState({lookMoreVisible:!1})},footer:null},I.createElement("ul",null,p.list&&L()(t=p.list).call(t,(function(e,t){return I.createElement("li",{key:t},e.depend_product_name,"——",e.depend_service_name,"配置变更后,相关依赖服务",I.createElement("span",{style:{color:"#ff5f5c"}},e.product_name,"——",e.service_name),"需要重新“滚动重启”。")})))))}}]),n}(I.Component))||Ae;const Ve=(0,M.Z)(Fe)},46103:(e,t,n)=>{n.d(t,{Z:()=>w});var r=n(1068),a=n.n(r),o=n(73126),i=n(68420),l=n(27344),s=n(5281),u=n(84441),c=n(3020),d=n(3362),p=n(44845),m=n(77766),f=n.n(m),v=n(67294),h=n(69035),_=n(45360),y=n(30258),g=n(37870),Z=n(4107);function E(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,d.Z)(e);if(t){var o=(0,d.Z)(this).constructor;n=a()(r,arguments,o)}else n=r.apply(this,arguments);return(0,c.Z)(this,n)}}var S=h.Z.Item,b={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}}},C=function(e){(0,u.Z)(n,e);var t=E(n);function n(){var e,r;(0,i.Z)(this,n);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return r=t.call.apply(t,f()(e=[this]).call(e,o)),(0,p.Z)((0,s.Z)(r),"validPass",(function(e,t,n){var a=r.props.form;t&&t===a.getFieldValue("oldPass")?n("新密码不能与旧密码一致"):t&&!/^(?![A-z0-9]+$)(?![A-z~!@#$%^&*]+$)(?![0-9~!@#$%^&*]+$)([0-9A-Za-z~!@#$%^&*]{8,20})$/.test(t)&&n("密码须包含数字、字母和特殊字符(支持~!@#$%^&*)，不低于8位"),n()})),(0,p.Z)((0,s.Z)(r),"handleResetSubmit",(function(){r.props.form.validateFields((function(e,t){e||(t.newPass===t.ensurePass?r.props.onSubmit(t):_.Z.error("两次密码填写不一致"))}))})),(0,p.Z)((0,s.Z)(r),"handleCancel",(function(){r.props.onCancel()})),r}return(0,l.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.form,n=e.userInfo,r=e.visible,a=e.isCheckedResetPwd,i=t.getFieldDecorator;return v.createElement(y.Z,{className:"reset-password",maskClosable:!1,destroyOnClose:!0,visible:r,title:"重置密码",onOk:this.handleResetSubmit,onCancel:this.handleCancel},a&&v.createElement(g.Z,{type:"warning",showIcon:!0,message:"管理员开启了初始密码修改，您需要重置初始密码，否则将退出登录影响平台功能使用。"}),v.createElement(h.Z,null,null!=n&&n.username?v.createElement(S,(0,o.Z)({},b,{label:"账号"}),n.username||""):v.createElement(S,(0,o.Z)({},b,{label:"旧密码"}),i("oldPass",{rules:[{required:!0,message:"新密码不能为空"}]})(v.createElement(Z.Z.Password,{placeholder:"请输入旧密码"}))),v.createElement(S,(0,o.Z)({},b,{label:"新密码"}),i("newPass",{rules:[{required:!0,message:"新密码不能为空"},{validator:this.validPass}]})(v.createElement(Z.Z.Password,{placeholder:"请输入新密码"}))),v.createElement(S,(0,o.Z)({},b,{label:"确认新密码"}),i("ensurePass",{rules:[{required:!0,message:"确认新密码不能为空"},{validator:this.validPass}]})(v.createElement(Z.Z.Password,{placeholder:"请再次输入新密码"})))))}}]),n}(v.PureComponent);const w=h.Z.create()(C)},60558:(e,t,n)=>{n.d(t,{ON:()=>l,g8:()=>i});var r=n(49754),a=n(35558),o=n(98130);function i(e,t){if(!t)return e;var n=new r.Z;return n.setPublicKey(t),(0,a.GV)(n.encrypt(e)||"")}function l(e,t){return"04"+o.sg.encrypt(e,t,{inputEncoding:"utf8",outputEncoding:"hex"})}},64143:(e,t,n)=>{n.d(t,{Z:()=>y});var r=n(77766),a=n.n(r),o=n(78914),i=n.n(o),l=n(81643),s=n.n(l),u=n(2991),c=n.n(u),d=n(86902),p=n.n(d),m=n(31238),f=n.n(m),v=n(45360),h=n(36808),_=n(18274);const y={pageWidth:function(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)},pageHeight:function(){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)},getParameterByName:function(e,t){t||(t=window.location.href),e=e.replace(/[[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},getBase64:function(e,t){var n=new FileReader;n.addEventListener("load",(function(){return t(n.result)})),n.readAsDataURL(e)},percent:function(e,t){return e&&e!==1/0?(e>1&&(e=1),t=t||2,t=Math.pow(10,t),Math.round(e*t*100)/t+"%"):"0%"},getCssText:function(e){var t="";for(var n in e)t+=n+":"+e[n]+";";return t},formateDateTime:function(e){var t,n,r,o,i;if(!e)return"";var l=new Date(e),s=l.getFullYear(),u=l.getMonth()+1+"",c=l.getDate()+"",d=l.getHours()+"",p=l.getMinutes()+"",m=l.getSeconds()+"";return 1===u.toString().length&&(u="0".concat(u)),1===c.toString().length&&(c="0".concat(c)),1===d.toString().length&&(d="0".concat(d)),1===p.toString().length&&(p="0".concat(p)),1===m.toString().length&&(m="0".concat(m)),a()(t=a()(n=a()(r=a()(o=a()(i="".concat(s,"-")).call(i,u,"-")).call(o,c," ")).call(r,d,":")).call(n,p,":")).call(t,m)},formateDate:function(e){var t,n;if(!e)return"";var r=new Date(e),o=r.getFullYear(),i=r.getMonth()+1+"",l=r.getDate()+"";return 1===i.toString().length&&(i="0".concat(i)),1===l.toString().length&&(l="0".concat(l)),a()(t=a()(n="".concat(o,"-")).call(n,i,"-")).call(t,l)},trim:function(e){return"string"==typeof e?e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""):e},messageFilter:function(e,t,n,r){1001===e.status.code&&(r||v.Z.success("成功"),t&&t())},getTableParam:function(e){var t={};return i()(e).call(e,(function(e,n){var r=e.split("-");t[r[1]]=r[2]})),t},setAlertControl:function(e){var t={},n=e.alert_control;return"1"===n?t.close=1:(t.close=0,e["alert_num_"+n]&&(t.times_after_close=e["alert_num_"+n]),e["recover_num_"+n]&&(t.close_after_long_time_reset_amount=e["recover_num_"+n],t.close_after_long_time_reset_unit=e["recover_unit_"+n])),t},getAlertControl:function(e){var t={alert_control:""};return 0===e.close&&(0!==e.times_after_close?(t.alert_control="2",t["alert_num_"+t.alert_control]=e.times_after_close):t.alert_control="3",""!==e.close_after_long_time_reset_amount&&("2"===t.alert_control&&(t.alert_control="4"),t["alert_num_"+t.alert_control]=e.times_after_close,t["recover_num_"+t.alert_control]=e.close_after_long_time_reset_amount,t["recover_unit_"+t.alert_control]=e.close_after_long_time_reset_unit)),t},filterOption:function(e,t){var n;return-1!==s()(n=t.props.children).call(n,e)},getParamsFromUrl:function(e){var t={},n=[],r="",a="",o=e.substring(s()(e).call(e,"?")+1,e.length).split("&");for(var i in o)r=(n=o[i].split("="))[0],a=n[1],t[r]=a;return t},jsonToQuery:function(e){var t;return e?function(e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t}(c()(t=p()(e)).call(t,(function(t){return void 0===e[t]?"":encodeURIComponent(t)+"="+encodeURIComponent(e[t])}))).join("&"):""},checkNullObj:function(e){return 0===p()(e).length},serviceCallback:function(e,t,n){0===e.data.code?(v.Z.success(t),n&&n()):v.Z.error(e.data.msg)},noAuthorityToDO:function(e,t){return!e[t]&&(v.Z.error("权限不足，请联系管理员!"),!0)},get k8sNamespace(){return h.get(_.E9.NAMESPACE)},setNaviKey:function(e,t){sessionStorage.setItem("firstLevelNav",e),sessionStorage.setItem("siderLevelNav",t)},formatGBUnit:function(e){return s()(e).call(e,"MB")>-1?f()(e.replace("MB",""))/1024:s()(e).call(e,"KB")>-1?f()(e.replace("KB",""))/1024/1024:s()(e).call(e,"GB")>-1?f()(e.replace("GB","")):s()(e).call(e,"TB")>-1?1024*f()(e.replace("TB","")):0}}}}]);