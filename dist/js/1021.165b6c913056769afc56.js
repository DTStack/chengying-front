"use strict";(self.webpackChunkdt_em_front=self.webpackChunkdt_em_front||[]).push([[1021,3601],{71021:(e,t,n)=>{n.r(t),n.d(t,{default:()=>R});var o=n(88239),r=n(99663),a=n(22600),i=n(49135),s=n(93196),u=n(67294),l=n(45697),c=n.n(l),d=n(88106),p=n(94184),f=n.n(p);function h(e){var t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch(e){return t}}function m(e){var t=new XMLHttpRequest;e.onProgress&&t.upload&&(t.upload.onprogress=function(t){t.total>0&&(t.percent=t.loaded/t.total*100),e.onProgress(t)});var n=new FormData;e.data&&Object.keys(e.data).forEach((function(t){var o=e.data[t];Array.isArray(o)?o.forEach((function(e){n.append(t+"[]",e)})):n.append(t,e.data[t])})),n.append(e.filename,e.file),t.onerror=function(t){e.onError(t)},t.onload=function(){if(t.status<200||t.status>=300)return e.onError(function(e,t){var n="cannot "+e.method+" "+e.action+" "+t.status+"'",o=new Error(n);return o.status=t.status,o.method=e.method,o.url=e.action,o}(e,t),h(t));e.onSuccess(h(t),t)},t.open(e.method,e.action,!0),e.withCredentials&&"withCredentials"in t&&(t.withCredentials=!0);var o=e.headers||{};for(var r in null!==o["X-Requested-With"]&&t.setRequestHeader("X-Requested-With","XMLHttpRequest"),o)o.hasOwnProperty(r)&&null!==o[r]&&t.setRequestHeader(r,o[r]);return t.send(n),{abort:function(){t.abort()}}}var y=+new Date,v=0;function g(){return"rc-upload-"+y+"-"+ ++v}const b=function(e,t){if(e&&t){var n=Array.isArray(t)?t:t.split(","),o=e.name||"",r=e.type||"",a=r.replace(/\/.*$/,"");return n.some((function(e){var t,n,i=e.trim();return"."===i.charAt(0)?(t=o.toLowerCase(),n=i.toLowerCase(),-1!==t.indexOf(n,t.length-n.length)):/\/\*$/.test(i)?a===i.replace(/\/.*$/,""):r===i}))}return!0};const k=function(e,t,n){var o=function e(o,r){r=r||"",o.isFile?o.file((function(e){n(e)&&(o.fullPath&&!e.webkitRelativePath&&(Object.defineProperties(e,{webkitRelativePath:{writable:!0}}),e.webkitRelativePath=o.fullPath.replace(/^\//,""),Object.defineProperties(e,{webkitRelativePath:{writable:!1}})),t([e]))})):o.isDirectory&&function(e,t){var n=e.createReader(),o=[];!function e(){n.readEntries((function(n){var r=Array.prototype.slice.apply(n);o=o.concat(r),!r.length?t(o):e()}))}()}(o,(function(t){t.forEach((function(t){e(t,""+r+o.name+"/")}))}))},r=!0,a=!1,i=void 0;try{for(var s,u=e[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){o(s.value.webkitGetAsEntry())}}catch(e){a=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw i}}};var C=function(e){function t(){var e,n,o,a;(0,r.default)(this,t);for(var s=arguments.length,u=Array(s),l=0;l<s;l++)u[l]=arguments[l];return n=o=(0,i.default)(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(u))),o.state={uid:g()},o.reqs={},o.onChange=function(e){var t=e.target.files;o.uploadFiles(t),o.reset()},o.onClick=function(){var e=o.fileInput;e&&e.click()},o.onKeyDown=function(e){"Enter"===e.key&&o.onClick()},o.onFileDrop=function(e){var t=o.props.multiple;if(e.preventDefault(),"dragover"!==e.type)if(o.props.directory)k(e.dataTransfer.items,o.uploadFiles,(function(e){return b(e,o.props.accept)}));else{var n=Array.prototype.slice.call(e.dataTransfer.files).filter((function(e){return b(e,o.props.accept)}));!1===t&&(n=n.slice(0,1)),o.uploadFiles(n)}},o.uploadFiles=function(e){var t=Array.prototype.slice.call(e);t.map((function(e){return e.uid=g(),e})).forEach((function(e){o.upload(e,t)}))},o.saveFileInput=function(e){o.fileInput=e},a=n,(0,i.default)(o,a)}return(0,s.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.abort()}},{key:"upload",value:function(e,t){var n=this,o=this.props;if(!o.beforeUpload)return setTimeout((function(){return n.post(e)}),0);var r=o.beforeUpload(e,t);r&&r.then?r.then((function(t){var o=Object.prototype.toString.call(t);return"[object File]"===o||"[object Blob]"===o?n.post(t):n.post(e)})).catch((function(e){console})):!1!==r&&setTimeout((function(){return n.post(e)}),0)}},{key:"post",value:function(e){var t=this;if(this._isMounted){var n=this.props,o=n.data,r=n.onStart,a=n.onProgress,i=n.transformFile,s=void 0===i?function(e){return e}:i;new Promise((function(t){var o=n.action;if("function"==typeof o)return t(o(e));t(o)})).then((function(i){var u=e.uid,l=n.customRequest||m;Promise.resolve(s(e)).catch((function(e){})).then((function(s){"function"==typeof o&&(o=o(e));var c={action:i,filename:n.name,data:o,file:s,headers:n.headers,withCredentials:n.withCredentials,method:n.method||"post",onProgress:a?function(t){a(t,e)}:null,onSuccess:function(o,r){delete t.reqs[u],n.onSuccess(o,e,r)},onError:function(o,r){delete t.reqs[u],n.onError(o,r,e)}};t.reqs[u]=l(c),r(e)}))}))}}},{key:"reset",value:function(){this.setState({uid:g()})}},{key:"abort",value:function(e){var t=this.reqs;if(e){var n=e;e&&e.uid&&(n=e.uid),t[n]&&t[n].abort&&t[n].abort(),delete t[n]}else Object.keys(t).forEach((function(e){t[e]&&t[e].abort&&t[e].abort(),delete t[e]}))}},{key:"render",value:function(){var e,t=this.props,n=t.component,r=t.prefixCls,a=t.className,i=t.disabled,s=t.id,l=t.style,c=t.multiple,p=t.accept,h=t.children,m=t.directory,y=t.openFileDialogOnClick,v=f()((e={},(0,d.default)(e,r,!0),(0,d.default)(e,r+"-disabled",i),(0,d.default)(e,a,a),e)),g=i?{}:{onClick:y?this.onClick:function(){},onKeyDown:y?this.onKeyDown:function(){},onDrop:this.onFileDrop,onDragOver:this.onFileDrop,tabIndex:"0"};return u.createElement(n,(0,o.default)({},g,{className:v,role:"button",style:l}),u.createElement("input",{id:s,type:"file",ref:this.saveFileInput,onClick:function(e){return e.stopPropagation()},key:this.state.uid,style:{display:"none"},accept:p,directory:m?"directory":null,webkitdirectory:m?"webkitdirectory":null,multiple:c,onChange:this.onChange}),h)}}]),t}(u.Component);C.propTypes={id:c().string,component:c().string,style:c().object,prefixCls:c().string,className:c().string,multiple:c().bool,directory:c().bool,disabled:c().bool,accept:c().string,children:c().any,onStart:c().func,data:c().oneOfType([c().object,c().func]),action:c().oneOfType([c().string,c().func]),headers:c().object,beforeUpload:c().func,customRequest:c().func,onProgress:c().func,withCredentials:c().bool,openFileDialogOnClick:c().bool,transformFile:c().func};const w=C;var I=n(73935),D=n(42473),E=n.n(D),F={position:"absolute",top:0,opacity:0,filter:"alpha(opacity=0)",left:0,zIndex:9999},O=function(e){function t(){var e,n,o,a;(0,r.default)(this,t);for(var s=arguments.length,u=Array(s),l=0;l<s;l++)u[l]=arguments[l];return n=o=(0,i.default)(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(u))),o.state={uploading:!1},o.file={},o.onLoad=function(){if(o.state.uploading){var e=o,t=e.props,n=e.file,r=void 0;try{var a=o.getIframeDocument(),i=a.getElementsByTagName("script")[0];i&&i.parentNode===a.body&&a.body.removeChild(i),r=a.body.innerHTML,t.onSuccess(r,n)}catch(e){E()(!1,"cross domain error for Upload. Maybe server should return document.domain script. see Note from https://github.com/react-component/upload"),r="cross-domain",t.onError(e,null,n)}o.endUpload()}},o.onChange=function(){var e=o.getFormInputNode(),t=o.file={uid:g(),name:e.value&&e.value.substring(e.value.lastIndexOf("\\")+1,e.value.length)};o.startUpload();var n=o.props;if(!n.beforeUpload)return o.post(t);var r=n.beforeUpload(t);r&&r.then?r.then((function(){o.post(t)}),(function(){o.endUpload()})):!1!==r?o.post(t):o.endUpload()},o.saveIframe=function(e){o.iframe=e},a=n,(0,i.default)(o,a)}return(0,s.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this.updateIframeWH(),this.initIframe()}},{key:"componentDidUpdate",value:function(){this.updateIframeWH()}},{key:"getIframeNode",value:function(){return this.iframe}},{key:"getIframeDocument",value:function(){return this.getIframeNode().contentDocument}},{key:"getFormNode",value:function(){return this.getIframeDocument().getElementById("form")}},{key:"getFormInputNode",value:function(){return this.getIframeDocument().getElementById("input")}},{key:"getFormDataNode",value:function(){return this.getIframeDocument().getElementById("data")}},{key:"getFileForMultiple",value:function(e){return this.props.multiple?[e]:e}},{key:"getIframeHTML",value:function(e){var t="",n="";if(e){t='<script>document.domain="'+e+'";<\/script>',n='<input name="_documentDomain" value="'+e+'" />'}return'\n    <!DOCTYPE html>\n    <html>\n    <head>\n    <meta http-equiv="X-UA-Compatible" content="IE=edge" />\n    <style>\n    body,html {padding:0;margin:0;border:0;overflow:hidden;}\n    </style>\n    '+t+'\n    </head>\n    <body>\n    <form method="post"\n    encType="multipart/form-data"\n    action="" id="form"\n    style="display:block;height:9999px;position:relative;overflow:hidden;">\n    <input id="input" type="file"\n     name="'+this.props.name+'"\n     style="position:absolute;top:0;right:0;height:9999px;font-size:9999px;cursor:pointer;"/>\n    '+n+'\n    <span id="data"></span>\n    </form>\n    </body>\n    </html>\n    '}},{key:"initIframeSrc",value:function(){this.domain&&(this.getIframeNode().src="javascript:void((function(){\n        var d = document;\n        d.open();\n        d.domain='"+this.domain+"';\n        d.write('');\n        d.close();\n      })())")}},{key:"initIframe",value:function(){var e=this.getIframeNode(),t=e.contentWindow,n=void 0;this.domain=this.domain||"",this.initIframeSrc();try{n=t.document}catch(o){this.domain=document.domain,this.initIframeSrc(),n=(t=e.contentWindow).document}n.open("text/html","replace"),n.write(this.getIframeHTML(this.domain)),n.close(),this.getFormInputNode().onchange=this.onChange}},{key:"endUpload",value:function(){this.state.uploading&&(this.file={},this.state.uploading=!1,this.setState({uploading:!1}),this.initIframe())}},{key:"startUpload",value:function(){this.state.uploading||(this.state.uploading=!0,this.setState({uploading:!0}))}},{key:"updateIframeWH",value:function(){var e=I.findDOMNode(this),t=this.getIframeNode();t.style.height=e.offsetHeight+"px",t.style.width=e.offsetWidth+"px"}},{key:"abort",value:function(e){if(e){var t=e;e&&e.uid&&(t=e.uid),t===this.file.uid&&this.endUpload()}else this.endUpload()}},{key:"post",value:function(e){var t=this,n=this.getFormNode(),o=this.getFormDataNode(),r=this.props.data,a=this.props.onStart;"function"==typeof r&&(r=r(e));var i=document.createDocumentFragment();for(var s in r)if(r.hasOwnProperty(s)){var u=document.createElement("input");u.setAttribute("name",s),u.value=r[s],i.appendChild(u)}o.appendChild(i),new Promise((function(n){var o=t.props.action;if("function"==typeof o)return n(o(e));n(o)})).then((function(t){n.setAttribute("action",t),n.submit(),o.innerHTML="",a(e)}))}},{key:"render",value:function(){var e,t=this.props,n=t.component,r=t.disabled,a=t.className,i=t.prefixCls,s=t.children,l=t.style,c=(0,o.default)({},F,{display:this.state.uploading||r?"none":""}),p=f()((e={},(0,d.default)(e,i,!0),(0,d.default)(e,i+"-disabled",r),(0,d.default)(e,a,a),e));return u.createElement(n,{className:p,style:(0,o.default)({position:"relative",zIndex:0},l)},u.createElement("iframe",{ref:this.saveIframe,onLoad:this.onLoad,style:c}),s)}}]),t}(u.Component);O.propTypes={component:c().string,style:c().object,disabled:c().bool,prefixCls:c().string,className:c().string,accept:c().string,onStart:c().func,multiple:c().bool,children:c().any,data:c().oneOfType([c().object,c().func]),action:c().oneOfType([c().string,c().func]),name:c().string};const S=O;function P(){}var N=function(e){function t(){var e,n,o,a;(0,r.default)(this,t);for(var s=arguments.length,u=Array(s),l=0;l<s;l++)u[l]=arguments[l];return n=o=(0,i.default)(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(u))),o.state={Component:null},o.saveUploader=function(e){o.uploader=e},a=n,(0,i.default)(o,a)}return(0,s.default)(t,e),(0,a.default)(t,[{key:"componentDidMount",value:function(){this.props.supportServerRender&&this.setState({Component:this.getComponent()},this.props.onReady)}},{key:"getComponent",value:function(){return"undefined"!=typeof File?w:S}},{key:"abort",value:function(e){this.uploader.abort(e)}},{key:"render",value:function(){if(this.props.supportServerRender){var e=this.state.Component;return e?u.createElement(e,(0,o.default)({},this.props,{ref:this.saveUploader})):null}var t=this.getComponent();return u.createElement(t,(0,o.default)({},this.props,{ref:this.saveUploader}))}}]),t}(u.Component);N.propTypes={component:c().string,style:c().object,prefixCls:c().string,action:c().oneOfType([c().string,c().func]),name:c().string,multipart:c().bool,directory:c().bool,onError:c().func,onSuccess:c().func,onProgress:c().func,onStart:c().func,data:c().oneOfType([c().object,c().func]),headers:c().object,accept:c().string,multiple:c().bool,disabled:c().bool,beforeUpload:c().func,customRequest:c().func,onReady:c().func,withCredentials:c().bool,supportServerRender:c().bool,openFileDialogOnClick:c().bool},N.defaultProps={component:"span",prefixCls:"rc-upload",data:{},headers:{},name:"file",multipart:!1,onReady:P,onStart:P,onError:P,onSuccess:P,supportServerRender:!1,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0};const R=N}}]);