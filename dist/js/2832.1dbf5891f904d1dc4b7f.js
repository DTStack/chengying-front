"use strict";(self.webpackChunkdt_em_front=self.webpackChunkdt_em_front||[]).push([[2832],{19377:(e,t,n)=>{n.d(t,{Z:()=>f});var r=n(95266),a=n(77766),i=n.n(a),o=n(67294),c=n(31097),s=n(8263),l=n(30381),u=n.n(l),d=n(19528),p=n(64143);const f=function(e){var t=e.history,n=e.ip,a=(0,o.useState)([]),l=(0,r.Z)(a,2),f=l[0],m=l[1];(0,o.useEffect)((function(){v()}),[n]);var v=function(){d.BZ.getHostAlert({ip:n}).then((function(e){var t,n=e.data;0===n.code&&m(null==n||null===(t=n.data)||void 0===t?void 0:t.data)}))};return o.createElement(s.Z,{rowKey:function(e){var t;return i()(t="".concat(e.panel_title,"_")).call(t,e.time)},className:"dt-table-fixed-base",dataSource:f,pagination:!1,scroll:{y:!0},style:{height:485},size:"middle"},o.createElement(s.Z.Column,{title:"指标名称",key:"panel_title",render:function(e){return o.createElement("div",null,function(e){var t=null;switch(e){case"ok":t=o.createElement(c.Z,{title:e},o.createElement("i",{className:"emicon emicon-heart-fill color-ok"}));break;case"pending":t=o.createElement(c.Z,{title:e},o.createElement("i",{className:"emicon emicon-warning-circle-fill color-pending"}));break;case"alerting":t=o.createElement(c.Z,{title:e},o.createElement("i",{className:"emicon emicon-alert-fill color-alerting"}));break;case"no_data":t=o.createElement(c.Z,{title:e},o.createElement("i",{className:"emicon emicon-question-circle-fill color-no-data"}));break;case"paused":t=o.createElement(c.Z,{title:e},o.createElement("i",{className:"emicon emicon-poweroff-circle-fill color-paused"}));break;default:t=o.createElement(c.Z,{title:e},o.createElement("i",{className:"emicon emicon-API- color-no-data"}))}return t}(e.state),"  ",e.panel_title)}}),o.createElement(s.Z.Column,{title:"告警名称",dataIndex:"alert_name"}),o.createElement(s.Z.Column,{title:"来源仪表盘",dataIndex:"dashboard_name",render:function(e,n){return o.createElement("a",{onClick:function(e){return function(e){var n="/deploycenter/monitoring/dashdetail?url=".concat(e.url);p.Z.setNaviKey("menu_deploy_center","sub_menu_dashboard"),t.push(n)}(n)}},e)}}),o.createElement(s.Z.Column,{title:"告警时间",dataIndex:"time",render:function(e){return e?u()(e).format("YYYY-MM-DD HH:mm:ss"):"--"}}))}},32832:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Nn});var r=n(1068),a=n.n(r),i=n(66419),o=n.n(i),c=n(65420),s=n.n(c),l=n(19996),u=n.n(l),d=n(41511),p=n.n(d),f=n(86902),m=n.n(f),v=n(14310),h=n.n(v),g=n(20116),_=n.n(g),y=n(34074),S=n.n(y),Z=n(78914),C=n.n(Z),E=n(39649),k=n.n(E),b=n(20368),w=n.n(b),x=n(63978),I=n.n(x),N=n(73126),P=n(71649),H=n(68420),A=n(27344),R=n(5281),D=n(84441),T=n(3020),O=n(3362),F=n(44845),M=n(51942),L=n.n(M),K=n(77766),B=n.n(K),V=n(94198),U=n.n(V),j=n(3649),z=n.n(j),G=n(2991),Y=n.n(G),W=n(31581),J=n.n(W),$=n(54103),q=n.n($),Q=n(29027),X=n(32882),ee=n(15857),te=n(67294),ne=n(99210),re=n(97183),ae=n(79855),ie=n(45360),oe=n(67908),ce=n(80403),se=n(30258),le=n(65778),ue=n(19528),de=n(36808),pe=n(44930),fe=n(63109),me=n.n(fe),ve=n(36384),he=n.n(ve),ge=n(78580),_e=n.n(ge),ye=n(62462),Se=n.n(ye),Ze=n(92762),Ce=n.n(Ze),Ee=n(10062),ke=n.n(Ee),be=n(77149),we=n.n(be),xe=n(81643),Ie=n.n(xe),Ne=n(59340),Pe=n.n(Ne),He=n(20455),Ae=n.n(He),Re=n(93476),De=n.n(Re),Te=n(33032),Oe=n.n(Te),Fe=n(24105),Me=n(34041),Le=n(4107),Ke=n(94184),Be=n.n(Ke),Ve=n(31097),Ue=n(69035),je=n(74981);n(56395),n(76588);function ze(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,O.Z)(e);if(t){var i=(0,O.Z)(this).constructor;n=a()(r,arguments,i)}else n=r.apply(this,arguments);return(0,T.Z)(this,n)}}var Ge=Me.Z.Option,Ye=function(e){(0,D.Z)(n,e);var t=ze(n);function n(){var e,r;(0,H.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return r=t.call.apply(t,B()(e=[this]).call(e,i)),(0,F.Z)((0,R.Z)(r),"handleSubmit",(function(e){r.props.form.validateFields((function(e,t){e||r.props.handleSetParamSubmit()}))})),r}return(0,A.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.visible,n=e.onCancel,r=e.dropList,a=e.onChange,i=e.value,o=e.fileContent,c=e.handleContentChange,s=e.newAddParamArray,l=e.form.getFieldDecorator,u={labelCol:{span:3},wrapperCol:{span:10}};return te.createElement(se.Z,{title:"配置参数",width:900,visible:t,onCancel:n,onOk:this.handleSubmit,okText:"确认",cancelText:"取消",okButtonProps:{disabled:!r}},te.createElement("div",{style:{marginBottom:"10px"}},te.createElement(Me.Z,{style:{minWidth:160},onChange:a,value:i},null!=r?Y()(r).call(r,(function(e,t){return te.createElement(Ge,{key:"".concat(t),value:e},te.createElement(Ve.Z,{title:e},e))})):"")),te.createElement("div",{style:{backgroundColor:"#F5F5F5",border:"1px dashed #DDDDDD",height:"400px",width:"845px"},className:"service-config-pre service-config"},r?te.createElement(je.ZP,{mode:"javascript",theme:"xcode",onChange:c,value:o,style:{width:"100%",height:"100%",fontSize:"12px",lineHeight:"20px"}}):""),te.createElement("div",{style:{marginTop:"10px"}},te.createElement("span",{style:{fontWeight:"bold",fontSize:"12px"}},"参数赋值："),te.createElement("span",{style:{fontSize:"12px",color:"#A7A7A7"}},"为新增参数赋默认值，若无默认值，输入空格即可")),te.createElement(Ue.Z,null,Y()(s).call(s,(function(e,t){var n=e&&e.length>10?z()(e).call(e,0,10)+"...":e;return te.createElement(Ue.Z.Item,(0,N.Z)({},u,{style:{fontSize:"16px",marginBottom:"10px"},label:te.createElement(Ve.Z,{title:e},n),key:t}),l("".concat(e),{rules:[{required:!0,message:"参数默认值不能为空"},{message:"参数默认值长度不能大于512个字符",max:512}]})(te.createElement(Le.Z,{placeholder:"请输入默认值",id:e})))}))))}}]),n}(te.Component);const We=Ue.Z.create()(Ye);var Je,$e=n(81354),qe=n(71230),Qe=n(60331),Xe=n(9676),et=n(15746),tt={labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}},nt={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}}},rt=n(30381),at=n.n(rt),it=n(78241),ot=n(60558);function ct(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,O.Z)(e);if(t){var i=(0,O.Z)(this).constructor;n=a()(r,arguments,i)}else n=r.apply(this,arguments);return(0,T.Z)(this,n)}}var st=Ue.Z.Item,lt=(0,Q.$j)((function(e){return{ServiceStore:e.ServiceStore}}),(function(e){return{actions:(0,ee.DE)(L()({},X),e)}}))(Je=function(e){(0,D.Z)(n,e);var t=ct(n);function n(e){var r;return(0,H.Z)(this,n),r=t.call(this,e),(0,F.Z)((0,R.Z)(r),"disabledLink",[]),(0,F.Z)((0,R.Z)(r),"getHostsList",(function(){var e,t,n,a=r.props,i=a.sname,o=a.pname,c=a.HeaderStore;i&&o&&it.get(B()(e=B()(t="/api/v2/product/".concat(o,"/service/")).call(t,i,"/selected_hosts?clusterId=")).call(e,null===(n=c.cur_parent_cluster)||void 0===n?void 0:n.id),{}).then((function(e){0===(e=e.data).code?r.setState({hostsList:e.data.hosts}):ie.Z.error(e.msg)}))})),(0,F.Z)((0,R.Z)(r),"onCloseHost",(function(e,t,n,a){var i,o=r.props.ServiceStore.cur_service,c=r.props.actions.setServiceConfigModify,s=L()({},o.configModify),l=e.split(".")[0],u=o.Config[l].current[n].hosts.split(","),d=Ie()(u).call(u,t);Ce()(u).call(u,d,1);var p=u.join(",");r.setState({changeHosts:p.split(",")});var f={hosts:p,field:"string"==typeof o.Config[l].current[n]?o.Config[l].current[n]:o.Config[l].current[n].field};Ce()(i=o.Config[l].current).call(i,n,1,f),s["Config."+e]=o.Config[l].current,o.configModify=s,c(o)})),(0,F.Z)((0,R.Z)(r),"linkItem",(function(e,t,n){r.getHostsList();var a=r.props.ServiceStore.cur_service;r.filterHosts(a.Config[e.split(".")[0]].current),r.setState({hostVisible:!0,linkIndex:t,linkName:e.split(".")[0],changeHosts:[]})})),(0,F.Z)((0,R.Z)(r),"removeItem",(function(e,t,n){var a,i=r.props.ServiceStore.cur_service,o=r.props.actions.setServiceConfigModify,c=L()({},i.configModify),s=e.split(".")[0];i.Config[s].current.length>2?(Ce()(a=i.Config[s].current).call(a,t,1),c["Config."+e]=i.Config[s].current):(2==i.Config[s].current.length&&r.props.changeHosts(),i.Config[s].current=i.Config[s].current[0].field,c["Config."+e]=i.Config[s].current);i.configModify=c,o(i)})),(0,F.Z)((0,R.Z)(r),"addItem",(function(e,t){if(r.props.canEditHost){var n=r.props.ServiceStore.cur_service,a=r.props.actions.setServiceConfigModify,i=L()({},n.configModify),o=[],c=e.split(".")[0],s={hosts:"",field:p()(n.Config[c].current)?n.Config[c].current[0].field:n.Config[c].current};if(Ie()(e).call(e,".")>-1)if(p()(n.Config[c].current))n.Config[c].current.push(s);else{var l={hosts:"",field:n.Config[c].current};o.push(l,s),n.Config[c].current=o}else n.Config[c].current=p()(n.Config[c].current)?n.Config[c].current.push(s):o.push(n.Config[c].current,s);n.configModify=i,a(n)}else ie.Z.error("权限不足，请联系管理员！")})),(0,F.Z)((0,R.Z)(r),"onChangeHosts",(function(e){r.setState({changeHosts:e})})),r.state={default_input_value:"",has_config_value:!1,checkVisible:!1,iconType:0,passwd:"",key:{},password_key:"",hostVisible:!1,changeHosts:[],hostsList:[],linkIndex:null,linkName:""},r}return(0,A.Z)(n,[{key:"componentDidMount",value:function(){this.getHostsList()}},{key:"buildConfigEditByNode",value:function(e,t){var n,r=this.props,a=r.query,i=r.noEditAuthority,o=r.ServiceStore,c=r.noHosts,s=r.isKubernetes,l=r.repeatParams,u=o.cur_service&&o.cur_service.configModify&&m()(o.cur_service.configModify).length,d=this,f=!1,v=Y()(n=m()(e)).call(n,(function(n,r){var o,v=t?t+"."+n:n;return Y()(o=m()(e[n])).call(o,(function(t,r){var o,m,h,g,_,y,S,Z,C,E,k=v+"."+t;return"current"===t&&"string"==typeof e[n][t]?(f=!0,Ie()(v).call(v,a)>-1?te.createElement(st,(0,N.Z)({},tt,{labelAlign:"right",label:te.createElement("span",{className:"labelBox"},e[n].nouse&&te.createElement("i",{className:"emicon emicon-wyy icon-style"}),e[n].isnew&&te.createElement("i",{className:"emicon emicon-new icon-style"}),v.length>20?te.createElement(Ve.Z,{title:v},te.createElement("span",null,z()(v).call(v,0,20),"...")):v),key:v}),/password/.test(v.toLowerCase())?te.createElement("span",{style:{display:"inline-flex"}},te.createElement(Le.Z,{type:e[n].iconType?"text":/password/.test(v.toLowerCase())?"password":"text",disabled:/password/.test(v.toLowerCase())?!e[n].iconType:i,className:i?"c-paramConfig__ant-input":"",defaultValue:e[n][t],style:{width:400},value:e[n][t],addonAfter:te.createElement(Ve.Z,{title:"恢复默认值"},te.createElement("i",{className:"emicon emicon-undo",style:{fontSize:14},onClick:u?null:/password/.test(v.toLowerCase())?e[n].iconType?i?null:q()(o=d.handleReloadConfig).call(o,d,k,1):null:q()(m=d.handleReloadConfig).call(m,d,k,1)})),onChange:q()(h=d.handleInputChange).call(h,d,k),onFocus:q()(g=d.handleInputFocus).call(g,d,k)})):te.createElement("span",{style:{display:"inline-flex"}},te.createElement(Le.Z.TextArea,{disabled:/password/.test(v.toLowerCase())?!e[n].iconType:i,className:i?"c-paramConfig__ant-input":"",defaultValue:e[n][t],value:e[n][t],style:{width:363,height:32,outline:"none",resize:"none"},onChange:q()(_=d.handleInputChange).call(_,d,k),onFocus:q()(y=d.handleInputFocus).call(y,d,k)}),te.createElement("span",{className:"afteron"},te.createElement(Ve.Z,{title:"恢复默认值"},te.createElement("i",{className:"emicon emicon-undo",style:{fontSize:14},onClick:u?null:/password/.test(v.toLowerCase())?e[n].iconType?i?null:q()(S=d.handleReloadConfig).call(S,d,k,1):null:q()(Z=d.handleReloadConfig).call(Z,d,k,1)})))),e[n].updated&&te.createElement(Ve.Z,{title:te.createElement(te.Fragment,null,te.createElement("p",null,"最近修改时间：",at()(e[n].updated).utc().zone(6).format("YYYY-MM-DD HH:mm:ss")),te.createElement("p",null,"默认值：",e[n].default))},te.createElement("i",{className:"emicon emicon-revise icon-style"})),!/password/.test(v.toLowerCase())&&!s&&te.createElement("span",{className:"operate-icon"},te.createElement(oe.Z,{className:"plus-icon",type:"plus",onClick:q()(C=d.addItem).call(C,d,k)})),/password/.test(v.toLowerCase())?d.renderIcon(e[n]):null):""):"current"===t&&p()(e[n].current)?(f=!0,Ie()(v).call(v,a)>-1?te.createElement(st,(0,N.Z)({},tt,{label:te.createElement(te.Fragment,null,e[n].nouse&&te.createElement("i",{className:"emicon emicon-wyy icon-style"}),e[n].isnew&&te.createElement("i",{className:"emicon emicon-new icon-style"}),v.length>20?te.createElement(Ve.Z,{title:v},te.createElement("span",null,z()(v).call(v,0,20),"...")):v),key:v,className:"config-array"}),Y()(E=e[n].current).call(E,(function(r,a){var o,s,p,f,m,h,g,_,y,S,Z,C,E=we()(l).call(l,(function(e){return e===n}));return te.createElement(st,{key:a},e[n].current.length>1?te.createElement(Le.Z,{type:e[n].iconType?"text":/password/.test(v.toLowerCase())?"password":"text",disabled:/password/.test(v.toLowerCase())?!e[n].iconType:i,className:i?"c-paramConfig__ant-input":"",defaultValue:"string"==typeof r?r:r.field,style:{width:400},value:"string"==typeof r?r:r.field,addonAfter:te.createElement(Ve.Z,{title:"恢复默认值"},te.createElement("i",{className:"emicon emicon-undo",style:{fontSize:14},onClick:u?null:/password/.test(v.toLowerCase())?e[n].iconType?i?null:q()(o=d.handleReloadConfig).call(o,d,k,2,r.hosts):null:q()(s=d.handleReloadConfig).call(s,d,k,2,r.hosts)})),onChange:q()(p=d.handleInputArrayChange).call(p,d,k,a),onFocus:q()(f=d.handleInputFocus).call(f,d,k)}):te.createElement(Le.Z,{type:e[n].iconType?"text":/password/.test(v.toLowerCase())?"password":"text",disabled:/password/.test(v.toLowerCase())?!e[n].iconType:i,className:i?"c-paramConfig__ant-input":"",defaultValue:"string"==typeof r?r:r.field,style:{width:400},value:"string"==typeof r?r:r.field,addonAfter:te.createElement(Ve.Z,{title:"恢复默认值"},te.createElement("i",{className:"emicon emicon-undo",style:{fontSize:14},onClick:u?null:/password/.test(v.toLowerCase())?e[n].iconType?i?null:q()(m=d.handleReloadConfig).call(m,d,k,2,r.hosts):null:q()(h=d.handleReloadConfig).call(h,d,k,2,r.hosts)})),onChange:q()(g=d.handleInputChange).call(g,d,k),onFocus:q()(_=d.handleInputFocus).call(_,d,k)}),!/password/.test(v.toLowerCase())&&te.createElement("span",{className:"operate-icon"},te.createElement(oe.Z,{className:"plus-icon",type:"plus",onClick:q()(y=d.addItem).call(y,d,k)}),e[n][t].length>1&&te.createElement(oe.Z,{type:"link",className:"link-icon",onClick:q()(S=d.linkItem).call(S,d,k,a)}),a>0?te.createElement(oe.Z,{className:"dynamic-delete-button",type:"delete",onClick:q()(Z=d.removeItem).call(Z,d,k,a)}):null),/password/.test(v.toLowerCase())?d.renderIcon(e[n]):null,e[n].updated&&te.createElement(Ve.Z,{title:te.createElement(te.Fragment,null,te.createElement("p",null,"最近修改时间：",at()(e[n].updated).utc().zone(6).format("YYYY-MM-DD HH:mm:ss")),te.createElement("p",null,"默认值：",e[n].default))},te.createElement("i",{className:"emicon emicon-revise icon-style"})),l&&0===a&&E&&te.createElement("p",{className:"repeatparams-span"},"参数值重复,请重新输入"),n===c&&0===a&&te.createElement("span",{className:"nohosts-span"},"存在主机未关联该参数"),te.createElement(qe.Z,{style:e[n].current.length>1&&r.hosts?{marginTop:"12px"}:{}},e[n].current.length>1&&r.hosts?Y()(C=r.hosts.split(",")).call(C,(function(e,t){var n;return te.createElement("div",{key:t},te.createElement("div",{key:t,style:{marginRight:"4px",height:"28px",display:"inline-block",float:"left"}},te.createElement(Qe.Z,{visible:!0,closable:!0,onClose:q()(n=d.onCloseHost).call(n,d,k,e,a)},e)),t%3==2&&t!==r.hosts.split(",").length-1&&te.createElement("div",{dangerouslySetInnerHTML:{__html:"&nbsp;"}}))})):null))}))):""):""}))}));return f?v:te.createElement("span",{style:{margin:"1px 1%"}},"无")}},{key:"renderIcon",value:function(e){var t,n;return this.props.ServiceStore.cur_service.Config[e.config].iconType?te.createElement(oe.Z,{type:"unlock",theme:"filled",style:{fontSize:20,marginLeft:"20px"},onClick:q()(t=this.closeKey).call(t,this,e.config)}):te.createElement(oe.Z,{type:"lock",theme:"filled",style:{fontSize:20,cursor:"pointer",marginLeft:"20px"},onClick:q()(n=this.saveKey).call(n,this,e.config)})}},{key:"saveKey",value:function(e){this.props.canEditPwd?this.setState({checkVisible:!0,key:e}):ie.Z.error("权限不足，请联系管理员！")}},{key:"handleInputChange",value:function(e,t){var n=this.props,r=n.ServiceStore,a=n.actions,i=n.encryptInfo,o=this.state.password_key,c=r.cur_service,s=a.setServiceConfigModify,l=L()({},c.configModify);if(/password/.test(e.toLowerCase()))if("sm2"!==i.encrypt_type){var u={securityKey:$e.MD5(o),iv:"1234567890123456"};l["Config."+e]=this.encrypt(t.target.value,u)}else l["Config."+e]=(0,ot.ON)(t.target.value,i.encrypt_public_key);else l["Config."+e]=t.target.value;Ie()(e).call(e,".")>-1?c.Config[e.split(".")[0]][e.split(".")[1]]=t.target.value:c.Config[e]=t.target.value,c.configModify=l,s(c)}},{key:"handleInputArrayChange",value:function(e,t,n){var r,a=this.props.ServiceStore.cur_service,i=this.props.actions.setServiceConfigModify,o=L()({},a.configModify),c=e.split(".")[0],s={hosts:a.Config[c].current[t].hosts?a.Config[c].current[t].hosts:"",field:n.target.value};Ce()(r=a.Config[c].current).call(r,t,1,s),o["Config."+e]=a.Config[c].current,a.configModify=o,i(a)}},{key:"replacePasswd",value:function(e,t){var n=this.props.ServiceStore.cur_service,r=this.props.actions.setServiceConfigModify,a=L()({},n.Config);a[e].current=t,a[e].iconType=1,n.Config=a,r(n)}},{key:"closeKey",value:function(e){var t=this.props,n=t.form,r=(t.encryptInfo,t.ServiceStore),a=t.actions,i=r.cur_service,o=n.setFieldsValue,c=a.setServiceConfigModify,s=this.state.password_key,l=i.Config[e].current;""==l&&(l="45d3161f8aa54588ab3901fa954cc01a");var u={securityKey:$e.MD5(s),iv:"1234567890123456"},d=this.encrypt(l,u),p=L()({},i.Config);p[e].current=d,p[e].iconType=0,i.Config=p,c(i),o({input_password:""})}},{key:"handleInputFocus",value:function(e,t){this.setState({default_input_value:t.target.value})}},{key:"handleReloadConfig",value:function(e,t,n){var r=this;if(!this.props.canReset)return ie.Z.error("权限不足，请联系管理员！"),!1;se.Z.confirm({title:"确认恢复此字段的默认值吗？",icon:te.createElement(oe.Z,{type:"exclamation-circle",theme:"filled"}),okType:"danger",onOk:function(){var a=r.props,i=a.sname,o=a.pname,c=a.pid,s=a.pversion;1==t?r.props.actions.resetServiceConfig({product_name:o,service_name:i,pid:c,product_version:s,field_path:"Config."+e}):r.props.actions.resetMultiServiceConfig({product_name:o,service_name:i,pid:c,product_version:s,field_path:"Config."+e,hosts:n})}})}},{key:"handleServiceConfigReset",value:function(e){var t=this.props,n=t.sname,r=t.pname,a=t.pid,i=t.pversion;this.props.actions.resetServiceConfig({product_name:r,service_name:n,pid:a,product_version:i,field_path:e.field_path})}},{key:"checkPassWord",value:function(){var e=this.props.form,t=e.getFieldValue,n=e.setFieldsValue,r=this.state.key,a=this.props.ServiceStore.cur_service,i=t("input_password"),o={securityKey:$e.MD5(i),iv:"1234567890123456"},c=this.decrypt(a.Config[r].current,o);"45d3161f8aa54588ab3901fa954cc01a"==c?(c="",this.replacePasswd(r,c),this.setState({checkVisible:!1,password_key:i},(function(){return n({input_password:""})}))):c?(this.replacePasswd(r,c),this.setState({checkVisible:!1,password_key:i},(function(){return n({input_password:""})}))):ie.Z.error("密码输入错误！请重新输入")}},{key:"encrypt",value:function(e,t){var n=$e.enc.Utf8.parse(t.securityKey),r=$e.enc.Utf8.parse(t.iv);return $e.AES.encrypt(e,n,{iv:r,mode:$e.mode.CBC,padding:$e.pad.Pkcs7}).toString()}},{key:"decrypt",value:function(e,t){var n=$e.enc.Utf8.parse(t.securityKey),r=$e.enc.Utf8.parse(t.iv);return $e.AES.decrypt(e,n,{iv:r,mode:$e.mode.CBC,padding:$e.pad.Pkcs7}).toString($e.enc.Utf8)}},{key:"saveHosts",value:function(){var e,t=this.state,n=t.changeHosts,r=t.linkIndex,a=t.linkName,i=this.props.ServiceStore.cur_service,o=this.props.actions.setServiceConfigModify,c=L()({},i.configModify),s={hosts:0!==n.length?i.Config[a].current[r].hosts.length>1?i.Config[a].current[r].hosts+","+n.join(","):n.join(","):i.Config[a].current[r].hosts,field:"string"==typeof i.Config[a].current[r]?i.Config[a].current[r]:i.Config[a].current[r].field};Ce()(e=i.Config[a].current).call(e,r,1,s),c["Config."+a+".current"]=i.Config[a].current,i.configModify=c,o(i),this.cancelLink()}},{key:"cancelLink",value:function(){this.setState({hostVisible:!1,linkIndex:null,linkName:""})}},{key:"filterHosts",value:function(e){var t=[];p()(e)&&Y()(e).call(e,(function(e,n){var r=e.hosts&&e.hosts.split(",");if(r&&r.length>=1)for(var a in r)""!==r[a]&&"string"==typeof r[a]&&t.push(r[a])})),this.disabledLink=t}},{key:"render",value:function(){var e=this,t=this.props.ServiceStore.cur_service,n=(void 0===t?{}:t).Config,r=this.state,a=r.checkVisible,i=r.hostsList,o=r.hostVisible,c=r.changeHosts,s=this.props.form,l=s.getFieldDecorator,u=s.setFieldsValue,d=this.disabledLink;return n?te.createElement("div",{className:"edit-panel config-box"},te.createElement(Ue.Z,null,this.buildConfigEditByNode(n)),te.createElement(se.Z,{visible:a,title:"解锁提醒",onOk:function(){return e.checkPassWord()},onCancel:function(){return e.setState({checkVisible:!1},(function(){return u({input_password:""})}))},okText:"确认",cancelText:"取消"},te.createElement("form",{action:"",autoComplete:"off"},te.createElement(st,(0,N.Z)({},nt,{label:"解锁密码"}),l("input_password",{})(te.createElement(Le.Z,{type:"password",autoComplete:"off"}))))),te.createElement(se.Z,{title:"关联主机",className:"linkhosts-modal",visible:o,onOk:function(){return e.saveHosts()},onCancel:function(){return e.cancelLink()}},te.createElement("div",{className:"linkhosts-title"},te.createElement(oe.Z,{type:"info-circle",theme:"filled",style:{marginRight:"5px",color:"#3f87ff",verticalAlign:"middle"}}),te.createElement("span",null,"已关联的主机需要删除后才能再次关联")),te.createElement("div",{className:"linkhosts-content"},te.createElement(Xe.Z.Group,{onChange:this.onChangeHosts,style:{width:"100%"},value:c},te.createElement(qe.Z,null,i&&Y()(i).call(i,(function(e,t){return d&&Se()(d).call(d,(function(t){return t===e}))>-1?te.createElement(et.Z,{span:8,key:t},te.createElement(Xe.Z,{value:e,disabled:!0,style:{marginBottom:"20px"}},e)):te.createElement(et.Z,{span:8,key:t},te.createElement(Xe.Z,{value:e,style:{marginBottom:"20px"}},e))}))))))):te.createElement("div",{className:"edit-panel config-box"},te.createElement("p",{style:{lineHeight:"20px"}},"无"))}}]),n}(te.Component))||Je;const ut=Ue.Z.create()(lt);var dt,pt=n(19623),ft=n(59314),mt=n(51298),vt=n(45334);function ht(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,O.Z)(e);if(t){var i=(0,O.Z)(this).constructor;n=a()(r,arguments,i)}else n=r.apply(this,arguments);return(0,T.Z)(this,n)}}var gt=se.Z.confirm,_t=Ue.Z.Item,yt={download:"下载"},St={RUNNING:"active",FAIL:"exception",SUCCESS:"success"},Zt=(0,Q.$j)((function(e){return{ServiceStore:e.ServiceStore}}),(function(e){return{actions:(0,ee.DE)(L()({},X),e)}}))(dt=function(e){(0,D.Z)(r,e);var t=ht(r);function r(e){var n;return(0,H.Z)(this,r),n=t.call(this,e),(0,F.Z)((0,R.Z)(n),"processInterval",null),n.state={default_input_value:"",has_config_value:!1,checkVisible:!1,key:{},statusVisible:!1,statusDetail:{},currentOperate:"",currentOperateSwitch:{},service_name:"",product_name:"",product_version:""},n}return(0,A.Z)(r,[{key:"componentWillUnmount",value:function(){this.processInterval&&clearInterval(this.processInterval)}},{key:"handleSwitchExtension",value:function(e){var t,n,r,a=this.props,i=a.sname,o=a.pname;window.location.href=B()(t=B()(n=B()(r="/api/v2/product/".concat(o,"/service/")).call(r,i,"/extention_operation?type=")).call(n,e.Type,"&value=")).call(t,e.Value)}},{key:"handleSwitch",value:function(e,t){var n=this,r=this.props,a=r.sname,i=r.pname;e.name=t,this.setState({currentOperateSwitch:t}),ue.BZ.getSwitchRecord({product_name:i,service_name:a,name:t}).then((function(r){var o=r.data;0===o.code&&(o&&o.data&&o.data.record_id?(n.setState({statusVisible:!0}),n.getSwitchDetail(o.data.record_id)):(e.name=t,e.sname=a,e.pname=i,n.handleSwitchConfirm(e)))}))}},{key:"handleSwitchConfirm",value:function(e){var t,n=e.IsOn,r=this;gt({title:"确定".concat(n?"关闭":"开启","Nginx吗？"),icon:te.createElement(oe.Z,{type:"exclamation-circle",theme:"filled"}),content:B()(t="Nginx".concat(n?"关闭":"开启","后，默认重启服务，确定")).call(t,n?"关闭":"开启","吗？"),onOk:function(){r.operateSwitch(e)}})}},{key:"operateSwitch",value:function(e){var t=this,n=this.props,r=n.pversion,a=n.pname,i=n.sname;ue.BZ.operateSwitch({product_name:a,service_name:i,name:e.name,type:e.IsOn?"off":"on",product_version:r}).then((function(e){var n=e.data;0===n.code&&n.data&&n.data.record_id&&(t.setState({statusVisible:!0,statusDetail:{}}),t.getSwitchDetail(n.data.record_id))}))}},{key:"getSwitchDetail",value:function(e){var t=this,n=this.props,r=n.sname,a=n.pname;ue.BZ.getSwitchDetail({product_name:a,service_name:r,record_id:e}).then((function(n){var r=n.data;0===r.code&&(r.data&&"RUNNING"===r.data.status?(t.setState({statusDetail:r.data}),t.processInterval||(t.processInterval=J()((function(){return t.getSwitchDetail(e)}),5e3))):(t.setState({statusDetail:r.data}),t.processInterval&&clearInterval(t.processInterval),t.processInterval=null,"SUCCESS"===r.data.status&&t.props.updateServiceConfig()))}))}},{key:"buildInstanceEditByNode",value:function(e,t,n){var r=this,a=t+1,i=m()(e),o=Se()(i).call(i,(function(e){return"environment"===e}));return-1!==o&&(Ce()(i).call(i,o,1),i.push("environment")),Y()(i).call(i,(function(i,o){var c=n?n+"."+i:i;if("object"===(0,pt.Z)(e[i])){if("Switch"!=i)return r.buildInstanceEditByNode(e[i],a,c);for(var s in e[i]){var l,u,d,p;return te.createElement(_t,(0,N.Z)({label:s},tt),te.createElement(_t,{key:i+"-"+s,style:{display:"inline-block"}},te.createElement(ft.Z,{checked:e[i].Nginx.IsOn,onClick:q()(l=r.handleSwitch).call(l,r,e[i].Nginx,"Nginx")})),e[i].Nginx.IsOn&&te.createElement("a",{style:{marginLeft:"5px"},onClick:q()(u=r.handleSwitchExtension).call(u,r,e[i].Nginx.Extention)},yt[null===(d=e[i].Nginx.Extention)||void 0===d?void 0:d.Type]," ",null===(p=e[i].Nginx.Extention)||void 0===p?void 0:p.Value))}}else{if("MaxReplica"===i||"StartAfterInstall"===i)return te.createElement(_t,(0,N.Z)({},tt,{label:c,key:i+"-"+t}),te.createElement("span",null,e[i]));if("UseCloud"!==i){var f,m,v,h=te.createElement("i",{className:"emicon emicon-undo",style:{fontSize:14}}),g=c.length>20?te.createElement(Ve.Z,{title:c},z()(c).call(c,0,20),"..."):c;"environment"===n&&(g=te.createElement("span",null,te.createElement("i",{className:"emicon emicon-env mr-8",style:{position:"absolute",left:"-52px",fontSize:44,color:"#00a755"}}),g));var _=mt.Z.Paragraph,y=te.createElement(Ve.Z,{trigger:0===e[i].length?"focus":"hover",arrowPointAtCenter:!0,title:function(){return te.createElement(_,{copyable:!0,style:{color:"#fff"}},e[i])}},te.createElement("div",null,te.createElement(Le.Z,{defaultValue:e[i],style:{width:400},value:e[i].length>40?z()(f=e[i]).call(f,0,40)+"...":e[i],className:"c-paramConfig__ant-input",disabled:!0,addonAfter:h,onChange:q()(m=r.handleInputChange).call(m,r,c),onFocus:q()(v=r.handleInputFocus).call(v,r,c)})));return te.createElement(_t,(0,N.Z)({},tt,{label:g,key:i+"-"+t}),y)}}}))}},{key:"renderIcon",value:function(e){var t,n;return this.props.ServiceStore.cur_service.Config[e.config].iconType?te.createElement(oe.Z,{type:"unlock",theme:"filled",style:{fontSize:20,marginLeft:"20px"},onClick:q()(t=this.closeKey).call(t,this,e.config)}):te.createElement(oe.Z,{type:"lock",theme:"filled",style:{fontSize:20,cursor:"pointer",marginLeft:"20px"},onClick:q()(n=this.saveKey).call(n,this,e.config)})}},{key:"saveKey",value:function(e){this.setState({checkVisible:!0,key:e})}},{key:"closeKey",value:function(e){var t=this.props.ServiceStore.cur_service,n=(0,this.props.form.getFieldValue)("input_password"),r={securityKey:$e.MD5(n),iv:"1234567890123456"},a=this.encrypt(t.Config[e].current,r),i=this.props.actions.setServiceConfigModify,o=L()({},t.Config);o[e].current=a,o[e].iconType=0,t.Config=o,i(t)}},{key:"encrypt",value:function(e,t){var n=$e.enc.Utf8.parse(t.securityKey),r=$e.enc.Utf8.parse(t.iv);return $e.AES.encrypt(e,n,{iv:r,mode:$e.mode.CBC,padding:$e.pad.Pkcs7}).toString()}},{key:"decrypt",value:function(e,t){var n=$e.enc.Utf8.parse(t.securityKey),r=$e.enc.Utf8.parse(t.iv);return $e.AES.decrypt(e,n,{iv:r,mode:$e.mode.CBC,padding:$e.pad.Pkcs7}).toString($e.enc.Utf8)}},{key:"handleInputChange",value:function(e,t){var n=this.props.ServiceStore.cur_service,r=this.props.actions.setServiceConfigModify,a=L()({},n.configModify);a["Instance."+e]=t.target.value,Ie()(e).call(e,".")>-1?n.Instance[e.split(".")[0]][e.split(".")[1]]=t.target.value:n.Instance[e]=t.target.value,n.configModify=a,r(n)}},{key:"handleInputFocus",value:function(e,t){this.setState({default_input_value:t.target.value})}},{key:"handleReloadConfig",value:function(e,t){var n=this;se.Z.confirm({title:"确认恢复此字段的默认值吗？",icon:te.createElement(oe.Z,{type:"exclamation-circle",theme:"filled"}),okType:"danger",onOk:function(){var t=n.props,r=t.sname,a=t.pname,i=t.pid,o=t.pversion;n.props.actions.resetServiceConfig({product_name:a,service_name:r,pid:i,product_version:o,field_path:"Instance."+e})}})}},{key:"checkPassWord",value:function(){var e=this.props.form.getFieldValue,t=this.state.key,n=this.props.ServiceStore.cur_service,r=e("input_password"),a={securityKey:$e.MD5(r),iv:"1234567890123456"},i=this.decrypt(n.Config[t].current,a);i||"Qve2w+9noccWGql7x32JQg=="==n.Config[t].current?(this.replacePasswd(t,i),this.setState({checkVisible:!1})):ie.Z.error("密码输入错误！请重新输入")}},{key:"replacePasswd",value:function(e,t){var n=this.props.ServiceStore.cur_service,r=this.props.actions.setServiceConfigModify,a=L()({},n.Config);a[e].current=t,a[e].iconType=1,n.Config=a,r(n)}},{key:"render",value:function(){var e=this,t=this.props.ServiceStore.cur_service.Instance,r=this.state,a=r.checkVisible,i=r.statusVisible,o=r.statusDetail,c=r.currentOperateSwitch,s=this.props.form.getFieldDecorator;return t?te.createElement("div",{className:"edit-panel config-box",style:t.UseCloud?{display:"none"}:{display:"block"}},"{}"!==Pe()(t)?te.createElement(Ue.Z,null,this.buildInstanceEditByNode(t,1)):te.createElement("p",{style:{lineHeight:"20px"}},"无"),te.createElement(se.Z,{title:"".concat("off"===o.switch_type?"关闭":"开启","Nginx"),visible:i,onOk:function(){return e.setState({statusVisible:!1})},onCancel:function(){return e.setState({statusVisible:!1})},okText:"确认",cancelText:"取消",bodyStyle:{padding:0}},"RUNNING"==o.status&&te.createElement("div",{className:"config-tips"},te.createElement(oe.Z,{style:{color:"#3F87FF"},type:"exclamation-circle",theme:"filled"}),te.createElement("span",{style:{marginLeft:"8px"}},"关闭窗口后，进行中的任务将在后台运行")),"SUCCESS"!==o.status&&te.createElement("div",{className:"config-progress",style:{width:"FAIL"==o.status?"350px":"325px"}},te.createElement("span",{style:{marginRight:"8px"}},"FAIL"==o.status?"".concat("off"===o.switch_type?"关闭":"开启","失败"):"".concat("off"===o.switch_type?"关闭":"开启","中")),te.createElement(vt.Z,{style:{width:"267px"},percent:o.progress,status:St[o.status]}),"FAIL"==o.status&&te.createElement("span",{style:{color:"#3F87FF",cursor:"pointer"},onClick:function(){return e.operateSwitch(c)}},"重试")),"SUCCESS"!==o.status&&te.createElement("div",{style:{lineHeight:"32px",height:"86px",overflow:"scroll",whiteSpace:"pre-wrap",padding:"0 83px",marginBottom:"28px",overflowX:"hidden"}},o.status_message),"SUCCESS"===o.status&&te.createElement("div",{style:{padding:"24px 177px 28px",textAlign:"center"}},te.createElement("img",{src:n(8842),style:{display:"block",margin:"0 auto",width:"80px",height:"80px"}}),te.createElement("div",{style:{marginTop:"24px",lineHeight:"28px",fontSize:"20px"}},"Nginx","off"===o.switch_type?"关闭":"开启","成功"))),te.createElement(se.Z,{visible:a,title:"解锁提醒",onOk:function(){return e.checkPassWord()},onCancel:function(){return e.setState({checkVisible:!1})},okText:"确认",cancelText:"取消"},te.createElement("form",{action:"",autoComplete:"off"},te.createElement(_t,(0,N.Z)({},nt,{label:"解锁密码"}),s("input_password",{})(te.createElement(Le.Z,{type:"password",autoComplete:"off"})))))):te.createElement("div",{className:"edit-panel config-box",style:{display:"none"}},te.createElement("p",{style:{lineHeight:"20px"}},"无"))}}]),r}(te.Component))||dt;const Ct=Ue.Z.create()(Zt);var Et=n(77268),kt=Me.Z.Option;const bt=function(e){var t,n,r,a,i,o,c,s,l=e.cur_service,u=e.configFile,d=e.handleFileChange,p=e.isRestart,f=e.handleRestartServiceInTurn,m=e.couldSaveConfig,v=e.handleSaveServiceConfig,h=e.distributeServiceConfig,g=e.handleAddParamConfigShow,_=e.handleResetServiceConfig,y=e.isKubernetes;return te.createElement(qe.Z,{className:"c-paramConfig-toolbar"},te.createElement(et.Z,{span:8,style:{display:"flex",alignItems:"center"}},"配置文件：",te.createElement(Me.Z,{placeholder:"请选择配置文件",value:null!=l&&null!==(t=l.Instance)&&void 0!==t&&t.ConfigPaths?u:void 0,style:{width:"264px",marginRight:"-50px"},onChange:d},(null==l||null===(n=l.Instance)||void 0===n?void 0:n.ConfigPaths)&&te.createElement(kt,{value:"all"},"全部"),Y()(r=(null==l||null===(a=l.Instance)||void 0===a?void 0:a.ConfigPaths)||[]).call(r,(function(e){return te.createElement(kt,{key:e,value:e},e)})))),te.createElement(Et.Z,{disabled:!m,type:"primary",style:{marginRight:10},icon:"save",onClick:v},"保存"),te.createElement(Et.Z,{disabled:!m,type:"default",icon:"redo",className:m?"c-paramConfig-toolbar__btn":null,onClick:_,style:{marginRight:10}},"重置"),te.createElement(Et.Z,{disabled:!!m||!(null!=l&&null!==(i=l.Instance)&&void 0!==i&&i.ConfigPaths)||!(null!=l&&null!==(o=l.Instance)&&void 0!==o&&o.ConfigPaths.length),type:"primary",icon:"plus",style:{marginRight:10},onClick:function(){return g(!0)}},"添加参数"),!y&&de.get("em_current_cluster_id")&&te.createElement(te.Fragment,null,te.createElement(Et.Z,{type:"primary",ghost:!0,onClick:h,style:{marginRight:10},disabled:!(null!=l&&null!==(c=l.Instance)&&void 0!==c&&null!==(s=c.ConfigPaths)&&void 0!==s&&s.length)||m,icon:"setting"},"配置下发"),te.createElement(Et.Z,{type:"default",className:p?"":"c-paramConfig-toolbar__btn",disabled:p,loading:p,onClick:f},!p&&te.createElement("i",{className:"emicon emicon-poweroff",style:{lineHeight:"12px",verticalAlign:"-2px",marginRight:5}}),"滚动重启")))};var wt=n(90143),xt=n(64143),It=n(18446),Nt=n.n(It);function Pt(e,t){var n=void 0!==s()&&u()(e)||e["@@iterator"];if(!n){if(p()(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return Ht(e,t);var r=z()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return o()(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ht(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,i=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw i}}}}function Ht(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function At(e,t){var n=m()(e);if(h()){var r=h()(e);t&&(r=_()(r).call(r,(function(t){return S()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Rt(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?C()(n=At(Object(a),!0)).call(n,(function(t){(0,F.Z)(e,t,a[t])})):k()?w()(e,k()(a)):C()(r=At(Object(a))).call(r,(function(t){I()(e,t,S()(a,t))}))}return e}function Dt(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,O.Z)(e);if(t){var i=(0,O.Z)(this).constructor;n=a()(r,arguments,i)}else n=r.apply(this,arguments);return(0,T.Z)(this,n)}}var Tt=Fe.Z.Panel,Ot=se.Z.confirm,Ft=Me.Z.Option,Mt=function(e){(0,D.Z)(n,e);var t=Dt(n);function n(){var e,r;(0,H.Z)(this,n);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=t.call.apply(t,B()(e=[this]).call(e,i)),(0,F.Z)((0,R.Z)(r),"state",{dropList:[],currentConfigFile:"",currentDiffFile:"",fileContent:"",oldParamArray:[],newValue:"",newAddParamArray:[],deleteConfig:"",configQuery:"",noHosts:"",visibleConfigInfo:!1,visibleConfig:!1,repeatParams:[],allHostList:[],currentHosts:[],diffData:{before:"",after:""},selectHost:"",encryptInfo:{}}),(0,F.Z)((0,R.Z)(r),"getConfigFile",(function(){var e=r.props,t=e.cur_service_info.service_name,n=e.ServiceStore,a=n.cur_product,i=a.product_name,o=a.product_version,c=n.configFile;t&&i&&o&&ue.BZ.getParamDropList({productName:i,productVersion:o,serviceName:t}).then((function(e){var t,n,a=(null===(t=e=e.data)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.list)||[],i=("all"===c?void 0:c)||a[0]||"";r.setState({dropList:a,currentConfigFile:i,currentDiffFile:i,fileContent:""}),a.length&&r.handleConfigFileClick(i)}))})),(0,F.Z)((0,R.Z)(r),"getServiceInfo",(function(){var e=r.props,t=e.cur_service_info,n=e.cur_product_info;(0,r.props.actions.getHostsList)({product_name:null==n?void 0:n.product_name,service_name:null==t?void 0:t.service_name,namespace:xt.Z.k8sNamespace},(function(e,t){var n=Y()(t).call(t,(function(e){return e.ip}));r.setState({currentHosts:n,selectHost:n[0]})}))})),(0,F.Z)((0,R.Z)(r),"getPublicKey",(0,pe.Z)(me().mark((function e(){var t,n;return me().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ue.bS.getPublicKey();case 2:if(t=e.sent,0===(n=t.data).code){e.next=6;break}return e.abrupt("return");case 6:r.setState({encryptInfo:n.data});case 7:case"end":return e.stop()}}),e)})))),(0,F.Z)((0,R.Z)(r),"handleConfigFileClick",(function(e){r.setState({currentConfigFile:e},(function(){r.getParamContent(e)}))})),(0,F.Z)((0,R.Z)(r),"handleDiffFileClick",(function(e){r.setState({currentDiffFile:e},(function(){r.state.visibleConfig&&r.getConfDiff()}))})),(0,F.Z)((0,R.Z)(r),"getParamContent",(function(e){var t=r.props,n=t.cur_service_info,a=t.ServiceStore.cur_product;ue.BZ.getParamContent({productName:a.product_name,productVersion:a.product_version,serviceName:n.service_name,servicePath:e}).then((function(t){r.handleFileChange(e);var n=t.data.data,a=r.getParamArray(n);r.setState({fileContent:n,oldParamArray:a})}))})),(0,F.Z)((0,R.Z)(r),"getParamArray",(function(e){for(var t=/{{\.(\w+)}}/gm,n=t.exec(e),r=[];null!==n;)n.index===t.lastIndex&&t.lastIndex++,C()(n).call(n,(function(e,t){1===t&&r.push(e)})),n=t.exec(e);return r=o()(new(he())(r))})),(0,F.Z)((0,R.Z)(r),"handleFocusOut",(function(e,t){var n=r.state.oldParamArray,a=[],i=r.getParamArray(e);C()(n).call(n,(function(e){if(_e()(i).call(i,e)){var t=Se()(i).call(i,(function(t){return t===e}));Ce()(i).call(i,t,1)}else a.push(e)})),r.setState({newValue:e,fileContent:e,newAddParamArray:i,deleteConfig:a.toString()})})),(0,F.Z)((0,R.Z)(r),"handleSetParamSubmit",(function(){var e={},t=r.props,n=t.ServiceStore.cur_product,a=t.cur_service_info,i=t.actions,o=r.state,c=o.newAddParamArray,s=void 0===c?[]:c,l=o.currentConfigFile,u=o.newValue,d=o.deleteConfig;C()(s).call(s,(function(t){var n=document.getElementById(t);e["".concat(t)]=n.value}));var p={file:l,content:u,values:e,deleted:d};ue.BZ.setParamUpdate({productName:null==n?void 0:n.product_name,productVersion:null==n?void 0:n.product_version,serviceName:null==a?void 0:a.service_name},p).then((function(e){0===e.data.code?(ie.Z.success("添加参数成功！"),r.setState({newAddParamArray:[],visibleConfigInfo:!1},(function(){r.getConfigFile()})),i.refreshProductAndService({product_name:n.product_name,product_version:n.product_version,service_name:a.service_name})):ie.Z.error(e.data.msg)}))})),(0,F.Z)((0,R.Z)(r),"onCloseModal",(function(){r.setState({newAddParamArray:[]}),r.handleAddParamConfigShow(!1)})),(0,F.Z)((0,R.Z)(r),"getConfDiff",(function(){var e=r.props,t=e.ServiceStore.cur_product,n=e.cur_service_info,a=r.state,i=a.selectHost,o={file:a.currentDiffFile,ip:i||"",product_name:t.product_name,product_version:t.product_version,service_name:n.service_name};ue.BZ.getConfDiff(o).then((function(e){var t=e.data,n=t.code,a=t.data,i=t.msg,o={before:"",after:""};0===n?o=Rt(Rt({},o),a):ie.Z.error(i),r.setState({diffData:o},(function(){}))}))})),(0,F.Z)((0,R.Z)(r),"handleServiceConfigSearch",(function(e){e.stopPropagation(),r.setState({configQuery:e.target.value})})),(0,F.Z)((0,R.Z)(r),"getCurrentHostsList",(function(){var e,t,n=r.props,a=n.cur_product_info,i=n.cur_service_info,o=n.HeaderStore.cur_parent_cluster,c=a.product_name,s=i.service_name;c&&s&&it.get(B()(e=B()(t="/api/v2/product/".concat(c,"/service/")).call(t,s,"/selected_hosts?clusterId=")).call(e,o.id),{}).then((function(e){0===(e=e.data).code?r.setState({allHostList:e.data.hosts},(function(){r.handleSaveMoreConfig()})):ie.Z.error(e.msg)}))})),(0,F.Z)((0,R.Z)(r),"handleSaveMoreConfig",(function(){var e,t,n=r.props,a=n.ServiceStore,i=n.cur_service_info,o=a.cur_product.product_name,c=a.cur_service,s="";ke()(e=m()(c.configModify)).call(e,(function(e){if(p()(c.configModify[e])){var t,n=Y()(t=c.configModify[e]).call(t,(function(e){return e.hosts})),a=r.state.allHostList,i=n.join(",").split(",");return!(!a||i.length!==a.length||!we()(a).call(a,(function(e){return-1!==Ie()(i).call(i,e)})))||(s=e.split(".")[1],!1)}return!0}))?Y()(t=m()(c.configModify)).call(t,(function(e){var t=(0,F.Z)({},e,c.configModify[e]);p()(c.configModify[e])?ue.BZ.modifyMultiAllHosts({product_name:o,service_name:i.service_name},t).then((function(t){var n;if(0===(t=t.data).code)delete c.configModify[e],r.changeHosts(),ie.Z.success("关联成功!");else if(100===t.code&&_e()(n=t.msg).call(n,"输入值重复")){var a,i=t.msg.substring(1,Ie()(a=t.msg).call(a,")")).split(",");r.setState({repeatParams:i,noHosts:""})}else ie.Z.error(t.msg)})):ue.BZ.modifyProductConfigAll({product_name:o,service_name:i.service_name},t).then((function(t){0===(t=t.data).code?(delete c.configModify[e],ie.Z.success("保存完成!"),r.setState({noHosts:""})):ie.Z.error(t.msg)})),"{}"===Pe()(c.configModify)&&(c.configModify={},r.setCurrentService(c,i.service_name))})):r.setState({noHosts:s})})),(0,F.Z)((0,R.Z)(r),"handleSaveServiceConfig",(function(){var e,t=r.props,n=t.authorityList,a=t.ServiceStore,i=t.cur_service_info;if(!xt.Z.noAuthorityToDO(n,"service_config_edit")){var o,c,s=a.cur_product.product_name,l=a.cur_service;if(we()(e=Ae()(l.configModify)).call(e,(function(e){return p()(e)})))if(we()(o=Ae()(l.configModify)).call(o,(function(e){return p()(e)&&we()(e).call(e,(function(e){return""===e.hosts}))})))we()(c=m()(l.configModify)).call(c,(function(e){var t;p()(l.configModify[e])&&we()(t=l.configModify[e]).call(t,(function(e){return""===e.hosts}))&&r.setState({noHosts:e.split(".")[1]})}));else r.changeHosts(),r.getCurrentHostsList();else ue.BZ.modifyProductConfigAll({product_name:s,service_name:i.service_name},l.configModify).then((function(e){0===(e=e.data).code&&(l.configModify={},r.setCurrentService(l,i.service_name),ie.Z.success("保存完成!"),r.changeHosts())}))}})),(0,F.Z)((0,R.Z)(r),"handleDiffHost",(function(e){r.setState({selectHost:e},(function(){r.getConfDiff()}))})),(0,F.Z)((0,R.Z)(r),"handleFileChange",(function(e){var t=r.props,n=t.ServiceStore.cur_product,a=t.cur_service_info.service_name,i=t.actions,o=n.product_name,c=n.product_version;o&&c&&a&&(i.getServiceConfigList({product_name:o,product_version:c,service_name:a,file:e}),i.setConfigFile(e))})),(0,F.Z)((0,R.Z)(r),"handleResetServiceConfig",(function(){var e=r.props,t=e.authorityList,n=e.ServiceStore,a=e.cur_service_info;if(!xt.Z.noAuthorityToDO(t,"service_config_edit")){var i=n.cur_product.product_name;if(i){var o={product_name:i};xt.Z.k8sNamespace&&(o.namespace=xt.Z.k8sNamespace),ue.BZ.getCurrentProduct(o).then((function(e){if(0===(e=e.data).code){var t={};for(var n in e.data.product.Service)a.service_name===n&&(t=e.data.product.Service[n]);r.setCurrentService(t,a.service_name),r.changeHosts()}else ie.Z.error(e.msg)}))}}})),(0,F.Z)((0,R.Z)(r),"setCurrentService",(function(e,t){var n=r.props.ServiceStore.cur_product;r.props.actions.setCurrentService(e,{product_name:n.product_name,service_name:t,product_version:n.product_version})})),(0,F.Z)((0,R.Z)(r),"handleAddParamConfigShow",(function(e){var t=r.props.authorityList;xt.Z.noAuthorityToDO(t,"service_config_edit")||r.setState({visibleConfigInfo:e})})),(0,F.Z)((0,R.Z)(r),"handleDispath",(function(){if(r.props.authorityList.service_config_distribute){var e=r.state.visibleConfig;e||r.getConfDiff(),r.setState({visibleConfig:!e})}else ie.Z.error("权限不足，请联系管理员！")})),(0,F.Z)((0,R.Z)(r),"distributeServiceConfig",(function(){var e=r.props,t=e.authorityList,n=e.ServiceStore,a=e.cur_service_info,i=r.state,o=i.visibleConfig,c=i.diffData;if(!xt.Z.noAuthorityToDO(t,"service_config_distribute")){var s=n.cur_product;o&&c.before!==c.after?Ot({title:"确定将运行配置下发至各主机吗？",icon:te.createElement(oe.Z,{type:"exclamation-circle",theme:"filled"}),className:"rollstart-comfirm-dialog",onOk:function(){ue._7.distributeServiceConfig({serviceName:a.service_name,productId:s.id}).then((function(e){0===e.data.code?ie.Z.success("配置下发成功！"):ie.Z.error("配置下发失败！")})),r.handleDispath()},onCancel:function(){}}):r.handleDispath()}})),(0,F.Z)((0,R.Z)(r),"changeHosts",(function(){r.setState({noHosts:"",repeatParams:[]})})),(0,F.Z)((0,R.Z)(r),"handleRestartServiceInTurn",(function(){var e=r.props,t=e.authorityList,n=e.ServiceStore.cur_product,a=e.products,i=e.cur_service_info,o=e.actions;if(!xt.Z.noAuthorityToDO(t,"service_roll_restart")){var c,s=-1,l=Pt(a);try{for(l.s();!(c=l.n()).done;){var u=c.value;u.product_name===n.product_name&&(s=u.id)}}catch(e){l.e(e)}finally{l.f()}Ot({title:"确定要滚动重启该服务下的所有主机吗？",content:"重启后最新的运行配置将生效。重启过程中会出现部分主机上服务暂时停止的情况，但服务整体将正常运行。",icon:te.createElement(oe.Z,{type:"exclamation-circle",theme:"filled"}),className:"rollstart-comfirm-dialog",onOk:function(){return o.setServiceRollRestartState(i.service_name,!0),new(De())((function(e,t){Oe()(e,500),ue.BZ.setServiceRollRestart({pid:s,service_name:i.service_name}).then((function(e){var t=e.data,n=t.code,r=t.msg;0===n?ie.Z.success("滚动重启完成"):ie.Z.success(r),o.setServiceRollRestartState(i.service_name,!1)})).catch((function(){ie.Z.success("重启完成"),o.setServiceRollRestartState(i.service_name,!1)}))}))},onCancel:function(){o.setServiceRollRestartState(i.service_name,!1)}})}})),r}return(0,A.Z)(n,[{key:"componentDidMount",value:function(){this.getConfigFile(),this.getServiceInfo(),this.getPublicKey()}},{key:"componentDidUpdate",value:function(e,t){Nt()(this.props.cur_service_info,e.cur_service_info)||(this.getConfigFile(),this.getServiceInfo())}},{key:"render",value:function(){var e,t,n,r,a,i,o=this,c=this.props,s=c.ServiceStore,l=s.cur_product,u=s.configFile,d=s.cur_service,p=c.HeaderStore,f=c.services,v=c.isKubernetes,h=c.cur_product_info,g=c.authorityList,_=c.getCurrentProduct,y=c.cur_service_info,S=this.state,Z=S.dropList,C=S.currentConfigFile,E=S.fileContent,k=S.visibleConfigInfo,b=S.currentDiffFile,w=S.visibleConfig,x=S.noHosts,I=S.currentHosts,N=S.configQuery,P=S.diffData,H=S.selectHost,A=S.repeatParams,R=S.encryptInfo,D=(null==d?void 0:d.configModify)&&m()(null==d?void 0:d.configModify).length,T=null;d&&null!=l&&null!==(e=l.product)&&void 0!==e&&null!==(t=e.Service[d.service_name])&&void 0!==t&&t.hosts&&(T=null==l||null===(i=l.product)||void 0===i?void 0:i.Service[d.service_name].isRestart);var O=g.service_config_edit,F=te.createElement("div",{className:"extra-sider"},te.createElement(Me.Z,{value:H,onChange:this.handleDiffHost,placeholder:"选择主机",size:"small"},Y()(I).call(I,(function(e){return te.createElement(Ft,{key:e},e)}))),te.createElement("h2",null,"配置文件"),te.createElement("ul",{className:"extra-ul",onClick:function(e){var t;return o.handleDiffFileClick(null===(t=e.target)||void 0===t?void 0:t.title)}},Y()(n=(null==d||null===(r=d.Instance)||void 0===r?void 0:r.ConfigPaths)||[]).call(n,(function(e,t){return te.createElement("li",{title:e,key:e,className:Be()("",{"extra-selected":e===b})},e)})))),M=te.createElement("div",{className:"run-setting"},"运行配置",te.createElement(Le.Z,{placeholder:"输入参数名称搜索",value:N,onClick:function(e){e.stopPropagation()},autoComplete:"off",onChange:this.handleServiceConfigSearch}));return te.createElement(te.Fragment,null,te.createElement("div",{style:{maxHeight:"calc(100vh - 180px)",overflowY:"auto"}},te.createElement(Fe.Z,{className:"ant-collapse-no-border box-shadow-style collapse-config",defaultActiveKey:["1"]},te.createElement(Tt,{key:"1",header:M},te.createElement(bt,{cur_service:d,configFile:u,handleFileChange:this.handleFileChange,isRestart:T,handleRestartServiceInTurn:this.handleRestartServiceInTurn,couldSaveConfig:D,handleSaveServiceConfig:this.handleSaveServiceConfig,distributeServiceConfig:this.handleDispath,handleAddParamConfigShow:this.handleAddParamConfigShow,handleResetServiceConfig:this.handleResetServiceConfig,isKubernetes:v}),!!y&&te.createElement(ut,{canEditHost:null==g?void 0:g.sub_menu_scheme_host_associated,canEditPwd:null==g?void 0:g.sub_menu_scheme_password_lock,canReset:null==g?void 0:g.reset_service_config_edit,sname:y.service_name,pname:h.product_name,query:N,pid:h.product_id,HeaderStore:p,pversion:h.product_version,noEditAuthority:!O,noHosts:x,changeHosts:this.changeHosts,isKubernetes:v,repeatParams:A,encryptInfo:R})),te.createElement(Tt,{header:"部署配置",key:"2"},y?te.createElement(Ct,{sname:y.service_name,pname:h.product_name,pid:h.product_id,pversion:h.product_version,updateServiceConfig:function(){return _(h.product_name,h.product_version,!0)}}):null),te.createElement(Tt,{header:"依赖组件",key:"3"},y&&f&&null!==(a=f[y.service_name])&&void 0!==a&&a.DependsOn?f[y.service_name].DependsOn.join(","):"无"))),k&&te.createElement(We,{visible:k,onCancel:this.onCloseModal,handleSetParamSubmit:this.handleSetParamSubmit,dropList:Z,onChange:this.handleConfigFileClick,value:C,fileContent:E,handleContentChange:this.handleFocusOut,newAddParamArray:this.state.newAddParamArray}),w&&te.createElement(wt.Z,{visible:w,title:"配置下发（请确认变更前后的配置，若配置前后无变化，则无需重启服务）",extra:F,data:[P.before,P.after],handleCancle:this.handleDispath,handleSubmit:this.distributeServiceConfig}))}}]),n}(te.PureComponent);const Lt=function(e){var t=e.visible,n=e.autoTestInfo,r=e.autoTestMsg,a=e.handleTest,i=e.handleClose;return te.createElement(se.Z,{title:"自动化测试",footer:null,visible:t,onCancel:i},te.createElement("div",{className:"auto-smoke"},te.createElement("div",null,"点击按钮开始自动化测试",te.createElement(Et.Z,{type:"primary",style:{marginLeft:20},disabled:1===n.exec_status,onClick:a},"开始测试"),1===n.exec_status&&te.createElement(Et.Z,{type:"link",loading:!0},"运行中")),te.createElement("p",null,"最近一次运行时间：",n.end_time||"--"),te.createElement("p",null,"查看报告：",!(null!=n&&n.exec_status)&&"--",3===n.exec_status&&te.createElement("span",{className:"error"},"运行失败"),n.report_url&&2===n.exec_status&&te.createElement("a",{href:n.report_url,target:"_blank"},"测试报告")),3===n.exec_status&&r&&te.createElement("div",{className:"exec-error-log"},"错误日志：",te.createElement("code",null,r))))};function Kt(e,t){var n=void 0!==s()&&u()(e)||e["@@iterator"];if(!n){if(p()(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return Bt(e,t);var r=z()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return o()(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Bt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,i=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw i}}}}function Bt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Vt(e,t){var n=m()(e);if(h()){var r=h()(e);t&&(r=_()(r).call(r,(function(t){return S()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ut(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?C()(n=Vt(Object(a),!0)).call(n,(function(t){(0,F.Z)(e,t,a[t])})):k()?w()(e,k()(a)):C()(r=Vt(Object(a))).call(r,(function(t){I()(e,t,S()(a,t))}))}return e}function jt(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,O.Z)(e);if(t){var i=(0,O.Z)(this).constructor;n=a()(r,arguments,i)}else n=r.apply(this,arguments);return(0,T.Z)(this,n)}}var zt=re.Z.Sider,Gt=ne.Z.SubMenu,Yt=function(e){(0,D.Z)(n,e);var t=jt(n);function n(){var e,r;(0,H.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return r=t.call.apply(t,B()(e=[this]).call(e,i)),(0,F.Z)((0,R.Z)(r),"timeInterval",void 0),(0,F.Z)((0,R.Z)(r),"state",{openKeys:["f0"],selectedKeys:["sub0_0"],visible:!1,smokeInfo:{},smokeMsg:""}),(0,F.Z)((0,R.Z)(r),"handleSelectProduct",(function(e){var t=r.props.products,n=t[e.key].product_name,a=t[e.key].product_version;""!==n&&ue.BZ.getCurrentProduct({product_name:n}).then((function(e){0===(e=e.data).code?(de.set("em_product_name",e.data.product_name),de.set("em_product_id",e.data.id),r.props.actions.setCurrentProduct(e.data),r.props.actions.getServiceGroup({product_name:n},(function(t,i,o){r.props.setSideNavState({cur_product_info:{product_id:e.data.id,product_name:n,product_version:a},services:e.data.product.Service,cur_service:t,menuKey:{selectedKeys:o,openKeys:(0,P.Z)(i)}}),r.props.handleSwitchService(t,n),r.props.setCurrentService(e.data.product.Service[t.service_name],t.service_name)}),"",{cloud:!0})):ie.Z.error(e.msg)}))})),(0,F.Z)((0,R.Z)(r),"handleUseOption",(function(e){"2"!=e.key?r.handleSelectSSOption(e):r.handleToggle()})),(0,F.Z)((0,R.Z)(r),"handleToggle",(function(){var e=r.state,t=e.smokeMsg,n=e.visible;n?t="":(clearTimeout(r.timeInterval),r.getAutoTestStatus()),r.setState({visible:!n,smokeMsg:t})})),(0,F.Z)((0,R.Z)(r),"getAutoTestStatus",(function(){var e=r.props,t=e.cur_product_info,n=e.HeaderStore.cur_parent_cluster,a={product_name:null==t?void 0:t.product_name,cluster_id:null==n?void 0:n.id};a.product_name&&ue.BZ.getAutoTestStatus(a).then((function(e){var t=e.data,n=t.code,a=t.data;0===n&&r.setState({smokeInfo:a},(function(){r.timeInterval=Oe()((function(){r.getAutoTestStatus()}),5e3)}))}))})),(0,F.Z)((0,R.Z)(r),"handleTest",(function(){var e=r.props,t=e.cur_product_info,n=e.HeaderStore.cur_parent_cluster,a=r.state.smokeInfo,i={product_name:null==t?void 0:t.product_name,cluster_id:null==n?void 0:n.id};r.setState({smokeInfo:Ut(Ut({},a),{},{exec_status:1})},(function(){ue.BZ.startAutoTestTest(i).then((function(e){var t=e.data,n=t.code,i=t.msg;0!=n?(a.exec_status=3,r.setState({smokeInfo:a,smokeMsg:i})):(clearTimeout(r.timeInterval),r.getAutoTestStatus())}))}))})),(0,F.Z)((0,R.Z)(r),"handleSelectSSOption",(function(e){var t=(0,R.Z)(r),n=r.props,a=n.products,i=n.cur_product_info,o=i.product_name,c=i.product_version,s=n.authorityList;if(!xt.Z.noAuthorityToDO(s,"service_product_start_stop")){var l,u=-1,d=Kt(a);try{for(d.s();!(l=d.n()).done;){var p=l.value;p.product_name===o&&(u=p.id)}}catch(e){d.e(e)}finally{d.f()}var f=te.createElement("div",null,te.createElement("p",null,"1. 为防止误操作停止，若配置了监控告警，平台将正常发送告警；"),te.createElement("p",null,"2. 组件停止后，若服务器发生断电恢复的情况，服务将自动重启；"),te.createElement("p",null,"3. 可通过点击“启动”按钮恢复组件服务。")),m=se.Z.confirm({title:"0"===e.key?"停止组件将停止其下所有服务，请注意并谨慎操作：":"启动该组件的所有服务吗？",content:"0"===e.key?f:"",okType:"0"===e.key?"danger":"primary",icon:te.createElement(oe.Z,{type:"exclamation-circle",theme:"filled"}),okText:"0"===e.key?"停止":"启动",className:"ss-confirm-modal",width:"0"===e.key?550:416,onOk:function(){return"0"===e.key?(m.update({content:te.createElement("p",null,o,"服务正在停止中，请耐心等待..."),cancelButtonProps:{disabled:!0}}),ue.BZ.stopAllServiceByProduct({pid:u}).then((function(e){0===(e=e.data).code?(t.props.getCurrentProduct(o,c),t.props.getRestartService()):(ie.Z.error(e.msg),m.destroy())})).catch((function(){m.destroy()}))):(m.update({content:te.createElement("p",null,o,"服务正在启动中，请耐心等待..."),cancelButtonProps:{disabled:!0}}),ue.BZ.startAllServiceByProduct({pid:u}).then((function(e){0===(e=e.data).code?(t.props.getCurrentProduct(o,c),t.props.getRestartService()):(ie.Z.error(e.msg),m.destroy())})).catch((function(){m.destroy()})))}})}})),(0,F.Z)((0,R.Z)(r),"handleMenuOpenChange",(function(e){r.setState({openKeys:e},(function(){r.props.setSideNavState({menuKey:{selectedKeys:r.state.selectedKeys,openKeys:e}})}))})),r}return(0,A.Z)(n,[{key:"componentDidUpdate",value:function(e,t){var n,r,a,i,o=+localStorage.getItem("em_role_id")||1;(Nt()(this.props.cur_product_info,e.cur_product_info)||3===o||(clearTimeout(this.timeInterval),this.getAutoTestStatus()),Nt()(null===(n=this.props.menuKey)||void 0===n?void 0:n.openKeys,null==t?void 0:t.openKeys)&&Nt()(null===(r=this.props.menuKey)||void 0===r?void 0:r.selectedKeys,null==t?void 0:t.selectedKeys))||this.setState({openKeys:null===(a=this.props.menuKey)||void 0===a?void 0:a.openKeys,selectedKeys:null===(i=this.props.menuKey)||void 0===i?void 0:i.selectedKeys})}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timeInterval)}},{key:"handleChangeService",value:function(e){var t=this.props.cur_product_info.product_name,n=[];for(var r in this.props.ServiceStore.services)n.push({name:r,sub:this.props.ServiceStore.services[r]});var a=e.key.substr(3).split("_");this.props.handleSwitchService(n[a[0]].sub[a[1]],t),this.props.setSideNavState({cur_service:n[a[0]].sub[a[1]],menuKey:{selectedKeys:[e.key],openKeys:this.state.openKeys}}),this.setState({selectedKeys:[e.key]})}},{key:"render",value:function(){var e,t=this.props,n=t.products,r=t.cur_product_info,a=t.isKubernetes,i=t.ServiceStore,o=this.state,c=o.openKeys,s=o.selectedKeys,l=o.visible,u=o.smokeInfo,d=o.smokeMsg,p=te.createElement(ne.Z,{onClick:this.handleSelectProduct},Y()(n).call(n,(function(e,t){return te.createElement(ne.Z.Item,{key:t},e.product_name)}))),f=te.createElement(ne.Z,{onClick:this.handleUseOption},te.createElement(ne.Z.Item,{key:"0"},"停止"),te.createElement(ne.Z.Item,{key:"1"},"启动"),(null==u?void 0:u.auto_test)&&te.createElement(ne.Z.Divider,null),(null==u?void 0:u.auto_test)&&te.createElement(ne.Z.Item,{key:"2"},"自动化测试",1===(null==u?void 0:u.exec_status)&&te.createElement(oe.Z,{type:"loading",style:{marginLeft:10}}))),m=[];for(var v in i.services)m.push({name:v,sub:i.services[v]});return te.createElement(zt,{width:240,className:"box-shadow-style",style:{marginBottom:20,minHeight:document.body.clientHeight-88-40,overflow:"hidden"}},te.createElement("div",{className:"side-product"},te.createElement("div",{className:"product-filter-wrapper clearfix"},te.createElement(ce.Z,{overlayClassName:"dt-em-dropdown-light service-dt-em-dropdown-black",overlay:p,trigger:["click"]},te.createElement("a",{className:"ant-dropdown-link",href:"#"},r.product_name," ",te.createElement(oe.Z,{type:"down"}))),!a&&te.createElement(ce.Z,{overlayClassName:"dt-em-dropdown-light service-dt-em-dropdown-setting",overlay:f,trigger:["click"]},te.createElement("a",{className:"fl-r",style:{color:"#3f87ff"},onClick:function(e){return e.preventDefault()}},te.createElement(oe.Z,{type:"setting"}))))),te.createElement(ne.Z,{className:"c-sidenav__menu",mode:"inline",theme:"light",selectedKeys:s,openKeys:c,onOpenChange:this.handleMenuOpenChange,onClick:q()(e=this.handleChangeService).call(e,this)},m.length>1?Y()(m).call(m,(function(e,t){var n;return te.createElement(Gt,{key:"f"+t,title:te.createElement("span",null,e.name)},Y()(n=e.sub).call(n,(function(e,n){var r=i.cur_product.product.Service[e.service_name];return te.createElement(ne.Z.Item,{key:"sub"+t+"_"+n},te.createElement("i",{className:"dot-cls",style:e.alert?{display:"inline-block"}:{display:"none"}}),te.createElement("div",{className:"clearfix"},te.createElement("span",{className:"c-text-ellipsis",style:{maxWidth:100}},e.service_name_display),r&&r.Version&&te.createElement("div",{className:"service-version"},"v"!==r.Version.split("-")[0].substring(0,1)&&"v",r.Version.split("-")[0])))})))})):Y()(m).call(m,(function(e,t){var n;return Y()(n=e.sub).call(n,(function(e,t){var n=i.cur_product.product.Service[e.service_name];return te.createElement(ne.Z.Item,{key:"sub0_"+t},te.createElement("i",{className:"dot-cls",style:e.alert?{display:"inline-block"}:{display:"none"}}),te.createElement("div",{className:"clearfix"},te.createElement("span",{className:"c-text-ellipsis",style:{maxWidth:100}},e.service_name_display),n&&n.Version&&te.createElement("div",{className:"service-version"},"v"!==n.Version.split("-")[0].substring(0,1)&&"v",n.Version.split("-")[0])))}))}))),l&&te.createElement(Lt,{visible:l,autoTestInfo:u,autoTestMsg:d,handleClose:this.handleToggle,handleTest:this.handleTest}))}}]),n}(te.PureComponent),Wt=n(52553),Jt=n(8263),$t=n(39144),qt=n(95266);const Qt=function(e){var t=e.history,n=e.currentHostDetail,r=e.currentHosts,a=e.dashId,i=e.cur_service_info,o=e.ServiceStore,c=(e.timeRange,n.ip),s=o.cur_product.product_name,l=(0,te.useState)([]),u=(0,qt.Z)(l,2),d=u[0],p=u[1];(0,te.useEffect)((function(){a&&f()}),[a,c]);var f=function(){ue.BZ.getAlertsHistory({dashboardId:a,ip:c||Y()(r).call(r,(function(e){return e.ip})).join(","),product_name:s,service_name:null==i?void 0:i.service_name}).then((function(e){var t,n=e.data;0===n.code&&p(null==n||null===(t=n.data)||void 0===t?void 0:t.data)}))};return te.createElement(Jt.Z,{rowKey:function(e){var t;return B()(t="".concat(e.panel_title,"_")).call(t,e.time)},className:"dt-table-fixed-base",dataSource:d,pagination:!1,scroll:{y:!0},style:{height:485},size:"middle"},te.createElement(Jt.Z.Column,{title:"指标名称",key:"panel_title",render:function(e){return te.createElement("div",null,function(e){var t=null;switch(e){case"ok":t=te.createElement(Ve.Z,{title:e},te.createElement("i",{className:"emicon emicon-heart-fill color-ok"}));break;case"pending":t=te.createElement(Ve.Z,{title:e},te.createElement("i",{className:"emicon emicon-warning-circle-fill color-pending"}));break;case"alerting":t=te.createElement(Ve.Z,{title:e},te.createElement("i",{className:"emicon emicon-alert-fill color-alerting"}));break;case"no_data":t=te.createElement(Ve.Z,{title:e},te.createElement("i",{className:"emicon emicon-question-circle-fill color-no-data"}));break;case"paused":t=te.createElement(Ve.Z,{title:e},te.createElement("i",{className:"emicon emicon-poweroff-circle-fill color-paused"}));break;default:t=te.createElement(Ve.Z,{title:e},te.createElement("i",{className:"emicon emicon-API- color-no-data"}))}return t}(e.state),"  ",e.panel_title)}}),te.createElement(Jt.Z.Column,{title:"告警名称",dataIndex:"alert_name"}),te.createElement(Jt.Z.Column,{title:"来源仪表盘",dataIndex:"dashboard_name",render:function(e,n){return te.createElement("a",{onClick:function(e){return function(e){var n="/deploycenter/monitoring/dashdetail?url=".concat(e.url);xt.Z.setNaviKey("menu_deploy_center","sub_menu_dashboard"),t.push(n)}(n)}},e)}}),te.createElement(Jt.Z.Column,{title:"告警时间",dataIndex:"time",render:function(e){return e?at()(e).format("YYYY-MM-DD HH:mm:ss"):"--"}}))};var Xt=n(19377),en={0:["default","未就绪"],1:["processing","进行中"],2:["success","正常"],3:["error","异常"]},tn=null;const nn=function(e){var t=e.curProduct,n=e.curService,r=e.currentHostDetail,a=(0,te.useState)([]),i=(0,qt.Z)(a,2),o=i[0],c=i[1];(0,te.useEffect)((function(){return s(),function(){return clearTimeout(tn)}}),[r]);var s=function e(){ue.BZ.getHealthCheck({product_name:null==t?void 0:t.product_name,service_name:null==n?void 0:n.service_name,ip:null==r?void 0:r.ip}).then((function(t){var n,r;0===(t=t.data).code?(c(null===(n=t)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.list),clearTimeout(tn),tn=Oe()((function(){e()}),5e3)):ie.Z.error(t.msg)}))},l=function(e){se.Z.confirm({title:"手动执行",content:"确认立即执行该脚本？状态将在执行完成后更新，请耐心等待。",okText:"确认",cancelText:"取消",onOk:function(){!function(e){ue.BZ.manualExecution({record_id:e.record_id,product_name:null==e?void 0:e.product_name,service_name:null==e?void 0:e.service_name}).then((function(e){0===(e=e.data).code&&(ie.Z.success(e.msg),s())}))}(e)}})};return te.createElement(Jt.Z,{rowKey:"record_id",className:"dt-table-fixed-base",dataSource:o,pagination:!1,scroll:{y:!0},style:{height:485},size:"middle"},te.createElement(Jt.Z.Column,{title:"脚本名称",dataIndex:"script_name_display"}),te.createElement(Jt.Z.Column,{title:"状态",dataIndex:"exec_status",render:function(e){var t=(0,qt.Z)(en[e],2),n=t[0],r=t[1];return te.createElement("span",null,te.createElement(Wt.Z,{status:n}),r)}}),te.createElement(Jt.Z.Column,{title:"检查时间",dataIndex:"start_time",render:function(e){return e||"--"}}),te.createElement(Jt.Z.Column,{title:"详情",dataIndex:"error_message",ellipsis:!0,render:function(e){return te.createElement("span",null,e||"--")}}),te.createElement(Jt.Z.Column,{title:"定时执行",dataIndex:"auto_exec",render:function(e,t){return te.createElement(ft.Z,{onChange:function(){return function(e){var t=!(null!=e&&e.auto_exec);ue.BZ.setAutoexecSwitch({record_id:e.record_id,auto_exec:t,product_name:null==e?void 0:e.product_name,service_name:null==e?void 0:e.service_name}).then((function(e){0===(e=e.data).code&&(ie.Z.success(e.msg),s())}))}(t)},checkedChildren:"开",unCheckedChildren:"关",checked:e})}}),te.createElement(Jt.Z.Column,{title:"操作",width:120,render:function(e){return te.createElement(Et.Z,{type:"link",style:{padding:0},disabled:1===e.exec_status,onClick:function(){return l(e)}},"手动执行")}}))};var rn=n(21888),an=Ue.Z.Item,on={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}}};const cn=Ue.Z.create()((function(e){var t=e.visible,n=e.defaultValue,r=e.form,a=r.getFieldDecorator,i=r.validateFields,o=te.useState(!1),c=(0,qt.Z)(o,2),s=c[0],l=c[1];return te.createElement(se.Z,{title:"服务扩缩容",visible:t,confirmLoading:s,onOk:function(){i((function(t,n){t||(l(!0),e.onOk(n.replica))}))},onCancel:e.onCancel},te.createElement(Ue.Z,null,te.createElement(an,(0,N.Z)({label:"Replica"},on),a("replica",{initialValue:n||void 0,rules:[{required:!0,message:"请输入扩缩容节点数"},{validator:function(e,t,n){(t||0===t)&&(/^-?[0-9]\d*$/.test(t)||n("请输入整数"),(t<1||t>1e3)&&n("请输入1-1000内的数值")),n()}}]})(te.createElement(rn.Z,{placeholder:"请输入扩缩容节点数",style:{width:"100%"}})))))}));function sn(e,t){var n=m()(e);if(h()){var r=h()(e);t&&(r=_()(r).call(r,(function(t){return S()(e,t).enumerable}))),n.push.apply(n,r)}return n}function ln(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?C()(n=sn(Object(a),!0)).call(n,(function(t){(0,F.Z)(e,t,a[t])})):k()?w()(e,k()(a)):C()(r=sn(Object(a))).call(r,(function(t){I()(e,t,S()(a,t))}))}return e}function un(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,O.Z)(e);if(t){var i=(0,O.Z)(this).constructor;n=a()(r,arguments,i)}else n=r.apply(this,arguments);return(0,T.Z)(this,n)}}var dn=se.Z.confirm,pn=function(e){(0,D.Z)(n,e);var t=un(n);function n(){var e,r;(0,H.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return r=t.call.apply(t,B()(e=[this]).call(e,i)),(0,F.Z)((0,R.Z)(r),"handleTableConfig",(function(e,t){if(!r.props.authorityList.service_view)return"--";if("schema"in t&&t.schema){var n=JSON.parse(t.schema).Instance;return te.createElement(te.Fragment,null,te.createElement("a",{style:{display:n.ConfigPaths?"inline":"none",paddingRight:"5px"},onClick:function(e){e.stopPropagation(),r.props.handleOpenHostConfig(t)}},"配置"),te.createElement("a",{style:{display:n.Logs?"inline":"none"},onClick:function(e){e.stopPropagation(),r.handleToLog(t)}},"日志"))}return"--"})),(0,F.Z)((0,R.Z)(r),"initColumns",(function(){var e=r.props,t=e.isRestart,n=e.authorityList,a=e.haRoleClass,i=e.HeaderStore.cur_parent_cluster,o=e.ipRender,c=null==n?void 0:n.service_start_stop,s=[{title:"IP地址",dataIndex:"ip",key:"ip",render:o,width:"16.5%"},{title:"角色",dataIndex:"ha_role",key:"ha_role",className:a,render:function(e){return e||" - "}},{title:"运行状态",dataIndex:"status",key:"status",render:function(e,t){return te.createElement(Ve.Z,{title:t.status_message},te.createElement("span",null,e))}},{title:"健康状态",dataIndex:"health_state",key:"health_state",width:"10.5%",render:function(e,t){var n="-",r={};if("running"===t.status){switch(t.health_state){case-2:n="等待",r={color:"#333"};break;case 0:n="不健康",r={color:"#FF5F5C"};break;case 1:n="健康",r={color:"#12BC6A"}}r.display="inline-block"}else r.display="none";return-1===t.health_state&&(n="未设置",r.display="none"),te.createElement(te.Fragment,null,"none"!==r.display&&te.createElement(Wt.Z,{color:r.color}),te.createElement("span",{style:{paddingRight:8}},n))}},{title:"组件版本",dataIndex:"product_version",key:"product_version"},{title:"更新时间",dataIndex:"update_time",key:"update_time",width:"21.1%"},{title:"查看",dataIndex:"config",key:"config",render:function(e,t){return r.handleTableConfig(e,t)}},{title:"停止/启动",dataIndex:"option",key:"option",render:function(e,n){var a={display:"none"},i={display:"none"};switch(n.status){case"stopped":case"run fail":a.display="inline-block",i.display="none";break;case"running":case"health-checked":case"stop fail":case"health-check fail":a.display="none",i.display="inline-block"}return te.createElement("span",null,c?te.createElement("span",null,te.createElement(Et.Z,{disabled:t||n.isDisable,onClick:function(e){e.stopPropagation(),r.handleStartHost(n)},type:"primary",ghost:!0,style:ln(ln({},a),{},{width:64,height:26,padding:0})},"启动"),te.createElement(Et.Z,{disabled:t||n.isDisable,onClick:function(e){e.stopPropagation(),r.handleStopHost(n)},type:"primary",ghost:!0,style:ln(ln({},i),{},{width:64,height:26,padding:0})},"停止")):"--")}}];if("kubernetes"===(null==i?void 0:i.type)&&s.pop(),"hide"===a){var l=Se()(s).call(s,(function(e){return"ha_role"===e.dataIndex}));l>-1&&Ce()(s).call(s,l,1)}return s})),(0,F.Z)((0,R.Z)(r),"handleStartHost",(function(e){var t=null,n=r.props.sHosts,a=r.props.ServiceStore.cur_product,i=r.props.actions,o=i.disableInstance,c=i.startInstance,s=i.getHostsList;for(var l in n)n[l].id===e.id&&(t=l);o({instance_index:t,service_name:e.service_name}),c({agent_id:e.agent_id,instance_index:t,product_name:a.product_name,service_name:e.service_name},(function(){s({product_name:a.product_name,service_name:e.service_name})}))})),(0,F.Z)((0,R.Z)(r),"handleStopHost",(function(e){var t=null,n=r.props.sHosts,a=r.props.ServiceStore.cur_product,i=r.props.actions,o=i.disableInstance,c=i.stopInstance,s=i.getHostsList;for(var l in n)n[l].id===e.id&&(t=l);dn({title:"确定要停用该实例吗？",icon:te.createElement(oe.Z,{type:"exclamation-circle",theme:"filled"}),okButtonProps:{disabled:e.isDisable},onOk:function(){o({instance_index:t,service_name:e.service_name}),c({agent_id:e.agent_id,instance_index:t,product_name:a.product_name,service_name:e.service_name},(function(){s({product_name:a.product_name,service_name:e.service_name})}))}})})),(0,F.Z)((0,R.Z)(r),"handleToLog",(function(e){var t=JSON.parse(e.schema);xt.Z.setNaviKey("menu_ops_center","sub_menu_diagnose_log"),r.props.history.push("/opscenter/diagnosis/log",{product_name:e.product_name,host_ip:e.ip,service_name:e.service_name,logpaths:t.Instance.Logs,log_service_id:e.id})})),r}return(0,A.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.sHosts,n=e.handleClickRow,r=e.selectedRow;return te.createElement(Jt.Z,{rowKey:"id",scroll:{y:490,x:!1},size:"middle",className:"dt-pagination-lower box-shadow-style",pagination:!1,columns:this.initColumns(),dataSource:t,onRow:function(e){return{onClick:function(t){return n(e)}}},rowClassName:function(e,t){return e.ip===r?"recordSelectedRow":""}})}}]),n}(te.PureComponent),fn=Me.Z.Option;const mn=function(e){var t=e.configVisible,n=e.curent_config_path,r=e.data,a=e.handleCloseHostConfig,i=e.handleConfigPathClick,o=e.config_paths;return te.createElement(se.Z,{title:"配置信息",width:900,footer:null,visible:t,onCancel:a},te.createElement("div",{style:{marginBottom:"10px"}},te.createElement(Me.Z,{style:{minWidth:160},value:n,onChange:i},Y()(o).call(o,(function(e,t){return te.createElement(fn,{key:"".concat(t),value:e},te.createElement(Ve.Z,{title:e},e))})))),te.createElement("pre",{style:{backgroundColor:"#F5F5F5",border:"1px dashed #DDD",maxHeight:500,overflowY:"auto"},className:"service-config-pre"},r))};function vn(e,t){var n=void 0!==s()&&u()(e)||e["@@iterator"];if(!n){if(p()(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return hn(e,t);var r=z()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return o()(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hn(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,i=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw i}}}}function hn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function gn(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,O.Z)(e);if(t){var i=(0,O.Z)(this).constructor;n=a()(r,arguments,i)}else n=r.apply(this,arguments);return(0,T.Z)(this,n)}}var _n=se.Z.confirm,yn=function(e){(0,D.Z)(n,e);var t=gn(n);function n(){var e,r;(0,H.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return r=t.call.apply(t,B()(e=[this]).call(e,i)),(0,F.Z)((0,R.Z)(r),"runtimeHost",null),(0,F.Z)((0,R.Z)(r),"runtimeAlert",null),(0,F.Z)((0,R.Z)(r),"state",{rangeDate:[],configVisible:!1,config_paths:[],current_instance_id:"",curent_config_path:"",hasServiceAlert:!1,hasHealthAlert:!1,hasHostAlert:!1,use_cloud:!1,haRoleClass:"hide",expandVisible:!1,key:"tab1",currentHostDetail:{},currentHosts:[]}),(0,F.Z)((0,R.Z)(r),"getServiceInfo",(function(){var e=r.props,t=e.cur_service_info,n=e.cur_product_info;(0,r.props.actions.getHostsList)({product_name:null==n?void 0:n.product_name,service_name:null==t?void 0:t.service_name,namespace:xt.Z.k8sNamespace},(function(e,t){r.setState({use_cloud:e,haRoleClass:t[0]&&t[0].ha_role?"":"hide",currentHosts:t},(function(){clearTimeout(r.runtimeHost),r.runtimeHost=Oe()((function(){r.getServiceInfo()}),1e4)}))}))})),(0,F.Z)((0,R.Z)(r),"getTableRow",(function(e){r.setState({currentHostDetail:e})})),(0,F.Z)((0,R.Z)(r),"ipRender",(function(e,t){try{return JSON.parse(t.schema).Instance.HomePage?te.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:JSON.parse(t.schema).Instance.HomePage.replace("link_ip",e),title:JSON.parse(t.schema).Instance.HomePage.replace("link_ip",e)},e):e}catch(t){return e}})),(0,F.Z)((0,R.Z)(r),"handleTableConfig",(function(e,t){if(!r.props.authorityList.service_view)return"--";if("schema"in t&&t.schema){var n=JSON.parse(t.schema).Instance;return te.createElement("span",null,te.createElement("a",{style:{display:n.ConfigPaths?"inline":"none",paddingRight:"5px"},onClick:function(){return r.handleOpenHostConfig(t)}},"配置"),te.createElement("a",{style:{display:n.Logs?"inline":"none"},onClick:function(){return r.handleToLog(t)}},"日志"))}return"--"})),(0,F.Z)((0,R.Z)(r),"initFakeServiceColumns",(function(){var e=r.props.authorityList.service_view;return[{title:"IP地址",dataIndex:"ip",key:"ip",render:r.ipRender,width:"30%"},{title:"组件版本",dataIndex:"product_version",key:"product_version",width:"30%"},{title:"更新时间",dataIndex:"update_time",key:"update_time",width:"30%"},{title:"查看",dataIndex:"config",key:"config",render:function(t,n){if(!e)return"--";if("schema"in n&&n.schema){var a=JSON.parse(n.schema).Instance.ConfigPaths?{display:"inline",padding:"0 5px"}:{display:"none"};return te.createElement("a",{style:a,onClick:function(){return r.handleOpenHostConfig(n)}},"配置")}return"--"}}]})),(0,F.Z)((0,R.Z)(r),"initColumnUserCloud",(function(){return[{title:"IP地址",dataIndex:"ip",key:"ip",render:r.ipRender,width:"30%"},{title:"产品版本",dataIndex:"product_version",key:"product_version",width:"70%"}]})),(0,F.Z)((0,R.Z)(r),"handleOpenHostConfig",(function(e){var t=JSON.parse(e.schema);r.props.actions.getHostConfig({instance_id:e.id,configfile:t.Instance.ConfigPaths[0]},(function(){r.setState({configVisible:!0,config_paths:t.Instance.ConfigPaths,current_instance_id:e.id,curent_config_path:t.Instance.ConfigPaths[0]})}))})),(0,F.Z)((0,R.Z)(r),"handleCloseHostConfig",(function(){r.setState({configVisible:!1})})),(0,F.Z)((0,R.Z)(r),"handleConfigPathClick",(function(e){var t=r.state.current_instance_id;r.props.actions.getHostConfig({instance_id:t,configfile:e},(function(){r.setState({curent_config_path:e})}))})),(0,F.Z)((0,R.Z)(r),"handleToLog",(function(e){var t=JSON.parse(e.schema);xt.Z.setNaviKey("menu_ops_center","sub_menu_diagnose_log"),r.props.history.push("/opscenter/diagnosis/log",{product_name:e.product_name,host_ip:e.ip,service_name:e.service_name,logpaths:t.Instance.Logs,log_service_id:e.id})})),(0,F.Z)((0,R.Z)(r),"getServiceAlert",(function(){var e=r.props,t=e.cur_service_info.service_name,n=e.ServiceStore.cur_product.product_name,a=e.dashId,i=r.state,o=i.currentHostDetail.ip,c=i.currentHosts;a&&ue.BZ.getAlertsHistory({dashboardId:a,ip:o||Y()(c).call(c,(function(e){return e.ip})).join(","),product_name:n,service_name:t}).then((function(e){var t=e.data;if(0===t.code&&null!=t&&t.data){var n,a=null===(n=t.data.data)||void 0===n?void 0:we()(n).call(n,(function(e){var t;return!_e()(t=["ok","paused","pending"]).call(t,e.state)}));r.setState({hasServiceAlert:a})}}))})),(0,F.Z)((0,R.Z)(r),"getHealthCheck",(function(){var e=r.props,t=e.cur_service_info.service_name,n=e.ServiceStore.cur_product.product_name,a=r.state.currentHostDetail.ip;ue.BZ.getHealthCheck({product_name:n,service_name:t,ip:a}).then((function(e){var t=e.data;if(0===t.code&&null!=t&&t.data){var n,a=null===(n=t.data.list)||void 0===n?void 0:we()(n).call(n,(function(e){return 3===e.exec_status}));r.setState({hasHealthAlert:a})}else ie.Z.error(t.msg)}))})),(0,F.Z)((0,R.Z)(r),"getHostAlert",(function(){var e=r.state,t=e.currentHostDetail.ip,n=e.currentHosts;n.length&&ue.BZ.getHostAlert({ip:t||Y()(n).call(n,(function(e){return e.ip})).join(",")}).then((function(e){var t=e.data;if(0===t.code&&null!=t&&t.data){var n,a=null===(n=t.data.data)||void 0===n?void 0:we()(n).call(n,(function(e){return"alerting"===e.state}));r.setState({hasHostAlert:a})}else ie.Z.error(t.msg)}))})),(0,F.Z)((0,R.Z)(r),"handleExOrCap",(function(){var e=r.state.expandVisible,t=r.props.authorityList;xt.Z.noAuthorityToDO(t,"service_replica")||r.setState({expandVisible:!e})})),(0,F.Z)((0,R.Z)(r),"handlePodChange",(function(e){var t=r.props,n=t.cur_service_info,a=t.ServiceStore,i=t.getServiceGroup,o=a.cur_product,c={replica:e};xt.Z.k8sNamespace&&(c.namespace=xt.Z.k8sNamespace),ue.BZ.instanceReplica({product_name:o.product_name,service_name:n.service_name},c).then((function(e){var t=e.data,n=t.code,a=t.msg;0===n?i():ie.Z.error(a),r.handleExOrCap()}))})),(0,F.Z)((0,R.Z)(r),"handleRestartServiceInTurn",(function(){var e=r.props,t=e.authorityList,n=e.ServiceStore,a=e.cur_service_info,i=e.products,o=e.actions;if(!xt.Z.noAuthorityToDO(t,"service_roll_restart")){var c,s=n.cur_product,l=-1,u=vn(i);try{for(u.s();!(c=u.n()).done;){var d=c.value;d.product_name===s.product_name&&(l=d.id)}}catch(e){u.e(e)}finally{u.f()}_n({title:"确定要滚动重启该服务下的所有主机吗？",content:"重启后最新的运行配置将生效。重启过程中会出现部分主机上服务暂时停止的情况，但服务整体将正常运行。",icon:te.createElement(oe.Z,{type:"exclamation-circle",theme:"filled"}),className:"rollstart-comfirm-dialog",onOk:function(){return o.setServiceRollRestartState(a.service_name,!0),new(De())((function(e,t){Oe()(e,500),ue.BZ.setServiceRollRestart({pid:l,service_name:a.service_name}).then((function(e){var t=e.data,n=t.code,r=t.msg;0===n?ie.Z.success("滚动重启完成"):ie.Z.success(r),o.setServiceRollRestartState(a.service_name,!1)})).catch((function(){ie.Z.success("重启完成"),o.setServiceRollRestartState(a.service_name,!1)}))}))},onCancel:function(){o.setServiceRollRestartState(a.service_name,!1)}})}})),(0,F.Z)((0,R.Z)(r),"onTabChange",(function(e){r.setState({key:e})})),r}return(0,A.Z)(n,[{key:"componentDidUpdate",value:function(e,t){var n=this,r=this.props,a=r.cur_service_info,i=r.dashId,o=this.state.currentHosts;Nt()(e.dashId,i)&&Nt()(e.cur_service_info,a)||this.setState({hasServiceAlert:!1,hasHealthAlert:!1,rangeDate:[],key:"tab1",currentHostDetail:JSON.parse(sessionStorage.getItem("host_service"))||{},use_cloud:!0},(function(){n.getServiceInfo(),n.runtimeAlert=Oe()((function(){sessionStorage.removeItem("host_service")}),100)})),!Nt()(o,t.currentHosts)&&o.length&&(this.getServiceAlert(),this.getHealthCheck(),this.getHostAlert())}},{key:"componentWillUnmount",value:function(){clearTimeout(this.runtimeAlert),clearTimeout(this.runtimeHost)}},{key:"render",value:function(){var e,t,n=this.props,r=n.cur_service_info,a=r.service_name,i=r.IsJob,o=n.cur_service_info,c=n.HeaderStore.cur_parent_cluster,s=n.ServiceStore,l=s.cur_product,u=s.config,d=n.ServiceStore,p=n.history,f=n.dashId,m=this.state,v=m.configVisible,h=m.expandVisible,g=m.curent_config_path,_=m.config_paths,y=m.hasHealthAlert,S=m.hasServiceAlert,Z=m.hasHostAlert,C=m.use_cloud,E=m.haRoleClass,k=m.currentHosts,b=(m.rangeDate,m.currentHostDetail),w=null==l||null===(e=l.product)||void 0===e?void 0:e.Service[a],x=(null==w?void 0:w.isRestart)||!1,I=(null==w||null===(t=w.Instance)||void 0===t?void 0:t.Pseudo)&&!C,P=!I&&C,H=!I&&!C,A=[];I&&(A=this.initFakeServiceColumns()),P&&(A=this.initColumnUserCloud());var R="kubernetes"===(null==c?void 0:c.type),D=R&&1===(null==c?void 0:c.mode)&&!i,T=[{key:"tab1",tab:te.createElement(Wt.Z,{dot:S},"服务告警")},{key:"tab2",tab:te.createElement(Wt.Z,{dot:Z},"主机告警")},{key:"tab3",tab:te.createElement(Wt.Z,{dot:y},"健康检查")}],O={tab1:te.createElement(Qt,{dashId:f,cur_service_info:o,ServiceStore:d,currentHostDetail:b,currentHosts:k,history:p}),tab2:te.createElement(Xt.Z,{ip:(null==b?void 0:b.ip)||Y()(k).call(k,(function(e){return e.ip})).join(","),history:p}),tab3:te.createElement(nn,{curProduct:l,curService:o,currentHostDetail:b})};return te.createElement(te.Fragment,null,te.createElement("div",{className:"card-wrapper has-card-extra max-content__scroll"},te.createElement("div",{className:"mb-12 clearfix"},te.createElement("p",{className:"text-title-bold fl-l"},"运行主机"),H&&!R&&de.get("em_current_cluster_id")&&te.createElement(Et.Z,{className:"fl-r",type:"primary",disabled:x,loading:x,onClick:this.handleRestartServiceInTurn},"滚动重启"),D&&te.createElement(Et.Z,{className:"fl-r",type:"primary",onClick:this.handleExOrCap},"服务扩缩容")),te.createElement("div",{className:"service-list",style:{marginBottom:20}},H?te.createElement(pn,(0,N.Z)({},this.props,{sHosts:k,haRoleClass:E,isRestart:x,ipRender:this.ipRender,handleOpenHostConfig:this.handleOpenHostConfig,handleClickRow:this.getTableRow,selectedRow:null==b?void 0:b.ip})):te.createElement(Jt.Z,{rowKey:"id",scroll:{y:490,x:!1},size:"middle",className:"dt-pagination-lower box-shadow-style",pagination:!1,columns:A,dataSource:k})),H&&te.createElement(te.Fragment,null,te.createElement("div",{className:"mb-12 clearfix"},te.createElement("p",{className:"text-title-bold fl-l"},"运行状况 ",te.createElement("span",null,null==b?void 0:b.ip))),te.createElement($t.Z,{className:"box-shadow-style status-card",bordered:!1,tabList:T,activeTabKey:this.state.key,onTabChange:this.onTabChange},O[this.state.key]))),v&&te.createElement(mn,{configVisible:v,curent_config_path:g,data:u,handleCloseHostConfig:this.handleCloseHostConfig,handleConfigPathClick:this.handleConfigPathClick,config_paths:_}),h&&te.createElement(cn,{visible:h,defaultValue:k.length,onOk:this.handlePodChange,onCancel:this.handleExOrCap}))}}]),n}(te.PureComponent);function Sn(e,t){var n=m()(e);if(h()){var r=h()(e);t&&(r=_()(r).call(r,(function(t){return S()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zn(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?C()(n=Sn(Object(a),!0)).call(n,(function(t){(0,F.Z)(e,t,a[t])})):k()?w()(e,k()(a)):C()(r=Sn(Object(a))).call(r,(function(t){I()(e,t,S()(a,t))}))}return e}function Cn(e,t){var n=void 0!==s()&&u()(e)||e["@@iterator"];if(!n){if(p()(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return En(e,t);var r=z()(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return o()(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return En(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,i=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw i}}}}function En(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function kn(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,O.Z)(e);if(t){var i=(0,O.Z)(this).constructor;n=a()(r,arguments,i)}else n=r.apply(this,arguments);return(0,T.Z)(this,n)}}var bn=ne.Z.Item,wn=re.Z.Content,xn=ae.Z.TabPane,In=function(e){(0,D.Z)(n,e);var t=kn(n);function n(){var e,r;(0,H.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return r=t.call.apply(t,B()(e=[this]).call(e,i)),(0,F.Z)((0,R.Z)(r),"state",{cur_parent_product:r.props.HeaderStore.cur_parent_product||"",products:[],cur_product_info:{product_name:de.get("em_product_name")||"",product_version:"",product_id:U()(de.get("em_product_id"),10)||-1},cur_service_info:{},log_modal_visible:!1,logpaths:[],log_service_id:-1,activeKey:"0",dashurl:"",services:null,urlParams:{},dashId:"",menuKey:{openKeys:["f0"],selectedKeys:["sub0_0"]},redService:{count:0,list:[]},redVisible:!1,noHosts:"",repeatParams:[]}),(0,F.Z)((0,R.Z)(r),"haInterval",null),(0,F.Z)((0,R.Z)(r),"noticeInterval",null),(0,F.Z)((0,R.Z)(r),"parentProduct",""),(0,F.Z)((0,R.Z)(r),"initServices",(function(){var e=r.props.HeaderStore.cur_parent_product,t=r.state.products;"选择产品"===e||""===e||""!==r.parentProduct||t.length||(r.getProductList(e),r.getRedService(e),r.parentProduct=e),r.getRestartService()})),(0,F.Z)((0,R.Z)(r),"getRedService",(function(e){ue.BZ.getRedService({parentProductName:e}).then((function(e){0===(e=e.data).code?r.setState({redService:{count:e.data.count,list:e.data.list},redVisible:e.data.count>0},(function(){r.props.actions.setRedService({count:e.data.count,list:e.data.list})})):ie.Z.error(e.msg)}))})),(0,F.Z)((0,R.Z)(r),"getRestartService",(function(){ue.BZ.getRestartService({}).then((function(e){0===(e=e.data).code?r.props.actions.setResartServiceList({count:e.data.count,list:e.data.list}):ie.Z.error(e.msg)}))})),(0,F.Z)((0,R.Z)(r),"checkUrlParam",(function(e){var t,n,a={},i=z()(t=r.props.location.search).call(t,1);Y()(n=i.split("&")).call(n,(function(e){a[e.split("=")[0]]=e.split("=")[1]})),r.setState({urlParams:a},(function(){e&&e()}))})),(0,F.Z)((0,R.Z)(r),"getProductList",(function(e){var t=r.state.cur_product_info,n={parentProductName:e};ue.BZ.getProductName(n).then((function(e){var n;if(0===(e=e.data).code&&null!==(n=e.data)&&void 0!==n&&n.list){var a,i=null===(a=e.data)||void 0===a?void 0:a.list;i.length||(t.product_name="",t.product_id=-1),r.setState({products:i,cur_product_info:t},(function(){i.length?r.getDefaultService(i):(de.remove("em_product_id"),de.remove("em_product_name"),r.props.actions.resetServices())}))}}))})),(0,F.Z)((0,R.Z)(r),"getDefaultService",(function(e){var t,n=r.state,a=n.cur_product_info,i=n.urlParams,o=a.product_name,c=a.product_version,s=i.component||o,l=c,u=!1,d=Cn(e);try{for(d.s();!(t=d.n()).done;){var p=t.value;p.product_name===s&&(u=!0,l=p.product_version,s=p.product_name,de.set("em_product_id",p.id))}}catch(e){d.e(e)}finally{d.f()}if(!u&&e.length){s=e[0].product_name,l=e[0].product_version;var f=JSON.parse(sessionStorage.getItem("service_object"));f&&f.productName&&(s=f.productName)}r.getCurrentProduct(s,l)})),(0,F.Z)((0,R.Z)(r),"getCurrentProduct",(function(e,t,n){var a=r.state,i=a.cur_service_info,o=a.urlParams,c=a.menuKey;if(e){var s={product_name:e};xt.Z.k8sNamespace&&(s.namespace=xt.Z.k8sNamespace),de.remove("em_product_name"),ue.BZ.getCurrentProduct(s).then((function(a){var s=a.data;if(0===s.code){r.props.actions.setCurrentProduct(s.data);var l={cloud:!0};xt.Z.k8sNamespace&&(l.namespace=xt.Z.k8sNamespace),r.props.actions.getServiceGroup({product_name:e},(function(a,o,l){n||(c.openKeys=(0,P.Z)(o),c.selectedKeys=[l],i=a),r.setState({cur_product_info:{product_id:s.data.id,product_name:e,product_version:t},services:s.data.product.Service,cur_service_info:i,menuKey:c},(function(){r.handleSwitchService(i,e,s.data)}))}),o.service||"",l)}else ie.Z.error(s.msg)}))}})),(0,F.Z)((0,R.Z)(r),"handleSwitchService",(function(e,t,n){var a,i,o=r.props,c=o.ServiceStore,s=o.history,l=o.actions,u=c.cur_product,d=n||u,p=r.state,f=p.services,m=p.dashurl,v=p.activeKey,h=p.dashId,g=!1;for(var _ in l.setConfigFile("all"),f)_===e.service_name&&f[_].Instance&&""!==f[_].Instance.PrometheusPort&&(g=!0);r.haInterval&&clearInterval(r.haInterval),r.setCurrentService(Zn(Zn({},d.product.Service[e.service_name]),{},{configModify:{}}),e.service_name),s.replace(B()(a=B()(i="/opscenter/service?component=".concat(t,"&service_group=")).call(i,(d.product.Service[e.service_name]||{}).Group,"&service=")).call(a,e.service_name)),g?ue.BZ.getServiceDashInfo({product_name:d.product_name,service_name:e.service_name}).then((function(t){(t=t.data).length?(m=t[0].url,h=t[0].id):(m="",h=""),r.setState({cur_service_info:e,dashurl:m,dashId:h,activeKey:v})})):r.setState({cur_service_info:e,dashurl:"",dashId:""})})),(0,F.Z)((0,R.Z)(r),"getServiceGroup",(function(){var e=r.state,t=e.cur_product_info,n=e.cur_service_info,a=t.product_name,i={cloud:!0};xt.Z.k8sNamespace&&(i.namespace=xt.Z.k8sNamespace),r.props.actions.getServiceGroup({product_name:a},(function(e,t,i){r.handleSwitchService(n,a)}),"",i)})),(0,F.Z)((0,R.Z)(r),"handleTabsChange",(function(e){r.setState({activeKey:e})})),(0,F.Z)((0,R.Z)(r),"setCurrentService",(function(e,t){var n=r.props.ServiceStore.cur_product;r.props.actions.setCurrentService(e,{product_name:n.product_name,service_name:t,product_version:n.product_version})})),(0,F.Z)((0,R.Z)(r),"setMenuKey",(function(e){var t=r.props.actions,n=e.service_name,a=e.product_name;ue.BZ.getCurrentProduct({product_name:a}).then((function(e){0===(e=e.data).code?(de.set("em_product_name",e.data.product_name),de.set("em_product_id",e.data.id),t.setCurrentProduct(e.data),t.getServiceGroup({product_name:a},(function(t,n,i){r.setState({cur_product_info:{product_id:e.data.id,product_name:a},services:e.data.product.Service,cur_service_info:t,menuKey:{selectedKeys:[i],openKeys:(0,P.Z)(n)}}),r.handleSwitchService(t,a),r.setCurrentService(e.data.product.Service[t.service_name],t.service_name)}),n,{cloud:!0})):ie.Z.error(e.msg)}))})),(0,F.Z)((0,R.Z)(r),"changeHosts",(function(){r.setState({noHosts:"",repeatParams:[]})})),r}return(0,A.Z)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.HeaderStore.cur_parent_product;this.checkUrlParam(this.initServices),this.noticeInterval&&clearInterval(this.noticeInterval),this.noticeInterval=J()((function(){var n="选择产品"===t?de.get("em_current_parent_product"):t;e.getRestartService(),e.getRedService(n)}),5e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.haInterval),clearInterval(this.noticeInterval)}},{key:"componentDidUpdate",value:function(e,t){var n,r=this.props,a=r.location.search,i=r.HeaderStore,o=r.ServiceStore,c=i.cur_parent_product,s=i.cur_parent_cluster,l=o.redService,u=t.products,d=t.cur_product_info;a!==e.location.search&&this.checkUrlParam(),"选择产品"===c||""===c||""!==this.parentProduct&&this.parentProduct===c&&s.id===i.cur_parent_cluster.id||0!==u.length||(this.getProductList(c),this.parentProduct=c),l.count!==e.ServiceStore.redService.count&&this.getCurrentProduct(d.product_name,d.product_version,!0),(null==e||null===(n=e.HeaderStore)||void 0===n?void 0:n.cur_parent_product)!==c&&"选择产品"!==c&&this.getRedService(c)}},{key:"handleLogModalCancel",value:function(){this.setState({log_modal_visible:!1})}},{key:"render",value:function(){var e,t,n,r=this,a=this.props,i=a.ServiceStore.restartService,o=a.ServiceStore,c=a.HeaderStore,s=a.authorityList,l=this.state,u=l.dashurl,d=l.activeKey,p=l.cur_service_info,f=l.cur_product_info,m=l.redService,v=l.redVisible,h=l.products,g=s.service_dashboard_view,_="kubernetes"===(null==c||null===(e=c.cur_parent_cluster)||void 0===e?void 0:e.type),y=window.location.protocol+"//"+window.location.hostname+":"+window.APPCONFIG.GRAFANA_PORT+u+"?theme=light&no-feedback=true&var-cluster="+c.cur_parent_cluster.name,S={products:h,cur_product_info:f,menuKey:this.state.menuKey,isKubernetes:_,ServiceStore:o,HeaderStore:c,actions:this.props.actions,authorityList:s},Z=te.createElement(ne.Z,null,m.list&&Y()(t=m.list).call(t,(function(e,t){return te.createElement(bn,{key:t},te.createElement("a",{onClick:function(){return r.setMenuKey(e)}},e.product_name,"——",e.service_name))})));return te.createElement("div",{className:"service-container"},0==i.count&&m.count>0&&v&&te.createElement("div",{className:"service-attention"},te.createElement("div",{className:"attention-content"},te.createElement(oe.Z,{type:"exclamation-circle",theme:"filled",style:{color:"#ffa941",marginRight:"8px",marginLeft:"8px"}}),te.createElement(ce.Z,{overlay:Z,placement:"bottomRight"},te.createElement("a",{onClick:function(e){return e.preventDefault()},className:"dropdown"},te.createElement("span",null,"一共有",m.count,"个异常服务")," ",te.createElement(oe.Z,{type:"down"}))))),te.createElement(re.Z,{className:"service-content"},te.createElement(Yt,(0,N.Z)({},S,{handleSwitchService:this.handleSwitchService,setCurrentService:this.setCurrentService,setSideNavState:function(e){return r.setState(e)},getCurrentProduct:this.getCurrentProduct,getRestartService:this.getRestartService})),te.createElement(wn,null,te.createElement(ae.Z,{className:"service-tab c-tabs-padding",style:{padding:"0 0 0 20px"},activeKey:d,onChange:this.handleTabsChange},te.createElement(xn,{tab:"运行状态",key:"0"},te.createElement(yn,(0,N.Z)({},this.props,{cur_service_info:p,cur_product_info:f,dashId:this.state.dashId,getServiceGroup:this.getServiceGroup,products:h,setCurrentService:this.setCurrentService}))),te.createElement(xn,{tab:"参数配置",key:"1"},te.createElement(Mt,(0,N.Z)({},this.props,this.state,{isKubernetes:_,getCurrentProduct:this.getCurrentProduct}))),g&&""!==this.state.dashurl&&te.createElement(xn,{tab:"仪表盘",key:"2"},te.createElement("iframe",{className:"style-iframe",src:y,frameBorder:"0",style:{height:"calc(100vh - 180px)"}}))))),te.createElement(se.Z,{destroyOnClose:!0,title:"执行日志",footer:null,width:900,visible:this.state.log_modal_visible,onCancel:q()(n=this.handleLogModalCancel).call(n,this)},te.createElement(le.Z,{logs:this.state.logpaths,serviceid:this.state.log_service_id,isreset:!this.state.log_modal_visible})))}}]),n}(te.Component);const Nn=(0,Q.$j)((function(e){return{HeaderStore:e.HeaderStore,ServiceStore:e.ServiceStore,authorityList:e.UserCenterStore.authorityList}}),(function(e){return{actions:(0,ee.DE)(L()({},X),e)}}))(In)},60558:(e,t,n)=>{n.d(t,{ON:()=>c,g8:()=>o});var r=n(49754),a=n(35558),i=n(98130);function o(e,t){if(!t)return e;var n=new r.Z;return n.setPublicKey(t),(0,a.GV)(n.encrypt(e)||"")}function c(e,t){return"04"+i.sg.encrypt(e,t,{inputEncoding:"utf8",outputEncoding:"hex"})}},64143:(e,t,n)=>{n.d(t,{Z:()=>_});var r=n(77766),a=n.n(r),i=n(78914),o=n.n(i),c=n(81643),s=n.n(c),l=n(2991),u=n.n(l),d=n(86902),p=n.n(d),f=n(31238),m=n.n(f),v=n(45360),h=n(36808),g=n(18274);const _={pageWidth:function(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)},pageHeight:function(){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)},getParameterByName:function(e,t){t||(t=window.location.href),e=e.replace(/[[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},getBase64:function(e,t){var n=new FileReader;n.addEventListener("load",(function(){return t(n.result)})),n.readAsDataURL(e)},percent:function(e,t){return e&&e!==1/0?(e>1&&(e=1),t=t||2,t=Math.pow(10,t),Math.round(e*t*100)/t+"%"):"0%"},getCssText:function(e){var t="";for(var n in e)t+=n+":"+e[n]+";";return t},formateDateTime:function(e){var t,n,r,i,o;if(!e)return"";var c=new Date(e),s=c.getFullYear(),l=c.getMonth()+1+"",u=c.getDate()+"",d=c.getHours()+"",p=c.getMinutes()+"",f=c.getSeconds()+"";return 1===l.toString().length&&(l="0".concat(l)),1===u.toString().length&&(u="0".concat(u)),1===d.toString().length&&(d="0".concat(d)),1===p.toString().length&&(p="0".concat(p)),1===f.toString().length&&(f="0".concat(f)),a()(t=a()(n=a()(r=a()(i=a()(o="".concat(s,"-")).call(o,l,"-")).call(i,u," ")).call(r,d,":")).call(n,p,":")).call(t,f)},formateDate:function(e){var t,n;if(!e)return"";var r=new Date(e),i=r.getFullYear(),o=r.getMonth()+1+"",c=r.getDate()+"";return 1===o.toString().length&&(o="0".concat(o)),1===c.toString().length&&(c="0".concat(c)),a()(t=a()(n="".concat(i,"-")).call(n,o,"-")).call(t,c)},trim:function(e){return"string"==typeof e?e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""):e},messageFilter:function(e,t,n,r){1001===e.status.code&&(r||v.Z.success("成功"),t&&t())},getTableParam:function(e){var t={};return o()(e).call(e,(function(e,n){var r=e.split("-");t[r[1]]=r[2]})),t},setAlertControl:function(e){var t={},n=e.alert_control;return"1"===n?t.close=1:(t.close=0,e["alert_num_"+n]&&(t.times_after_close=e["alert_num_"+n]),e["recover_num_"+n]&&(t.close_after_long_time_reset_amount=e["recover_num_"+n],t.close_after_long_time_reset_unit=e["recover_unit_"+n])),t},getAlertControl:function(e){var t={alert_control:""};return 0===e.close&&(0!==e.times_after_close?(t.alert_control="2",t["alert_num_"+t.alert_control]=e.times_after_close):t.alert_control="3",""!==e.close_after_long_time_reset_amount&&("2"===t.alert_control&&(t.alert_control="4"),t["alert_num_"+t.alert_control]=e.times_after_close,t["recover_num_"+t.alert_control]=e.close_after_long_time_reset_amount,t["recover_unit_"+t.alert_control]=e.close_after_long_time_reset_unit)),t},filterOption:function(e,t){var n;return-1!==s()(n=t.props.children).call(n,e)},getParamsFromUrl:function(e){var t={},n=[],r="",a="",i=e.substring(s()(e).call(e,"?")+1,e.length).split("&");for(var o in i)r=(n=i[o].split("="))[0],a=n[1],t[r]=a;return t},jsonToQuery:function(e){var t;return e?function(e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t}(u()(t=p()(e)).call(t,(function(t){return void 0===e[t]?"":encodeURIComponent(t)+"="+encodeURIComponent(e[t])}))).join("&"):""},checkNullObj:function(e){return 0===p()(e).length},serviceCallback:function(e,t,n){0===e.data.code?(v.Z.success(t),n&&n()):v.Z.error(e.data.msg)},noAuthorityToDO:function(e,t){return!e[t]&&(v.Z.error("权限不足，请联系管理员!"),!0)},get k8sNamespace(){return h.get(g.E9.NAMESPACE)},setNaviKey:function(e,t){sessionStorage.setItem("firstLevelNav",e),sessionStorage.setItem("siderLevelNav",t)},formatGBUnit:function(e){return s()(e).call(e,"MB")>-1?m()(e.replace("MB",""))/1024:s()(e).call(e,"KB")>-1?m()(e.replace("KB",""))/1024/1024:s()(e).call(e,"GB")>-1?m()(e.replace("GB","")):s()(e).call(e,"TB")>-1?1024*m()(e.replace("TB","")):0}}}}]);