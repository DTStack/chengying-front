"use strict";(self.webpackChunkdt_em_front=self.webpackChunkdt_em_front||[]).push([[5770],{35770:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ue,operationMaps:()=>le,statusMap:()=>ce});var r=n(86902),a=n.n(r),o=n(14310),c=n.n(o),l=n(20116),u=n.n(l),i=n(34074),s=n.n(i),m=n(78914),f=n.n(m),d=n(39649),p=n.n(d),_=n(20368),g=n.n(_),v=n(63978),h=n.n(v),E=n(44845),Z=n(95266),b=n(77766),S=n.n(b),w=n(33032),C=n.n(w),y=n(59340),T=n.n(y),N=n(31238),M=n.n(N),x=n(67294),j=n(45360),k=n(8263),D=n(11382),I=n(52553),Y=n(36808),B=n(19528),F=n(81643),O=n.n(F),H=n(2991),K=n.n(H),A=n(11128),R=n.n(A),L=n(34041),P=n(39903),V=n(10114),z=n(4107),U=n(67908),G=n(30381),W=n.n(G);function $(e,t){var n=a()(e);if(c()){var r=c()(e);t&&(r=u()(r).call(r,(function(t){return s()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?f()(n=$(Object(a),!0)).call(n,(function(t){(0,E.Z)(e,t,a[t])})):p()?g()(e,p()(a)):f()(r=$(Object(a))).call(r,(function(t){h()(e,t,s()(a,t))}))}return e}var q=L.Z.Option,J=P.Z.RangePicker,X=function(e){var t=e.handleEvent,n=x.useState([]),r=(0,Z.Z)(n,2),a=r[0],o=r[1],c=x.useState([]),l=(0,Z.Z)(c,2),i=l[0],s=l[1];x.useEffect((function(){m()}),[]);var m=function(){B.mt.getEchoSearchList({clusterId:Y.get("em_current_cluster_id")}).then((function(e){var t=e.data;0===t.code?(o(t.data||[]),s(t.data||[])):j.Z.error(t.msg)}))};return x.createElement(V.Z,{dataSource:K()(i).call(i,(function(e){return x.createElement(q,{key:e},e)})),onSelect:function(e){t((function(t){return Q(Q({},t),{},{objectValue:e,page:1})}))},onChange:function(e){return function(e){var n=a;e?n=u()(a).call(a,(function(t){var n;return e&&O()(n=t.toLowerCase()).call(n,e.toLowerCase())>-1})):t((function(t){return Q(Q({},t),{},{objectValue:e,page:1})})),s(n)}(e)},allowClear:!0},x.createElement(z.Z,{placeholder:"请输入搜索关键词",suffix:x.createElement(U.Z,{type:"search"})}))};const ee=function(e){var t,n=e.handleEvent;return x.createElement("div",{className:"echo-form clearfix mb-12"},x.createElement("span",{className:"mr-20"},"对象：",x.createElement(X,{handleEvent:n})),x.createElement("span",{className:"mr-20"},"操作：",x.createElement(L.Z,{placeholder:"请选择命令",showSearch:!0,onChange:function(e){n((function(t){return Q(Q({},t),{},{operationType:e,page:1})}))},allowClear:!0},K()(t=a()(le)).call(t,(function(e){return x.createElement(q,{key:e,value:e},le[e])})))),x.createElement("span",{className:"mr-20"},"状态：",x.createElement(L.Z,{placeholder:"请选择状态",showSearch:!0,onChange:function(e){n((function(t){return Q(Q({},t),{},{status:e,page:1})}))},allowClear:!0},x.createElement(q,{value:"2"},"正常"),x.createElement(q,{value:"3"},"失败"),x.createElement(q,{value:"1"},"进行中"))),x.createElement("span",{className:"mr-20"},"开始时间：",x.createElement(J,{format:"YYYY-MM-DD HH:mm",disabledDate:te,showTime:!0,onChange:function(e,t){t.length&&""===t[0]&&""===t[1]&&n((function(e){return Q(Q({},e),{},{startTime:t[0],endTime:t[1],page:1})}))},onOk:function(e){var t=e&&e.length?W()(e[0]).format("YYYY-MM-DD HH:mm"):"",r=e&&e.length?W()(e[1]).format("YYYY-MM-DD HH:mm"):"";if(t&&r&&t===r)return j.Z.warning("开始时间必须小于结束时间！");n((function(e){return Q(Q({},e),{},{startTime:t,endTime:r,page:1})}))}})))};function te(e){return e&&e.valueOf()>R()()}var ne=n(75940),re=n(64143);function ae(e,t){var n=a()(e);if(c()){var r=c()(e);t&&(r=u()(r).call(r,(function(t){return s()(e,t).enumerable}))),n.push.apply(n,r)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?f()(n=ae(Object(a),!0)).call(n,(function(t){(0,E.Z)(e,t,a[t])})):p()?g()(e,p()(a)):f()(r=ae(Object(a))).call(r,(function(t){h()(e,t,s()(a,t))}))}return e}var ce={2:{label:"正常",value:"success"},3:{label:"失败",value:"error"},1:{label:"进行中",value:"processing"}},le={1:"产品包部署",2:"补丁包升级",3:"产品包启动",4:"服务启动",5:"服务滚动重启",6:"主机初始化",7:"Kerberos开启",8:"Kerberos关闭"};const ue=function(e){var t=e.history,n=e.location,r=x.useState({clusterId:Y.get("em_current_cluster_id"),operationType:void 0,objectValue:"",status:"",startTime:"",endTime:"",page:1,pageSize:10}),a=(0,Z.Z)(r,2),o=a[0],c=a[1],l=x.useState([]),u=(0,Z.Z)(l,2),i=u[0],s=u[1],m=x.useState(0),f=(0,Z.Z)(m,2),d=f[0],p=f[1],_=x.useState(!1),g=(0,Z.Z)(_,2),v=g[0],h=g[1],E=x.useState(!1),b=(0,Z.Z)(E,2),w=b[0],y=b[1],N={current:o.page,pageSize:o.pageSize,total:d,size:"small",showTotal:function(e){var t;return S()(t="共 ".concat(e," 条数据，每页显示 ")).call(t,o.pageSize," 条")}},F=x.useRef(null);x.useEffect((function(){return O(),function(){h(!0),clearTimeout(F.current)}}),[o]);var O=function e(){var t=oe(oe({},o),{},{startTime:o.startTime||void 0,endTime:o.endTime||void 0,status:o.status||void 0,objectValue:o.objectValue||void 0});y(!0),B.mt.getEchoOrder(t).then((function(t){var n=t.data;if(0===n.code){if(s(n.data.list),p(n.data.count),y(!1),v)return null;F.current=C()((function(){e()}),5e3)}else j.Z.error(n.msg)}))};return x.createElement("div",{className:"scriptecho-page"},x.createElement(ee,{handleEvent:c}),x.createElement(k.Z,{rowKey:"operationId",className:"dt-table-fixed-base",style:{height:"calc(100vh - 230px)"},dataSource:i,onChange:function(e,t,n){c((function(t){return oe(oe({},t),{},{page:e.current})}))},pagination:N,loading:w,scroll:{y:!0}},x.createElement(k.Z.Column,{title:"",width:30,key:"operationId",render:function(e,t){return x.createElement("div",null,1===t.operationStatus?x.createElement(D.Z,{size:"small"}):x.createElement("span",null," "))}}),x.createElement(k.Z.Column,{title:"对象",width:"20%",dataIndex:"objectValue",render:function(e,n){return x.createElement("a",{onClick:function(e){return function(e){if(j.Z.destroy(),!e.isExist)return j.Z.warning("该组件已从该集群卸载！");var n="";switch(e.objectType){case 1:n="/deploycenter/cluster/detail/deployed",re.Z.setNaviKey("menu_deploy_center","sub_menu_cluster_list");break;case 2:n="/opscenter/service",Y.set("em_product_id",""),Y.set("em_product_name",e.productName),Y.set("em_current_parent_product",e.parentProductName),re.Z.setNaviKey("menu_ops_center","sub_menu_service");break;default:n="/opscenter/hoststatus",e=oe(oe({},e),{},{hostIp:e.objectValue}),Y.set("em_product_id",""),Y.set("em_product_name",e.productName),Y.set("em_current_parent_product",e.parentProductName),re.Z.setNaviKey("menu_ops_center","sub_menu_host")}sessionStorage.setItem("service_object",T()(e)),t.push(n)}(n)}},e)}}),x.createElement(k.Z.Column,{title:"操作",dataIndex:"operationName",render:function(e,r){return x.createElement("a",{onClick:function(e){return function(e){t.push("/deploycenter/cluster/detail/echoDetail?from=".concat(n.pathname),e)}(r)}},e)}}),x.createElement(k.Z.Column,{title:"状态",dataIndex:"operationStatus",render:function(e){var t=ce[e];return x.createElement("span",null,x.createElement(I.Z,{status:t.value})," ",t.label)}}),x.createElement(k.Z.Column,{title:"开始时间",dataIndex:"startTime"}),x.createElement(k.Z.Column,{title:"持续时间",width:"12%",dataIndex:"duration",render:function(e,t){return 1===t.operationStatus?x.createElement(ne.Z,{initial:M()(e)}):e+"s"}})))}},64143:(e,t,n)=>{n.d(t,{Z:()=>h});var r=n(77766),a=n.n(r),o=n(78914),c=n.n(o),l=n(81643),u=n.n(l),i=n(2991),s=n.n(i),m=n(86902),f=n.n(m),d=n(31238),p=n.n(d),_=n(45360),g=n(36808),v=n(18274);const h={pageWidth:function(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)},pageHeight:function(){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)},getParameterByName:function(e,t){t||(t=window.location.href),e=e.replace(/[[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},getBase64:function(e,t){var n=new FileReader;n.addEventListener("load",(function(){return t(n.result)})),n.readAsDataURL(e)},percent:function(e,t){return e&&e!==1/0?(e>1&&(e=1),t=t||2,t=Math.pow(10,t),Math.round(e*t*100)/t+"%"):"0%"},getCssText:function(e){var t="";for(var n in e)t+=n+":"+e[n]+";";return t},formateDateTime:function(e){var t,n,r,o,c;if(!e)return"";var l=new Date(e),u=l.getFullYear(),i=l.getMonth()+1+"",s=l.getDate()+"",m=l.getHours()+"",f=l.getMinutes()+"",d=l.getSeconds()+"";return 1===i.toString().length&&(i="0".concat(i)),1===s.toString().length&&(s="0".concat(s)),1===m.toString().length&&(m="0".concat(m)),1===f.toString().length&&(f="0".concat(f)),1===d.toString().length&&(d="0".concat(d)),a()(t=a()(n=a()(r=a()(o=a()(c="".concat(u,"-")).call(c,i,"-")).call(o,s," ")).call(r,m,":")).call(n,f,":")).call(t,d)},formateDate:function(e){var t,n;if(!e)return"";var r=new Date(e),o=r.getFullYear(),c=r.getMonth()+1+"",l=r.getDate()+"";return 1===c.toString().length&&(c="0".concat(c)),1===l.toString().length&&(l="0".concat(l)),a()(t=a()(n="".concat(o,"-")).call(n,c,"-")).call(t,l)},trim:function(e){return"string"==typeof e?e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""):e},messageFilter:function(e,t,n,r){1001===e.status.code&&(r||_.Z.success("成功"),t&&t())},getTableParam:function(e){var t={};return c()(e).call(e,(function(e,n){var r=e.split("-");t[r[1]]=r[2]})),t},setAlertControl:function(e){var t={},n=e.alert_control;return"1"===n?t.close=1:(t.close=0,e["alert_num_"+n]&&(t.times_after_close=e["alert_num_"+n]),e["recover_num_"+n]&&(t.close_after_long_time_reset_amount=e["recover_num_"+n],t.close_after_long_time_reset_unit=e["recover_unit_"+n])),t},getAlertControl:function(e){var t={alert_control:""};return 0===e.close&&(0!==e.times_after_close?(t.alert_control="2",t["alert_num_"+t.alert_control]=e.times_after_close):t.alert_control="3",""!==e.close_after_long_time_reset_amount&&("2"===t.alert_control&&(t.alert_control="4"),t["alert_num_"+t.alert_control]=e.times_after_close,t["recover_num_"+t.alert_control]=e.close_after_long_time_reset_amount,t["recover_unit_"+t.alert_control]=e.close_after_long_time_reset_unit)),t},filterOption:function(e,t){var n;return-1!==u()(n=t.props.children).call(n,e)},getParamsFromUrl:function(e){var t={},n=[],r="",a="",o=e.substring(u()(e).call(e,"?")+1,e.length).split("&");for(var c in o)r=(n=o[c].split("="))[0],a=n[1],t[r]=a;return t},jsonToQuery:function(e){var t;return e?function(e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t}(s()(t=f()(e)).call(t,(function(t){return void 0===e[t]?"":encodeURIComponent(t)+"="+encodeURIComponent(e[t])}))).join("&"):""},checkNullObj:function(e){return 0===f()(e).length},serviceCallback:function(e,t,n){0===e.data.code?(_.Z.success(t),n&&n()):_.Z.error(e.data.msg)},noAuthorityToDO:function(e,t){return!e[t]&&(_.Z.error("权限不足，请联系管理员!"),!0)},get k8sNamespace(){return g.get(v.E9.NAMESPACE)},setNaviKey:function(e,t){sessionStorage.setItem("firstLevelNav",e),sessionStorage.setItem("siderLevelNav",t)},formatGBUnit:function(e){return u()(e).call(e,"MB")>-1?p()(e.replace("MB",""))/1024:u()(e).call(e,"KB")>-1?p()(e.replace("KB",""))/1024/1024:u()(e).call(e,"GB")>-1?p()(e.replace("GB","")):u()(e).call(e,"TB")>-1?1024*p()(e.replace("TB","")):0}}}}]);