"use strict";(self.webpackChunkdt_em_front=self.webpackChunkdt_em_front||[]).push([[3814,1633],{81633:(e,t,a)=>{a.r(t),a.d(t,{default:()=>f});var n=a(42723),l=a(88239),r=a(99663),s=a(49135),o=a(93196),c=a(67294),u=a(45697),i=a.n(u),d=a(94184),p=a.n(d),h=a(46871),m=function(e){function t(a){(0,r.default)(this,t);var n=(0,s.default)(this,e.call(this,a));n.handleChange=function(e){var t=n.props,a=t.disabled,r=t.onChange;a||("checked"in n.props||n.setState({checked:e.target.checked}),r&&r({target:(0,l.default)({},n.props,{checked:e.target.checked}),stopPropagation:function(){e.stopPropagation()},preventDefault:function(){e.preventDefault()},nativeEvent:e.nativeEvent}))},n.saveInput=function(e){n.input=e};var o="checked"in a?a.checked:a.defaultChecked;return n.state={checked:o},n}return(0,o.default)(t,e),t.getDerivedStateFromProps=function(e,t){return"checked"in e?(0,l.default)({},t,{checked:e.checked}):null},t.prototype.focus=function(){this.input.focus()},t.prototype.blur=function(){this.input.blur()},t.prototype.render=function(){var e,t=this.props,a=t.prefixCls,r=t.className,s=t.style,o=t.name,u=t.id,i=t.type,d=t.disabled,h=t.readOnly,m=t.tabIndex,f=t.onClick,y=t.onFocus,g=t.onBlur,v=t.autoFocus,b=t.value,k=(0,n.default)(t,["prefixCls","className","style","name","id","type","disabled","readOnly","tabIndex","onClick","onFocus","onBlur","autoFocus","value"]),E=Object.keys(k).reduce((function(e,t){return"aria-"!==t.substr(0,5)&&"data-"!==t.substr(0,5)&&"role"!==t||(e[t]=k[t]),e}),{}),Z=this.state.checked,C=p()(a,r,((e={})[a+"-checked"]=Z,e[a+"-disabled"]=d,e));return c.createElement("span",{className:C,style:s},c.createElement("input",(0,l.default)({name:o,id:u,type:i,readOnly:h,disabled:d,tabIndex:m,className:a+"-input",checked:!!Z,onClick:f,onFocus:y,onBlur:g,onChange:this.handleChange,autoFocus:v,ref:this.saveInput,value:b},E)),c.createElement("span",{className:a+"-inner"}))},t}(c.Component);m.propTypes={prefixCls:i().string,className:i().string,style:i().object,name:i().string,id:i().string,type:i().string,defaultChecked:i().oneOfType([i().number,i().bool]),checked:i().oneOfType([i().number,i().bool]),disabled:i().bool,onFocus:i().func,onBlur:i().func,onChange:i().func,onClick:i().func,tabIndex:i().oneOfType([i().string,i().number]),readOnly:i().bool,autoFocus:i().bool,value:i().any},m.defaultProps={prefixCls:"rc-checkbox",className:"",style:{},type:"checkbox",defaultChecked:!1,onFocus:function(){},onBlur:function(){},onChange:function(){}},(0,h.polyfill)(m);const f=m},5380:(e,t,a)=>{a.r(t),a.d(t,{AlertRulePage:()=>O,default:()=>B});var n=a(1068),l=a.n(n),r=a(68420),s=a(27344),o=a(5281),c=a(84441),u=a(3020),i=a(3362),d=a(44845),p=a(54103),h=a.n(p),m=a(41511),f=a.n(m),y=a(77149),g=a.n(y),v=a(33032),b=a.n(v),k=a(2991),E=a.n(k),Z=a(67294),C=a(97183),S=a(4107),_=a(34041),w=a(27049),F=a(45360),N=a(8263),R=a(77268),L=a(30381),x=a.n(L),P=a(19528),z=a(29027),A=a(96486);function I(e){var t=function(){if("undefined"==typeof Reflect||!l())return!1;if(l().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(l()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,i.Z)(e);if(t){var r=(0,i.Z)(this).constructor;a=l()(n,arguments,r)}else a=n.apply(this,arguments);return(0,u.Z)(this,a)}}var q=C.Z.Content,T=S.Z.Search,K=_.Z.Option,O=function(e){(0,c.Z)(a,e);var t=I(a);function a(e){var n;return(0,r.Z)(this,a),n=t.call(this,e),(0,d.Z)((0,o.Z)(n),"state",{list:[],query:void 0,state:"all",cur_parent_product:void 0,cur_parent_cluster:{id:-1},productList:[],page:1,size:20,total:0,selectedRowKeys:[]}),(0,d.Z)((0,o.Z)(n),"time",void 0),(0,d.Z)((0,o.Z)(n),"getColumns",(function(){var e=n.props.authorityList;return[{title:"告警名称",dataIndex:"name",key:"name",ellipsis:!0},{title:"状态",dataIndex:"state",key:"state",ellipsis:!0,render:function(e,t){var a=null;switch(t.state){case"ok":a=Z.createElement("span",null,Z.createElement("span",{className:"color-ok status-icon"}),t.state);break;case"pending":a=Z.createElement("span",null,Z.createElement("span",{className:"color-pending status-icon"}),t.state);break;case"alerting":a=Z.createElement("span",null,Z.createElement("span",{className:"color-alerting status-icon"}),t.state);break;case"no_data":a=Z.createElement("span",null,Z.createElement("span",{className:"color-no-data status-icon"}),t.state);break;case"paused":a=Z.createElement("span",null,Z.createElement("span",{className:"color-paused status-icon"}),t.state);break;default:a=Z.createElement("span",null,Z.createElement("span",{className:"color-no-data status-icon"}),t.state)}return a}},{title:"仪表盘名称",dataIndex:"dashboardSlug",key:"dashboardSlug",ellipsis:!0},{title:"仪表盘标题",dataIndex:"panelTitle",key:"panelTitle",ellipsis:!0},{title:"更新时间",dataIndex:"newStateDate",key:"newStateDate",render:function(e){return x()(e).format("YYYY-MM-DD HH:mm:ss")},ellipsis:!0},{title:"操作",key:"opreation",width:120,render:function(t,a){var l,r,s=e.alarm_record_open_close,c="/deploycenter/monitoring/dashdetail?url="+encodeURIComponent(a.url)+"&panelId="+a.panelId;return Z.createElement("span",null,Z.createElement("a",{onClick:h()(l=n.handleSwitchPauseState).call(l,(0,o.Z)(n),a,s)},"paused"===a.state?Z.createElement("span",null,"开始"):Z.createElement("span",null,"暂停")),Z.createElement(w.Z,{type:"vertical",style:{backgroundColor:"#3F87FF"}}),Z.createElement("a",{onClick:h()(r=n.handleLink).call(r,(0,o.Z)(n),c,s)},Z.createElement("span",null,"编辑")))}}]})),(0,d.Z)((0,o.Z)(n),"onSelectChange",(function(e){n.setState({selectedRowKeys:e})})),(0,d.Z)((0,o.Z)(n),"handleSwitchPauseState",(function(e,t){t?(null!=e&&e.state&&"paused"===(null==e?void 0:e.state)?e.paused=!1:null!=e&&e.state&&(e.paused=!0),P.jN.switchGrafanaAlertPause({alertId:(0,A.isArray)(null==e?void 0:e.selectedRowKeys)?null==e?void 0:e.selectedRowKeys.join(","):"".concat(null==e?void 0:e.id),paused:e.paused}).then((function(e){var t=n.state,a=t.state,l=t.query,r=t.cur_parent_product,s=t.page,o=t.size;n.setState({selectedRowKeys:[]},(function(){n.updateAlertRuleList({state:a,query:l,dashboardTag:r,page:s,size:o})}))}))):F.Z.error("权限不足，请联系管理员！")})),(0,d.Z)((0,o.Z)(n),"handleLink",(function(e,t){t?n.props.history.push(e):F.Z.error("权限不足，请联系管理员！")})),(0,d.Z)((0,o.Z)(n),"getProductList",(function(){P.t6.getParentProductList().then((function(e){0===(e=e.data).code&&n.setState({productList:e.data})}))})),(0,d.Z)((0,o.Z)(n),"onChangePage",(function(e,t){var a=n.state,l=a.state,r=a.cur_parent_product,s=a.query;n.setState({page:e,size:t}),n.updateAlertRuleList({state:l,query:s,dashboardTag:r,page:e,size:t})})),(0,d.Z)((0,o.Z)(n),"handleFilterAlertByQuery",(function(e){var t=n.state,a=t.state,l=t.cur_parent_product,r=t.page,s=t.size;n.setState({query:e}),n.updateAlertRuleList({state:a,query:e,dashboardTag:l,page:r,size:s})})),(0,d.Z)((0,o.Z)(n),"handleFilterAlertByState",(function(e){var t=n.state,a=t.cur_parent_product,l=t.size,r=t.query;n.setState({state:e,page:1}),n.updateAlertRuleList({state:e,query:r,dashboardTag:a,page:1,size:l})})),(0,d.Z)((0,o.Z)(n),"handleProductChange",(function(e){var t=n.state,a=t.state,l=t.size,r=t.query;n.setState({cur_parent_product:e,page:1}),n.updateAlertRuleList({state:a,query:r,dashboardTag:e,page:1,size:l})})),(0,d.Z)((0,o.Z)(n),"batchStop",(function(){var e=n.props.authorityList,t={selectedRowKeys:n.state.selectedRowKeys,paused:!0};n.handleSwitchPauseState(t,e.alarm_record_open_close)})),(0,d.Z)((0,o.Z)(n),"batchStart",(function(){var e=n.props.authorityList,t={selectedRowKeys:n.state.selectedRowKeys,paused:!1};n.handleSwitchPauseState(t,e.alarm_record_open_close)})),n}return(0,s.Z)(a,[{key:"componentDidMount",value:function(){var e=this.state,t=e.state,a=e.query,n=e.cur_parent_product,l=e.page,r=e.size;this.updateAlertRuleList({state:t,query:a,dashboardTag:n,page:l,size:r}),this.getProductList()}},{key:"updateAlertRuleList",value:function(e){var t=this;P.jN.getAlertRuleList(e).then((function(e){0===(e=e.data).code?t.setState({list:f()(e.data.data)?e.data.data:[],total:e.data.total},(function(){var e,a=g()(e=t.state.list).call(e,(function(e){return"pending"===e.state})),n=t.state,l=n.state,r=n.query,s=n.cur_parent_product,o=n.page,c=n.size;clearTimeout(t.time),a&&(t.time=b()((function(){t.updateAlertRuleList({state:l,query:r,dashboardTag:s,page:o,size:c})}),3e3))})):F.Z.error(e.msg)}))}},{key:"render",value:function(){var e=this,t=this.state,a=t.list,n=t.state,l=t.productList,r=void 0===l?[]:l,s=t.size,o=t.total,c=t.page,u=t.selectedRowKeys,i={size:"small",pageSize:s,total:o,current:c,onChange:this.onChangePage,showTotal:function(e){return Z.createElement("span",null,"共",Z.createElement("span",{style:{color:"#3F87FF"}},e),"条数据，每页显示",Z.createElement("span",{style:{color:"#3F87FF"}},s),"条")}},d={selectedRowKeys:u,onChange:this.onSelectChange};return Z.createElement(C.Z,{style:{height:"calc(100vh - 140px)"}},Z.createElement(q,null,Z.createElement("div",{className:"alert-rules-page"},Z.createElement("div",{className:"clearfix mb-12"},Z.createElement("span",null,"产品："),Z.createElement(_.Z,{className:"dt-form-shadow-bg mr-20",style:{width:264},placeholder:"请选择产品",onChange:this.handleProductChange},f()(r)&&E()(r).call(r,(function(e){return Z.createElement(K,{key:e,value:e},e)}))),Z.createElement(T,{className:"dt-form-shadow-bg mr-20",style:{width:264},placeholder:"请输入告警名称或仪表盘名称",onSearch:this.handleFilterAlertByQuery}),Z.createElement("span",null,"状态："),Z.createElement(_.Z,{className:"dt-form-shadow-bg",style:{width:264},defaultValue:"all",value:n,onChange:this.handleFilterAlertByState},Z.createElement(K,{value:"all"},"All"),Z.createElement(K,{value:"ok"},"OK"),Z.createElement(K,{value:"not_ok"},"Not OK"),Z.createElement(K,{value:"alerting"},"Alerting"),Z.createElement(K,{value:"no_data"},"No Data"),Z.createElement(K,{value:"paused"},"Paused"),Z.createElement(K,{value:"pending"},"Pending"))),Z.createElement(N.Z,{rowKey:"id",className:"dt-table-fixed-base",style:{height:"calc(100vh - 180px"},scroll:{y:!0},columns:this.getColumns(),rowSelection:d,dataSource:a,pagination:i}),Z.createElement("div",{style:{position:"absolute",bottom:35,left:40,zIndex:1e3}},Z.createElement(R.Z,{onClick:function(){return e.batchStop()}},"批量暂停"),"  ",Z.createElement(R.Z,{onClick:function(){return e.batchStart()}},"批量开始")))))}}]),a}(Z.Component);const B=(0,z.$j)((function(e){return{HeaderStore:e.HeaderStore,authorityList:e.UserCenterStore.authorityList}}))(O)}}]);