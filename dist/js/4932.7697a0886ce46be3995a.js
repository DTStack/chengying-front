"use strict";(self.webpackChunkdt_em_front=self.webpackChunkdt_em_front||[]).push([[4932],{4482:(e,t,n)=>{n.r(t),n.d(t,{addIpToConfig:()=>_,cancelDeploy:()=>N,forceStop:()=>w,forceUninstall:()=>b,getCurrentUnDepolyList:()=>I,getDeployList:()=>P,getIsFirstSmooth:()=>u,getServiceIpList:()=>h,getUnDeployLog:()=>F,getUnDepolyList:()=>k,getUndeploy:()=>x,getUpgradeType:()=>s,handleSetServiceIp:()=>y,modifyConfigConfig:()=>m,modifyInstanceConfig:()=>p,modifyIpConfig:()=>v,modifyServiceConfig:()=>f,modifyServiceInput:()=>d,resetDeployStatus:()=>C,resetServiceConfig:()=>g,returnToStepOne:()=>S,saveForcedUpgrade:()=>l,startProductDeploy:()=>E,startUnDeployService:()=>L,switchUseCloudByProduct:()=>D,updateIpsByService:()=>Z,updateProductConfig:()=>i});var a=n(45360),r=n(56466),o=n(19528),c=n(64143),i=function(e){return function(t){o.aJ.getProductConfig({productName:e.product_name,productVersion:e.product_version}).then((function(e){0===(e=e.data).code?t({type:r.Eo.UPDATE_PRD_CONFIG,payload:e.data.list[0]}):a.Z.error(e.msg)}))}},l=function(e){return{type:r.Eo.SAVE_FORCED_UPGRADE,payload:e}},s=function(e){return{type:r.Eo.UPGRADE_TYPE,payload:e}},u=function(e){return{type:r.Eo.GET_FIRST_SMOOTH,payload:e}},d=function(e){return 0===e.type?{type:r.Eo.MODIFY_INSTANCE_CONFIG,payload:e}:{type:r.Eo.MODIFY_CONFIG_CONFIG,payload:e}},p=function(e){return{type:r.Eo.MODIFY_INSTANCE_CONFIG,payload:e}},m=function(e){return{type:r.Eo.MODIFY_CONFIG_CONFIG,payload:e}},f=function(e){return function(t){o.aJ.motifyServiceConfig({productName:e.product_name,serviceName:e.service_name},{field_path:e.field_path,field:e.field}).then((function(n){0===(n=n.data).code?(n.data&&a.Z.warning(n.data),t(i(e))):a.Z.error(n.msg)}))}},g=function(e){var t=e.service_name;return function(n){o.aJ.resetSchemaField({productName:e.product_name,serviceName:e.service_name},{field_path:e.field_path,product_version:e.product_version}).then((function(c){0===(c=c.data).code?o.aJ.getProductConfig({productName:e.product_name,productVersion:e.product_version}).then((function(c){0===(c=c.data).code?(n({type:r.Eo.UPDATE_PRD_CONFIG,payload:c.data.list[0]}),o.aJ.getIp({productName:e.product_name,serviceName:e.service_name}).then((function(e){0===(e=e.data).code?n({type:r.Eo.GET_SERVICE_IPS,payload:{service_name:t,ips:e.data.ip}}):a.Z.error(e.msg)}))):a.Z.error(c.msg)})):a.Z.error(c.msg)}))}},h=function(e){var t=e.service_name;return function(n){o.aJ.getIp({productName:e.product_name,serviceName:e.service_name}).then((function(e){0===(e=e.data).code?n({type:r.Eo.GET_SERVICE_IPS,payload:{service_name:t,ips:e.data.ip||[]}}):a.Z.error(e.msg)}))}},v=function(e,t,n){return{type:r.Eo.UPDATE_IP_CONFIG,payload:{pindex:e,index:t,ip:n}}},y=function(e){return function(t){o.aJ.setIp({serviceName:e.service_name,productName:e.product_name},{ip:e.ip}).then((function(n){0===(n=n.data).code?(t({type:r.Eo.GET_SERVICE_IPS,payload:{service_name:e.service_name,ips:e.ip?e.ip.split(","):[]}}),t(i(e))):a.Z.error(n.msg)}))}},_=function(e){return{type:r.Eo.ADD_IP_TO_CONFIG,payload:{pindex:e}}},Z=function(e,t){return{type:r.Eo.UPDATE_IP_BY_SERVICE,payload:{service:e,ips:t}}},E=function(e,t){return function(n){o.aJ.deploy({productName:e.product_name,productVersion:e.product_version}).then((function(e){0===(e=e.data).code?(n({type:r.Eo.START_PRD_DEPLOY,payload:{deploy_uuid:e.data.deploy_uuid,deploy_status:!0}}),t()):a.Z.error(e.msg)}))}},S=function(){return{type:r.Eo.RETURN_TO_CONFIG}},P=function(e,t){return function(n){o.aJ.getProductConfig({productName:e.product_name,productVersion:e.product_version}).then((function(c){0===(c=c.data).code?(n({type:r.Eo.UPDATE_DEPLOY_STATUS,payload:c.data.list[0].status}),o.aJ.getDeployList({deployUuid:e.deploy_uuid}).then((function(e){if(0===e.code)return n({type:r.Eo.UPDATE_DEPLOY_LIST,payload:{list:e.data.list,complete:e.data.complete}});a.Z.error(e.msg)})),"deploying"!==c.data.list[0].status&&t(c)):a.Z.error(c.msg)}))}},C=function(){return{type:r.Eo.RESET_DEPLOY_STATUS}},D=function(e){return{type:r.Eo.SWITH_USE_CLOUD,payload:e}},N=function(e){return function(t){o.aJ.cancelDeploy({productName:e.product_name,productVersion:e.product_version}).then((function(e){0===(e=e.data).code?a.Z.success("已停止部署！"):a.Z.error(e.msg)}))}},L=function(e){return function(t){o.aJ.unDeployService({productName:e.product_name,productVersion:e.product_version},{clusterId:e.clusterId,namespace:e.namespace}).then((function(e){var n=e.data;0===n.code?t({type:r.l2.START_UNDEPLOY,payload:{deploy_uuid:n.data.deploy_uuid,autoRefresh:!0}}):a.Z.error(n.msg)}))}},x=function(e){var t=e.deploy_uuid,n=e.autoRefresh,a=e.complete;return{type:r.l2.START_UNDEPLOY,payload:{deploy_uuid:t,autoRefresh:n,complete:a}}},k=function(e){return function(t){o.aJ.getUnDeployList({deployUuid:e.deployUuid,start:e.start,status:e.status,limit:e.limit}).then((function(e){if(0===e.data.code){var n=e.data.data.count-e.data.data.list&&e.data.data.list.length;t({type:r.l2.UPDATE_UNDEPLOY_LIST,payload:{unDeployList:e.data.data.list||[],complete:e.data.data.complete,start:n,count:e.data.data.count}})}else a.Z.error(e.data.msg)}))}},I=function(e){return function(t){o.aJ.getUnDeployList({deployUuid:e.deployUuid,start:e.start,status:e.status,limit:e.limit}).then((function(e){0===e.data.code?t({type:r.l2.UPDATE_CURRENT_UNDEPLOY_LIST,payload:{unDeployList:e.data.data.list||[],complete:e.data.data.complete,count:e.data.data.count}}):a.Z.error(e.data.msg)}))}},w=function(e,t){return function(n){o.aJ.forceStop(e).then((function(e){c.Z.serviceCallback(e,"强制卸载成功！",t)}))}},b=function(e,t){return function(n){o.aJ.forceUninstall(e).then((function(e){c.Z.serviceCallback(e,"强制卸载成功！",t)}))}},F=function(e){return function(t){o.aJ.getUnDeployLog(e).then((function(e){0===e.code?t({type:r.l2.GET_UNDEPLOY_LOG,payload:{unDeployLog:e.data||""}}):a.Z.error(e.msg)}))}}},28568:(e,t,n)=>{n.d(t,{Z:()=>x});var a=n(1068),r=n.n(a),o=n(68420),c=n(27344),i=n(5281),l=n(84441),s=n(3020),u=n(3362),d=n(44845),p=n(2991),m=n.n(p),f=n(25843),g=n.n(f),h=n(77766),v=n.n(h),y=n(67294),_=n(34041),Z=n(85733),E=n(30258),S=n(31097),P=n(4107),C=n(67908);function D(e){var t=function(){if("undefined"==typeof Reflect||!r())return!1;if(r().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(r()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,u.Z)(e);if(t){var o=(0,u.Z)(this).constructor;n=r()(a,arguments,o)}else n=a.apply(this,arguments);return(0,s.Z)(this,n)}}var N=_.Z.Option,L=Z.Z.TreeNode,x=function(e){(0,l.Z)(n,e);var t=D(n);function n(e){var a;return(0,o.Z)(this,n),a=t.call(this,e),(0,d.Z)((0,i.Z)(a),"state",{first_logfile:"",second_logfile:"",show_second_select:!1,second_logs:[],log_message:"",lineNum:"200",searchText:"",sourceText:"",query:""}),(0,d.Z)((0,i.Z)(a),"onSearch",(function(e){a.setState({query:e},(function(){a.setLogMessage(a.props.content,!1)}))})),(0,d.Z)((0,i.Z)(a),"setContent",(function(e){var t=a.setQueryKey(e),n=new RegExp(/([\S ]*ERROR[\S ]*)/,"gi");return t.replace(n,'<span style="color: red">$1</span>')})),(0,d.Z)((0,i.Z)(a),"setQueryKey",(function(e){var t=a.state.query;if(""===t)return e;var n=t.toLowerCase(),r=new RegExp("(".concat(n,")"),"gi");return e.replace(r,'<span style="color: #2391F7">$1</span>')})),(0,d.Z)((0,i.Z)(a),"setLogMessage",(function(e,t){var n=a.props.fileGoBottom,r=document.getElementById("textPre");r&&(r.innerHTML=a.setContent(e||""),(void 0===t?n:t)&&document.getElementsByClassName("log-message-box").length>0&&document.getElementsByClassName("log-message-box")[0].scrollTo(0,r.offsetHeight))})),(0,d.Z)((0,i.Z)(a),"renderServiceSelect",(function(){var e=a.props,t=e.serviceData,n=e.onSelectedService;return y.createElement(Z.Z,{showSearch:!0,style:{width:200,marginRight:10},dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:"按服务搜索",allowClear:!0,treeDefaultExpandAll:!0,onChange:n},function(e){var t=[],n=function(n){if(Object.prototype.hasOwnProperty.call(e,n)){var a=e[n];t.push(y.createElement(L,{value:n,title:n,key:n,selectable:!1},a&&m()(a).call(a,(function(e){return y.createElement(L,{isLeaf:!0,value:e.service_name,title:e.service_name_display,key:n+"-"+e.service_name})}))))}};for(var a in e)n(a);return t}(t))})),a}return(0,c.Z)(n,[{key:"componentDidMount",value:function(){this.setLogMessage(this.props.content)}},{key:"componentDidUpdate",value:function(e,t){var n=document.getElementById("textPre");this.props.content===e.content&&this.props.content&&!n.innerHTML&&this.setLogMessage(this.props.content),this.props.content!==e.content&&this.setLogMessage(this.props.content)}},{key:"render",value:function(){var e=this.props,t=e.visible,n=e.onCancel,a=e.title,r=e.maskClosable,o=e.onSelectedFile,c=e.fileList,i=e.content,l=e.selectedFile,s=e.serviceData,u=e.loading;return y.createElement(E.Z,{className:"logtail-box",destroyOnClose:!0,title:a,footer:null,width:800,visible:t,maskClosable:r,onCancel:n},y.createElement("div",{className:"logtail-box"},y.createElement("div",{className:"option-bar",style:{display:"flex"}},s&&y.createElement("span",null,this.renderServiceSelect()),c?y.createElement(_.Z,{allowClear:!0,showSearch:!0,placeholder:"选择文件",value:l,style:{width:200,marginBottom:10,marginRight:10},onChange:o},m()(c).call(c,(function(e,t){var n,a=g()(e).call(e);return y.createElement(N,{key:v()(n="".concat(a,"-")).call(n,t),value:a},y.createElement(S.Z,{title:a},a))}))):null,y.createElement(P.Z.Search,{placeholder:"输入关键词",style:{width:200,marginBottom:10},onSearch:this.onSearch})),y.createElement("div",{className:"log-message-box",style:{height:"400px",paddingTop:"10px",overflowY:"auto",backgroundColor:"#F5F5F5",border:"1px dashed #DDDDDD"}},i?y.createElement("pre",{id:"textPre",style:{paddingLeft:10,height:"auto"}}):null,""===i?y.createElement("div",{style:{lineHeight:"380px",color:"#dddddd",textAlign:"center"}},"没有记录"):null,null===i?y.createElement("div",{style:{lineHeight:"380px",color:"#dddddd",textAlign:"center"}},"请选择上方过滤条件"):null,u&&i&&y.createElement(C.Z,{className:"ml-10",type:"loading"}))))}}]),n}(y.Component)},18274:(e,t,n)=>{n.d(t,{E9:()=>i,MD:()=>a,OY:()=>o,RI:()=>c,XN:()=>r});var a=[{text:"部署成功",value:"deployed"},{text:"部署失败",value:"deploy fail"},{text:"部署中",value:"deploying"},{text:"卸载失败",value:"undeploy fail"},{text:"卸载中",value:"undeploying"}],r=[{text:"更新成功",value:"success"},{text:"更新失败",value:"fail"},{text:"更新中",value:"update"}],o={hosts:["主机集群"],kubernetes:["Kubernetes集群（自建集群）","Kubernetes集群（导入已有集群）"]},c={hosts:{title:"主机安装会经过2个状态：管控安装-主机初始化，若某一步安装失败，请查看具体日志。",filters:[{text:"管控安装成功",value:"管控安装成功"},{text:"管控安装失败",value:"管控安装失败"},{text:"script安装成功",value:"script安装成功"},{text:"script安装失败",value:"script安装失败"},{text:"主机初始化成功",value:"主机初始化成功"},{text:"主机初始化失败",value:"主机初始化失败"}],finalStatus:3},kubernetes:{title:"Kubernetes集群主机安装会经过5个状态：管控安装-主机初始化-K8S Docker初始化-K8S Node初始化-K8S Node部署成功，若某一步安装失败，请查看具体日志",filters:[{text:"管控安装失败",value:"管控安装失败",status:-1},{text:"管控安装成功",value:"管控安装成功",status:1},{text:"主机初始化失败",value:"主机初始化失败",status:-3},{text:"主机初始化成功",value:"主机初始化成功",status:3},{text:"K8S DOCKER初始化失败",value:"K8S DOCKER初始化失败",status:-5},{text:"K8S DOCKER初始化成功",value:"K8S DOCKER初始化成功",status:5},{text:"K8S NODE初始化失败",value:"K8S NODE初始化失败",status:-6},{text:"K8S NODE初始化成功",value:"K8S NODE初始化成功",status:6},{text:"K8S NODE部署失败",value:"K8S NODE部署失败",status:-7},{text:"K8S NODE部署成功",value:"K8S NODE部署成功",status:7}],finalStatus:7}},i={NAMESPACE:"em_current_k8s_namespace"}},14932:(e,t,n)=>{n.r(t),n.d(t,{default:()=>he});var a,r=n(1068),o=n.n(r),c=n(73126),i=n(68420),l=n(27344),s=n(5281),u=n(84441),d=n(3020),p=n(3362),m=n(44845),f=n(77766),g=n.n(f),h=n(51942),v=n.n(h),y=n(86902),_=n.n(y),Z=n(2991),E=n.n(Z),S=n(31581),P=n.n(S),C=n(20116),D=n.n(C),N=n(33032),L=n.n(N),x=n(94198),k=n.n(x),I=n(67294),w=n(34041),b=n(4107),F=n(45360),T=n(67908),O=n(38272),R=n(71230),U=n(15746),A=n(45334),M=n(99210),B=n(87558),G=n(52553),K=n(80403),V=n(77268),Y=n(30258),J=n(69035),H=n(96486),j=n(19528),z=n(54103),q=n.n(z),$=n(29027),W=n(27049),Q=n(8263),X=n(15857),ee=n(35969),te=n(4482),ne=n(6101),ae=n(64143);function re(e){var t=function(){if("undefined"==typeof Reflect||!o())return!1;if(o().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(o()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,p.Z)(e);if(t){var r=(0,p.Z)(this).constructor;n=o()(a,arguments,r)}else n=a.apply(this,arguments);return(0,d.Z)(this,n)}}var oe=w.Z.Option;const ce=(0,$.$j)((function(e){return{authorityList:e.UserCenterStore.authorityList}}),(function(e){return{unDeployActions:(0,X.DE)(v()({},te),e)}}))(a=function(e){(0,u.Z)(n,e);var t=re(n);function n(){var e,a;(0,i.Z)(this,n);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return a=t.call.apply(t,g()(e=[this]).call(e,o)),(0,m.Z)((0,s.Z)(a),"state",{loading:!1,searchParam:{clusterId:0,productName:void 0,parentProductName:void 0,productVersion:void 0,deploy_status:"","sort-by":"create_time","sort-dir":"desc",limit:10,start:0},unDeployRecord:"",activeKey:"",modalStatus:"",selectedRecord:void 0,currentPage:1,showModal:!1}),(0,m.Z)((0,s.Z)(a),"handleDelProduct",(function(e,t){if(t){var n=a.props.componentData.list;Y.Z.confirm({title:"确定删除此安装包？",content:"删除后，再次部署时需要再次上传。",icon:I.createElement(T.Z,{type:"exclamation-circle",theme:"filled"}),okType:"danger",onOk:function(){ee.Z.deleteProducyPackage({productName:e.product_name,productVersion:e.product_version}).then((function(e){0===(e=e.data).code?n.length>1?a.props.getDataList():a.props.getParentProductsList():F.Z.error(e.msg)}))}})}else F.Z.error("权限不足，请联系管理员！")})),(0,m.Z)((0,s.Z)(a),"renderOption",(function(e){return E()(e).call(e,(function(e,t){return I.createElement(oe,{key:t+"",value:e},e)}))})),(0,m.Z)((0,s.Z)(a),"handleTableChange",(function(e,t,n){var r,o=v()(a.state.searchParam);(t.type&&(o.type=t.type[0]),o.start=e.current-1,o.deploy_status=t.status,t.product_type)&&(o.product_type=E()(r=t.product_type).call(r,(function(e){return+e})).join(","));if(n){var c=n.field,i=n.order;i&&(o["sort-dir"]="descend"===i?"desc":"asc"),c&&(o["sort-by"]=c)}a.setState({searchParam:o,currentPage:e.current},(function(){return a.props.getDataList(o)}))})),(0,m.Z)((0,s.Z)(a),"goToDeplay",(function(e,t){if(t){a.props.unDeployActions.saveForcedUpgrade([]),a.props.unDeployActions.getIsFirstSmooth(!1),a.props.unDeployActions.getUpgradeType("");var n="/deploycenter/appmanage/installs?type="+(0===e.product_type?"hosts":"kubernetes")+"&product_version="+e.product_version+"&product_name="+e.product_name+"&id="+e.id+"&from="+a.props.location.pathname;ae.Z.setNaviKey("menu_deploy_center","sub_menu_product_deploy"),a.props.history.push(n)}else F.Z.error("权限不足，请联系管理员！")})),(0,m.Z)((0,s.Z)(a),"getTableColumns",(function(){var e=a.props.authorityList,t=e.package_view,n=e.sub_menu_product_deploy,r=e.package_upload_delete;return[{title:"组件名称",dataIndex:"product_name_display"},{title:"组件版本号",dataIndex:"product_version",key:"product_version",sorter:!0,render:function(e,t){return I.createElement("span",null,e,1===t.is_current_version&&I.createElement(T.Z,{style:{marginLeft:3},type:"star"}))}},{title:"安装包类型",dataIndex:"product_type",key:"product_type",filters:[{text:"传统包",value:"0"},{text:"Kubernetes包",value:"1"}],render:function(e){return I.createElement("span",null,e?"Kubernetes包":"传统包")}},{title:"上传时间",key:"create_time",dataIndex:"create_time",sorter:!0},{title:"上传人",dataIndex:"username",key:"username",render:function(e,t){return e||"--"}},{title:"查看",dataIndex:"visit",render:function(e,n){return I.createElement(I.Fragment,null,t?I.createElement("a",{onClick:function(){return a.setState({selectedRecord:n})}},"配置"):"--")}},{title:"操作",dataIndex:"action",render:function(e,t){var o;return I.createElement(I.Fragment,null,I.createElement(I.Fragment,null,I.createElement("a",{onClick:function(){return a.goToDeplay(t,n)}},"部署"),I.createElement(W.Z,{type:"vertical"})),!t.is_current_version&&I.createElement("a",{onClick:q()(o=a.handleDelProduct).call(o,(0,s.Z)(a),t,r)},"删除"))}}]})),(0,m.Z)((0,s.Z)(a),"render",(function(){var e=a.state,t=e.loading,n=e.searchParam,r=e.currentPage,o=a.props.componentData,c={size:"small",pageSize:n.limit,total:o.count,current:r,showTotal:function(e){return I.createElement("span",null,"共",I.createElement("span",{style:{color:"#3F87FF"}},e),"条数据，每页显示",n.limit,"条")}};return I.createElement(I.Fragment,null,I.createElement(Q.Z,{rowKey:"id",className:"dt-table-fixed-base",style:{height:"calc(100vh - 136px)"},columns:a.getTableColumns(),dataSource:o.list,scroll:{y:!0},pagination:c,loading:t,onChange:a.handleTableChange}),I.createElement(ne.Z,{componentData:a.state.selectedRecord,onClose:function(){return a.setState({selectedRecord:void 0})},shouldGetAll:!0}))})),a}return(0,l.Z)(n,null,[{key:"getDerivedStateFromProps",value:function(e,t){var n=t.searchParam,a=n.parentProductName,r=n.productVersion,o=n.productName;return e.parentProductName!==a||e.productVersion!==r||e.productName!==o?{currentPage:1,searchParam:v()({},t.searchParam,{parentProductName:e.parentProductName,productVersion:e.productVersion,productName:e.productName,start:0})}:null}}]),n}(I.Component))||a;var ie,le=n(9669),se=n.n(le);function ue(e){var t=function(){if("undefined"==typeof Reflect||!o())return!1;if(o().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(o()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,p.Z)(e);if(t){var r=(0,p.Z)(this).constructor;n=o()(a,arguments,r)}else n=a.apply(this,arguments);return(0,d.Z)(this,n)}}var de=w.Z.Option,pe=b.Z.Search,me=null,fe={},ge=(0,$.$j)((function(e){return{authorityList:e.UserCenterStore.authorityList}}),void 0)(ie=function(e){(0,u.Z)(n,e);var t=ue(n);function n(){var e,a;(0,i.Z)(this,n);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return a=t.call.apply(t,g()(e=[this]).call(e,o)),(0,m.Z)((0,s.Z)(a),"state",{productList:[],componentList:[],loading:!1,searchParam:{clusterId:0,productName:void 0,parentProductName:void 0,productVersion:void 0,deploy_status:"","sort-by":"create_time","sort-dir":"desc",limit:10,start:0},componentData:{list:[],count:0},visible:!1,fileList:[],isShowPag:!1,interFileList:[]}),(0,m.Z)((0,s.Z)(a),"getParentProductsList",(function(e){j.t6.getParentProductList({limit:0}).then((function(t){if(0===(t=t.data).code){var n=t.data;a.setState({productList:n}),n&&n.length>0?a.getProductComponents({parentProductName:e||n[0]}):a.resetPages()}else F.Z.error(t.msg)}))})),(0,m.Z)((0,s.Z)(a),"resetPages",(function(){a.setState({productList:[],componentList:[],searchParam:{clusterId:0,productName:void 0,parentProductName:void 0,productVersion:void 0,deploy_status:"","sort-by":"create_time","sort-dir":"desc",limit:10,start:0},componentData:{list:[],count:0}})})),(0,m.Z)((0,s.Z)(a),"getDataList",(function(e){var t=v()({},e&&_()(e).length?e:a.state.searchParam);t.parentProductName&&(t.start=t.start*t.limit,t.deploy_status&&(t.deploy_status=t.deploy_status.join(",")),t.productName&&(t.productName=t.productName.join(",")),a.setState({loading:!0}),j.t6.getAllProducts(t).then((function(e){if(0===(e=e.data).code){var t=e.data;a.setState({componentData:t})}else F.Z.error(e.msg);a.setState({loading:!1})})))})),(0,m.Z)((0,s.Z)(a),"getProductComponents",(function(e){var t=v()({},a.state.searchParam,e);j.BZ.getProductName({clusterId:0,parentProductName:e.parentProductName}).then((function(e){if(0===(e=e.data).code){var n,r=e.data.list;n=(0,H.uniqBy)(r,"product_name"),a.setState({componentList:n,searchParam:t},(function(){a.getDataList()}))}else F.Z.error(e.msg)}))})),(0,m.Z)((0,s.Z)(a),"handleSelectChange",(function(e){var t=v()({},a.state.searchParam,{parentProductName:e,productName:void 0,productVersion:void 0});a.setState({searchParam:t},(function(){a.getProductComponents(t)}))})),(0,m.Z)((0,s.Z)(a),"handleComponentSearch",(function(e){var t=v()({},a.state.searchParam,{productVersion:e});a.setState({searchParam:t},a.getDataList)})),(0,m.Z)((0,s.Z)(a),"onComponentChange",(function(e){a.setState({searchParam:v()({},a.state.searchParam,{productName:e,deploy_status:""})},a.getDataList)})),(0,m.Z)((0,s.Z)(a),"renderProducts",(function(){var e=a.state,t=e.productList,n=e.searchParam,r=t&&E()(t).call(t,(function(e,t){return I.createElement(de,{key:"".concat(t),value:e},I.createElement(T.Z,{type:"appstore-o",style:{marginRight:"6px"}}),e)}));return I.createElement(w.Z,{className:"dt-form-shadow-bg",style:{width:180},size:"default",placeholder:"选择产品",value:n.parentProductName,onChange:a.handleSelectChange},r)})),(0,m.Z)((0,s.Z)(a),"showModal",(function(){var e=a.props.authorityList;ae.Z.noAuthorityToDO(e,"package_upload_delete")||a.setState({visible:!0})})),(0,m.Z)((0,s.Z)(a),"hideModal",(function(){a.setState({visible:!1}),a.props.form.resetFields()})),(0,m.Z)((0,s.Z)(a),"Verifylink",(function(e){j.t6.Verifylink(e).then((function(t){var n=t.data,r=n.code,o=n.msg;0===r?(a.hideModal(),a.addNetworkPackages(e),a.props.form.resetFields()):(a.showModal(),F.Z.warning(o))}))})),(0,m.Z)((0,s.Z)(a),"addNetworkPackages",(function(e){j.t6.addNetworkPackage(e).then((function(e){var t=e.data,n=t.msg;0===t.code?F.Z.success(n):F.Z.error(n),a.getDataList()})),a.getProductpackageList()})),(0,m.Z)((0,s.Z)(a),"getProductpackageList",(function(){me=P()((function(){j.t6.getProductpackageList().then((function(e){var t=e.data.data.data;a.setState({interFileList:t}),0===t.length&&clearInterval(me)}))}),500)})),(0,m.Z)((0,s.Z)(a),"handleSubmit",(function(e){e.preventDefault(),a.props.form.validateFields((function(e,t){if(!e){var n=t.TextArea.split("\n");a.Verifylink({name:n})}}))})),(0,m.Z)((0,s.Z)(a),"delPackage",(function(e){var t=a.state.fileList;E()(t).call(t,(function(t,n){return e===n&&(t.status="removed"),t})),a.setState({fileList:t})})),(0,m.Z)((0,s.Z)(a),"delInterPackage",(function(e,t){j.t6.delProductPackageItem({record_id:t[e].id}).then((function(e){var t=e.data.data;a.setState({interFileList:null!=t?t:[]})}))})),(0,m.Z)((0,s.Z)(a),"istrueShow",(function(){a.setState({isShowPag:!a.state.isShowPag})})),(0,m.Z)((0,s.Z)(a),"isfalseShow",(function(){a.setState({isShowPag:!1},(function(){!0!==a.state.isShowPag?clearInterval(me):a.getProductpackageList()}))})),(0,m.Z)((0,s.Z)(a),"handleChange",(function(e){var t=e.event,n=e.file,r=e.fileList;t&&(r=D()(r).call(r,(function(e){return"error"!=e.status})),n&&"removed"===n.status&&(r=D()(r).call(r,(function(e){return"removed"!=e.status})),"removed"===n.status&&fe[n.uid].abort()),n&&"100.00"===n.percent&&(r=D()(r).call(r,(function(e){return"100.00"!=e.percent})),L()((function(){a.getDataList()}),1e3)),r=D()(r).call(r,(function(e){return"done"!==e.status})),a.setState({fileList:r}))})),(0,m.Z)((0,s.Z)(a),"Iporgrss",(function(e,t){return I.createElement("div",null,I.createElement("div",{style:{position:"absolute",top:115,right:14,display:"".concat(!0===a.state.isShowPag?"block":"none")}},e.length||0!==t.length?I.createElement(O.Z,{itemLayout:"vertical",size:"small",split:!1,style:{width:300,height:500,maxHeight:500,overflow:"hidden",overflowY:"auto",backgroundColor:"#fff",borderRadius:"3px",boxShadow:"0px 0px 8px #ccc",paddingTop:"10px",zIndex:9999}},I.createElement("div",{style:{position:"absolute",top:8,right:10,zIndex:999,display:"".concat(!0===a.state.isShowPag?"block":"none")}},I.createElement(T.Z,{onClick:a.isfalseShow,type:"close"})),I.createElement("div",{style:{width:"80%",height:"30px",textAlign:"center",lineHeight:"30px",border:"2px solid #ffe58f",borderRadius:5,backgroundColor:"#fffbe6",margin:"0px auto"}},I.createElement(T.Z,{type:"exclamation-circle",theme:"filled",style:{color:"#ffe58f",fontSize:16}})," ",I.createElement("span",null,"安装包上传中，请勿刷新页面")),0===e.length?"":E()(e).call(e,(function(e,t){return I.createElement(O.Z.Item,{key:t,style:{paddingLeft:20}},I.createElement(R.Z,{justify:"center"},I.createElement(U.Z,{span:23},I.createElement("span",{style:{fontSize:10}},e.name))),I.createElement(R.Z,{justify:"start"},I.createElement(U.Z,{span:2},I.createElement(T.Z,{theme:"outlined",style:{color:"#1890ff"},type:100!==e.percent?"loading":"check-circle"})),I.createElement(U.Z,{span:18},I.createElement(A.Z,{strokeWidth:3,size:"small",status:"active",percent:k()(e.percent)})),I.createElement(U.Z,{span:2},I.createElement(T.Z,{theme:"outlined",style:{color:"#1890ff",paddingLeft:10},onClick:function(){return a.delPackage(t)},type:"delete"}))))})),0===t.length?"":E()(t).call(t,(function(e,n){return I.createElement(O.Z.Item,{key:n,style:{paddingLeft:20}},I.createElement(R.Z,{justify:"center"},I.createElement(U.Z,{span:23},I.createElement("span",{style:{fontSize:10}},e.name))),I.createElement(R.Z,{justify:"start"},I.createElement(U.Z,{span:2},I.createElement(T.Z,{theme:"outlined",style:{color:"#1890ff"},type:100!==e.percent?"loading":"check-circle"})),I.createElement(U.Z,{span:18},I.createElement(A.Z,{strokeWidth:3,size:"small",status:"active",percent:k()(e.percent)})),I.createElement(U.Z,{span:2},I.createElement(T.Z,{theme:"outlined",style:{color:"#1890ff",paddingLeft:10},onClick:function(){return a.delInterPackage(n,t)},type:"delete"}))))}))):""))})),(0,m.Z)((0,s.Z)(a),"customRequest",(function(e){var t=e.action,n=e.file,a=e.filename,r=e.headers,o=(e.onError,e.onProgress),c=e.onSuccess,i=e.withCredentials,l=new FormData;l.append(a,n);var s=se().CancelToken.source();se().post(t,l,{withCredentials:i,headers:r,onUploadProgress:function(e){var t=e.total,a=e.loaded;o({percent:Math.round(a/t*100).toFixed(2),name:n.name,uid:n.uid})},cancelToken:s.token}).then((function(e){var t=e.data;if(0!==(null==t?void 0:t.code))return F.Z.error(t.msg);c(t,n)})).catch((function(e){})),fe[n.uid]={abort:function(){s.cancel()}}})),a}return(0,l.Z)(n,[{key:"componentDidMount",value:function(){this.getParentProductsList()}},{key:"render",value:function(){var e,t,n=this,a=this.state,r=a.componentList,o=a.searchParam,i=a.componentData,l=a.visible,s=a.fileList,u=a.interFileList,d=this.props,p=d.authorityList,m=d.history,f=g()(e=g()(t="".concat(o.parentProductName,"-")).call(t,o.productName,"-")).call(e,o.productVersion),h={name:"package",action:"/api/v2/product/upload",accept:".tar",onChange:this.handleChange,showUploadList:!1,openFileDialogOnClick:!!p.package_upload_delete,customRequest:function(e){return n.customRequest(e)}},v=I.createElement("div",null,I.createElement(M.Z,null,I.createElement(M.Z.Item,null,I.createElement(B.Z,h,I.createElement("a",{onClick:function(){return ae.Z.noAuthorityToDO(p,"package_upload_delete")}},"上传本地包"))),I.createElement(M.Z.Item,null,I.createElement("a",{onClick:this.showModal,style:{color:"#3F87FF"},className:"ant-upload ant-upload-select ant-upload-select-text"},"来自网络")))),y=this.props.form.getFieldDecorator;return I.createElement("div",{className:"app-manager-container product-package-container"},I.createElement("div",{className:"clearfix mb-12"},I.createElement(I.Fragment,null,I.createElement("span",{className:"mr-20"},"产品：",this.renderProducts()),I.createElement("span",{className:"mr-20"},"组件名称：",I.createElement(w.Z,{className:"dt-form-shadow-bg",mode:"multiple",size:"default",placeholder:"选择组件",value:this.state.searchParam.productName,style:{width:180},onChange:this.onComponentChange},r&&E()(r).call(r,(function(e){return I.createElement(de,{"data-testid":"option-".concat(e.product_name_display),key:e.product_name},e.product_name)})))),I.createElement("span",{className:"mr-20"},I.createElement(pe,{className:"dt-form-shadow-bg",style:{width:264},placeholder:"按组件版本号搜索",onSearch:this.handleComponentSearch}))),I.createElement("div",{className:"fl-r"},I.createElement("a",{onClick:this.istrueShow},I.createElement(G.Z,{count:s.length||0!==u.length?s.length+u.length:0},I.createElement(K.Z,{overlay:v,placement:"bottomLeft"},I.createElement(V.Z,{type:"primary"},"上传组件安装包")))))),I.createElement(ce,(0,c.Z)({key:"component-list"+f},this.state.searchParam,{location:location,history:m,componentData:i,getDataList:this.getDataList,getParentProductsList:this.getParentProductsList})),this.Iporgrss(s,u),I.createElement(Y.Z,{title:"来自网络",visible:l,onOk:this.handleSubmit,onCancel:this.hideModal},I.createElement(J.Z,{name:"basic",labelCol:{span:4},wrapperCol:{span:20}},I.createElement(J.Z.Item,{label:"地址"},y("TextArea",{rules:[{required:!0,message:"请输入地址"}]})(I.createElement(b.Z.TextArea,{placeholder:"请输入安装包地址，多个地址间需换行输入"}))))))}}]),n}(I.Component))||ie;const he=J.Z.create()(ge)},6101:(e,t,n)=>{n.d(t,{Z:()=>S});var a=n(1068),r=n.n(a),o=n(44930),c=n(68420),i=n(27344),l=n(5281),s=n(84441),u=n(3020),d=n(3362),p=n(44845),m=n(63109),f=n.n(m),g=n(77766),h=n.n(g),v=n(67294),y=n(96486),_=n(19528),Z=n(28568);function E(e){var t=function(){if("undefined"==typeof Reflect||!r())return!1;if(r().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(r()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,d.Z)(e);if(t){var o=(0,d.Z)(this).constructor;n=r()(a,arguments,o)}else n=a.apply(this,arguments);return(0,u.Z)(this,n)}}const S=function(e){(0,s.Z)(n,e);var t=E(n);function n(){var e,a;(0,c.Z)(this,n);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return a=t.call.apply(t,h()(e=[this]).call(e,i)),(0,p.Z)((0,l.Z)(a),"state",{loading:!1,selectedService:null,configList:[],showModal:!1,modalContent:null,visibleConfigInfo:!1,selectedFile:void 0,serviceGroup:null}),(0,p.Z)((0,l.Z)(a),"loadServiceGroup",function(){var e=(0,o.Z)(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.props.shouldGetAll){e.next=7;break}return e.next=4,_.BZ.getAllServiceGroup(t);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,_.BZ.getServiceGroup(t);case 9:e.t0=e.sent;case 10:0===(n=e.t0).data.code&&a.setState({serviceGroup:(0,y.get)(n,"data.data.groups",{})});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,p.Z)((0,l.Z)(a),"onShowConfigInfo",(function(e){var t=a.props.shouldGetAll;e&&e.product_name&&a.setState({visibleConfigInfo:!0},(function(){var n={product_name:e.product_name};t&&(n.product_version=e.product_version),a.loadServiceGroup(n)}))})),(0,p.Z)((0,l.Z)(a),"getConfigList",(function(e){_._7.getServiceTree(e).then((function(e){0===e.data.code&&a.setState({configList:(0,y.get)(e,"data.data.list",[])})}))})),(0,p.Z)((0,l.Z)(a),"getConfigContent",(function(e){_._7.getServiceFile(e).then((function(e){0===e.data.code&&a.setState({modalContent:(0,y.get)(e,"data.data","")})}))})),(0,p.Z)((0,l.Z)(a),"onSelectedFile",(function(e){var t=a.props.componentData;a.setState({selectedFile:e});var n=a.state.selectedService;a.getConfigContent({file:e,serviceName:n,productName:t.product_name,productVersion:t.product_version})})),(0,p.Z)((0,l.Z)(a),"onSelectedConfigService",(function(e){var t=a.props.componentData;a.setState({selectedService:e,selectedFile:void 0,configList:[]}),a.getConfigList({serviceName:e,productName:t.product_name,productVersion:t.product_version})})),(0,p.Z)((0,l.Z)(a),"onCloseModal",(function(){a.setState({visibleConfigInfo:!1,selectedService:null,selectedFile:void 0,modalContent:null},(function(){a.props.onClose()}))})),(0,p.Z)((0,l.Z)(a),"render",(function(){var e=a.state.visibleConfigInfo;return v.createElement(v.Fragment,null,v.createElement(Z.Z,{key:"configModal",title:"配置信息",fileList:a.state.configList,visible:e,content:a.state.modalContent,serviceData:a.state.serviceGroup,onCancel:a.onCloseModal,selectedFile:a.state.selectedFile,onSelectedFile:a.onSelectedFile,onSelectedService:a.onSelectedConfigService}))})),a}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){var e=this.props.componentData;this.props.componentData&&this.onShowConfigInfo(e)}},{key:"componentDidUpdate",value:function(e){e.componentData!==this.props.componentData&&this.onShowConfigInfo(this.props.componentData)}}]),n}(v.Component)},64143:(e,t,n)=>{n.d(t,{Z:()=>y});var a=n(77766),r=n.n(a),o=n(78914),c=n.n(o),i=n(81643),l=n.n(i),s=n(2991),u=n.n(s),d=n(86902),p=n.n(d),m=n(31238),f=n.n(m),g=n(45360),h=n(36808),v=n(18274);const y={pageWidth:function(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)},pageHeight:function(){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)},getParameterByName:function(e,t){t||(t=window.location.href),e=e.replace(/[[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},getBase64:function(e,t){var n=new FileReader;n.addEventListener("load",(function(){return t(n.result)})),n.readAsDataURL(e)},percent:function(e,t){return e&&e!==1/0?(e>1&&(e=1),t=t||2,t=Math.pow(10,t),Math.round(e*t*100)/t+"%"):"0%"},getCssText:function(e){var t="";for(var n in e)t+=n+":"+e[n]+";";return t},formateDateTime:function(e){var t,n,a,o,c;if(!e)return"";var i=new Date(e),l=i.getFullYear(),s=i.getMonth()+1+"",u=i.getDate()+"",d=i.getHours()+"",p=i.getMinutes()+"",m=i.getSeconds()+"";return 1===s.toString().length&&(s="0".concat(s)),1===u.toString().length&&(u="0".concat(u)),1===d.toString().length&&(d="0".concat(d)),1===p.toString().length&&(p="0".concat(p)),1===m.toString().length&&(m="0".concat(m)),r()(t=r()(n=r()(a=r()(o=r()(c="".concat(l,"-")).call(c,s,"-")).call(o,u," ")).call(a,d,":")).call(n,p,":")).call(t,m)},formateDate:function(e){var t,n;if(!e)return"";var a=new Date(e),o=a.getFullYear(),c=a.getMonth()+1+"",i=a.getDate()+"";return 1===c.toString().length&&(c="0".concat(c)),1===i.toString().length&&(i="0".concat(i)),r()(t=r()(n="".concat(o,"-")).call(n,c,"-")).call(t,i)},trim:function(e){return"string"==typeof e?e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""):e},messageFilter:function(e,t,n,a){1001===e.status.code&&(a||g.Z.success("成功"),t&&t())},getTableParam:function(e){var t={};return c()(e).call(e,(function(e,n){var a=e.split("-");t[a[1]]=a[2]})),t},setAlertControl:function(e){var t={},n=e.alert_control;return"1"===n?t.close=1:(t.close=0,e["alert_num_"+n]&&(t.times_after_close=e["alert_num_"+n]),e["recover_num_"+n]&&(t.close_after_long_time_reset_amount=e["recover_num_"+n],t.close_after_long_time_reset_unit=e["recover_unit_"+n])),t},getAlertControl:function(e){var t={alert_control:""};return 0===e.close&&(0!==e.times_after_close?(t.alert_control="2",t["alert_num_"+t.alert_control]=e.times_after_close):t.alert_control="3",""!==e.close_after_long_time_reset_amount&&("2"===t.alert_control&&(t.alert_control="4"),t["alert_num_"+t.alert_control]=e.times_after_close,t["recover_num_"+t.alert_control]=e.close_after_long_time_reset_amount,t["recover_unit_"+t.alert_control]=e.close_after_long_time_reset_unit)),t},filterOption:function(e,t){var n;return-1!==l()(n=t.props.children).call(n,e)},getParamsFromUrl:function(e){var t={},n=[],a="",r="",o=e.substring(l()(e).call(e,"?")+1,e.length).split("&");for(var c in o)a=(n=o[c].split("="))[0],r=n[1],t[a]=r;return t},jsonToQuery:function(e){var t;return e?function(e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t}(u()(t=p()(e)).call(t,(function(t){return void 0===e[t]?"":encodeURIComponent(t)+"="+encodeURIComponent(e[t])}))).join("&"):""},checkNullObj:function(e){return 0===p()(e).length},serviceCallback:function(e,t,n){0===e.data.code?(g.Z.success(t),n&&n()):g.Z.error(e.data.msg)},noAuthorityToDO:function(e,t){return!e[t]&&(g.Z.error("权限不足，请联系管理员!"),!0)},get k8sNamespace(){return h.get(v.E9.NAMESPACE)},setNaviKey:function(e,t){sessionStorage.setItem("firstLevelNav",e),sessionStorage.setItem("siderLevelNav",t)},formatGBUnit:function(e){return l()(e).call(e,"MB")>-1?f()(e.replace("MB",""))/1024:l()(e).call(e,"KB")>-1?f()(e.replace("KB",""))/1024/1024:l()(e).call(e,"GB")>-1?f()(e.replace("GB","")):l()(e).call(e,"TB")>-1?1024*f()(e.replace("TB","")):0}}}}]);