"use strict";(self.webpackChunkdt_em_front=self.webpackChunkdt_em_front||[]).push([[2292],{42238:(t,e,n)=>{n.d(e,{Y:()=>a,v:()=>r});var r={labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:12}}},a={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}}}},22292:(t,e,n)=>{n.r(e),n.d(e,{default:()=>ne});var r=n(1068),a=n.n(r),s=n(14310),o=n.n(s),l=n(20116),i=n.n(l),u=n(34074),c=n.n(u),p=n(39649),f=n.n(p),d=n(20368),h=n.n(d),m=n(63978),v=n.n(m),y=n(3649),g=n.n(y),Z=n(66419),b=n.n(Z),k=n(65420),w=n.n(k),x=n(19996),E=n.n(x),S=n(41511),C=n.n(S),I=n(73126),M=n(71649),A=n(44930),O=n(68420),P=n(27344),j=n(5281),H=n(84441),_=n(3020),D=n(3362),N=n(44845),q=n(63109),B=n.n(q),R=n(77766),T=n.n(R),V=n(78914),F=n.n(V),$=n(59340),U=n.n($),z=n(86902),J=n.n(z),W=n(81643),L=n.n(W),K=n(33032),Y=n.n(K),G=n(2991),Q=n.n(G),X=n(67294),tt=n(29027),et=n(56466),nt=n(45360),rt=n(19528),at=function(t){return{type:et.q7.update_hostArr,payload:t}},st=function(t){return{type:et.q7.update_installMsg,payload:t}},ot=function(t){return{type:et.q7.set_disabled,payload:t}},lt=function(t){return{type:et.q7.to_page,payload:t}},it=function(t){return function(e){e({type:"getnewinstallMsg",payload:t})}},ut=function(){return{type:et.q7.reset_state}};function ct(t,e){rt.$b.connectHost(t.item,t.type).then((function(t){return dt(t,e)}))}function pt(t){return rt.$b.installHost(t.item,t.type).then((function(t){return dt(t)}))}function ft(t){return rt.$b.checkInstallUrl({aid:t}).then((function(t){return dt(t)}))}function dt(t,e){return void 0===t?(nt.Z.error("服务器连接不上"),!1):e?e(t):t}var ht=n(78241),mt=n(47302),vt=n.n(mt),yt=n(69035),gt=n(4107),Zt=n(66253),bt=n(42238);function kt(t){var e=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,D.Z)(t);if(e){var s=(0,D.Z)(this).constructor;n=a()(r,arguments,s)}else n=r.apply(this,arguments);return(0,_.Z)(this,n)}}var wt=yt.Z.Item,xt=gt.Z.TextArea,Et=Zt.ZP.Group,St=function(t){(0,H.Z)(n,t);var e=kt(n);function n(t){var r;return(0,O.Z)(this,n),r=e.call(this,t),(0,N.Z)((0,j.Z)(r),"validIp",(function(t,e,n){var a=/^(?:(?:^|,)(?:[0-9]|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])(?:\.(?:[0-9]|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])){3})+$/;if(e&&!a.test(e))n("存在格式不正确的ip地址");else if(e&&a.test(e)){var s=r.repeatIps(e);s?n(s):n()}else n()})),(0,N.Z)((0,j.Z)(r),"repeatIps",(function(t){for(var e,n="",r=t?vt()(e=t.split(",")).call(e):[],a=0;a<r.length-1;a++)r[a]===r[a+1]&&(n="ip:".concat(r[a],"已存在，请检查输入！"));return n})),(0,N.Z)((0,j.Z)(r),"checkIP",(function(t){var e=t.target.value,n=[];L()(e).call(e,",")>-1?n=e.split(","):n.push(e),r.setState({IPArr:n})})),(0,N.Z)((0,j.Z)(r),"onChange",(function(t){var e=t.target.value;r.setState({value:e,fileName:"",password:""})})),(0,N.Z)((0,j.Z)(r),"handleChange",(function(t){var e=r.props.form,n=t.target.value;r.setState({password:n}),e.setFieldsValue({password:n})})),(0,N.Z)((0,j.Z)(r),"inputDOM",X.createRef()),(0,N.Z)((0,j.Z)(r),"uploadSecret",(function(){var t=r.props.form,e=r.inputDOM.files[0];if(e)if(e.size/1024>=100)nt.Z.warn("请选择小于100Kb文件上传！");else if(window.FileReader){var n=new FileReader;n.readAsText(e),n.onload=function(e){t.setFieldsValue({pk:e.target.result})},r.setState({fileName:e.name}),r.inputDOM.value=""}else nt.Z.warn("浏览器不支持");else nt.Z.warn("请选择上传的秘钥")})),r.state={value:"密码",fileName:"",password:"",ip:"",IPArr:null},r}return(0,P.Z)(n,[{key:"render",value:function(){var t=this,e=this.state,n=e.value,r=e.fileName,a=e.password,s=this.props.form.getFieldDecorator;return X.createElement("div",{style:{margin:"50px auto",width:"80%"}},X.createElement(yt.Z,{className:"login-form",style:{width:"60%"}},X.createElement(wt,(0,I.Z)({},bt.v,{label:"机器IP"}),s("host",{rules:[{required:!0,message:"please input machine ip"},{validator:this.validIp}]})(X.createElement(xt,{onBlur:function(e){return t.checkIP(e)},autosize:{minRows:2,maxRows:6},rows:4,placeholder:"输入机器ip，英文逗号分隔（如：172.1.1.1,172.1.1.2）"}))),X.createElement(wt,(0,I.Z)({},bt.v,{label:"SSH端口"}),s("port",{initialValue:"22",rules:[{required:!0,message:"必填项"},{max:10,message:"端口最大不能超过10位!"},{pattern:/^[1-9]{1}[0-9]*$/,message:"端口号仅限为非0开头的数字!"}]})(X.createElement(gt.Z,{autoComplete:"true",type:"port",placeholder:"输入端口号"}))),X.createElement(wt,(0,I.Z)({},bt.v,{label:"登陆方式"}),X.createElement(Et,{onChange:function(e){return t.onChange(e)},defaultValue:"密码"},X.createElement(Zt.ZP,{value:"密钥"},"密钥"),X.createElement(Zt.ZP,{value:"密码"},"密码"))),X.createElement(wt,(0,I.Z)({},bt.v,{label:"用户名",extra:"需要sudo+NOPASSWD权限"}),s("user",{initialValue:"admin",rules:[{required:!0}]})(X.createElement(gt.Z,{placeholder:"输入用户名",type:"user"}))),"密钥"===n?X.createElement(wt,(0,I.Z)({},bt.v,{label:"密钥"}),s("pk",{rules:[{required:!0,message:"密钥不可为空!"}]})(X.createElement(gt.Z,{style:{display:"none"}})),X.createElement("label",{className:"ant-btn",style:{lineHeight:"28px"}},"上传秘钥文件",X.createElement("input",{ref:function(e){return t.inputDOM=e},type:"file",onChange:this.uploadSecret,style:{display:"none"}})),X.createElement("span",null,r)):X.createElement(wt,(0,I.Z)({},bt.v,{label:"密码"}),s("password",{rules:[{required:!0,message:"密码不可为空!"}]})(X.createElement(gt.Z,{style:{display:"none"},autoComplete:"off",placeholder:"密码"})),X.createElement(gt.Z,{type:"password",value:a,onChange:this.handleChange,autoComplete:"off",placeholder:"密码"}))))}}]),n}(X.Component);const Ct=yt.Z.create({})(St);function It(t){var e=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,D.Z)(t);if(e){var s=(0,D.Z)(this).constructor;n=a()(r,arguments,s)}else n=r.apply(this,arguments);return(0,_.Z)(this,n)}}var Mt=function(t){(0,H.Z)(n,t);var e=It(n);function n(){return(0,O.Z)(this,n),e.apply(this,arguments)}return(0,P.Z)(n,[{key:"render",value:function(){return X.createElement("div",null,X.createElement("h3",{style:{padding:"10px",margin:"10px 100px"}},"1.执行服务器初始化"),X.createElement("h3",{style:{padding:"10px",margin:"10px 100px"}},"2.安装agent"))}}]),n}(X.Component),At=n(45334),Ot=n(31097),Pt=n(67908),jt=n(55241),Ht=n(8263);function _t(t,e){var n=void 0!==w()&&E()(t)||t["@@iterator"];if(!n){if(C()(t)||(n=function(t,e){var n;if(!t)return;if("string"==typeof t)return Dt(t,e);var r=g()(n=Object.prototype.toString.call(t)).call(n,8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return b()(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Dt(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){l=!0,s=t},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw s}}}}function Dt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Nt(t,e){var n=J()(t);if(o()){var r=o()(t);e&&(r=i()(r).call(r,(function(e){return c()(t,e).enumerable}))),n.push.apply(n,r)}return n}function qt(t){for(var e=1;e<arguments.length;e++){var n,r,a=null!=arguments[e]?arguments[e]:{};e%2?F()(n=Nt(Object(a),!0)).call(n,(function(e){(0,N.Z)(t,e,a[e])})):f()?h()(t,f()(a)):F()(r=Nt(Object(a))).call(r,(function(e){v()(t,e,c()(a,e))}))}return t}function Bt(t){var e=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,D.Z)(t);if(e){var s=(0,D.Z)(this).constructor;n=a()(r,arguments,s)}else n=r.apply(this,arguments);return(0,_.Z)(this,n)}}var Rt=function(t){switch(t){case 0:return{percent:0,title:"等待安装",color:"host-status-wait-install"};case-1:return{percent:30,status:"exception",title:"管控安装失败",color:"host-status-control-failed"};case 1:return{percent:30,status:"active",title:"管控安装成功",color:"host-status-control-successed"};case-2:return{percent:60,status:"exception",title:"script安装失败",color:"host-status-script-failed"};case 2:return{percent:60,status:"active",title:"script安装成功",color:"host-status-script-successed"};case-3:return{percent:100,status:"exception",title:"主机初始化失败",color:"host-status-init-failed"};case 3:return{percent:100,status:"success",title:"主机初始化成功",color:"host-status-init-successed"};default:return{percent:100,status:"exception"}}},Tt=function(t){(0,H.Z)(a,t);var e,n,r=Bt(a);function a(t){var e;return(0,O.Z)(this,a),e=r.call(this,t),(0,N.Z)((0,j.Z)(e),"timeoutObject",{}),(0,N.Z)((0,j.Z)(e),"currentHostArr",[]),(0,N.Z)((0,j.Z)(e),"reInstall",(function(t){var n=e.props,r=n.installMsg,a=n.updateInstallMsg,s=-1;F()(r).call(r,(function(e,n){e.aid===t.aid&&(s=n)})),-1!==s&&(r[s]=qt(qt({},r[s]),{},{status:0,detail:"等待安装"}),a(r),e.handleSubmit(r[s].host))})),e}return(0,P.Z)(a,[{key:"componentWillUnmount",value:function(){var t,e=this.timeoutObject;F()(t=J()(e)).call(t,(function(t,n){clearTimeout(e[t])}))}},{key:"installCheck",value:(n=(0,A.Z)(B().mark((function t(e){var n,r,a,s,o,l=this;return B().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.props,r=n.installMsg,a=n.updateInstallMsg,null!=e&&void 0!==e&&""!==e&&e){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,ft(e);case 5:s=t.sent,o=s.data,0===s.code?(F()(r).call(r,(function(t,n){t.aid===e&&(1!==o.status&&2!==o.status&&0!==o.status||(l.timeoutObject[e]=Y()((function(){l.installCheck(e)}),2e3)),t.status=o.status||1,t.detail="".concat(o.status_msg))})),a(r)):(F()(r).call(r,(function(t,n){t.aid===e&&(t.status=o.result_code||-1,t.detail=s.msg)})),nt.Z.error(s.msg));case 8:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"installProgress",value:(e=(0,A.Z)(B().mark((function t(e){var n,r,a,s,o,l,i,u;return B().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.props,r=n.installMsg,a=n.updateInstallMsg,s=this.pkOrPwd(e),t.next=4,pt(s);case 4:(o=t.sent)&&(l=o.code,i=o.msg,u=o.data,0===l||"ok"===i?(F()(r).call(r,(function(t){var n;t.host===e.host&&(t.aid=u.aid,t.detail=T()(n="ip: ".concat(e.host,",安装信息：")).call(n,u.result))})),a(r),this.installCheck(u.aid)):nt.Z.error(e.host+"安装失败"+i));case 6:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"pkOrPwd",value:function(t){var e;return t.pk?(e="pk",delete t.password):(e="pwd",delete t.pk),{type:e,item:t}}},{key:"handleSubmit",value:function(t){var e=this,n=this.props.hostArr;if(t){var r,a=null,s=_t(n);try{for(s.s();!(r=s.n()).done;){var o=r.value;o.host===t&&(a=o)}}catch(t){s.e(t)}finally{s.f()}a&&this.installProgress(a)}else{var l;F()(l=this.currentHostArr).call(l,(function(t,n){e.installProgress(t)}))}}},{key:"render",value:function(){var t=this,e=this.props.installMsg,n=[{title:"IP",key:"ip",width:"25%",dataIndex:"host"},{title:"安装进度",width:"40%",key:"progress",dataIndex:"progress",render:function(t,e){var n=Rt(e.status);return X.createElement(At.Z,{className:"c-host-add-progress",percent:n.percent,strokeWidth:5,status:n.status})}},{title:"状态",width:"25%",dataIndex:"status",key:"status",render:function(e,n){var r=-1===n.status||-2===n.status||-3===n.status;return X.createElement("span",{className:"".concat(Rt(n.status).color," install-opt")},Rt(n.status).title,r&&n.msg&&X.createElement(Ot.Z,{placement:"bottom",title:n.msg},X.createElement(Pt.Z,{className:"icon-tips",type:"question-circle"})),n.aid&&r&&X.createElement("a",{style:{marginLeft:10},onClick:function(){return t.reInstall(n)}},"重试"))}},{title:"详情",dataIndex:"detail",key:"detail",render:function(t,e){return X.createElement(jt.Z,{placement:"left",content:X.createElement("div",{style:{maxHeight:300,overflowY:"auto"}},t)},X.createElement("a",{href:"#",style:{color:"#aaf"}},"查看详情"))}}];return X.createElement("div",{className:"steps-main access-table"},X.createElement(Ht.Z,{scroll:{y:500},columns:n,dataSource:e,pagination:!1}))}}]),a}(X.Component),Vt={jumpPage:function(t){return lt(t)},updateInstallMsg:function(t){return st(t)},updateHostArr:function(t){return at(t)},setDisabled:function(t){return ot(t)},getNewState:function(t){return it(t)},resetState:function(){return ut()}};(0,tt.$j)((function(t){return{current:t.hostAdd.current,disabled:t.hostAdd.disabled,forms:t.hostAdd.forms,hostArr:t.hostAdd.hostArr,installMsg:t.hostAdd.installMsg}}),Vt)(Tt);var Ft,$t=n(27220),Ut=n(79855),zt=n(77268);function Jt(t,e){var n=void 0!==w()&&E()(t)||t["@@iterator"];if(!n){if(C()(t)||(n=function(t,e){var n;if(!t)return;if("string"==typeof t)return Wt(t,e);var r=g()(n=Object.prototype.toString.call(t)).call(n,8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return b()(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Wt(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){throw t})),f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){l=!0,s=t})),f:function(){try{o||null==n.return||n.return()}finally{if(l)throw s}}}}function Wt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Lt(t,e){var n=J()(t);if(o()){var r=o()(t);e&&(r=i()(r).call(r,(function(e){return c()(t,e).enumerable}))),n.push.apply(n,r)}return n}function Kt(t){for(var e=1;e<arguments.length;e++){var n,r,a=null!=arguments[e]?arguments[e]:{};e%2?F()(n=Lt(Object(a),!0)).call(n,(function(e){(0,N.Z)(t,e,a[e])})):f()?h()(t,f()(a)):F()(r=Lt(Object(a))).call(r,(function(e){v()(t,e,c()(a,e))}))}return t}function Yt(t){var e=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,D.Z)(t);if(e){var s=(0,D.Z)(this).constructor;n=a()(r,arguments,s)}else n=r.apply(this,arguments);return(0,_.Z)(this,n)}}var Gt=$t.Z.Step,Qt=Ut.Z.TabPane,Xt=gt.Z.TextArea,te=[{title:"添加机器"},{title:"安装内容说明"},{title:"执行安装"}],ee={jumpPage:function(t){return lt(t)},updateInstallMsg:function(t){return st(t)},updateHostArr:function(t){return at(t)},setDisabled:function(t){return ot(t)},getNewState:function(t){return it(t)},resetState:function(){return ut()}};const ne=(0,tt.$j)((function(t){return{current:t.addHostStore.current,disabled:t.addHostStore.disabled,forms:t.addHostStore.forms,hostArr:t.addHostStore.hostArr,installMsg:t.addHostStore.installMsg}}),ee)(Ft=function(t){(0,H.Z)(s,t);var e,n,r,a=Yt(s);function s(t){var e;return(0,O.Z)(this,s),e=a.call(this,t),(0,N.Z)((0,j.Z)(e),"timeoutObject",{}),(0,N.Z)((0,j.Z)(e),"currentHostArr",[]),(0,N.Z)((0,j.Z)(e),"HostAddForm",X.createRef()),(0,N.Z)((0,j.Z)(e),"concatSessionStore",(function(t){if(Object.prototype.hasOwnProperty.call(sessionStorage,"batch_inaaaawdstallInfo")){var e=JSON.parse(sessionStorage.getItem("batch_installInfo"))||[];t=T()(t).call(t,e)}return t})),(0,N.Z)((0,j.Z)(e),"reInstall",(function(t){var n=e.props,r=n.installMsg,a=n.updateInstallMsg,s=-1;F()(r).call(r,(function(e,n){e.aid===t.aid&&(s=n)})),-1!==s&&(r[s]=Kt(Kt({},r[s]),{},{status:0,detail:"等待安装"}),a(r),e.handleSubmit(r[s].host))})),(0,N.Z)((0,j.Z)(e),"backToHostList",(function(){window.location.href="/host"})),(0,N.Z)((0,j.Z)(e),"configInitialize",(function(){var t=e.props,n=t.jumpPage,r=t.installMsg;e.currentHostArr=[];sessionStorage.setItem("batch_installInfo",U()(r)),n(0)})),e.timeoutObject={},e.currentHostArr=[],e.state={installMsg:[],shellCMD:"",cmdVisible:!1},e}return(0,P.Z)(s,[{key:"componentDidMount",value:function(){var t=this;Object.prototype.hasOwnProperty.call(sessionStorage,"batch_installInfo")&&delete sessionStorage.batch_installInfo,ht.get("/api/v2/agent/install/installCmd",{}).then((function(e){0===e.code?t.setState({shellCMD:e.data}):nt.Z.error(e.msg)}))}},{key:"componentWillUnmount",value:function(){var t;this.props.resetState(),Object.prototype.hasOwnProperty.call(sessionStorage,"batch_installInfo")&&delete sessionStorage.batch_installInfo;var e=this.timeoutObject;F()(t=J()(e)).call(t,(function(t,n){clearTimeout(e[t])}))}},{key:"goValid",value:function(){var t,e=this,n=this.props.updateInstallMsg,r=this.HostAddForm.getFieldsValue();for(var a in r)if(void 0===r[a]||""===r[a])return;var s=[],o=[];L()(t=r.host).call(t,",")>-1?o=r.host.split(","):o.push(r.host),F()(o).call(o,(function(t,n){var a={host:t,port:r.port,user:r.user,password:r.password||"",pk:r.pk||""},o={host:t,percent:0,status:0,msg:""};s.push(o),e.linkProgress(a,o)})),n(s=this.concatSessionStore(s))}},{key:"linkProgress",value:(r=(0,A.Z)(B().mark((function t(e,n){var r,a,s,o=this;return B().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=this.props,a=r.setDisabled,s=r.updateHostArr,ct(e=this.pkOrPwd(e),(function(t){if(t){var r,l=t.code,i=t.msg;0===l||"ok"===i?(nt.Z.success("ip连通性验证通过！"),s(e.item),o.setState({installMsg:T()(r=[]).call(r,(0,M.Z)(o.state.installMsg),[n])}),o.currentHostArr.push(e.item),a(!1)):(nt.Z.error(e.host+"连接失败"+t.msg),a(!0))}}));case 3:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})},{key:"handleSubmit",value:function(t){var e=this;if(t){var n,r=null,a=Jt(this.currentHostArr);try{for(a.s();!(n=a.n()).done;){var s=n.value;s.host===t&&(r=s)}}catch(t){a.e(t)}finally{a.f()}r&&this.installProgress(r)}else{var o;F()(o=this.currentHostArr).call(o,(function(t){e.installProgress(t)}))}}},{key:"installProgress",value:(n=(0,A.Z)(B().mark((function t(e){var n,r,a,s,o,l,i,u;return B().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.props,r=n.installMsg,a=n.updateInstallMsg,s=this.pkOrPwd(e),t.next=4,pt(s);case 4:(o=t.sent)&&(l=o.code,i=o.msg,u=o.data,0===l||"ok"===i?(F()(r).call(r,(function(t){var n;t.host===e.host&&(t.aid=u.aid,t.detail=T()(n="ip: ".concat(e.host,",安装信息：")).call(n,u.result))})),a(r),this.installCheck(u.aid)):nt.Z.error(e.host+"安装失败"+i));case 6:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"installCheck",value:(e=(0,A.Z)(B().mark((function t(e){var n,r,a,s,o,l=this;return B().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.props,r=n.installMsg,a=n.updateInstallMsg,null!=e&&void 0!==e&&""!==e&&e){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,ft(e);case 5:s=t.sent,o=s.data,0===s.code?(F()(r).call(r,(function(t,n){t.aid===e&&(1!==o.status&&2!==o.status&&0!==o.status||(l.timeoutObject[e]=Y()((function(){l.installCheck(e)}),2e3)),t.status=o.status||1,t.detail="".concat(o.status_msg))})),a(r),this.setState({installMsg:r})):(F()(r).call(r,(function(t,n){t.aid===e&&(t.status=o.result_code||-1,t.detail=s.msg)})),nt.Z.error(s.msg));case 8:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"pkOrPwd",value:function(t){var e;return t.pk?(e="pk",delete t.password):(e="pwd",delete t.pk),{type:e,item:t}}},{key:"prev",value:function(){var t=this.props,e=t.current,n=t.jumpPage;0===e?window.location.href="/host":n(e-1)}},{key:"next",value:function(){var t=this.props,e=t.current,n=t.jumpPage,r=t.setDisabled;1===e&&(this.handleSubmit(null),r(!0)),n(e+1)}},{key:"showCmdModal",value:function(){this.setState({cmdVisible:!0})}},{key:"handleCloseNoCmdModal",value:function(){this.setState({cmdVisible:!1})}},{key:"render",value:function(){var t=this,e={margin:"0 10px"},n=this.props,r=n.current,a=n.disabled,s=Kt(Kt({},this.props),{},{reInstall:this.reInstall});return X.createElement("div",{style:{width:"100%",minHeight:"700px",overflow:"auto"}},X.createElement("div",{style:{margin:"15px 170px 170px 170px",width:"80%",paddingBottom:"50px",backgroundColor:"#fff"}},X.createElement("div",{style:{padding:"40px 80px"}},X.createElement($t.Z,{current:r},Q()(te).call(te,(function(t){return X.createElement(Gt,{key:t.title,title:t.title})}))),X.createElement("div",{style:{margin:"20px 0",padding:"20px",width:"100%",backgroundColor:"rgb(250,250,250)"}},0===r&&X.createElement(Ut.Z,{defaultActiveKey:"1"},X.createElement(Qt,{tab:"账号接入",key:"1"},X.createElement(Ct,(0,I.Z)({ref:function(e){return t.HostAddForm=e}},this.props))),X.createElement(Qt,{tab:"命令行接入",key:"2"},X.createElement("p",null,"复制下面命令到命令行执行："),X.createElement(Xt,{id:"J_CMDCode",rows:4,value:this.state.shellCMD}),X.createElement(zt.Z,{id:"J_CopyBtn",style:{marginTop:15},type:"default","data-clipboard-action":"cut","data-clipboard-target":"#J_CMDCode"},"复制代码"))),1===r&&X.createElement(Mt,null),2===r&&X.createElement(Tt,s)),X.createElement("div",{className:"steps-action",style:{marginRight:0,padding:"0 20px",width:"100%",textAlign:"right"}},2!==r&&X.createElement(zt.Z,{style:e,onClick:function(){return t.prev()}},"返回"," "),0===r&&X.createElement(zt.Z,{style:e,type:"primary",onClick:function(){return t.goValid()}},"验证连通性"),2!==r&&X.createElement(zt.Z,{style:e,type:"primary",disabled:a,onClick:function(){return t.next()}},"下一步"),2===r&&X.createElement(zt.Z,{style:e,onClick:this.backToHostList},"进入主机列表"),2===r&&X.createElement(zt.Z,{style:e,type:"primary",onClick:this.configInitialize},"继续配置")))))}}]),s}(X.Component))||Ft}}]);