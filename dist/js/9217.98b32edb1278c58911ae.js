"use strict";(self.webpackChunkdt_em_front=self.webpackChunkdt_em_front||[]).push([[9217],{89217:(e,t,n)=>{n.r(t),n.d(t,{Host:()=>Re,default:()=>Fe});var r=n(1068),a=n.n(r),o=n(14310),l=n.n(o),s=n(34074),i=n.n(s),c=n(78914),u=n.n(c),d=n(39649),p=n.n(d),f=n(20368),h=n.n(f),m=n(63978),g=n.n(m),v=n(71649),_=n(44930),y=n(68420),Z=n(27344),E=n(5281),x=n(84441),C=n(3020),S=n(3362),b=n(44845),k=n(63109),D=n.n(k),w=n(77766),R=n.n(w),F=n(2991),L=n.n(F),I=n(86902),H=n.n(I),N=n(51942),M=n.n(N),A=n(20116),O=n.n(A),T=n(78580),B=n.n(T),P=n(41511),K=n.n(P),z=n(94473),j=n.n(z),G=n(54103),U=n.n(G),q=n(67294),X=n(29027),W=n(4107),$=n(69035),V=n(45360),Y=n(30258),Q=n(67908),J=n(77268),ee=n(9676),te=n(8263),ne=n(94198),re=n.n(ne),ae=n(25843),oe=n.n(ae),le=n(62462),se=n.n(le),ie=n(34041),ce=n(19528),ue=n(94184),de=n.n(ue);function pe(e,t){var n=H()(e);if(l()){var r=l()(e);t&&(r=O()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function fe(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?u()(n=pe(Object(a),!0)).call(n,(function(t){(0,b.Z)(e,t,a[t])})):p()?h()(e,p()(a)):u()(r=pe(Object(a))).call(r,(function(t){g()(e,t,i()(a,t))}))}return e}function he(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,S.Z)(e);if(t){var o=(0,S.Z)(this).constructor;n=a()(r,arguments,o)}else n=r.apply(this,arguments);return(0,C.Z)(this,n)}}var me=ie.Z.Option,ge=function(e){(0,x.Z)(n,e);var t=he(n);function n(){var e,r;(0,y.Z)(this,n);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return r=t.call.apply(t,R()(e=[this]).call(e,o)),(0,b.Z)((0,E.Z)(r),"state",{isOpen:!1,value:[],input:"",status:{flagInputFocus:!1,flagSelectFocus:!1},options:[],isADD:!1,isEDIT:!1,editID:"",validateStatus:!0}),(0,b.Z)((0,E.Z)(r),"getRoleListByCluster",function(){var e=(0,_.Z)(D().mark((function e(t){var n,a,o,l,s,i;return D().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.props.cur_parent_cluster,e.next=3,ce.Xi.getRoleList({cluster_id:n.id});case 3:a=e.sent,o=a.data,l=o.code,s=o.data,0===l&&(i=L()(s).call(s,(function(e){return{key:""+e.role_id,value:""+e.role_id,label:e.role_name,roleType:e.role_type}})),r.setState({options:i,isADD:!1,input:""},(function(){"function"==typeof t&&t(i)})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,b.Z)((0,E.Z)(r),"addRole",function(){var e=(0,_.Z)(D().mark((function e(t){var n,a,o,l,s;return D().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.props.cur_parent_cluster,e.next=3,ce.Xi.addRole({cluster_id:n.id,role_name:t});case 3:a=e.sent,o=a.data,l=o.code,s=o.msg,0===l?(V.Z.success("添加成功"),r.getRoleListByCluster()):V.Z.error(s);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,b.Z)((0,E.Z)(r),"deleteRole",function(){var e=(0,_.Z)(D().mark((function e(t){var n,a;return D().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.props.cur_parent_cluster,e.next=3,ce.Xi.deleteRole({cluster_id:n.id,role_id:t});case 3:a=e.sent,0===a.data.code?(V.Z.success("删除成功"),r.getRoleListByCluster((function(e){var t=r.props.value,n=r.refreshSelectedValue(t,e);r.props.updateRoleList(n)}))):V.Z.error("删除失败");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,b.Z)((0,E.Z)(r),"handleSelectStatusChange",(function(e){var t=r.state.status;r.setState({status:fe(fe({},t),{},{flagSelectFocus:e})})})),(0,b.Z)((0,E.Z)(r),"handleInputStatusChange",(function(e){var t=r.state.status;r.setState({status:fe(fe({},t),{},{flagInputFocus:e})})})),(0,b.Z)((0,E.Z)(r),"hideSelect",(function(){var e=r.state,t=e.status,n=e.isADD,a=e.isEDIT;return n||a?(V.Z.error("请先保存"),!1):(r.setState({status:fe(fe({},t),{},{flagInputFocus:!1,flagSelectFocus:!1})}),!0)})),(0,b.Z)((0,E.Z)(r),"handleOptionAdd",(function(){var e=r.state,t=e.isADD,n=e.isEDIT;!0===t||n?V.Z.error("请先保存"):r.setState({isADD:!0})})),(0,b.Z)((0,E.Z)(r),"handleOptionSave",(function(){var e=r.state.input,t=r.validator(e);if(!t.status)return V.Z.error(t.message),void r.setState({validateStatus:t.status});r.addRole(e)})),(0,b.Z)((0,E.Z)(r),"handleOptionDelete",(function(e){var t=r.state,n=t.isADD,a=t.isEDIT;e&&(n||a)?V.Z.error("请先保存"):e?Y.Z.confirm({title:"确认要删除该角色？",content:"删除后该角色将不可用！",icon:q.createElement(Q.Z,{type:"close-circle",theme:"filled",style:{color:"#FF5F5C"}}),okType:"danger",onOk:function(){!0!==r.state.isADD?r.deleteRole(re()(e.value)):V.Z.error("请先保存")},okText:"删除",zIndex:1e6}):r.setState({isADD:!1,input:"",validateStatus:!0})})),(0,b.Z)((0,E.Z)(r),"renameRoleName",(function(e,t,n){var a=r.validator(t);if(!a.status)return V.Z.error(a.message),void r.setState({validateStatus:a.status});var o=r.props.cur_parent_cluster;ce.Xi.modifyRole({cluster_id:o.id,role_id:re()(e),new_name:t}).then((function(e){var t=e.data,a=t.code,o=t.msg;0===a?("function"==typeof n&&n(),V.Z.success("保存成功"),r.getRoleListByCluster(),r.setState({isEDIT:!1,input:""})):V.Z.error(o)}))})),(0,b.Z)((0,E.Z)(r),"validator",(function(e){var t={status:!0,message:""};return""===oe()(e).call(e)?(t.status=!1,t.message="名称不能为空"):/^[0-9a-zA-Z_]{1,}$/.test(oe()(e).call(e))||(t.status=!1,t.message="仅支持英文、数字、下划线"),r.setState({validateStatus:t.status}),t})),(0,b.Z)((0,E.Z)(r),"refreshSelectedValue",(function(e,t){return O()(e).call(e,(function(e){return se()(t).call(t,(function(t){return t.value==="".concat(e)}))>-1}))})),(0,b.Z)((0,E.Z)(r),"handleOptionEdit",(function(e,t){var n=r.state,a=n.isADD,o=n.isEDIT;a||o?V.Z.error("请先保存"):r.setState({isEDIT:!0,editID:e,input:t})})),(0,b.Z)((0,E.Z)(r),"renderDropItem",(function(e){var t=r.state,n=t.editID,a=t.input,o=t.validateStatus,l=r.props.value,s=function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return q.createElement("div",{onClick:function(e){return V.Z.error("请先保存")},className:"ant-select-dropdown-menu-item ds-option",key:e.key,style:{width:"100%",height:"32px",padding:"0px 32px 0px 12px",lineHeight:"32px",background:n?"rgb(242, 249, 255)":void 0}},t)};if(e.key===n)return s(q.createElement("div",{onClick:function(e){return e.stopPropagation()}},q.createElement(W.Z,{onChange:function(e){r.setState({input:e.currentTarget.value})},className:de()({rolenameinput:!0,rolenamenull:!o}),onClick:function(e){return e.stopPropagation()},style:{height:"24px",width:"260px"},value:a}),q.createElement(Q.Z,{className:"ml-5",onClick:function(){r.renameRoleName(n,r.state.input)},style:{fontSize:"12px",color:"#999999",cursor:"pointer",lineHeight:"28px",marginRight:"2px",marginLeft:"6px"},type:"check"}),q.createElement(Q.Z,{type:"close",style:{cursor:"pointer",color:"#999999",fontSize:"12px",lineHeight:"28px",marginLeft:"2px"},onClick:function(){r.setState({isEDIT:!1,input:""})}})));var i=se()(l).call(l,(function(t){return"".concat(t)===e.key}))>-1;return s(q.createElement("div",null,q.createElement("div",{style:{display:"inline-block",width:"260px"}},e.label),1!==e.roleType?q.createElement(q.Fragment,null,q.createElement(Q.Z,{type:"delete",className:"fr emicon",style:{lineHeight:"34px",color:"#999999",fontSize:"12px",marginLeft:"10px",marginRight:"-5px"},onClick:function(t){r.handleOptionDelete(e),t.stopPropagation()}}),q.createElement(Q.Z,{type:"edit",onClick:function(t){r.handleOptionEdit(e.key,e.label),t.stopPropagation()},className:"fr emicon",style:{lineHeight:"34px",color:"#999999",fontSize:"12px",marginRight:"-6px"}})):null,i?q.createElement(Q.Z,{type:"check",style:{cursor:"pointer",color:"#12BC6A",fontSize:"12px",lineHeight:"28px",marginLeft:"37px"},onClick:function(){r.setState({isEDIT:!1,input:""})}}):null),i)})),(0,b.Z)((0,E.Z)(r),"getDropRender",(function(e,t){var n=r.state,a=n.isADD,o=n.input,l=n.validateStatus,s=n.isEDIT,i=q.createElement("div",null,a?q.createElement("div",{className:"edit-role-item",style:{padding:"4px 20px 4px 12px"}},q.createElement(W.Z,{style:{width:"260px",height:"24px"},className:de()({rolenameinput:!0,rolenamenull:!l}),value:o,onChange:function(e){r.setState({input:e.currentTarget.value})},onBlur:function(){return r.handleInputStatusChange(!1)},onFocus:function(){return r.handleInputStatusChange(!0)}}),q.createElement(Q.Z,{className:"ml-5",onClick:r.handleOptionSave,style:{color:"#999999",lineHeight:"22px",verticalAlign:"middle",marginLeft:"6px"},type:"check"}),q.createElement(Q.Z,{type:"close",style:{cursor:"pointer",color:"#999999",fontSize:"12px",lineHeight:"22px",marginLeft:"3px",verticalAlign:"middle"},onClick:function(){return r.handleOptionDelete()}})):null,q.createElement("div",{style:{width:"100%",height:"1px",background:"#E8E8E8"}}),q.createElement("div",null,q.createElement("div",{className:"drop-render"},q.createElement("div",{className:"circle-plus"},q.createElement("span",{className:"emicon emicon-plus"})),q.createElement("a",{style:{flex:"none",padding:"8px",display:"inline-block",cursor:"pointer"},onClick:r.handleOptionAdd},"自定义类型"))));return s?q.createElement("div",{className:"dynamic-drop-select"},q.createElement("div",{style:{padding:"4px 0"}},L()(t).call(t,r.renderDropItem)),i):q.createElement("div",{className:"dynamic-drop-select"},e,i)})),r}return(0,Z.Z)(n,[{key:"componentDidMount",value:function(){this.getRoleListByCluster()}},{key:"render",value:function(){var e,t=this,n=this.state,r=n.status,a=n.options,o=r.flagInputFocus||r.flagSelectFocus;return q.createElement("span",{onClick:function(e){return e.stopPropagation()}},q.createElement(ie.Z,{className:"ds-select",mode:"multiple",open:o,value:L()(e=this.props.value).call(e,(function(e){return"".concat(e)})),suffixIcon:q.createElement(Q.Z,{type:"delete"}),placeholder:"请选择角色",optionLabelProp:"label",showSearch:!1,onChange:function(e){t.props.onChange(L()(e).call(e,(function(e){return re()(e)})))},optionFilterProp:"label",onFocus:function(){t.handleSelectStatusChange(!0)},dropdownRender:function(e){return t.getDropRender(e,a)}},L()(a).call(a,(function(e){return q.createElement(me,{className:"ds-option",label:e.label,key:e.value,value:e.value},q.createElement("span",{onClick:function(e){return e.stopPropagation()}},e.label),1!==e.roleType?q.createElement(q.Fragment,null,q.createElement(Q.Z,{type:"delete",className:"fr emicon",style:{marginTop:"4px",color:"#999999",fontSize:"12px",marginLeft:"10px",marginRight:"-5px"},onClick:function(n){t.handleOptionDelete(e),n.stopPropagation()}}),q.createElement(Q.Z,{type:"edit",onClick:function(n){t.handleOptionEdit(e.key,e.label),n.stopPropagation()},className:"fr emicon",style:{marginTop:"4px",color:"#999999",fontSize:"12px",marginRight:"-6px"}})):null)}))))}}]),n}(q.Component),ve=n(96486),_e=n(18274),ye=n(64143),Ze=n(52553),Ee=n(31097),xe=n(60331),Ce=n(70688);function Se(e,t){var n=H()(e);if(l()){var r=l()(e);t&&(r=O()(r).call(r,(function(t){return i()(e,t).enumerable}))),n.push.apply(n,r)}return n}function be(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?u()(n=Se(Object(a),!0)).call(n,(function(t){(0,b.Z)(e,t,a[t])})):p()?h()(e,p()(a)):u()(r=Se(Object(a))).call(r,(function(t){g()(e,t,i()(a,t))}))}return e}function ke(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,S.Z)(e);if(t){var o=(0,S.Z)(this).constructor;n=a()(r,arguments,o)}else n=r.apply(this,arguments);return(0,C.Z)(this,n)}}var De=W.Z.Search,we=$.Z.Item,Re=function(e){(0,x.Z)(n,e);var t=ke(n);function n(){var e,r;(0,y.Z)(this,n);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return r=t.call.apply(t,R()(e=[this]).call(e,o)),(0,b.Z)((0,E.Z)(r),"refDropDown",null),(0,b.Z)((0,E.Z)(r),"refModal",null),(0,b.Z)((0,E.Z)(r),"state",{selectedRowKeys:[],reqParams:{cluster_id:1,limit:10,start:0,"sort-by":"id","sort-dir":"desc",host_or_ip:"",is_running:"",status:"",group:"",role:""},hosts:{count:0,list:[]},hostGroups:[],tableLoading:!1,visibleHostModal:{visible:!1,batch:!1,data:{sid:[],roleList:[],host:[]}}}),(0,b.Z)((0,E.Z)(r),"authorityControl",(function(e,t,n,a){var o=r.props.authorityList;if(!ye.Z.noAuthorityToDO(o,t))switch(e){case"edit":r.handleEditCluster();break;case"delete":r.handleDeleteHost();break;case"roleSet":r.handleBatchRoleSet()}})),(0,b.Z)((0,E.Z)(r),"getClusterhostGroupLists",(function(){var e=r.props.cur_parent_cluster,t=e.type,n=e.id;ce.t6.getClusterhostGroupLists({type:t,id:n}).then((function(e){var t;0===(e=e.data).code&&r.setState({hostGroups:L()(t=e.data||[]).call(t,(function(e){return{text:e,value:e}}))})}))})),(0,b.Z)((0,E.Z)(r),"getHostList",(function(){var e=r.state.reqParams,t=r.props.cur_parent_cluster;r.setState({tableLoading:!0}),ce.t6.getClusterHostList(be(be({},e),{},{cluster_id:t.id,role:"kubernetes"===t.type?e.role:void 0}),t.type).then((function(e){0===(e=e.data).code?r.setState({hosts:{count:e.data.count,list:e.data.hosts||[]}}):V.Z.error(e.msg),r.setState({tableLoading:!1})}))})),(0,b.Z)((0,E.Z)(r),"handleTableChange",(function(e,t,n){var a=r.props.cur_parent_cluster,o=be(be({},r.state.reqParams),{},{start:(e.current-1)*e.pageSize});H()(t)&&(o.is_running=(t.is_running||[]).join(","),o.status=(t.status||[]).join(","),o.group=(t.group||[]).join(","),"kubernetes"===a.type&&(o.role=(t.roles||[]).join(","))),H()(n)&&"order"in n?(o["sort-by"]=n.field,o["sort-dir"]="ascend"===n.order?"asc":"desc"):(o["sort-by"]="id",o["sort-dir"]="desc"),r.setState({reqParams:o},(function(){r.getHostList()}))})),(0,b.Z)((0,E.Z)(r),"handleSearch",(function(e){r.setState({reqParams:M()({},r.state.reqParams,{host_or_ip:e})},r.getHostList)})),(0,b.Z)((0,E.Z)(r),"handleEditCluster",(function(){var e,t,n,a=r.props,o=a.cur_parent_cluster,l=a.history.location,s=o.id,i=o.type,c=o.mode;r.props.history.push(R()(e=R()(t=R()(n="/deploycenter/cluster/create/edit?id=".concat(s,"&type=")).call(n,i,"&mode=")).call(t,c,"&from=")).call(e,l.pathname))})),(0,b.Z)((0,E.Z)(r),"progressProp",(function(e){var t=r.props.cur_parent_cluster,n=void 0===t?{}:t;switch(e){case 0:return{percent:0,title:"等待安装",color:"#FF5F5C"};case-1:return{percent:30,status:"exception",title:"管控安装失败",color:"#FF5F5C"};case 1:return{percent:30,status:"active",title:"管控安装成功",color:"#12BC6A"};case-2:return{percent:"hosts"===n.type?60:40,status:"exception",title:"script安装失败",color:"#FF5F5C"};case 2:return{percent:"hosts"===n.type?60:40,status:"active",title:"script安装成功",color:"#12BC6A"};case-3:return{percent:"hosts"===n.type?100:50,status:"exception",title:"主机初始化失败",color:"#FF5F5C"};case 3:return{percent:"hosts"===n.type?100:50,status:"hosts"===n.type?"success":"active",title:"主机初始化成功",color:"#12BC6A"};case-4:return{percent:50,status:"exception",title:"主机下线",color:"#FF5F5C"};case-5:return{percent:60,status:"exception",title:"K8S DOCKER初始化失败",color:"#FF5F5C"};case 5:return{percent:60,status:"active",title:"K8S DOCKER初始化成功",color:"#12BC6A"};case-6:return{percent:80,status:"exception",title:"K8S NODE初始化失败",color:"#FF5F5C"};case 6:return{percent:80,status:"active",title:"K8S NODE初始化成功",color:"#12BC6A"};case-7:return{percent:100,status:"exception",title:"K8S NODE部署失败",color:"#FF5F5C"};case 7:return{percent:100,status:"success",title:"K8S NODE部署成功",color:"#12BC6A"};default:return{percent:100,status:"exception",color:"#333"}}})),(0,b.Z)((0,E.Z)(r),"handleSelectChange",(function(e){r.setState({selectedRowKeys:e})})),(0,b.Z)((0,E.Z)(r),"handleDeleteHost",(function(){var e,t=r.state,n=t.selectedRowKeys,a=t.hosts.list,o=void 0===a?[]:a,l=O()(o).call(o,(function(e){return B()(n).call(n,e.id)&&!e.is_running}))||[];l.length?Y.Z.confirm({title:"只可下架agent已停止的主机，确定下架这些主机吗？",content:"主机下架将会将主机上的数据库信息、服务信息清除掉，请谨慎操作！",icon:q.createElement(Q.Z,{type:"exclamation-circle",theme:"filled"}),okText:"确定",cancelText:"取消",onOk:(e=(0,_.Z)(D().mark((function e(){var t,n;return D().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ce.Xi.deleteHost({aid:L()(l).call(l,(function(e){return e.id}))});case 2:t=e.sent,0===(n=t.data).code?(V.Z.success("删除成功！"),r.getHostList()):V.Z.error(n.msg);case 5:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)}),onCancel:function(){}}):Y.Z.confirm({title:"当前无停止的主机，不支持下架",icon:q.createElement(Q.Z,{type:"exclamation-circle",theme:"filled"}),okText:"确定",cancelText:"取消",onOk:function(){},onCancel:function(){}})})),(0,b.Z)((0,E.Z)(r),"getCheckedIds",(function(){var e,t=r.state,n=t.hosts,a=t.selectedRowKeys,o=K()(n.list)&&L()(e=n.list).call(e,(function(e){return e.id}));return(0,ve.intersection)(a,o)})),(0,b.Z)((0,E.Z)(r),"handleFooterChange",(function(e){var t,n=r.state.hosts.list,a=void 0===n?[]:n,o=L()(a).call(a,(function(e){return e.id})),l=[];e.target.checked?l=R()(t=[]).call(t,(0,v.Z)(r.state.selectedRowKeys),(0,v.Z)(o)):l=(0,ve.difference)(r.state.selectedRowKeys,o);r.setState({selectedRowKeys:l})})),(0,b.Z)((0,E.Z)(r),"handleBatchRoleSet",(function(){var e,t=r.state,n=t.selectedRowKeys,a=t.hosts,o=r.props.authorityList.sub_menu_role_manage,l=a.list,s=O()(e=L()(n).call(n,(function(e){return j()(l).call(l,(function(t){return t.id===e}))}))).call(e,(function(e){return e})),i=L()(s).call(s,(function(e){return e.sid})),c=L()(s).call(s,(function(e){return e.ip}));o?r.setState({visibleHostModal:{visible:!0,batch:!0,data:{sid:i,roleList:[],host:c}}}):V.Z.error("尚无权限执行该操作")})),(0,b.Z)((0,E.Z)(r),"handleRoleSet",(function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=r.state.hosts,o=a.list,l=null===(t=j()(o).call(o,(function(t){return t.sid===e})))||void 0===t?void 0:t.ip;r.setState({visibleHostModal:{visible:!0,batch:!1,data:{sid:[e],roleList:n,host:[l]}}})})),(0,b.Z)((0,E.Z)(r),"bindHostRoles",function(){var e=(0,_.Z)(D().mark((function e(t,n,a){var o,l;return D().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=L()(t).call(t,(function(e){return{sid:e,role_id_list:n}})),e.next=3,ce.Xi.bindHostRoles(o);case 3:l=e.sent,0===l.data.code?(V.Z.success("保存成功"),r.getHostList(),a()):V.Z.error("保存失败");case 6:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()),(0,b.Z)((0,E.Z)(r),"roleBtnRender",(function(e){return!0===e.isKubernetesCustom?null:e.selectedRowKeys.length>0?q.createElement(J.Z,{style:{marginLeft:20},type:"primary",onClick:function(){return r.authorityControl("roleSet","sub_menu_role_manage")}},"设置角色"):q.createElement(J.Z,{style:{marginLeft:20},disabled:!0},"设置角色")})),(0,b.Z)((0,E.Z)(r),"updateRoleList",(function(e){var t=r.state.visibleHostModal,n=t.data;r.setState({visibleHostModal:be(be({},t),{},{data:be(be({},n),{},{roleList:e})})})})),r}return(0,Z.Z)(n,[{key:"componentDidMount",value:function(){this.getHostList(),this.getClusterhostGroupLists()}},{key:"componentDidUpdate",value:function(e){e.cur_parent_cluster.id!==this.props.cur_parent_cluster.id&&(this.getHostList(),this.getClusterhostGroupLists())}},{key:"render",value:function(){var e,t=this,n=this.props,r=n.cur_parent_cluster,a=n.authorityList,o=this.state,l=o.selectedRowKeys,s=o.reqParams,i=o.hosts,c=i.list,u=void 0===c?[]:c,d=i.count,p=o.hostGroups,f=o.tableLoading,h=o.visibleHostModal,m={size:"small",showTotal:function(e){return q.createElement("span",null,"共",q.createElement("span",{style:{color:"#3F87FF"}},e),"条数据，每页显示",s.limit,"条")},current:s.start/s.limit+1,pageSize:s.limit,total:d},g={selectedRowKeys:l,onChange:this.handleSelectChange},v="kubernetes"===r.type,_=v&&0===r.mode,y=_e.RI[r.type],Z=function(e){var t,n=e.statusInfo,r=e.isKubernetes,a=e.isKubernetesCustom,o=e.authorityList,l=e.progressProp,s=e.hostGroups,i=e.handleRoleSet,c=o.sub_menu_role_manage;return O()(t=[{title:"节点",dataIndex:"hostname",render:function(e,t){return q.createElement("div",null,q.createElement("p",null,t.hostname),q.createElement("p",{className:"text-gray"},t.ip))}},{title:"agent状态",dataIndex:"is_running",filters:[{text:"运行中",value:"true"},{text:"已停止",value:"false"}],filterMultiple:!0,render:function(e){return q.createElement(Ze.Z,{color:e?"#12BC6A":"#FF5F5C",text:e?"运行中":"已停止"})}},{title:q.createElement("span",null,"主机初始化状态",q.createElement(Ee.Z,{title:n.title},q.createElement(Q.Z,{type:"info-circle"}))),dataIndex:"status",width:"15%",filters:n.filters,filterMultiple:!0,render:function(e,t){var r=n.finalStatus;return q.createElement(q.Fragment,null,q.createElement(Ze.Z,{color:l(t.status).color,text:l(t.status).title||t.errorMsg}),t.status!==r&&q.createElement(Ee.Z,{title:t.errorMsg}," ",q.createElement(Q.Z,{type:"info-circle"})))}},r?{title:"角色",dataIndex:"roles",width:"18%",filters:[{text:"Control",value:"Control"},{text:"Worker",value:"Worker"},{text:"Etcd",value:"Etcd"},{text:"全部",value:"all"}],filterMultiple:!0,render:function(e,t){var n=[];for(var r in t.roles)t.roles[r]&&n.push(r);return q.createElement(q.Fragment,null,L()(n).call(n,(function(e){return q.createElement(xe.Z,{className:"c-cluster__tag",key:e},e)})))}}:void 0,{title:"主机分组",dataIndex:"group",filters:s,filterMultiple:!0},{title:"CPU",dataIndex:"cpu_usage_pct",sorter:!0,render:function(e,t){return q.createElement(Ce.Z,{now:t.cpu_core_used_display,total:t.cpu_core_size_display})}},r?{title:"POD",dataIndex:"pod_usage_pct",sorter:!0,render:function(e,t){return q.createElement(Ce.Z,{now:t.pod_used_display,total:t.pod_size_display})}}:{title:"磁盘",dataIndex:"disk_usage_pct",sorter:!0,render:function(e,t){return q.createElement(Ce.Z,{pStyle:{width:140,marginLeft:"-28px"},now:t.disk_used_display,total:t.disk_size_display})}},a?void 0:{title:"角色",dataIndex:"role_list_display",ellipsis:!0,render:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return 0===e.length?"--":q.createElement(Ee.Z,{title:L()(e).call(e,(function(e){return e.role_name})).join(",")},q.createElement("span",null,L()(e).call(e,(function(e){return e.role_name})).join(",")))}},a?void 0:{title:"操作",render:function(e,t){var n;t.role_list_display=t.role_list_display||[];var r=L()(n=t.role_list_display).call(n,(function(e){return e.role_id}));return q.createElement("span",{className:"link-btn",onClick:function(){c?i(t.sid,r):V.Z.error("权限不足，请联系管理员！")}},"编辑角色")}}]).call(t,(function(e){return void 0!==e}))}({isKubernetes:v,isKubernetesCustom:_,statusInfo:y,hostGroups:p,progressProp:this.progressProp,handleRoleSet:this.handleRoleSet,authorityList:a}),E=this.getCheckedIds();return q.createElement("div",{className:"cluster-page-body"},q.createElement("div",{className:"clearfix mb-12"},q.createElement(De,{className:"dt-form-shadow-bg",style:{width:264},placeholder:"按主机ip或名称搜索",onSearch:this.handleSearch}),q.createElement(J.Z,{className:"fl-r",type:"primary",onClick:function(){return t.authorityControl("edit","cluster_edit")}},"编辑集群")),q.createElement(te.Z,{rowKey:"id",className:"dt-table-fixed-contain-footer c-cluster__table",style:{height:"calc(100vh - 232px)"},dataSource:u,pagination:m,loading:f,scroll:{y:!0},onChange:this.handleTableChange,rowSelection:g,columns:Z,footer:function(){return q.createElement("div",null,q.createElement(ee.Z,{"data-testid":"check-all-btn",style:{marginRight:12},checked:E.length&&E.length===u.length,indeterminate:E.length&&E.length<u.length,onChange:t.handleFooterChange},"全选"),l.length?q.createElement(J.Z,{type:"primary",onClick:function(){return t.authorityControl("delete","cluster_edit")}},"下架"):q.createElement(J.Z,{disabled:!0},"下架"),t.roleBtnRender({isKubernetesCustom:_,selectedRowKeys:l}))}}),q.createElement("span",{onClick:function(){t.refDropDown.hideSelect()},ref:function(e){return t.refModal=e}},q.createElement(Y.Z,{className:"role-hosts-modal",visible:h.visible,title:h.batch?"批量设置主机角色":"设置主机角色",maskClosable:!1,onCancel:function(e){e.stopPropagation(),t.refDropDown.hideSelect()&&t.setState({visibleHostModal:{visible:!1,batch:t.state.visibleHostModal.batch,data:{sid:[],roleList:[],host:[]}}})},onOk:function(){var e;if(null===(e=t.refDropDown)||void 0===e?void 0:e.hideSelect()){var n=t.state.visibleHostModal.data;t.bindHostRoles(n.sid,n.roleList,(function(){t.setState({visibleHostModal:{visible:!1,batch:t.state.visibleHostModal.batch,data:{sid:[],roleList:[],host:[]}}})}))}}},q.createElement($.Z,{labelCol:{span:4},wrapperCol:{span:20},className:"hosts-role-form"},h.batch?null:q.createElement(we,{label:"节点ip"},h.data.host.join(",")),q.createElement(we,{label:"选择角色"},q.createElement(ge,{ref:function(e){return t.refDropDown=e},cur_parent_cluster:r,container:this.refModal,value:this.state.visibleHostModal.data.roleList,onChange:function(e){var n=t.state.visibleHostModal,r=n.data.host,a=void 0===r?[]:r;t.setState({visibleHostModal:be(be({},n),{},{data:{roleList:e,sid:n.data.sid,host:a}})})},updateRoleList:U()(e=this.updateRoleList).call(e,this)}))))))}}]),n}(q.PureComponent);const Fe=(0,X.$j)((function(e){return{cur_parent_cluster:e.HeaderStore.cur_parent_cluster,authorityList:e.UserCenterStore.authorityList}}))(Re)},64143:(e,t,n)=>{n.d(t,{Z:()=>_});var r=n(77766),a=n.n(r),o=n(78914),l=n.n(o),s=n(81643),i=n.n(s),c=n(2991),u=n.n(c),d=n(86902),p=n.n(d),f=n(31238),h=n.n(f),m=n(45360),g=n(36808),v=n(18274);const _={pageWidth:function(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)},pageHeight:function(){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)},getParameterByName:function(e,t){t||(t=window.location.href),e=e.replace(/[[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},getBase64:function(e,t){var n=new FileReader;n.addEventListener("load",(function(){return t(n.result)})),n.readAsDataURL(e)},percent:function(e,t){return e&&e!==1/0?(e>1&&(e=1),t=t||2,t=Math.pow(10,t),Math.round(e*t*100)/t+"%"):"0%"},getCssText:function(e){var t="";for(var n in e)t+=n+":"+e[n]+";";return t},formateDateTime:function(e){var t,n,r,o,l;if(!e)return"";var s=new Date(e),i=s.getFullYear(),c=s.getMonth()+1+"",u=s.getDate()+"",d=s.getHours()+"",p=s.getMinutes()+"",f=s.getSeconds()+"";return 1===c.toString().length&&(c="0".concat(c)),1===u.toString().length&&(u="0".concat(u)),1===d.toString().length&&(d="0".concat(d)),1===p.toString().length&&(p="0".concat(p)),1===f.toString().length&&(f="0".concat(f)),a()(t=a()(n=a()(r=a()(o=a()(l="".concat(i,"-")).call(l,c,"-")).call(o,u," ")).call(r,d,":")).call(n,p,":")).call(t,f)},formateDate:function(e){var t,n;if(!e)return"";var r=new Date(e),o=r.getFullYear(),l=r.getMonth()+1+"",s=r.getDate()+"";return 1===l.toString().length&&(l="0".concat(l)),1===s.toString().length&&(s="0".concat(s)),a()(t=a()(n="".concat(o,"-")).call(n,l,"-")).call(t,s)},trim:function(e){return"string"==typeof e?e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""):e},messageFilter:function(e,t,n,r){1001===e.status.code&&(r||m.Z.success("成功"),t&&t())},getTableParam:function(e){var t={};return l()(e).call(e,(function(e,n){var r=e.split("-");t[r[1]]=r[2]})),t},setAlertControl:function(e){var t={},n=e.alert_control;return"1"===n?t.close=1:(t.close=0,e["alert_num_"+n]&&(t.times_after_close=e["alert_num_"+n]),e["recover_num_"+n]&&(t.close_after_long_time_reset_amount=e["recover_num_"+n],t.close_after_long_time_reset_unit=e["recover_unit_"+n])),t},getAlertControl:function(e){var t={alert_control:""};return 0===e.close&&(0!==e.times_after_close?(t.alert_control="2",t["alert_num_"+t.alert_control]=e.times_after_close):t.alert_control="3",""!==e.close_after_long_time_reset_amount&&("2"===t.alert_control&&(t.alert_control="4"),t["alert_num_"+t.alert_control]=e.times_after_close,t["recover_num_"+t.alert_control]=e.close_after_long_time_reset_amount,t["recover_unit_"+t.alert_control]=e.close_after_long_time_reset_unit)),t},filterOption:function(e,t){var n;return-1!==i()(n=t.props.children).call(n,e)},getParamsFromUrl:function(e){var t={},n=[],r="",a="",o=e.substring(i()(e).call(e,"?")+1,e.length).split("&");for(var l in o)r=(n=o[l].split("="))[0],a=n[1],t[r]=a;return t},jsonToQuery:function(e){var t;return e?function(e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t}(u()(t=p()(e)).call(t,(function(t){return void 0===e[t]?"":encodeURIComponent(t)+"="+encodeURIComponent(e[t])}))).join("&"):""},checkNullObj:function(e){return 0===p()(e).length},serviceCallback:function(e,t,n){0===e.data.code?(m.Z.success(t),n&&n()):m.Z.error(e.data.msg)},noAuthorityToDO:function(e,t){return!e[t]&&(m.Z.error("权限不足，请联系管理员!"),!0)},get k8sNamespace(){return g.get(v.E9.NAMESPACE)},setNaviKey:function(e,t){sessionStorage.setItem("firstLevelNav",e),sessionStorage.setItem("siderLevelNav",t)},formatGBUnit:function(e){return i()(e).call(e,"MB")>-1?h()(e.replace("MB",""))/1024:i()(e).call(e,"KB")>-1?h()(e.replace("KB",""))/1024/1024:i()(e).call(e,"GB")>-1?h()(e.replace("GB","")):i()(e).call(e,"TB")>-1?1024*h()(e.replace("TB","")):0}}}}]);