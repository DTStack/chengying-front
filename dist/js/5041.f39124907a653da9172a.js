(self.webpackChunkdt_em_front=self.webpackChunkdt_em_front||[]).push([[5041,4974,1633],{58657:(e,t,n)=>{var o=n(60386);e.exports=function(e,t,n){for(n=n||document,e={parentNode:e};(e=e.parentNode)&&e!==n;)if(o(e,t))return e}},60386:e=>{"use strict";e.exports=function(e,t){var n=window.Element.prototype,o=n.matches||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector;if(!e||1!==e.nodeType)return!1;var s=e.parentNode;if(o)return o.call(e,t);for(var a=s.querySelectorAll(t),r=a.length,i=0;i<r;i++)if(a[i]===e)return!0;return!1}},62988:(e,t,n)=>{var o=n(61755),s=n(26665).each;function a(e,t){this.query=e,this.isUnconditional=t,this.handlers=[],this.mql=window.matchMedia(e);var n=this;this.listener=function(e){n.mql=e.currentTarget||e,n.assess()},this.mql.addListener(this.listener)}a.prototype={constuctor:a,addHandler:function(e){var t=new o(e);this.handlers.push(t),this.matches()&&t.on()},removeHandler:function(e){var t=this.handlers;s(t,(function(n,o){if(n.equals(e))return n.destroy(),!t.splice(o,1)}))},matches:function(){return this.mql.matches||this.isUnconditional},clear:function(){s(this.handlers,(function(e){e.destroy()})),this.mql.removeListener(this.listener),this.handlers.length=0},assess:function(){var e=this.matches()?"on":"off";s(this.handlers,(function(t){t[e]()}))}},e.exports=a},38177:(e,t,n)=>{var o=n(62988),s=n(26665),a=s.each,r=s.isFunction,i=s.isArray;function c(){if(!window.matchMedia)throw new Error("matchMedia not present, legacy browsers require a polyfill");this.queries={},this.browserIsIncapable=!window.matchMedia("only all").matches}c.prototype={constructor:c,register:function(e,t,n){var s=this.queries,c=n&&this.browserIsIncapable;return s[e]||(s[e]=new o(e,c)),r(t)&&(t={match:t}),i(t)||(t=[t]),a(t,(function(t){r(t)&&(t={match:t}),s[e].addHandler(t)})),this},unregister:function(e,t){var n=this.queries[e];return n&&(t?n.removeHandler(t):(n.clear(),delete this.queries[e])),this}},e.exports=c},61755:e=>{function t(e){this.options=e,!e.deferSetup&&this.setup()}t.prototype={constructor:t,setup:function(){this.options.setup&&this.options.setup(),this.initialised=!0},on:function(){!this.initialised&&this.setup(),this.options.match&&this.options.match()},off:function(){this.options.unmatch&&this.options.unmatch()},destroy:function(){this.options.destroy?this.options.destroy():this.off()},equals:function(e){return this.options===e||this.options.match===e}},e.exports=t},26665:e=>{e.exports={isFunction:function(e){return"function"==typeof e},isArray:function(e){return"[object Array]"===Object.prototype.toString.apply(e)},each:function(e,t){for(var n=0,o=e.length;n<o&&!1!==t(e[n],n);n++);}}},24974:(e,t,n)=>{var o=n(38177);e.exports=new o},81633:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var o=n(42723),s=n(88239),a=n(99663),r=n(49135),i=n(93196),c=n(67294),l=n(45697),u=n.n(l),p=n(94184),h=n.n(p),f=n(46871),d=function(e){function t(n){(0,a.default)(this,t);var o=(0,r.default)(this,e.call(this,n));o.handleChange=function(e){var t=o.props,n=t.disabled,a=t.onChange;n||("checked"in o.props||o.setState({checked:e.target.checked}),a&&a({target:(0,s.default)({},o.props,{checked:e.target.checked}),stopPropagation:function(){e.stopPropagation()},preventDefault:function(){e.preventDefault()},nativeEvent:e.nativeEvent}))},o.saveInput=function(e){o.input=e};var i="checked"in n?n.checked:n.defaultChecked;return o.state={checked:i},o}return(0,i.default)(t,e),t.getDerivedStateFromProps=function(e,t){return"checked"in e?(0,s.default)({},t,{checked:e.checked}):null},t.prototype.focus=function(){this.input.focus()},t.prototype.blur=function(){this.input.blur()},t.prototype.render=function(){var e,t=this.props,n=t.prefixCls,a=t.className,r=t.style,i=t.name,l=t.id,u=t.type,p=t.disabled,f=t.readOnly,d=t.tabIndex,m=t.onClick,v=t.onFocus,y=t.onBlur,g=t.autoFocus,k=t.value,b=(0,o.default)(t,["prefixCls","className","style","name","id","type","disabled","readOnly","tabIndex","onClick","onFocus","onBlur","autoFocus","value"]),Z=Object.keys(b).reduce((function(e,t){return"aria-"!==t.substr(0,5)&&"data-"!==t.substr(0,5)&&"role"!==t||(e[t]=b[t]),e}),{}),C=this.state.checked,w=h()(n,a,((e={})[n+"-checked"]=C,e[n+"-disabled"]=p,e));return c.createElement("span",{className:w,style:r},c.createElement("input",(0,s.default)({name:i,id:l,type:u,readOnly:f,disabled:p,tabIndex:d,className:n+"-input",checked:!!C,onClick:m,onFocus:v,onBlur:y,onChange:this.handleChange,autoFocus:g,ref:this.saveInput,value:k},Z)),c.createElement("span",{className:n+"-inner"}))},t}(c.Component);d.propTypes={prefixCls:u().string,className:u().string,style:u().object,name:u().string,id:u().string,type:u().string,defaultChecked:u().oneOfType([u().number,u().bool]),checked:u().oneOfType([u().number,u().bool]),disabled:u().bool,onFocus:u().func,onBlur:u().func,onChange:u().func,onClick:u().func,tabIndex:u().oneOfType([u().string,u().number]),readOnly:u().bool,autoFocus:u().bool,value:u().any},d.defaultProps={prefixCls:"rc-checkbox",className:"",style:{},type:"checkbox",defaultChecked:!1,onFocus:function(){},onBlur:function(){},onChange:function(){}},(0,f.polyfill)(d);const m=d},40528:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>R});var o,s=n(1068),a=n.n(s),r=n(71649),i=n(68420),c=n(27344),l=n(5281),u=n(84441),p=n(3020),h=n(3362),f=n(44845),d=n(2991),m=n.n(d),v=n(32366),y=n.n(v),g=n(78580),k=n.n(g),b=n(77766),Z=n.n(b),C=n(41511),w=n.n(C),N=n(67294),E=n(29027),x=n(97183),S=n(34041),_=n(30258),I=n(67908),L=n(45360),F=n(69035),D=n(8263),q=n(14277),T=n(77268),B=n(78241);function O(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,h.Z)(e);if(t){var s=(0,h.Z)(this).constructor;n=a()(o,arguments,s)}else n=o.apply(this,arguments);return(0,p.Z)(this,n)}}var H=x.Z.Content,M=S.Z.Option,R=(0,E.$j)((function(e){return{authorityList:e.UserCenterStore.authorityList,HeaderStore:e.HeaderStore}}),void 0)(o=function(e){(0,u.Z)(n,e);var t=O(n);function n(e){var o;return(0,i.Z)(this,n),o=t.call(this,e),(0,f.Z)((0,l.Z)(o),"setBackupData",(function(e){var t=[],n=-1;m()(e).call(e,(function(e){var o;return m()(o=e.service).call(o,(function(o){n++,t.push({id:n,componentName:e.product,componentVersion:e.version,serviceName:o.name,hostsInfo:o.host_info})})),t})),o.setState({backupList:t,total:t.length})})),(0,f.Z)((0,l.Z)(o),"getColumns",(function(){var e=o.props.authorityList;return[{title:"组件名称",dataIndex:"componentName",key:"componentName",ellipsis:!0},{title:"组件版本号",dataIndex:"componentVersion",key:"componentVersion",ellipsis:!0},{title:"服务名称",dataIndex:"serviceName",key:"serviceName",ellipsis:!0},{title:"操作",key:"opreation",width:120,render:function(t,n){return N.createElement("span",null,e.sub_menu_backup_manage_delete?N.createElement("a",{onClick:function(){o.toDelete(n)}},"删除"):"--")}}]})),(0,f.Z)((0,l.Z)(o),"toDelete",(function(e){_.Z.confirm({title:"确认要删除该备份文件吗？",content:"删除后该备份将不可恢复！",icon:N.createElement(I.Z,{type:"close-circle",theme:"filled",style:{color:"#FF5F5C"}}),okType:"danger",onOk:function(){var t,n=o.state.hosts,s=[];""!==n?m()(t=e.hostsInfo).call(t,(function(e){return e.ip==n&&s.push(e),s})):s=e.hostsInfo;var a=[{product:e.componentName,version:e.componentVersion,service:[{name:e.serviceName,host_info:s}]}];B.post("/api/v2/product/clean",a).then((function(e){0===(e=e.data).code?(o.getBackupList(),L.Z.success("删除成功")):L.Z.error(e.msg)}))},okText:"删除"})})),(0,f.Z)((0,l.Z)(o),"onChangePage",(function(e,t){o.setState({page:e,size:t})})),(0,f.Z)((0,l.Z)(o),"setComponentsArr",(function(){var e=o.state,t=e.originalData,n=e.hosts,s=[];""==n?m()(t).call(t,(function(e){return s.push(e.product),s})):m()(t).call(t,(function(e){var t;return m()(t=e.service).call(t,(function(t){var o;m()(o=t.host_info).call(o,(function(t){t.ip==n&&s.push(e.product)}))})),s})),o.setState({componentList:y()(s).call(s,(function(e,t){var n;return k()(e).call(e,t)?e:Z()(n=[]).call(n,(0,r.Z)(e),[t])}),[])})})),(0,f.Z)((0,l.Z)(o),"onChangeComponent",(function(e){o.setServiceList(e),o.setState({components:e},(function(){o.filterData(),o.setHostsList()}))})),(0,f.Z)((0,l.Z)(o),"setServiceList",(function(e){var t=[],n=o.state.originalData;m()(n).call(n,(function(n){var o;n.product===e&&m()(o=n.service).call(o,(function(e){t.push(e.name)}));return t})),o.setState({services:"",serviceList:y()(t).call(t,(function(e,t){var n;return k()(e).call(e,t)?e:Z()(n=[]).call(n,(0,r.Z)(e),[t])}),[])})})),(0,f.Z)((0,l.Z)(o),"onChangeService",(function(e){o.setState({services:e},(function(){o.filterData()}))})),(0,f.Z)((0,l.Z)(o),"setHostsList",(function(){var e=o.state,t=e.originalData,n=e.components,s=[];""==n?m()(t).call(t,(function(e){var t;return m()(t=e.service).call(t,(function(e){var t;m()(t=e.host_info).call(t,(function(e){s.push(e.ip)}))})),s})):m()(t).call(t,(function(e){var t;e.product==n&&m()(t=e.service).call(t,(function(e){var t;m()(t=e.host_info).call(t,(function(e){s.push(e.ip)}))}));return s})),o.setState({hostsList:y()(s).call(s,(function(e,t){var n;return k()(e).call(e,t)?e:Z()(n=[]).call(n,(0,r.Z)(e),[t])}),[])})})),(0,f.Z)((0,l.Z)(o),"onChangeHosts",(function(e){o.setState({hosts:e},(function(){o.setComponentsArr(),o.filterData()}))})),(0,f.Z)((0,l.Z)(o),"filterData",(function(){var e=o.state,t=e.originalData,n=e.components,s=e.services,a=e.hosts,r=[],i=-1;m()(t).call(t,(function(e){var t;if(e.product===n&&""===s&&""===a)m()(t=e.service).call(t,(function(t){i++,r.push({id:i,componentName:e.product,componentVersion:e.version,serviceName:t.name,hostsInfo:t.host_info})}));else if(e.product===n&&""!==s&&""===a){var o;m()(o=e.service).call(o,(function(t){t.name===s&&(i++,r.push({id:i,componentName:e.product,componentVersion:e.version,serviceName:t.name,hostsInfo:t.host_info}))}))}else if(e.product===n&&""!==s&&""!==a){var c;m()(c=e.service).call(c,(function(t){var n;t.name===s&&m()(n=t.host_info).call(n,(function(n){n.ip===a&&(i++,r.push({id:i,componentName:e.product,componentVersion:e.version,serviceName:t.name,hostsInfo:t.host_info}))}))}))}else if(e.product===n&&""===s&&""!==a){var l;m()(l=e.service).call(l,(function(t){var n;m()(n=t.host_info).call(n,(function(n){n.ip===a&&(i++,r.push({id:i,componentName:e.product,componentVersion:e.version,serviceName:t.name,hostsInfo:t.host_info}))}))}))}else if(""===n&&""===s&&""!==a){var u;m()(u=e.service).call(u,(function(t){var n;m()(n=t.host_info).call(n,(function(n){n.ip===a&&(i++,r.push({id:i,componentName:e.product,componentVersion:e.version,serviceName:t.name,hostsInfo:t.host_info}))}))}))}return r})),o.setState({backupList:r,total:r.length})})),(0,f.Z)((0,l.Z)(o),"onChangeTable",(function(e,t){o.setState({selectedRows:t,selectedRowKeys:e})})),(0,f.Z)((0,l.Z)(o),"toMoreDelete",(function(){o.props.authorityList.sub_menu_backup_manage_delete?_.Z.confirm({title:"确认要批量删除备份文件吗？",content:"删除后备份将不可恢复！",icon:N.createElement(I.Z,{type:"close-circle",theme:"filled",style:{color:"#FF5F5C"}}),okType:"danger",onOk:function(){var e=o.state,t=e.selectedRows,n=e.hosts,s=[];m()(t).call(t,(function(e){var t;""!==n?m()(t=e.hostsInfo).call(t,(function(t){t.ip==n&&s.push({product:e.componentName,version:e.componentVersion,service:[{name:e.serviceName,host_info:[t]}]})})):s.push({product:e.componentName,version:e.componentVersion,service:[{name:e.serviceName,host_info:e.hostsInfo}]});return s})),B.post("/api/v2/product/clean",s).then((function(e){0===(e=e.data).code?(o.getBackupList(),o.setState({selectedRows:[],selectedRowKeys:[]}),L.Z.success("删除成功")):L.Z.error(e.msg)}))},okText:"删除"}):L.Z.error("尚无权限执行该操作")})),o.state={originalData:[],backupList:[],selectedRows:[],selectedRowKeys:[],components:"",componentList:[],serviceList:[],services:"",hostsList:[],hosts:"",page:1,size:10,total:0},o}return(0,c.Z)(n,[{key:"componentDidMount",value:function(){this.getBackupList()}},{key:"getBackupList",value:function(){var e=this,t=this.props.HeaderStore.cur_parent_cluster.id;B.get("/api/v2/product/backup",{clusterId:t}).then((function(t){if(0===(t=t.data).code){var n=e.state,o=n.components,s=n.services,a=n.hosts;e.setState({originalData:t.data},(function(){""==o&&""==s&&""==a?e.setBackupData(t.data):e.filterData(),e.setHostsList(),e.setComponentsArr()}))}else L.Z.error(t.msg)}))}},{key:"render",value:function(){var e=this.state,t=e.componentList,n=e.components,o=e.hosts,s=e.serviceList,a=e.backupList,r=e.hostsList,i=e.size,c=e.total,l=e.page,u=e.services,p=e.selectedRows,h={selectedRowKeys:e.selectedRowKeys,onChange:this.onChangeTable},f={size:"small",pageSize:i,total:c,current:l,onChange:this.onChangePage,showTotal:function(e){return N.createElement("span",null,"共",N.createElement("span",{style:{color:"#3F87FF"}},e),"条数据，每页显示",N.createElement("span",{style:{color:"#3F87FF"}},i),"条")}};return N.createElement(x.Z,{id:"monitorDataFlowContainer"},N.createElement(H,null,N.createElement("div",{className:"backup-page"},N.createElement("div",{className:"top-navbar clearfix"},N.createElement(F.Z,{className:"ant-advanced-search-form"},N.createElement("div",{style:{minWidth:"1000px",display:"flex"}},N.createElement(F.Z.Item,{label:"组件："},N.createElement(S.Z,{className:"dt-form-shadow-bg mr-20",style:{width:160},placeholder:"请选择组件",onChange:this.onChangeComponent,value:n||void 0},w()(t)&&m()(t).call(t,(function(e,t){return N.createElement(M,{key:t,value:e},e)})))),N.createElement(F.Z.Item,{label:"服务："},N.createElement(S.Z,{className:"dt-form-shadow-bg mr-20",style:{width:160},placeholder:"请选择服务",onChange:this.onChangeService,value:u||void 0},w()(s)&&m()(s).call(s,(function(e){return N.createElement(M,{key:e,value:e},e)})))),N.createElement(F.Z.Item,{label:"主机："},N.createElement(S.Z,{className:"dt-form-shadow-bg mr-20",style:{width:160},placeholder:"请选择主机",onChange:this.onChangeHosts,value:o||void 0},w()(r)&&m()(r).call(r,(function(e){return N.createElement(M,{key:e,value:e},e)}))))))),N.createElement("div",{className:"log_table box-shadow-style"},N.createElement(D.Z,{rowKey:"id",className:"dt-table-fixed-base",style:{height:"calc(100vh - 40px - 40px - 72px)"},scroll:{y:!0},locale:{emptyText:N.createElement(q.Z,null)},rowSelection:h,columns:this.getColumns(),dataSource:a,pagination:f}),N.createElement("span",{className:"batch-delete",style:{zIndex:100}},N.createElement(T.Z,{disabled:0==c||0==p.length,size:"small",type:"primary",onClick:this.toMoreDelete},"批量删除"))))))}}]),n}(N.Component))||o}}]);