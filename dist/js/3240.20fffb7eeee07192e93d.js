"use strict";(self.webpackChunkdt_em_front=self.webpackChunkdt_em_front||[]).push([[3240],{88081:(e,t,n)=>{n.d(t,{Z:()=>y});var r=n(1068),a=n.n(r),o=n(68420),l=n(27344),s=n(5281),c=n(84441),i=n(3020),u=n(3362),d=n(44845),p=n(77766),m=n.n(p),f=n(67294),h=n(28568),v=n(45360);function Z(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var o=(0,u.Z)(this).constructor;n=a()(r,arguments,o)}else n=r.apply(this,arguments);return(0,i.Z)(this,n)}}var y=function(e){(0,c.Z)(n,e);var t=Z(n);function n(){var e,r;(0,o.Z)(this,n);for(var a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];return r=t.call.apply(t,m()(e=[this]).call(e,l)),(0,d.Z)((0,s.Z)(r),"state",{fileContent:"",fileViewShow:!1}),(0,d.Z)((0,s.Z)(r),"ws",void 0),(0,d.Z)((0,s.Z)(r),"handleShowLog",(function(e){e.preventDefault(),r.setState({fileViewShow:!0},(function(){r.websocketLink()}))})),(0,d.Z)((0,s.Z)(r),"websocketLink",(function(){var e=!1,t=r.props.wsUrl;r.ws=new WebSocket(t),r.ws.onmessage=function(e){r.setState({fileContent:e.data})},r.ws.onerror=function(t){e=!0,v.Z.error("实时日志获取失败！")},r.ws.onclose=function(){r.state.fileViewShow&&!e&&r.websocketLink()}})),r}return(0,l.Z)(n,[{key:"render",value:function(){var e=this,t=this.state,n=t.fileViewShow,r=t.fileContent;return f.createElement(f.Fragment,null,f.createElement("a",{style:{fontSize:"12px",display:"inline-block",marginTop:"10px"},onClick:this.handleShowLog},"查看完整日志"),n&&f.createElement(h.Z,{title:"日志",serviceData:null,maskClosable:!0,visible:n,content:r,fileGoBottom:!0,loading:!0,onCancel:function(){e.setState({fileViewShow:!1,fileContent:""},(function(){e.ws.close()}))}}))}}]),n}(f.PureComponent)},28568:(e,t,n)=>{n.d(t,{Z:()=>N});var r=n(1068),a=n.n(r),o=n(68420),l=n(27344),s=n(5281),c=n(84441),i=n(3020),u=n(3362),d=n(44845),p=n(2991),m=n.n(p),f=n(25843),h=n.n(f),v=n(77766),Z=n.n(v),y=n(67294),g=n(34041),E=n(85733),C=n(30258),w=n(31097),b=n(4107),S=n(67908);function x(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var o=(0,u.Z)(this).constructor;n=a()(r,arguments,o)}else n=r.apply(this,arguments);return(0,i.Z)(this,n)}}var k=g.Z.Option,I=E.Z.TreeNode,N=function(e){(0,c.Z)(n,e);var t=x(n);function n(e){var r;return(0,o.Z)(this,n),r=t.call(this,e),(0,d.Z)((0,s.Z)(r),"state",{first_logfile:"",second_logfile:"",show_second_select:!1,second_logs:[],log_message:"",lineNum:"200",searchText:"",sourceText:"",query:""}),(0,d.Z)((0,s.Z)(r),"onSearch",(function(e){r.setState({query:e},(function(){r.setLogMessage(r.props.content,!1)}))})),(0,d.Z)((0,s.Z)(r),"setContent",(function(e){var t=r.setQueryKey(e),n=new RegExp(/([\S ]*ERROR[\S ]*)/,"gi");return t.replace(n,'<span style="color: red">$1</span>')})),(0,d.Z)((0,s.Z)(r),"setQueryKey",(function(e){var t=r.state.query;if(""===t)return e;var n=t.toLowerCase(),a=new RegExp("(".concat(n,")"),"gi");return e.replace(a,'<span style="color: #2391F7">$1</span>')})),(0,d.Z)((0,s.Z)(r),"setLogMessage",(function(e,t){var n=r.props.fileGoBottom,a=document.getElementById("textPre");a&&(a.innerHTML=r.setContent(e||""),(void 0===t?n:t)&&document.getElementsByClassName("log-message-box").length>0&&document.getElementsByClassName("log-message-box")[0].scrollTo(0,a.offsetHeight))})),(0,d.Z)((0,s.Z)(r),"renderServiceSelect",(function(){var e=r.props,t=e.serviceData,n=e.onSelectedService;return y.createElement(E.Z,{showSearch:!0,style:{width:200,marginRight:10},dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:"按服务搜索",allowClear:!0,treeDefaultExpandAll:!0,onChange:n},function(e){var t=[],n=function(n){if(Object.prototype.hasOwnProperty.call(e,n)){var r=e[n];t.push(y.createElement(I,{value:n,title:n,key:n,selectable:!1},r&&m()(r).call(r,(function(e){return y.createElement(I,{isLeaf:!0,value:e.service_name,title:e.service_name_display,key:n+"-"+e.service_name})}))))}};for(var r in e)n(r);return t}(t))})),r}return(0,l.Z)(n,[{key:"componentDidMount",value:function(){this.setLogMessage(this.props.content)}},{key:"componentDidUpdate",value:function(e,t){var n=document.getElementById("textPre");this.props.content===e.content&&this.props.content&&!n.innerHTML&&this.setLogMessage(this.props.content),this.props.content!==e.content&&this.setLogMessage(this.props.content)}},{key:"render",value:function(){var e=this.props,t=e.visible,n=e.onCancel,r=e.title,a=e.maskClosable,o=e.onSelectedFile,l=e.fileList,s=e.content,c=e.selectedFile,i=e.serviceData,u=e.loading;return y.createElement(C.Z,{className:"logtail-box",destroyOnClose:!0,title:r,footer:null,width:800,visible:t,maskClosable:a,onCancel:n},y.createElement("div",{className:"logtail-box"},y.createElement("div",{className:"option-bar",style:{display:"flex"}},i&&y.createElement("span",null,this.renderServiceSelect()),l?y.createElement(g.Z,{allowClear:!0,showSearch:!0,placeholder:"选择文件",value:c,style:{width:200,marginBottom:10,marginRight:10},onChange:o},m()(l).call(l,(function(e,t){var n,r=h()(e).call(e);return y.createElement(k,{key:Z()(n="".concat(r,"-")).call(n,t),value:r},y.createElement(w.Z,{title:r},r))}))):null,y.createElement(b.Z.Search,{placeholder:"输入关键词",style:{width:200,marginBottom:10},onSearch:this.onSearch})),y.createElement("div",{className:"log-message-box",style:{height:"400px",paddingTop:"10px",overflowY:"auto",backgroundColor:"#F5F5F5",border:"1px dashed #DDDDDD"}},s?y.createElement("pre",{id:"textPre",style:{paddingLeft:10,height:"auto"}}):null,""===s?y.createElement("div",{style:{lineHeight:"380px",color:"#dddddd",textAlign:"center"}},"没有记录"):null,null===s?y.createElement("div",{style:{lineHeight:"380px",color:"#dddddd",textAlign:"center"}},"请选择上方过滤条件"):null,u&&s&&y.createElement(S.Z,{className:"ml-10",type:"loading"}))))}}]),n}(y.Component)},18274:(e,t,n)=>{n.d(t,{E9:()=>s,MD:()=>r,OY:()=>o,RI:()=>l,XN:()=>a});var r=[{text:"部署成功",value:"deployed"},{text:"部署失败",value:"deploy fail"},{text:"部署中",value:"deploying"},{text:"卸载失败",value:"undeploy fail"},{text:"卸载中",value:"undeploying"}],a=[{text:"更新成功",value:"success"},{text:"更新失败",value:"fail"},{text:"更新中",value:"update"}],o={hosts:["主机集群"],kubernetes:["Kubernetes集群（自建集群）","Kubernetes集群（导入已有集群）"]},l={hosts:{title:"主机安装会经过2个状态：管控安装-主机初始化，若某一步安装失败，请查看具体日志。",filters:[{text:"管控安装成功",value:"管控安装成功"},{text:"管控安装失败",value:"管控安装失败"},{text:"script安装成功",value:"script安装成功"},{text:"script安装失败",value:"script安装失败"},{text:"主机初始化成功",value:"主机初始化成功"},{text:"主机初始化失败",value:"主机初始化失败"}],finalStatus:3},kubernetes:{title:"Kubernetes集群主机安装会经过5个状态：管控安装-主机初始化-K8S Docker初始化-K8S Node初始化-K8S Node部署成功，若某一步安装失败，请查看具体日志",filters:[{text:"管控安装失败",value:"管控安装失败",status:-1},{text:"管控安装成功",value:"管控安装成功",status:1},{text:"主机初始化失败",value:"主机初始化失败",status:-3},{text:"主机初始化成功",value:"主机初始化成功",status:3},{text:"K8S DOCKER初始化失败",value:"K8S DOCKER初始化失败",status:-5},{text:"K8S DOCKER初始化成功",value:"K8S DOCKER初始化成功",status:5},{text:"K8S NODE初始化失败",value:"K8S NODE初始化失败",status:-6},{text:"K8S NODE初始化成功",value:"K8S NODE初始化成功",status:6},{text:"K8S NODE部署失败",value:"K8S NODE部署失败",status:-7},{text:"K8S NODE部署成功",value:"K8S NODE部署成功",status:7}],finalStatus:7}},s={NAMESPACE:"em_current_k8s_namespace"}},42238:(e,t,n)=>{n.d(t,{Y:()=>a,v:()=>r});var r={labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:12}}},a={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}}}},37092:(e,t,n)=>{n.d(t,{Z:()=>P});var r=n(71649),a=n(95266),o=n(32366),l=n.n(o),s=n(86902),c=n.n(s),i=n(77766),u=n.n(i),d=n(39969),p=n.n(d),m=n(67294),f=n(45360),h=n(77268),v=n(30258),Z=n(11382),y=n(14277),g=n(74981),E=(n(44576),n(68886),n(40049),n(55827)),C=n(30381),w=n.n(C),b=n(36808),S=n(96486),x=function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=l()(n=c()(r)).call(n,(function(e,t){var n,a;return u()(n=u()(a="".concat(e)).call(a,t,"=")).call(n,r[t],"&")}),"".concat(e,"?")).replace(/&$/,"");fetch(a).then((function(e){return e.blob()})).then((function(e){var n=p().createObjectURL(e),r=document.createElement("a");r.href=n,r.download=t,r.click(),p().revokeObjectURL(r.href)})).catch((function(e){f.Z.error(e.message)}))},k=function(e){var t=e.title,n=e.visible,r=e.type,a=e.onColse,o=e.execId,l=e.showFooter,s=void 0===l||l,c=m.useRef(null),i=m.useCallback((function(e){var t=e.type,n=e.payload;switch(t){case"log":x("/api/v2/cluster/downLoadShellLog","".concat(o,"-shell.log"),n);break;case"echo":x("/api/v2/cluster/downLoadShellContent","".concat(o,"-content.sh"),n)}}),[]),u="echo"===r?m.createElement(h.Z,{type:"primary",disabled:!o,onClick:S.debounce((function(){return i({type:"echo",payload:{execId:o}})}),200)},"下载完整脚本"):m.createElement(h.Z,{type:"primary",disabled:!o,onClick:S.debounce((function(){i({type:"log",payload:{clusterId:b.get("em_current_cluster_id"),execId:o}})}),200)},"下载完整日志");return m.createElement(v.Z,{className:"code-view-modal",width:"echo"===r?520:1050,title:t,visible:n,footer:s?u:null,onCancel:function(e){c.current&&c.current.wsClose(),a()}},"echo"===r?m.createElement(I,{execId:o}):m.createElement(N,{execId:o,cref:c}))},I=function(e){var t=e.execId,n=m.useState(""),r=(0,a.Z)(n,2),o=r[0],l=r[1];return m.useEffect((function(){t&&function(e){E.Z.showShellContent({execId:e}).then((function(e){var t=e.data,n=t.data,r=t.code,a=t.msg;if(0===r)return l(n);f.Z.error(a)})).catch((function(e){f.Z.error(e.message)}))}(t)}),[t]),m.createElement(g.ZP,{className:"ace-code-portal",mode:"golang",theme:"kuroir",value:o,readOnly:!0,width:"400px",height:"100%",showGutter:!1})},N=function(e){var t=e.execId,n=e.cref,o=m.useState([]),l=(0,a.Z)(o,2),s=l[0],c=l[1],i=m.useState(!1),d=(0,a.Z)(i,2),p=d[0],f=d[1],h=m.useRef(null);m.useImperativeHandle(n,(function(){return{wsClose:function(){h.current&&h.current.close(),h.current=null}}}));m.useEffect((function(){if(t)try{var e,n;h.current=new WebSocket(u()(e=u()(n="ws://".concat(window.location.hostname,":")).call(n,window.location.port,"/api/v2/cluster/showShellLog?execId=")).call(e,t)),h.current.onmessage=function(e){c((function(t){var n;return u()(n=[]).call(n,(0,r.Z)(t),[{time:"[".concat(w()().format("hh:mm:ss"),"]"),message:e.data}])})),f(!1)},h.current.onopen=function(e){f(!0)},h.current.onerror=function(e){f(!1)},h.current.onclose=function(){f(!1)}}catch(e){f(!1)}}),[t]);return m.createElement(Z.Z,{spinning:p},s.length?m.createElement("div",{className:"log-info"},m.createElement("ul",{dangerouslySetInnerHTML:{__html:function(e){var t="";for(var n in e){t+="\n        <li>\n          <pre>".concat(e[n].message,"</pre>\n        </li>\n      ")}return t}(s)}})):m.createElement(y.Z,null))};const P=m.memo(k,(function(e,t){return e.execId===t.execId}))},33240:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ye});var r=n(1068),a=n.n(r),o=n(14310),l=n.n(o),s=n(20116),c=n.n(s),i=n(34074),u=n.n(i),d=n(39649),p=n.n(d),m=n(20368),f=n.n(m),h=n(63978),v=n.n(h),Z=n(73126),y=n(68420),g=n(27344),E=n(5281),C=n(84441),w=n(3020),b=n(3362),S=n(44845),x=n(51942),k=n.n(x),I=n(33032),N=n.n(I),P=n(78914),D=n.n(P),K=n(3649),_=n.n(K),G=n(78580),H=n.n(G),R=n(77766),M=n.n(R),L=n(86902),O=n.n(L),B=n(2991),q=n.n(B),T=n(94473),F=n.n(T),A=n(41511),W=n.n(A),V=n(67294),j=n(15857),U=n(29027),$=n(19528),z=n(57668),J=n(94184),Y=n.n(J),Q=n(34041),X=n(4107),ee=n(24105),te=n(69035),ne=n(30258),re=n(67908),ae=n(45360),oe=n(55241),le=n(31097),se=n(45334),ce=n(60331),ie=n(77268),ue=n(37870),de=n(8263),pe=n(14277),me=n(18274),fe=n(66253),he=n(44930),ve=n(63109),Ze=n.n(ve),ye=n(81643),ge=n.n(ye),Ee=n(9676),Ce={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:15}}},we=n(60558);function be(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,b.Z)(e);if(t){var o=(0,b.Z)(this).constructor;n=a()(r,arguments,o)}else n=r.apply(this,arguments);return(0,w.Z)(this,n)}}var Se=te.Z.Item,xe=fe.ZP.Group,ke=Ee.Z.Group,Ie=function(e){(0,C.Z)(n,e);var t=be(n);function n(){var e,r;(0,y.Z)(this,n);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return r=t.call.apply(t,M()(e=[this]).call(e,o)),(0,S.Z)((0,E.Z)(r),"state",{canGoOn:!1,fileName:"",method:2,testLoading:!1,showErrorHost:!1,canInstallHost:[],installLoading:!1,hostGroups:[],showResultModel:!1,isCreateGroup:!1,addHostData:{},showDetermine:!0,encryptInfo:{}}),(0,S.Z)((0,E.Z)(r),"secretKey",V.createRef()),(0,S.Z)((0,E.Z)(r),"getPublicKey",(0,he.Z)(Ze().mark((function e(){var t,n;return Ze().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.bS.getPublicKey();case 2:if(t=e.sent,0===(n=t.data).code){e.next=6;break}return e.abrupt("return");case 6:r.setState({encryptInfo:n.data});case 7:case"end":return e.stop()}}),e)})))),(0,S.Z)((0,E.Z)(r),"loadAllGroups",(function(){var e=r.props.clusterInfo,t=void 0===e?{}:e,n=t.type,a=t.id;$.t6.getClusterhostGroupLists({type:n,id:a}).then((function(e){0===(e=e.data).code&&r.setState({hostGroups:e.data||[]})}))})),(0,S.Z)((0,E.Z)(r),"installHost",(function(){var e=r.props,t=e.form,n=e.clusterInfo,a=void 0===n?{}:n,o=r.state.encryptInfo,l=o.encrypt_type,s=o.encrypt_public_key,c=t.getFieldValue("group");t.validateFields((function(e,t){if(!e){var n=r.state.canInstallHost.toString();r.setState({installLoading:!0});var o={host:n,port:t.port,user:t.user,group:t.group,cluster_type:a.type,cluster_id:a.id,role:t.role?t.role.join(","):void 0};1===r.state.method?k()(o,{type:"pk",pk:t.pk}):k()(o,{type:"pwd",password:"sm2"===l?(0,we.ON)(t.password,s):(0,we.g8)(t.password,s)}),$.y$.installHost(o,r.state.method).then((function(e){0!==(e=e.data).code?(ae.Z.error(e.msg),r.setState({installLoading:!1})):(N()((function(){r.props.refresh(c)}),1e3),r.props.afterInstall(),r.setState({installLoading:!1}))}))}}))})),(0,S.Z)((0,E.Z)(r),"testConnection",(function(){var e=r.state.encryptInfo,t=e.encrypt_type,n=e.encrypt_public_key;r.setState({showErrorHost:!1}),r.props.form.validateFields((function(e,a){if(!e){var o;a.role=a.role?a.role.join(","):void 0,a.password="sm2"===t?(0,we.ON)(a.password,n):(0,we.g8)(a.password,n),r.setState({testLoading:!0,canGoOn:!1,canInstallHost:[]});var l=(null==a||null===(o=a.host)||void 0===o?void 0:ge()(o).call(o,","))>-1?null==a?void 0:a.host.split(","):[a.host];$.y$.testConnection(a,r.state.method).then((function(e){var t=e.data,n=t.code,a=t.data,o=t.msg;if(0!==n)return ae.Z.error(o),void r.setState({testLoading:!1});r.setState({testLoading:!1,canInstallHost:l},(function(){var e=a.connectErrorIps,t=a.currentClusterExistIp,n=a.otherClusterExistIp;0===(null==e?void 0:e.length)&&0===(null==t?void 0:t.length)&&0===(null==n?void 0:n.length)?(ae.Z.success("测试连通性通过"),r.setState({showDetermine:!1,showResultModel:!1})):r.setState((function(){return{showResultModel:!0,addHostData:a}}))}))}))}}))})),(0,S.Z)((0,E.Z)(r),"handleMethodChange",(function(e){r.setState({method:e.target.value})})),(0,S.Z)((0,E.Z)(r),"uploadSecret",(function(){var e=r.props.form,t=r.secretKey.files[0];if(t)if(t.size/1024>=100)ae.Z.warn("请选择小于100Kb文件上传！");else if(window.FileReader){var n=new FileReader;n.readAsText(t),n.onload=function(t){e.setFieldsValue({pk:t.target.result})},r.setState({fileName:t.name}),r.secretKey.value=""}else ae.Z.warn("浏览器不支持");else ae.Z.warn("请选择上传的秘钥")})),(0,S.Z)((0,E.Z)(r),"handleGroupBlurChange",(function(e){"CREATENEWGROUP"===e&&r.setState({isCreateGroup:!0},(function(){r.props.form.setFieldsValue({group:""})}))})),r}return(0,g.Z)(n,[{key:"componentDidMount",value:function(){this.loadAllGroups(),this.getPublicKey()}},{key:"handleGroupBlur",value:function(e){}},{key:"render",value:function(){var e,t,n,r,a,o,l,s=this,c=this.props.clusterInfo,i=void 0===c?{}:c,u=this.props.form.getFieldDecorator,d=this.state.addHostData;return V.createElement("div",{className:"step-account"},V.createElement(te.Z,{style:{marginBottom:20}},V.createElement(Se,(0,Z.Z)({style:{marginBottom:20}},Ce,{label:V.createElement("span",null,"主机分组",V.createElement(le.Z,{title:"主机分组是对主机的划分，当集群中主机过多时，可对主机进行分组，方便管理。"},V.createElement(re.Z,{type:"question-circle"})))}),u("group",{})(this.state.isCreateGroup?V.createElement(X.Z,{placeholder:"输入新的分组名称"}):V.createElement(Q.Z,{onChange:this.handleGroupBlurChange,onBlur:this.handleGroupBlur},V.createElement(Q.Z.Option,{value:"CREATENEWGROUP"},"新建主机分组"),this.state.hostGroups&&q()(e=this.state.hostGroups).call(e,(function(e,t){return V.createElement(Q.Z.Option,{value:e,key:t+""},e)}))))),V.createElement(Se,(0,Z.Z)({style:{marginBottom:0}},Ce,{label:"机器IP"}),u("host",{rules:[{required:!0,message:"机器IP不能为空"}]})(V.createElement(X.Z.TextArea,{rows:4,placeholder:"支持输入多个IP及IP段。多个IP用英文都逗号分隔，如172.16.10,171.12.10.9。IP段用英文‘-’连接，如172.16.10-80。"}))),V.createElement(Se,(0,Z.Z)({style:{marginTop:20}},Ce,{label:"SSH接口"}),u("port",{rules:[{required:!0,message:"SSH端口不能为空"}],initialValue:"22"})(V.createElement(X.Z,null))),"kubernetes"===i.type&&V.createElement(Se,(0,Z.Z)({},Ce,{label:V.createElement(le.Z,{title:V.createElement("div",null,V.createElement("p",null,"主机角色说明："),V.createElement("p",null,"Etcd角色节点：运行etcd组件，用于存储Kubernetes集群配置数据。"),V.createElement("p",null,"Control角色节点：运行Kubernetes主组件（kube-apiserver，kube-scheduler，kube-controller-manager和cloud-controller-manager）。"),V.createElement("p",null,"Worker角色节点：运行Kubernetes kubelet，kube-proxy，Container runtime组件。"))},V.createElement("span",null,"主机角色"),V.createElement(re.Z,{type:"question-circle"}))}),u("role",{rules:[{required:!0,message:"主机角色不能为空"}],initialValue:["Etcd","Control","Worker"]})(V.createElement(ke,null,V.createElement(Ee.Z,{value:"Etcd"},"Etcd"),V.createElement(Ee.Z,{value:"Control"},"Control"),V.createElement(Ee.Z,{value:"Worker"},"Worker")))),V.createElement(Se,(0,Z.Z)({},Ce,{label:"登录方式"}),V.createElement(xe,{value:this.state.method,onChange:this.handleMethodChange},V.createElement(fe.ZP,{value:1},"密钥"),V.createElement(fe.ZP,{value:2},"密码"))),V.createElement(Se,(0,Z.Z)({},Ce,{label:"用户名",extra:"需要sudo+NOPASSWD权限"}),u("user",{rules:[{required:!0,message:"用户名不能为空"}],initialValue:"admin"})(V.createElement(X.Z,null))),2===this.state.method?V.createElement(Se,(0,Z.Z)({},Ce,{label:"密码"}),u("password",{rules:[{required:!0,message:"密码不能为空"}]})(V.createElement(X.Z.Password,null))):V.createElement(Se,(0,Z.Z)({},Ce,{label:"密钥"}),u("pk",{rules:[{required:!0,message:"密钥不可为空!"}]})(V.createElement(X.Z,{style:{display:"none"}})),V.createElement("label",{className:"ant-btn"},"上传秘钥文件",V.createElement("input",{ref:function(e){return s.secretKey=e},type:"file",onChange:this.uploadSecret,style:{display:"none"}})),V.createElement("span",null,this.state.fileName))),this.state.showResultModel?V.createElement("div",{style:{marginBottom:20}},V.createElement("p",null,V.createElement(re.Z,{type:"close-circle",style:{color:"red",fontSize:14,marginRight:6},theme:"filled"}),"异常IP列表:"),V.createElement("div",{className:"error-desc"},null!=d&&null!==(t=d.connectErrorIps)&&void 0!==t&&t.length?V.createElement("p",null,"- 连通失败IP：",(null==d||null===(n=d.connectErrorIps)||void 0===n?void 0:n.join(","))||"无"):"",null!=d&&null!==(r=d.currentClusterExistIp)&&void 0!==r&&r.length?V.createElement("p",null,"- 以下IP在当前集群已存在：",(null==d||null===(a=d.currentClusterExistIp)||void 0===a?void 0:a.join(","))||"无"):"",null!=d&&null!==(o=d.otherClusterExistIp)&&void 0!==o&&o.length?V.createElement("p",null,"- 以下IP在其他集群已存在：",(null==d||null===(l=d.otherClusterExistIp)||void 0===l?void 0:l.join(","))||"无"):"")):"",V.createElement("div",{className:"btn-container"},V.createElement(ie.Z,{loading:this.state.testLoading,type:"primary",onClick:this.testConnection},"测试连通性"),V.createElement("div",null,V.createElement(ie.Z,{onClick:this.props.onCancel,type:"default",className:"mr-8"},"取消"),V.createElement(ie.Z,{onClick:this.installHost,type:"primary",loading:this.state.installLoading,disabled:this.state.showResultModel||this.state.showDetermine},"确定"))))}}]),n}(V.Component);const Ne=te.Z.create()(Ie);function Pe(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,b.Z)(e);if(t){var o=(0,b.Z)(this).constructor;n=a()(r,arguments,o)}else n=r.apply(this,arguments);return(0,w.Z)(this,n)}}var De=Ee.Z.Group,Ke=te.Z.Item,_e=function(e){(0,C.Z)(n,e);var t=Pe(n);function n(){var e,r;(0,y.Z)(this,n);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return r=t.call.apply(t,M()(e=[this]).call(e,o)),(0,S.Z)((0,E.Z)(r),"state",{canGoOn:!1,cmdContent:"",roles:["Etcd","Control","Worker"],formItemMsg:{status:"success",help:""}}),(0,S.Z)((0,E.Z)(r),"fetchInstallCmd",(function(){var e=r.props.clusterInfo,t=void 0===e?{}:e,n=t.type,a=t.id;$.jy.getInstallCMD({type:n,clusterId:a,role:r.state.roles.join(",")}).then((function(e){0===e.data.code?r.setState({cmdContent:e.data.data}):ae.Z.error(e.data.msg)}))})),(0,S.Z)((0,E.Z)(r),"handleChange",(function(e){r.setState({roles:e},(function(){r.fetchInstallCmd(),r.handleCheck()}))})),(0,S.Z)((0,E.Z)(r),"handleCheck",(function(){var e={status:"error",help:"请选择主机角色"};return r.state.roles.length&&(e.status="success",e.help=""),r.setState({formItemMsg:e}),e.status})),(0,S.Z)((0,E.Z)(r),"handleCopy",(function(){var e=r.props.clusterInfo;if("success"===("kubernetes"===(void 0===e?{}:e).type?r.handleCheck():"success")){var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),document.getElementById("J_CopyBtn").dispatchEvent(t)}})),r}return(0,g.Z)(n,[{key:"componentDidMount",value:function(){this.fetchInstallCmd()}},{key:"render",value:function(){var e=this.props.clusterInfo,t=void 0===e?{}:e,n=this.state,r=n.formItemMsg,a=n.roles;return V.createElement("div",{className:"step-shell"},"kubernetes"===t.type&&V.createElement(te.Z,null,V.createElement(Ke,(0,Z.Z)({},Ce,{required:!0,validateStatus:r.status,help:r.help,label:V.createElement(le.Z,{title:V.createElement("div",null,V.createElement("p",null,"主机角色说明："),V.createElement("p",null,"Etcd角色节点：运行etcd组件，用于存储Kubernetes集群配置数据。"),V.createElement("p",null,"Control角色节点：运行Kubernetes主组件（kube-apiserver，kube-scheduler，kube-controller-manager和cloud-controller-manager）。"),V.createElement("p",null,"Worker角色节点：运行Kubernetes kubelet，kube-proxy，Container runtime组件。"))},V.createElement("span",null,"主机角色"),V.createElement(re.Z,{type:"question-circle"}))}),V.createElement(De,{value:a,onChange:this.handleChange},V.createElement(Ee.Z,{value:"Etcd"},"Etcd"),V.createElement(Ee.Z,{value:"Control"},"Control"),V.createElement(Ee.Z,{value:"Worker"},"Worker")))),V.createElement("div",{className:"clearfix"},V.createElement("div",{className:"ant-col ant-form-item-control-wrapper ant-col-xs-24 ant-col-sm-18 ant-col-offset-3"},V.createElement("p",{style:{fontSize:12,color:"#333",marginBottom:8}},"复制下面命令到命令行执行："),V.createElement(X.Z.TextArea,{id:"J_CMDCode",rows:7,value:this.state.cmdContent}),V.createElement(ie.Z,{className:"mt-10 mb-20",onClick:this.handleCopy},"复制代码"),V.createElement(ie.Z,{style:{visibility:"hidden"},id:"J_CopyBtn","data-clipboard-action":"cut","data-clipboard-target":"#J_CMDCode"}))),V.createElement("div",{style:{textAlign:"right",marginTop:"28px"}},V.createElement(ie.Z,{className:"mr-8",type:"default",onClick:this.props.onCancel},"取消"),V.createElement(ie.Z,{type:"primary",onClick:this.props.onCancel},"确定")))}}]),n}(V.Component);function Ge(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,b.Z)(e);if(t){var o=(0,b.Z)(this).constructor;n=a()(r,arguments,o)}else n=r.apply(this,arguments);return(0,w.Z)(this,n)}}var He=te.Z.Item,Re=fe.ZP.Group;const Me=function(e){(0,C.Z)(n,e);var t=Ge(n);function n(){var e,r;(0,y.Z)(this,n);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return r=t.call.apply(t,M()(e=[this]).call(e,o)),(0,S.Z)((0,E.Z)(r),"state",{radioType:"account"}),(0,S.Z)((0,E.Z)(r),"handleRadioChange",(function(e){r.setState({radioType:e.target.value})})),r}return(0,g.Z)(n,[{key:"render",value:function(){var e=this.state.radioType,t=this.props,n={afterInstall:t.afterInstall,refresh:t.refresh,clusterInfo:t.clusterInfo,onCancel:t.onCancel};return V.createElement("div",{className:"create-host-container"},V.createElement(te.Z,null,V.createElement(He,(0,Z.Z)({label:"接入方式"},Ce),V.createElement(Re,{value:e,onChange:this.handleRadioChange},V.createElement(fe.ZP,{value:"account"},"账号接入"),V.createElement(fe.ZP,{value:"shell"},"命令行接入")))),"account"===e?V.createElement(Ne,n):V.createElement(_e,n))}}]),n}(V.Component);var Le=n(88081);function Oe(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,b.Z)(e);if(t){var o=(0,b.Z)(this).constructor;n=a()(r,arguments,o)}else n=r.apply(this,arguments);return(0,w.Z)(this,n)}}const Be=function(e){(0,C.Z)(n,e);var t=Oe(n);function n(){var e,r;(0,y.Z)(this,n);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return r=t.call.apply(t,M()(e=[this]).call(e,o)),(0,S.Z)((0,E.Z)(r),"state",{value:r.props.value,editable:!1}),(0,S.Z)((0,E.Z)(r),"handleChange",(function(e){var t=e.target.value;r.setState({value:t})})),(0,S.Z)((0,E.Z)(r),"successClose",(function(){return function(){r.setState({editable:!1})}})),(0,S.Z)((0,E.Z)(r),"check",(function(){var e;r.props.onChange&&(""===(e=r.state.value)?(ae.Z.error("分组名称不可为空！"),0):e.length>20?(ae.Z.error("分组名称不得超过20字符"),0):/^[a-zA-Z0-9_@*#/]+$/.test(e)||(ae.Z.error("分组名称输入有误，请重新输入！"),0))&&r.props.onChange(r.state.value,r.successClose())})),(0,S.Z)((0,E.Z)(r),"close",(function(){r.setState({editable:!1,value:r.props.value})})),(0,S.Z)((0,E.Z)(r),"edit",(function(){r.setState({editable:!0})})),r}return(0,g.Z)(n,[{key:"render",value:function(){var e=this.state,t=e.value,n=e.editable;return V.createElement("div",{className:"editable-cell"},n?V.createElement("div",{className:"editable-cell-input-wrapper"},V.createElement(X.Z,{value:t,style:{width:"350px",fontSize:"12px"},placeholder:"只支持字母、数字及_ / @ * #特殊字符，不超过20个字符",onChange:this.handleChange,onPressEnter:this.check}),V.createElement(re.Z,{type:"check",className:"editable-cell-icon-check",onClick:this.check}),V.createElement(re.Z,{type:"close",className:"editable-cell-icon-close",onClick:this.close})):this.props.isShowEditIcon?V.createElement("div",{className:"editable-cell-text-wrapper"},t||" ",V.createElement(re.Z,{type:"edit",className:"editable-cell-icon",onClick:this.edit})):null)}}]),n}(V.Component);var qe,Te=n(42238),Fe=n(37092);function Ae(e,t){var n=O()(e);if(l()){var r=l()(e);t&&(r=c()(r).call(r,(function(t){return u()(e,t).enumerable}))),n.push.apply(n,r)}return n}function We(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?D()(n=Ae(Object(a),!0)).call(n,(function(t){(0,S.Z)(e,t,a[t])})):p()?f()(e,p()(a)):D()(r=Ae(Object(a))).call(r,(function(t){v()(e,t,u()(a,t))}))}return e}function Ve(e){var t=function(){if("undefined"==typeof Reflect||!a())return!1;if(a().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(a()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,b.Z)(e);if(t){var o=(0,b.Z)(this).constructor;n=a()(r,arguments,o)}else n=r.apply(this,arguments);return(0,w.Z)(this,n)}}var je=Q.Z.Option,Ue=X.Z.Search,$e=ee.Z.Panel,ze=te.Z.Item,Je=(0,U.$j)((function(e){return{filterSelectedItem:e.HostStore.filterSelectedItem,filterData:e.HostStore.filterData,selectRows:e.HostStore.selectRows,searchValue:e.HostStore.searchValue,clusterHostList:e.HostStore.clusterHostList,pager:e.HostStore.pager,clusterHostGroupList:e.HostStore.clusterHostGroupList}}),(function(e){return{actions:(0,j.DE)(k()({},z),e)}}))(qe=function(e){(0,C.Z)(n,e);var t=Ve(n);function n(e){var r;return(0,y.Z)(this,n),r=t.call(this,e),(0,S.Z)((0,E.Z)(r),"state",{addedHost:null,queryParams:{"sort-by":"id","sort-dir":"desc",q_host:"",hostGroupName:"",limit:10,start:0,currentPage:1,is_running:[],status:[],roles:""},aHostDetail:{status:"",status_msg:""},showModal:!1,rootLink:["/deploycenter/cluster/list","/deploycenter/appmanage/products","/installguide","/deploycenter/appmanage/installs"],activeKey:"",selectedRowKeys:[],selectedRows:[],hostMoveModal:!1,isNewGroup:!1,tableLoading:!1,clusterHostList:[],visibleInfo:{visible:!1,title:"日志查看",type:"log",execId:""},total:0}),(0,S.Z)((0,E.Z)(r),"timer",null),(0,S.Z)((0,E.Z)(r),"progressProp",(function(e){var t=r.props.clusterInfo,n=void 0===t?{}:t;switch(e){case 0:return{percent:0,title:"等待安装",color:"host-status-wait-install"};case-1:return{percent:30,status:"exception",title:"管控安装失败",color:"red-dot dot"};case 1:return{percent:30,status:"active",title:"管控安装成功",color:"green-dot dot"};case-2:return{percent:"hosts"===n.type?60:40,status:"exception",title:"script安装失败",color:"red-dot dot"};case 2:return{percent:"hosts"===n.type?60:40,status:"active",title:"script安装成功",color:"green-dot dot"};case-3:return{percent:"hosts"===n.type?100:50,status:"exception",title:"主机初始化失败",color:"red-dot dot"};case 3:return{percent:"hosts"===n.type?100:50,status:"hosts"===n.type?"success":"active",title:"主机初始化成功",color:"green-dot dot"};case-4:return{percent:50,status:"exception",title:"主机下线",color:"red-dot dot"};case-5:return{percent:60,status:"exception",title:"K8S DOCKER初始化失败",color:"red-dot dot"};case 5:return{percent:60,status:"active",title:"K8S DOCKER初始化成功",color:"green-dot dot"};case-6:return{percent:80,status:"exception",title:"K8S NODE初始化失败",color:"red-dot dot"};case 6:return{percent:80,status:"active",title:"K8S NODE初始化成功",color:"green-dot dot"};case-7:return{percent:100,status:"exception",title:"K8S NODE部署失败",color:"red-dot dot"};case 7:return{percent:100,status:"success",title:"K8S NODE部署成功",color:"green-dot dot"};default:return{percent:100,status:"exception"}}})),(0,S.Z)((0,E.Z)(r),"handleSearchByHost",(function(e){var t=r.state.queryParams;r.setState({selectedRowKeys:[],queryParams:k()(t,{q_host:e,start:0,currentPage:1})},(function(){r.getHostGroups(),r.loadData()}))})),(0,S.Z)((0,E.Z)(r),"loadData",(function(){var e=r.props.clusterInfo,t=r.state.queryParams;r.setState({tableLoading:!0});var n=null!=t&&t.is_running.length?null==t?void 0:t.is_running.join(","):"",a=null!=t&&t.status.length?null==t?void 0:t.status.join(","):"";r.props.actions.getClusterHostList({"sort-by":t["sort-by"],"sort-dir":t["sort-dir"],limit:t.limit,start:t.start,host_or_ip:t.q_host,is_running:n,status:a,group:t.hostGroupName,cluster_id:null==e?void 0:e.id,cluster_type:null==e?void 0:e.type,role:"hosts"===(null==e?void 0:e.type)?void 0:t.roles},(function(e){var t=e.hosts,n=e.count;r.setState({clusterHostList:t,total:n,tableLoading:!1},(function(){clearTimeout(r.timer),r.timer=N()((function(){r.loadData(),r.getHostGroups()}),3e3)}))}))})),(0,S.Z)((0,E.Z)(r),"getHostGroups",(function(){var e=r.props.clusterInfo,t=void 0===e?{}:e;r.props.actions.getClusterhostGroupLists({type:t.type,id:t.id})})),(0,S.Z)((0,E.Z)(r),"goToAdd",(function(){r.setState({showModal:!0})})),(0,S.Z)((0,E.Z)(r),"afterHostInstall",(function(){r.setState({showModal:!1}),r.loadData()})),(0,S.Z)((0,E.Z)(r),"hostDelete",(function(){var e=r.state.selectedRows,t=[];D()(e).call(e,(function(e){e.is_running||t.push(e.id)}));var n={aid:t};t.length>0?ne.Z.confirm({title:"只可下架agent已停止的主机，确定下架这些主机吗？",content:"主机下架将会将主机上的数据库信息、服务信息清除掉，请谨慎操作！",icon:V.createElement(re.Z,{type:"exclamation-circle",theme:"filled"}),okText:"确定",cancelText:"取消",onCancel:function(){},onOk:function(){$.$b.deleteHost(n).then((function(e){var t=e.data;0===t.code?(ae.Z.success("下架成功！"),r.getHostGroups(),r.loadData()):ae.Z.error(t.msg)}))}}):ne.Z.confirm({title:"当前无agent停止的主机，不支持下架",icon:V.createElement(re.Z,{type:"exclamation-circle",theme:"filled"}),okText:"确定"})})),(0,S.Z)((0,E.Z)(r),"handleEvent",(function(e){var t=r.state.visibleInfo;r.setState({visibleInfo:We(We({},t),{},{visible:!t.visible,execId:e?e.exec_id:""})})})),(0,S.Z)((0,E.Z)(r),"initColumns",(function(){var e,t=r.props.clusterInfo,n=r.state.queryParams,a=me.RI[t.type],o=[{title:"主机IP",dataIndex:"ip",key:"ip",sorter:!0,width:150,fixed:"left"},{title:"主机名称",dataIndex:"hostname",key:"hostname",render:function(e,t){return V.createElement(oe.Z,{content:V.createElement("span",null,"sid:",t.sid)},e)}},{title:"最近心跳时间",dataIndex:"updated",key:"updated",sorter:!0},{title:"主机创建时间",dataIndex:"created",key:"created",sorter:!0},{title:"启动用户",dataIndex:"run_user",key:"run_user",render:function(e){return V.createElement(le.Z,{placement:"right",title:e},e&&e.length>12?_()(e).call(e,0,13)+"...":e)}},{title:"agent状态",dataIndex:"is_running",key:"is_running",width:150,filters:[{text:"运行中",value:"true"},{text:"已停止",value:"false"}],filteredValue:null==n?void 0:n.is_running,filterMultiple:!0,render:function(e){var t=e?"green-dot dot":"red-dot dot";return V.createElement("span",{className:"status-box"},V.createElement("span",{className:t}),V.createElement("span",null,e?"运行中":"已停止"))}},{title:V.createElement("span",null,"初始化状态"," ",V.createElement(le.Z,{title:a.title},V.createElement(re.Z,{type:"info-circle"}))),dataIndex:"errorMsg",key:"errorMsg",filters:a.filters,filteredValue:null==n?void 0:n.status,filterMultiple:!0,render:function(e,t){var n,o=a.finalStatus;return V.createElement("span",null,H()(n=[-3,-2,-1,-4,-5,-6,-7,o]).call(n,t.status)&&V.createElement("span",{className:"status-box"},V.createElement("span",{className:r.progressProp(t.status).color}),V.createElement("span",null,r.progressProp(t.status).title),t.status!==o&&V.createElement(le.Z,{title:t.errorMsg}," ",V.createElement(re.Z,{type:"info-circle"})))||V.createElement(se.Z,(0,Z.Z)({className:"status-progress",style:{width:"80%"},format:function(e){var n;return M()(n="".concat(e,"% ")).call(n,t.errorMsg)}},r.progressProp(t.status))))}},{title:"查看",render:function(e,t){return V.createElement("a",{onClick:function(e){return r.handleEvent(t)}},"日志")}}],l=[{title:"主机角色",dataIndex:"roles",width:250,filters:[{text:"Etcd",value:"Etcd"},{text:"Control",value:"Control"},{text:"Worker",value:"Worker"},{text:"全部",value:"all"}],render:function(e,t){var n=O()(t.roles||{});return q()(n).call(n,(function(e){return t.roles[e]&&V.createElement(ce.Z,{className:"c-cluster__tag",key:e},e)}))}}];return"hosts"===t.type?o:M()(e=[]).call(e,o,l)})),(0,S.Z)((0,E.Z)(r),"onCellChange",(function(e){return function(t,n){var a,o=F()(a=r.props.clusterHostGroupList).call(a,(function(t){return t===e}));$.$b.updateGroupName({old:o,new:t}).then((function(e){0===e.data.code?(ae.Z.success("分组名称修改成功"),n(),r.setState({queryParams:k()(r.state.queryParams,{hostGroupName:t}),activeKey:t},(function(){r.getHostGroups(),r.loadData()}))):ae.Z.error(e.data.msg)}))}})),(0,S.Z)((0,E.Z)(r),"tableFooter",(function(e){return V.createElement("div",null,V.createElement(ie.Z,{className:"mr-10",onClick:r.clickMoveHost,icon:"swap"},"移动到"),V.createElement(ie.Z,{type:"danger",className:"btn_dele",onClick:r.hostDelete,icon:"delete"},"下架"))})),(0,S.Z)((0,E.Z)(r),"clickMoveHost",(function(){r.setState({hostMoveModal:!0})})),(0,S.Z)((0,E.Z)(r),"checkGroupName",(function(e){return""===e?(ae.Z.error("分组名称不可为空！"),!1):e.length>20?(ae.Z.error("分组名称不得超过20字符"),!1):!!/^[a-zA-Z0-9_@*#/]+$/.test(e)||(ae.Z.error("分组名称输入有误，请重新输入！"),!1)})),(0,S.Z)((0,E.Z)(r),"confirmMove",(function(){var e=r.state,t=e.selectedRowKeys,n=e.queryParams,a=r.props.form.getFieldValue("name");r.props.form.validateFields((function(e){!e&&r.checkGroupName(a)&&$.$b.confirmMoveHost({aid:t,to_group:a}).then((function(e){0===e.data.code?(ae.Z.success("移动分组成功"),r.props.form.resetFields(),r.setState({hostMoveModal:!1,isNewGroup:!1,activeKey:a,selectedRowKeys:[],queryParams:k()(n,{hostGroupName:a})},(function(){r.getHostGroups(),r.loadData()}))):ae.Z.error(e.data.msg)}))}))})),(0,S.Z)((0,E.Z)(r),"refresh",(function(e){r.setState({queryParams:k()(r.state.queryParams,{hostGroupName:e}),activeKey:e},(function(){r.loadData()}))})),(0,S.Z)((0,E.Z)(r),"handleClickPanel",(function(e){var t=r.state.queryParams;r.setState({selectedRowKeys:[],queryParams:k()(t,{"sort-by":"id","sort-dir":"desc",q_host:"",hostGroupName:e,limit:10,start:0,currentPage:1,is_running:"",status:"",roles:""}),activeKey:e},(function(){r.loadData()}))})),(0,S.Z)((0,E.Z)(r),"onSelectChange",(function(e,t){r.setState({selectedRowKeys:e,selectedRows:t})})),(0,S.Z)((0,E.Z)(r),"onTableChange",(function(e,t,n){var a=r.props.clusterInfo,o=k()(r.state.queryParams,{start:10*(e.current-1),currentPage:e.current});if(n){var l=n.field,s=n.order;switch(l){case"ip":o["sort-by"]="ip",o["sort-dir"]="descend"===s?"desc":"asc";break;case"updated":o["sort-by"]="updated",o["sort-dir"]="descend"===s?"desc":"asc";break;case"created":o["sort-by"]="created",o["sort-dir"]="descend"===s?"desc":"asc"}}O()(t).length&&(o.is_running=t.is_running||[],o.status=t.errorMsg||[],o.roles="hosts"===a.type?void 0:(t.roles||[]).join(",")),r.setState({queryParams:o,selectedRowKeys:[]},(function(){r.loadData()}))})),(0,S.Z)((0,E.Z)(r),"handleChangeGroup",(function(e){var t=r.props.form.setFieldsValue;"NEWGROUP"===e&&r.setState({isNewGroup:!0},(function(){t({name:""})}))})),r}return(0,g.Z)(n,[{key:"componentDidMount",value:function(){this.loadData(),this.getHostGroups()}},{key:"componentDidUpdate",value:function(){var e=this,t=this.props.clusterHostGroupList;if(""===this.state.activeKey&&W()(t)&&t.length){var n=this.props.clusterHostGroupList[0]||"";this.setState({activeKey:n,queryParams:k()(this.state.queryParams,{hostGroupName:n})},(function(){e.loadData(),e.getHostGroups()}))}}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer)}},{key:"render",value:function(){var e,t=this,n=this.props,r=n.clusterHostGroupList,a=n.clusterInfo,o=this.state,l=o.selectedRowKeys,s=o.queryParams,c=o.isNewGroup,i=o.clusterHostList,u=o.visibleInfo,d=this.props.form.getFieldDecorator,p=l.length>0,m={selectedRowKeys:l,onChange:this.onSelectChange},f={size:"small",current:s.currentPage,pageSize:10,total:this.state.total};return V.createElement("div",{className:"host-page"},V.createElement("div",{className:"host-option"},V.createElement(Ue,{placeholder:"按主机ip或名称搜索",style:{width:264},onSearch:this.handleSearchByHost}),V.createElement(ie.Z,{type:"primary",style:{float:"right"},onClick:this.goToAdd},"添加主机")),p?V.createElement(ue.Z,{type:"info",showIcon:!0,message:"已选择".concat(l.length,"项")}):null,W()(r)&&r.length?V.createElement(V.Fragment,null,V.createElement(ee.Z,{className:"host-collapse",activeKey:this.state.activeKey,accordion:!0,onChange:this.handleClickPanel,style:{borderRadius:"0",marginTop:"8px"}},q()(r).call(r,(function(e){return V.createElement($e,{style:{borderRadius:"0"},header:V.createElement("div",{onClick:function(e){e.stopPropagation()},className:"panel-table"},V.createElement(de.Z,{rowKey:function(e,t){return t+""},showHeader:!1,className:"select-table",bordered:!1,pagination:!1,dataSource:[{name:e}],columns:[{title:"name",dataIndex:"name",render:function(e,n){return V.createElement(Be,{isShowEditIcon:!0,value:e,onChange:t.onCellChange(e)})}}]})),key:"".concat(e)},V.createElement(de.Z,{rowKey:"id",size:"middle",className:Y()("dt-pagination-lower",{"has-footer":p}),columns:t.initColumns(),dataSource:i,rowSelection:m,onChange:t.onTableChange,pagination:f,footer:p?t.tableFooter:null,loading:t.state.tableLoading}))}))),"kubernetes"===a.type&&V.createElement(Le.Z,{wsUrl:M()(e="ws://".concat(window.location.host,"/api/v2/cluster/kubernetes/")).call(e,a.id,"/installLog")})):V.createElement(pe.Z,{style:{marginTop:"10%"}}),V.createElement(ne.Z,{destroyOnClose:!0,visible:this.state.showModal,title:"添加主机",onCancel:function(){t.setState({showModal:!1})},footer:null},V.createElement(Me,{afterInstall:this.afterHostInstall,refresh:this.refresh,clusterInfo:a,onCancel:function(){t.setState({showModal:!1})}})),V.createElement(ne.Z,{visible:this.state.hostMoveModal,width:"650px",title:"移动主机至",onCancel:function(){t.props.form.resetFields(),t.setState({hostMoveModal:!1,isNewGroup:!1})},onOk:this.confirmMove},V.createElement(te.Z,null,V.createElement(ze,(0,Z.Z)({},Te.v,{label:"主机分组"}),d("name",{rules:[{required:!0,message:"请选择或输入主机分组"}]})(c?V.createElement(X.Z,{placeholder:"请输入新建分组名称",style:{minWidth:200}}):V.createElement(Q.Z,{placeholder:"请选择主机分组",style:{minWidth:200},onChange:this.handleChangeGroup},V.createElement(je,{value:"NEWGROUP"},"新建分组"),r&&q()(r).call(r,(function(e){return V.createElement(je,{value:e,key:e},e)}))))))),u.visible&&V.createElement(Fe.Z,(0,Z.Z)({},u,{onColse:this.handleEvent})))}}]),n}(V.Component))||qe;const Ye=te.Z.create()(Je)},60558:(e,t,n)=>{n.d(t,{ON:()=>s,g8:()=>l});var r=n(49754),a=n(35558),o=n(98130);function l(e,t){if(!t)return e;var n=new r.Z;return n.setPublicKey(t),(0,a.GV)(n.encrypt(e)||"")}function s(e,t){return"04"+o.sg.encrypt(e,t,{inputEncoding:"utf8",outputEncoding:"hex"})}}}]);