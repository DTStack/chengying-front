"use strict";(self.webpackChunkdt_em_front=self.webpackChunkdt_em_front||[]).push([[7999],{33529:(e,t,n)=>{n.d(t,{Z:()=>_});var a=n(1068),r=n.n(a),l=n(73126),s=n(68420),o=n(27344),i=n(5281),c=n(84441),u=n(3020),m=n(3362),d=n(44845),f=n(77766),p=n.n(f),Z=n(2991),h=n.n(Z),v=n(67294),y=n(69035),b=n(66253),E=n(4107),g=n(20666),w=n(36808);function C(e){var t=function(){if("undefined"==typeof Reflect||!r())return!1;if(r().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(r()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,m.Z)(e);if(t){var l=(0,m.Z)(this).constructor;n=r()(a,arguments,l)}else n=a.apply(this,arguments);return(0,u.Z)(this,n)}}var P=y.Z.Item,S=b.ZP.Group,I={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:14}}},k=function(e){(0,c.Z)(n,e);var t=C(n);function n(){var e,a;(0,s.Z)(this,n);for(var r=arguments.length,l=new Array(r),o=0;o<r;o++)l[o]=arguments[o];return a=t.call.apply(t,p()(e=[this]).call(e,l)),(0,d.Z)((0,i.Z)(a),"state",{targetKeys:[]}),(0,d.Z)((0,i.Z)(a),"renderItem",(function(e){return{label:v.createElement("span",{className:"custom-item",key:e.id},e.name),value:e.name}})),(0,d.Z)((0,i.Z)(a),"handleChange",(function(e,t,n){a.setState({targetKeys:e})})),a}return(0,o.Z)(n,[{key:"componentDidMount",value:function(){var e=this.props.memberInfo;if(null!=e&&e.cluster_list){var t,n=null==e?void 0:h()(t=e.cluster_list).call(t,(function(e){return e.cluster_id}));this.setState({targetKeys:n})}}},{key:"render",value:function(){var e=this.props,t=e.form,n=e.memberInfo,a=e.canEdit,r=e.clusterList,s=this.state.targetKeys,o=t.getFieldDecorator,i=this.props.formLayout||I;return v.createElement(y.Z,null,v.createElement(P,(0,l.Z)({label:"账号"},i),o("username",{initialValue:n?n.username:"",rules:[{required:!0,message:"账号信息不可为空"},{pattern:/^\S{1,32}$/,message:"请输入除空格外的其他字符，并不超过32个字符"}]})(v.createElement(E.Z,{placeholder:"请输入账号，允许中英文",disabled:!!n}))),v.createElement(P,(0,l.Z)({label:"姓名"},i),o("fullName",{initialValue:n?n.full_name:"",rules:[{pattern:/^\S{1,32}$/,message:"请输入除空格外的其他字符，并不超过32个字符"}]})(v.createElement(E.Z,{placeholder:"请输入姓名，允许中英文",disabled:void 0!==a&&!a}))),v.createElement(P,(0,l.Z)({label:"邮箱"},i),o("email",{initialValue:n?n.email:"",rules:[{required:!0,message:"邮箱信息不可为空"},{pattern:/^[a-zA-Z0-9._-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/,message:"请输入正确的邮箱格式"},{max:32,message:"长度不超过32字符"}]})(v.createElement(E.Z,{placeholder:"请输入邮箱",disabled:void 0!==a&&!a}))),v.createElement(P,(0,l.Z)({label:"手机号"},i),o("phone",{initialValue:n?n.phone:"",rules:[{pattern:/^0?1[35784][0-9][0-9]{8}$/,message:"请输入正确的手机号格式"}]})(v.createElement(E.Z,{placeholder:"请输入手机号",disabled:void 0!==a&&!a}))),v.createElement(P,(0,l.Z)({label:"公司名称"},i),o("company",{initialValue:n?n.company:"",rules:[{pattern:/^\S{1,128}$/,message:"请输入除空格外的其他字符，并不超过128个字符"}]})(v.createElement(E.Z,{placeholder:"请输入公司名称",disabled:void 0!==a&&!a}))),v.createElement(P,(0,l.Z)({label:"用户角色"},i),o("roleId",{initialValue:n?n.role_id:2,rules:[{required:!0,message:"请选择用户角色"}]})(v.createElement(S,{disabled:void 0!==a},void 0!==a&&v.createElement(b.ZP,{value:1},"Administrator"),v.createElement(b.ZP,{value:2},"Cluster Operator"),v.createElement(b.ZP,{value:3},"Cluster Reader")))),"/usercenter/selfinfo"!==window.location.pathname&&"true"===w.get("em_admin")&&v.createElement(P,(0,l.Z)({label:"集群权限"},i),"用户自主添加的集群默认具备该集群操作权限",o("clusterList",{initialValue:n?s:[]})(v.createElement(g.Z,{rowKey:function(e){return e.id},titles:["未选","已选"],dataSource:r,showSearch:!0,targetKeys:this.state.targetKeys,onChange:this.handleChange,render:this.renderItem}))),v.createElement(P,null,o("userId",{initialValue:n?n.id:void 0})(v.createElement(E.Z,{style:{display:"none"}}))))}}]),n}(v.PureComponent);const _=y.Z.create()(k)},46103:(e,t,n)=>{n.d(t,{Z:()=>S});var a=n(1068),r=n.n(a),l=n(73126),s=n(68420),o=n(27344),i=n(5281),c=n(84441),u=n(3020),m=n(3362),d=n(44845),f=n(77766),p=n.n(f),Z=n(67294),h=n(69035),v=n(45360),y=n(30258),b=n(37870),E=n(4107);function g(e){var t=function(){if("undefined"==typeof Reflect||!r())return!1;if(r().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(r()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,m.Z)(e);if(t){var l=(0,m.Z)(this).constructor;n=r()(a,arguments,l)}else n=a.apply(this,arguments);return(0,u.Z)(this,n)}}var w=h.Z.Item,C={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}}},P=function(e){(0,c.Z)(n,e);var t=g(n);function n(){var e,a;(0,s.Z)(this,n);for(var r=arguments.length,l=new Array(r),o=0;o<r;o++)l[o]=arguments[o];return a=t.call.apply(t,p()(e=[this]).call(e,l)),(0,d.Z)((0,i.Z)(a),"validPass",(function(e,t,n){var r=a.props.form;t&&t===r.getFieldValue("oldPass")?n("新密码不能与旧密码一致"):t&&!/^(?![A-z0-9]+$)(?![A-z~!@#$%^&*]+$)(?![0-9~!@#$%^&*]+$)([0-9A-Za-z~!@#$%^&*]{8,20})$/.test(t)&&n("密码须包含数字、字母和特殊字符(支持~!@#$%^&*)，不低于8位"),n()})),(0,d.Z)((0,i.Z)(a),"handleResetSubmit",(function(){a.props.form.validateFields((function(e,t){e||(t.newPass===t.ensurePass?a.props.onSubmit(t):v.Z.error("两次密码填写不一致"))}))})),(0,d.Z)((0,i.Z)(a),"handleCancel",(function(){a.props.onCancel()})),a}return(0,o.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.form,n=e.userInfo,a=e.visible,r=e.isCheckedResetPwd,s=t.getFieldDecorator;return Z.createElement(y.Z,{className:"reset-password",maskClosable:!1,destroyOnClose:!0,visible:a,title:"重置密码",onOk:this.handleResetSubmit,onCancel:this.handleCancel},r&&Z.createElement(b.Z,{type:"warning",showIcon:!0,message:"管理员开启了初始密码修改，您需要重置初始密码，否则将退出登录影响平台功能使用。"}),Z.createElement(h.Z,null,null!=n&&n.username?Z.createElement(w,(0,l.Z)({},C,{label:"账号"}),n.username||""):Z.createElement(w,(0,l.Z)({},C,{label:"旧密码"}),s("oldPass",{rules:[{required:!0,message:"新密码不能为空"}]})(Z.createElement(E.Z.Password,{placeholder:"请输入旧密码"}))),Z.createElement(w,(0,l.Z)({},C,{label:"新密码"}),s("newPass",{rules:[{required:!0,message:"新密码不能为空"},{validator:this.validPass}]})(Z.createElement(E.Z.Password,{placeholder:"请输入新密码"}))),Z.createElement(w,(0,l.Z)({},C,{label:"确认新密码"}),s("ensurePass",{rules:[{required:!0,message:"确认新密码不能为空"},{validator:this.validPass}]})(Z.createElement(E.Z.Password,{placeholder:"请再次输入新密码"})))))}}]),n}(Z.PureComponent);const S=h.Z.create()(P)},57999:(e,t,n)=>{n.r(t),n.d(t,{default:()=>j});var a=n(1068),r=n.n(a),l=n(86902),s=n.n(l),o=n(14310),i=n.n(o),c=n(20116),u=n.n(c),m=n(34074),d=n.n(m),f=n(78914),p=n.n(f),Z=n(39649),h=n.n(Z),v=n(20368),y=n.n(v),b=n(63978),E=n.n(b),g=n(44930),w=n(68420),C=n(27344),P=n(5281),S=n(84441),I=n(3020),k=n(3362),_=n(44845),x=n(63109),$=n.n(x),R=n(77766),A=n.n(R),F=n(67294),M=n(45360),N=n(71230),O=n(15746),V=n(77268),K=n(19528),q=n(33529),z=n(46103),B=n(60558);function U(e,t){var n=s()(e);if(i()){var a=i()(e);t&&(a=u()(a).call(a,(function(t){return d()(e,t).enumerable}))),n.push.apply(n,a)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n,a,r=null!=arguments[t]?arguments[t]:{};t%2?p()(n=U(Object(r),!0)).call(n,(function(t){(0,_.Z)(e,t,r[t])})):h()?y()(e,h()(r)):p()(a=U(Object(r))).call(a,(function(t){E()(e,t,d()(r,t))}))}return e}function D(e){var t=function(){if("undefined"==typeof Reflect||!r())return!1;if(r().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(r()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,k.Z)(e);if(t){var l=(0,k.Z)(this).constructor;n=r()(a,arguments,l)}else n=a.apply(this,arguments);return(0,I.Z)(this,n)}}var j=function(e){(0,S.Z)(n,e);var t=D(n);function n(){var e,a;(0,w.Z)(this,n);for(var r=arguments.length,l=new Array(r),s=0;s<r;s++)l[s]=arguments[s];return a=t.call.apply(t,A()(e=[this]).call(e,l)),(0,_.Z)((0,P.Z)(a),"state",{selfInfo:{},canEdit:!1,showModal:!1}),(0,_.Z)((0,P.Z)(a),"memberInfoForm",F.createRef()),(0,_.Z)((0,P.Z)(a),"getUserInfo",(function(){K.bS.getLoginedUserInfo().then((function(e){0===(e=e.data).code?a.setState({selfInfo:e.data.info}):M.Z.error(e.msg)}))})),(0,_.Z)((0,P.Z)(a),"handleResetSubmit",function(){var e=(0,g.Z)($().mark((function e(t){var n,r,l,s,o;return $().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.bS.getPublicKey();case 2:if(0===(n=e.sent).data.code){e.next=5;break}return e.abrupt("return");case 5:r=n.data.data,l=r.encrypt_type,s=r.encrypt_public_key,o={old_password:"sm2"===l?(0,B.ON)(t.oldPass,s):(0,B.g8)(t.oldPass,s),new_password:"sm2"===l?(0,B.ON)(t.newPass,s):(0,B.g8)(t.newPass,s)},K.bS.resetPasswordSelf(o).then((function(e){0===(e=e.data).code?(M.Z.success("修改成功"),a.setState({showModal:!1},a.getUserInfo)):M.Z.error(e.msg)}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,_.Z)((0,P.Z)(a),"resetPwdModalShow",(function(){a.setState({showModal:!a.state.showModal})})),(0,_.Z)((0,P.Z)(a),"handleEditClick",(function(){a.state.canEdit?a.memberInfoForm.props.form.validateFields(["email","fullName","phone","company"],(function(e,t){if(!e){var n=L({},t);K.bS.motifyUserInfo(n).then((function(e){0===(e=e.data).code?(M.Z.success("修改成功"),a.setState({canEdit:!1}),a.getUserInfo()):M.Z.error(e.msg)}))}})):a.setState({canEdit:!0})})),(0,_.Z)((0,P.Z)(a),"handleEditCancelClick",(function(){var e=a.state.selfInfo;a.memberInfoForm.props.form.setFieldsValue({email:e.email,phone:e.phone,fullName:e.full_name,company:e.company}),a.setState({canEdit:!1})})),a}return(0,C.Z)(n,[{key:"componentDidMount",value:function(){this.getUserInfo()}},{key:"render",value:function(){var e=this,t=this.state,n=t.selfInfo,a=t.canEdit;return F.createElement("div",{className:"selfinfo-container box-shadow-style"},F.createElement(q.Z,{memberInfo:n,canEdit:a,wrappedComponentRef:function(t){return e.memberInfoForm=t},formLayout:{labelCol:{xs:{span:24},sm:{span:9}},wrapperCol:{xs:{span:24},sm:{span:10}}}}),F.createElement(N.Z,null,F.createElement(O.Z,{span:9}),F.createElement(O.Z,{span:15},a&&F.createElement(V.Z,{className:"mr-20",onClick:this.handleEditCancelClick},"取消"),F.createElement(V.Z,{className:"mr-20",onClick:this.handleEditClick},a?"保存":"编辑资料"),F.createElement(V.Z,{type:"primary",onClick:this.resetPwdModalShow},"重置密码"))),F.createElement(z.Z,{visible:this.state.showModal,onCancel:this.resetPwdModalShow,onSubmit:this.handleResetSubmit}))}}]),n}(F.Component)}}]);