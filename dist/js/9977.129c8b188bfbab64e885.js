"use strict";(self.webpackChunkdt_em_front=self.webpackChunkdt_em_front||[]).push([[9977],{79977:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ae});var n=a(1068),r=a.n(n),o=a(86902),i=a.n(o),l=a(14310),u=a.n(l),c=a(20116),s=a.n(c),d=a(34074),h=a.n(d),f=a(78914),m=a.n(f),p=a(39649),v=a.n(p),g=a(20368),y=a.n(g),Z=a(63978),C=a.n(Z),P=a(68420),S=a(27344),k=a(5281),E=a(84441),b=a(3020),w=a(3362),x=a(44845),L=a(77766),A=a.n(L),O=a(94473),q=a.n(O),T=a(51942),N=a.n(T),F=a(41511),I=a.n(F),M=a(2991),_=a.n(M),V=a(67294),B=a(39903),K=a(34041),R=a(45360),j=a(4107),U=a(19528),z=a(8263),D=a(96486);function G(e,t){var a=i()(e);if(u()){var n=u()(e);t&&(n=s()(n).call(n,(function(t){return h()(e,t).enumerable}))),a.push.apply(a,n)}return a}function H(e){for(var t=1;t<arguments.length;t++){var a,n,r=null!=arguments[t]?arguments[t]:{};t%2?m()(a=G(Object(r),!0)).call(a,(function(t){(0,x.Z)(e,t,r[t])})):v()?y()(e,v()(r)):m()(n=G(Object(r))).call(n,(function(t){C()(e,t,h()(r,t))}))}return e}function J(e){var t=function(){if("undefined"==typeof Reflect||!r())return!1;if(r().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(r()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,w.Z)(e);if(t){var o=(0,w.Z)(this).constructor;a=r()(n,arguments,o)}else a=n.apply(this,arguments);return(0,b.Z)(this,a)}}var Q=function(e){(0,E.Z)(a,e);var t=J(a);function a(){var e,n;(0,P.Z)(this,a);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return n=t.call.apply(t,A()(e=[this]).call(e,o)),(0,x.Z)((0,k.Z)(n),"state",{pageParams:{start:0,limit:10,"sort-by":"create_time","sort-dir":"desc"},auditList:{list:[],count:0},loading:!1}),(0,x.Z)((0,k.Z)(n),"getAuditList",(function(){var e=n.state.pageParams,t=n.props.reqParams;n.setState({loading:!0}),U.Uv.getSafetyAudit(H(H({},t),e)).then((function(e){0===(e=e.data).code?n.setState({auditList:{count:e.data?e.data.count:0,list:e.data?e.data.list:[]}}):R.Z.error(e.msg),n.setState({loading:!1})}))})),(0,x.Z)((0,k.Z)(n),"handleTableChange",(function(e){var t=H(H({},n.state.pageParams),{},{start:(e.current-1)*e.pageSize});n.setState({pageParams:t},n.getAuditList)})),(0,x.Z)((0,k.Z)(n),"initColumns",(function(){return[{title:"时间",dataIndex:"create_time",key:"create_time",render:function(e){return e||"--"}},{title:"操作人",dataIndex:"operator",key:"operator",render:function(e){return e||"--"}},{title:"操作模块",dataIndex:"module",key:"module"},{title:"动作",dataIndex:"operation",key:"operation"},{title:"详细内容",dataIndex:"content",key:"content",width:"25%",render:function(e){return e||"--"}},{title:"来源IP",dataIndex:"ip",key:"ip",render:function(e){return e||"--"}}]})),n}return(0,S.Z)(a,[{key:"componentDidMount",value:function(){this.getAuditList()}},{key:"componentDidUpdate",value:function(e){(0,D.isEqual)(e.reqParams,this.props.reqParams)||this.setState({pageParams:H(H({},this.state.pageParams),{},{start:0})},this.getAuditList)}},{key:"render",value:function(){var e=this.state,t=e.auditList,a=e.pageParams,n=e.loading,r=this.initColumns(),o={size:"small",pageSize:a.limit,total:t.count,current:a.start/a.limit+1,showTotal:function(e){return V.createElement("span",null,"共",V.createElement("span",{style:{color:"#3F87FF"}},e),"条数据，每页显示",a.limit,"条")}};return V.createElement(z.Z,{rowKey:"id",className:"dt-table-fixed-base",style:{height:"calc(100vh - 135px)"},scroll:{y:!0},loading:n,columns:r,dataSource:t.list,pagination:o,onChange:this.handleTableChange})}}]),a}(V.PureComponent);function W(e,t){var a=i()(e);if(u()){var n=u()(e);t&&(n=s()(n).call(n,(function(t){return h()(e,t).enumerable}))),a.push.apply(a,n)}return a}function X(e){for(var t=1;t<arguments.length;t++){var a,n,r=null!=arguments[t]?arguments[t]:{};t%2?m()(a=W(Object(r),!0)).call(a,(function(t){(0,x.Z)(e,t,r[t])})):v()?y()(e,v()(r)):m()(n=W(Object(r))).call(n,(function(t){C()(e,t,h()(r,t))}))}return e}function Y(e){var t=function(){if("undefined"==typeof Reflect||!r())return!1;if(r().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(r()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,w.Z)(e);if(t){var o=(0,w.Z)(this).constructor;a=r()(n,arguments,o)}else a=n.apply(this,arguments);return(0,b.Z)(this,a)}}var $=B.Z.RangePicker,ee=K.Z.Option,te=[{value:"content",text:"详细内容",searchKey:"content"},{value:"operator",text:"操作人",searchKey:"operator"},{value:"ip",text:"IP",searchKey:"ip"}],ae=function(e){(0,E.Z)(a,e);var t=Y(a);function a(){var e,n;(0,P.Z)(this,a);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return n=t.call.apply(t,A()(e=[this]).call(e,o)),(0,x.Z)((0,k.Z)(n),"state",{moduleList:[],operationList:[],reqParams:{from:void 0,to:void 0,module:void 0,operation:void 0,content:void 0,operator:void 0,ip:void 0},searchType:te[0],searchVal:""}),(0,x.Z)((0,k.Z)(n),"getAuditModuleList",(function(){U.Uv.getAuditModule().then((function(e){0===(e=e.data).code?n.setState({moduleList:e.data?e.data.list:[]}):R.Z.error(e.msg)}))})),(0,x.Z)((0,k.Z)(n),"getAuditOperation",(function(e){e?U.Uv.getAuditOperation({module:e}).then((function(e){0===(e=e.data).code?n.setState({operationList:e.data?e.data.list:[]}):R.Z.error(e.msg)})):n.setState({operationList:[]})})),(0,x.Z)((0,k.Z)(n),"handleTimeRangeChange",(function(e,t){var a={from:e[0]?e[0].startOf("day").unix():void 0,to:e[1]?e[1].endOf("day").unix():void 0};n.onFilterChange(a)})),(0,x.Z)((0,k.Z)(n),"handleOperateModalChange",(function(e){var t={module:e,operation:void 0};n.getAuditOperation(e),n.onFilterChange(t)})),(0,x.Z)((0,k.Z)(n),"handleActionChange",(function(e){n.onFilterChange({operation:e})})),(0,x.Z)((0,k.Z)(n),"handleSearchTypeChange",(function(e){var t=q()(te).call(te,(function(t){return t.value===e}));n.setState({searchType:t,searchVal:void 0,reqParams:N()({},n.state.reqParams,{operator:"",ip:"",content:""})})})),(0,x.Z)((0,k.Z)(n),"handleSearchValChange",(function(e){n.setState({searchVal:e.target.value})})),(0,x.Z)((0,k.Z)(n),"handleSearch",(function(e){var t=n.state.searchType;n.onFilterChange((0,x.Z)({},t.searchKey,e))})),(0,x.Z)((0,k.Z)(n),"onFilterChange",(function(e){var t=X(X({},n.state.reqParams),e);n.setState({reqParams:t})})),n}return(0,S.Z)(a,[{key:"componentDidMount",value:function(){this.getAuditModuleList()}},{key:"render",value:function(){var e=this.state,t=e.reqParams,a=e.operationList,n=e.moduleList,r=e.searchType,o=e.searchVal,i=t.module,l=t.operation;return V.createElement("div",{className:"security-audit-page"},V.createElement("div",{className:"audit-header"},V.createElement($,{className:"dt-form-shadow-bg mr-20",style:{width:300},allowClear:!0,onChange:this.handleTimeRangeChange}),V.createElement("div",{className:"mr-20"},V.createElement("span",null,"操作模块："),V.createElement(K.Z,{className:"dt-form-shadow-bg",style:{width:200},placeholder:"选择操作模块",allowClear:!0,value:i,onChange:this.handleOperateModalChange},I()(n)&&_()(n).call(n,(function(e){return V.createElement(ee,{key:e,value:e},e)})))),V.createElement("div",{className:"mr-20"},V.createElement("span",null,"动作："),V.createElement(K.Z,{className:"dt-form-shadow-bg",style:{width:200},placeholder:"选择动作",allowClear:!0,value:l,onChange:this.handleActionChange},I()(a)&&_()(a).call(a,(function(e){return V.createElement(ee,{key:e,value:e},e)})))),V.createElement(j.Z.Search,{className:"dt-select-search-bar",style:{width:300},placeholder:"按".concat(r.text,"搜索"),value:o,addonBefore:V.createElement(K.Z,{value:r.value,onChange:this.handleSearchTypeChange},_()(te).call(te,(function(e){return V.createElement(ee,{key:e.value,value:e.value},e.text)}))),onChange:this.handleSearchValChange,onSearch:this.handleSearch})),V.createElement(Q,{reqParams:t}))}}]),a}(V.PureComponent)}}]);