"use strict";(self.webpackChunkdt_em_front=self.webpackChunkdt_em_front||[]).push([[9731],{49731:(e,t,a)=>{a.r(t),a.d(t,{default:()=>$e});var n={};a.r(n),a.d(n,{getDashboardList:()=>B});var r=a(1068),l=a.n(r),o=a(3649),i=a.n(o),s=a(66419),d=a.n(s),c=a(65420),u=a.n(c),h=a(19996),f=a.n(h),m=a(41511),p=a.n(m),v=a(73126),g=a(68420),Z=a(27344),y=a(5281),b=a(84441),E=a(3020),w=a(3362),C=a(44845),S=a(51942),F=a.n(S),k=a(81643),D=a.n(k),I=a(2991),N=a.n(I),M=a(67294),x=a(29027),O=a(15857),T=a(19528),A=a(45360),_=a(56466),V=a(96486);function L(e,t){var a=void 0!==u()&&f()(e)||e["@@iterator"];if(!a){if(p()(e)||(a=function(e,t){var a;if(!e)return;if("string"==typeof e)return P(e,t);var n=i()(a=Object.prototype.toString.call(e)).call(a,8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return d()(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return P(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){s=!0,l=e},f:function(){try{o||null==a.return||a.return()}finally{if(s)throw l}}}}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var j,B=function(e){return function(t){T.PZ.getServiceDashInfo(e).then((function(e){var a,n=[],r=[{title:"General",id:0,list:[]}],l=L(e.data);try{for(l.s();!(a=l.n()).done;){var o=a.value;switch(o.tags.length&&(n=V.concat(n,o.tags)),o.type){case"dash-folder":o.list=[],r.push(o);break;case"dash-db":if(o.folderId)for(var i in r)o.folderId===r[i].id&&r[i].list.push(o);else r[0].list.push(o)}}}catch(e){l.e(e)}finally{l.f()}t({type:_.EK.UPDATE_DASH_LIST,payload:{dashboards:r,tags:V.uniq(n)}})})).catch((function(e){return A.Z.error(e)}))}},U=a(97183),R=a(4107),q=a(34041),H=a(69035),$=a(77268),z=a(30258),J=a(71649),G=a(20116),W=a.n(G),K=a(77766),Y=a.n(K),Q=a(54103),X=a.n(Q),ee=a(59340),te=a.n(ee),ae=a(67908),ne=a(60331),re=a(31097);function le(e,t){var a=void 0!==u()&&f()(e)||e["@@iterator"];if(!a){if(p()(e)||(a=function(e,t){var a;if(!e)return;if("string"==typeof e)return oe(e,t);var n=i()(a=Object.prototype.toString.call(e)).call(a,8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return d()(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return oe(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){s=!0,l=e},f:function(){try{o||null==a.return||a.return()}finally{if(s)throw l}}}}function oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function ie(e){var t=function(){if("undefined"==typeof Reflect||!l())return!1;if(l().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(l()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,w.Z)(e);if(t){var r=(0,w.Z)(this).constructor;a=l()(n,arguments,r)}else a=n.apply(this,arguments);return(0,E.Z)(this,a)}}var se=H.Z.Item,de=q.Z.Option,ce=(0,x.$j)((function(e){return{dashboard:e.DashBoardStore}}),(function(e){return{actions:(0,O.DE)(F()({},n),e)}}))(j=function(e){(0,b.Z)(a,e);var t=ie(a);function a(e){var n;return(0,g.Z)(this,a),n=t.call(this,e),(0,C.Z)((0,y.Z)(n),"state",{finish:n.props.finish||!1,isNewFolder:!1,newFolderOk:!1,folderId:null,folder:"",dashName:"",tags:[],tagInputVisible:!1,tagInputValue:"",url:""}),(0,C.Z)((0,y.Z)(n),"handleAddNewFolder",(function(){var e=(0,y.Z)(n),t=n.state.folder;T.PZ.createDashFolder({uid:null,title:t}).then((function(t){t.id&&e.setState({newFolderOk:!0,folderId:t.id})}))})),(0,C.Z)((0,y.Z)(n),"handleSetExistFolder",(function(){n.setState({isNewFolder:!1,folder:""})})),(0,C.Z)((0,y.Z)(n),"handleFolderSelectChange",(function(e){if("-1"===e)n.setState({isNewFolder:!0,folder:"",newFolderOk:!1,folderId:null});else{var t=JSON.parse(e);n.setState({folder:t.title,folderId:t.id})}})),(0,C.Z)((0,y.Z)(n),"handleFolderInputChange",(function(e){n.setState({folder:e.target.value})})),(0,C.Z)((0,y.Z)(n),"handleDashNameChange",(function(e){return!!n.validateForm(e.target.value)})),(0,C.Z)((0,y.Z)(n),"validDashName",(function(e,t,a){t?n.validateForm(t)?a():a("仪表盘已存在"):a()})),(0,C.Z)((0,y.Z)(n),"handleRemoveTag",(function(e){var t,a=W()(t=n.state.tags).call(t,(function(t){return t!==e}));n.setState({tags:a})})),(0,C.Z)((0,y.Z)(n),"showTagInput",(function(){n.setState({tagInputVisible:!0})})),(0,C.Z)((0,y.Z)(n),"handleTagInputChange",(function(e){n.setState({tagInputValue:e.target.value})})),(0,C.Z)((0,y.Z)(n),"handleTagInputConfirm",(function(){var e,t=n.state,a=t.tagInputValue,r=t.tags;a&&-1===D()(r).call(r,a)&&(r=Y()(e=[]).call(e,(0,J.Z)(r),[a]));n.setState({tags:r,tagInputVisible:!1,tagInputValue:""})})),(0,C.Z)((0,y.Z)(n),"validateForm",(function(e){var t,a=n.state.folderId,r=!0,l=null,o=le(n.props.dashboard.dashboards);try{for(o.s();!(t=o.n()).done;){var i=t.value;i.id===a&&(l=i.list)}}catch(e){o.e(e)}finally{o.f()}if(l){var s,d=le(l);try{for(d.s();!(s=d.n()).done;){s.value.title===e&&(r=!1)}}catch(e){d.e(e)}finally{d.f()}}return r})),(0,C.Z)((0,y.Z)(n),"handleFormSubmit",(function(e){e.preventDefault();var t=(0,y.Z)(n),a=n.state,r=(a.folderId,a.dashName,a.tags);n.props.form.validateFields((function(e,a){e||T.PZ.createDashboard({dashboard:{id:null,uid:null,title:a.dashName_form,tags:r,timezone:"browser",version:"0"},folderId:JSON.parse(a.folderId_form).id,overwrite:!1}).then((function(e){e.data.id?t.setState({finish:!0,url:e.data.url,dashName:a.dashName_form}):A.Z.error(e.message)})).catch((function(e){"name-exists"===e.status&&A.Z.error("已存在相同名称的仪表盘")}))}))})),(0,C.Z)((0,y.Z)(n),"handleModalClose",(function(){n.setState({finish:!1,isNewFolder:!1,folderId:null,folder:"",dashName:"",tags:[],tagInputVisible:!1,tagInputValue:""}),n.props.onClose()})),n}return(0,Z.Z)(a,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.finish!==this.state.finish&&this.setState({finish:e.finish,folderId:-1,folder:"",dashName:"",tags:[],tagInputVisible:!1,tagInputValue:""})}},{key:"gotoEdit",value:function(){window.location.href="/deploycenter/monitoring/dashdetail?url="+encodeURIComponent(this.state.url)}},{key:"render",value:function(){var e,t,a=this,n=this.props,r=n.visible,l=n.onClose,o=n.dashboard,s=this.props.form.getFieldDecorator,d=this.state,c=d.finish,u=d.isNewFolder,h=d.folder,f=d.tags,m=d.tagInputVisible,p=d.tagInputValue,g=d.newFolderOk,Z={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}}};return M.createElement(z.Z,{title:"新增仪表盘",visible:r,onCancel:l,footer:c?M.createElement(M.Fragment,null,M.createElement($.Z,{type:"default",onClick:this.handleModalClose},"关闭"),M.createElement($.Z,{type:"primary",onClick:X()(e=this.gotoEdit).call(e,this)},"去编辑")):M.createElement(M.Fragment,null,M.createElement($.Z,{type:"default",onClick:this.handleModalClose},"取消"),M.createElement($.Z,{type:"primary",onClick:this.handleFormSubmit},"创建"))},M.createElement("div",{className:"add-dash-modal"},c?M.createElement("div",{className:"add-success"},M.createElement("i",{className:"emicon emicon-health_service"}),M.createElement("p",{className:"success-word"},"仪表盘“",this.state.dashName,"”创建成功!现在去编辑。")):M.createElement(H.Z,null,M.createElement(se,(0,v.Z)({},Z,{label:"Folder",required:!0}),s("folderId_form",{rules:[{required:!0,message:"文件夹不能为空"}]})(u?M.createElement("div",null,M.createElement(R.Z,{value:h,onChange:this.handleFolderInputChange,style:{width:340}}),!g&&M.createElement($.Z,{type:"default",style:{marginLeft:10},onClick:this.handleAddNewFolder},M.createElement(ae.Z,{type:"check"})),M.createElement($.Z,{type:"default",style:{marginLeft:10}},M.createElement(ae.Z,{type:"close",onClick:this.handleSetExistFolder}))):M.createElement(q.Z,{style:{width:340},value:h,onChange:this.handleFolderSelectChange},N()(t=o.dashboards).call(t,(function(e,t){return M.createElement(de,{key:t,value:te()(e)},e.title)}))))),M.createElement(se,(0,v.Z)({},Z,{label:"Name",required:!0}),s("dashName_form",{rules:[{required:!0,message:"仪表盘名称不能为空"},{validator:this.validDashName}]})(M.createElement(R.Z,{placeholder:"输入仪表盘名称",onChange:this.handleDashNameChange,style:{width:340}}))),M.createElement(se,(0,v.Z)({},Z,{label:"Tags"}),M.createElement("div",null,N()(f).call(f,(function(e){var t=e.length>10,n=M.createElement(ne.Z,{key:e,color:"blue",closable:!0,afterClose:function(){return a.handleRemoveTag}},t?"".concat(i()(e).call(e,0,10),"..."):e);return t?M.createElement(re.Z,{title:e,key:e},n):n})),m?M.createElement(R.Z,{type:"text",size:"small",style:{width:78},value:p,onChange:this.handleTagInputChange,onBlur:this.handleTagInputConfirm,onPressEnter:this.handleTagInputConfirm}):M.createElement(ne.Z,{onClick:this.showTagInput,style:{background:"#fff",borderStyle:"dashed"}},M.createElement(ae.Z,{type:"plus"})," New Tag"))))))}}]),a}(M.Component))||j;const ue=H.Z.create()(ce);var he,fe=a(66253),me=a(87558);function pe(e,t){var a=void 0!==u()&&f()(e)||e["@@iterator"];if(!a){if(p()(e)||(a=function(e,t){var a;if(!e)return;if("string"==typeof e)return ve(e,t);var n=i()(a=Object.prototype.toString.call(e)).call(a,8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return d()(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ve(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){s=!0,l=e},f:function(){try{o||null==a.return||a.return()}finally{if(s)throw l}}}}function ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function ge(e){var t=function(){if("undefined"==typeof Reflect||!l())return!1;if(l().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(l()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,w.Z)(e);if(t){var r=(0,w.Z)(this).constructor;a=l()(n,arguments,r)}else a=n.apply(this,arguments);return(0,E.Z)(this,a)}}var Ze=H.Z.Item,ye=fe.ZP.Button,be=fe.ZP.Group,Ee=me.Z.Dragger,we=R.Z.TextArea,Ce=(0,x.$j)((function(e){return{dashboard:e.DashBoardStore}}),(function(e){return{actions:(0,O.DE)(F()({},n),e)}}))(he=function(e){(0,b.Z)(n,e);var t=ge(n);function n(e){var r;return(0,g.Z)(this,n),r=t.call(this,e),(0,C.Z)((0,y.Z)(r),"uploadOnChange",(function(e){var t=r.props.form.setFieldsValue;e.file.status,e.file.response&&(0!==e.file.response.code?A.Z.error(e.file.response.msg):(A.Z.success("".concat(e.file.name," 上传成功！")),e.file.response.data&&(r.setState({importData:JSON.parse(e.file.response.data)}),t({dashname:JSON.parse(e.file.response.data).title}))))})),(0,C.Z)((0,y.Z)(r),"state",{importMod:"1",importTxt:"",importData:{title:""},uploadCfg:{name:"file",multiple:!1,showUploadList:!1,action:"/api/v2/common/file2text",headers:{authorization:"authorization-text"},onChange:r.uploadOnChange}}),(0,C.Z)((0,y.Z)(r),"handleModalClose",(function(){r.setState({importMod:"1",importTxt:"",importData:{title:""}}),r.props.onClose()})),(0,C.Z)((0,y.Z)(r),"showSwitchPanel",(function(){var e=null,t=r.state,n=t.importMod,l=t.uploadCfg,o=t.importTxt;switch(n){case"1":e=M.createElement(we,{rows:8,value:o,onChange:r.handleImportTxtChange});break;case"2":e=M.createElement(Ee,(0,v.Z)({},l,{className:"c-dragger_ant-upload"}),M.createElement("p",{className:"ant-upload-drag-icon"},M.createElement("img",{src:a(15165)})),M.createElement("p",{className:"ant-upload-text"},"点击或将文件拖拽到此处上传"))}return e})),(0,C.Z)((0,y.Z)(r),"handleImportModChange",(function(e){r.setState({importMod:e.target.value})})),(0,C.Z)((0,y.Z)(r),"handleImportTxtChange",(function(e){r.setState({importTxt:e.target.value})})),(0,C.Z)((0,y.Z)(r),"handleDashNameChange",(function(e){var t=r.state.importData,a=r.props.form.setFieldsValue;t.title=e.target.value,r.setState({importData:t}),a({dashname:e.target.value})})),(0,C.Z)((0,y.Z)(r),"validateDashName",(function(e,t,a){var n,l=!1,o=pe(r.props.dashboard.dashboards);try{for(o.s();!(n=o.n()).done;){var i,s=pe(n.value.list);try{for(s.s();!(i=s.n()).done;){i.value.title===t&&(l=!0)}}catch(e){s.e(e)}finally{s.f()}}}catch(e){o.e(e)}finally{o.f()}return l?a("仪表盘已经存在"):a()})),(0,C.Z)((0,y.Z)(r),"handleSubmitImport",(function(){var e=(0,y.Z)(r),t=r.state,a=t.importMod,n=t.importTxt,l=t.importData,o=null;switch(a){case"1":o=JSON.parse(n);break;case"2":o=l}T.PZ.importDashboard({dashboard:o,inputs:[{name:"DS_PROMETHEUS",type:"datasource",pluginId:"prometheus",value:"prometheus"}],overwrite:!0}).then((function(t){e.handleModalClose()})).catch((function(e){A.Z.error(e.message)}))})),r}return(0,Z.Z)(n,[{key:"render",value:function(){var e=this.props.visible,t=this.props.form.getFieldDecorator,a=this.state.importMod;return M.createElement(z.Z,{title:"导入仪表盘",width:520,visible:e,onOk:this.handleSubmitImport,onCancel:this.handleModalClose},M.createElement("div",{className:"import-data-panel"},M.createElement(be,{size:"small",value:a,onChange:this.handleImportModChange},M.createElement(ye,{value:"1"},M.createElement(ae.Z,{type:"copy"})," Paste JSON"),M.createElement(ye,{value:"2"},M.createElement(ae.Z,{type:"cloud-upload"})," Upload .json File"))),M.createElement("div",{style:{marginBottom:10}},this.showSwitchPanel()),M.createElement(H.Z,null,M.createElement(Ze,{label:"名称",required:!0},t("dashname",{rules:[{required:!0,message:"仪表盘名称不能为空！"},{validator:this.validateDashName,message:"仪表盘已经存在"}]})(M.createElement(R.Z,{style:{width:480},onChange:this.handleDashNameChange})))))}}]),n}(M.Component))||he;const Se=H.Z.create()(Ce);var Fe=a(78914),ke=a.n(Fe),De=a(94198),Ie=a.n(De),Ne=a(9676);const Me={default:"99,213,179",DTBase:"209,91,128",mysql:"251,110,108",mysql_slave:"207,43,40",prometheus:"11,13,16",pushgateway:"65,117,5",redis:"159,22,17",zookeeper:"116,96,239",Hadoop:"96,172,252",carbon_hivemetastore:"10,151,155",carbon_thriftserver:"239,83,80",yarn_session:"34,120,3",historyserver:"38,218,210",hivemetastore_analysis:"209,91,128",thriftserver:"24,144,255",hdfs_datanode:"78,119,194",hdfs_journalnode:"235,47,150",hdfs_namenode:"255,0,89",hdfs_zkfc:"189,16,224",jobhistory:"89,126,247",yarn_nodemanager:"114,46,209",yarn_resourcemanager:"57,15,133",Dtinsight:"82,196,26",dtuic:"245,34,45",Analytics:"207,20,35",API:"250,84,28",Batch:"135,55,0",Console:"212,107,9",Engine:"212,177,4",Gateway:"212,177,4",Schedule:"255,161,0",Stream:"150,193,12",Valid:"19,194,194",node_exporter:"0,184,255",DTinsight_index:"176,108,212",DTinsight:"50,211,235",DTApp:"102,142,214"};function xe(e,t){var a=void 0!==u()&&f()(e)||e["@@iterator"];if(!a){if(p()(e)||(a=function(e,t){var a;if(!e)return;if("string"==typeof e)return Oe(e,t);var n=i()(a=Object.prototype.toString.call(e)).call(a,8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return d()(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Oe(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){s=!0,l=e},f:function(){try{o||null==a.return||a.return()}finally{if(s)throw l}}}}function Oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function Te(e){var t=function(){if("undefined"==typeof Reflect||!l())return!1;if(l().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(l()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,w.Z)(e);if(t){var r=(0,w.Z)(this).constructor;a=l()(n,arguments,r)}else a=n.apply(this,arguments);return(0,E.Z)(this,a)}}var Ae,_e=q.Z.Option,Ve=function(e){(0,b.Z)(a,e);var t=Te(a);function a(e){var n;return(0,g.Z)(this,a),n=t.call(this,e),(0,C.Z)((0,y.Z)(n),"convertDashList",(function(e){return ke()(e).call(e,(function(e){var t;0===e.id?e.isOpen=!0:e.isOpen=!1,e.checked=!1,ke()(t=e.list).call(t,(function(e){e.checked=!1}))})),e})),(0,C.Z)((0,y.Z)(n),"state",{dashes:[],sFolder:[],sDash:[],moveModalVisible:!1,mFolder:{id:"",uid:"",title:""}}),(0,C.Z)((0,y.Z)(n),"buildDashList",(function(e){return N()(e).call(e,(function(e){var t,a,r;return M.createElement("li",{className:"dash-list-sub-row clearfix",key:e.id,onClick:X()(t=n.handleDashClick).call(t,(0,y.Z)(n),e)},M.createElement(Ne.Z,{checked:e.checked,onChange:X()(a=n.handleSelectDash).call(a,(0,y.Z)(n),e.id),style:{marginLeft:48}}),M.createElement(ae.Z,{type:"dashboard",style:{margin:"0px 10px 0 16px"}}),e.title,e.tags.length?N()(r=e.tags).call(r,(function(e,t){return M.createElement(ne.Z,{style:{float:"right",border:"1px solid rgb(".concat(Me[e]?Me[e]:Me.default,")"),backgroundColor:Me[e]?"rgba(".concat(Me[e],",0.10)"):"rgb(".concat(Me.default,",0.10)"),color:"rgb(".concat(Me[e]?Me[e]:Me.default,")")},key:t},e)})):"")}))})),(0,C.Z)((0,y.Z)(n),"handleFolderClick",(function(e,t){var a=n.state.dashes;if(D()(t).call(t,"dash-list-row")>-1||D()(t).call(t,"anticon")>-1){var r,l=xe(a);try{for(l.s();!(r=l.n()).done;){var o=r.value;o.id===e.id?o.isOpen=!e.isOpen:o.isOpen=!1}}catch(e){l.e(e)}finally{l.f()}n.setState({dashes:a})}})),(0,C.Z)((0,y.Z)(n),"handleDashClick",(function(e,t){var a;t.stopPropagation(),D()(a=t.target.getAttribute("class")).call(a,"dash-list-sub-row")>-1&&(window.location.href="/deploycenter/monitoring/dashdetail?url="+encodeURIComponent(e.url))})),(0,C.Z)((0,y.Z)(n),"handleSelectAll",(function(e){var t=n.state.dashes,a=[],r=[];if(e.target.checked){var l,o=xe(t);try{for(o.s();!(l=o.n()).done;){var i=l.value;i.checked=!0,a.push(i.uid);var s,d=xe(i.list);try{for(d.s();!(s=d.n()).done;){var c=s.value;c.checked=!0,r.push(c)}}catch(e){d.e(e)}finally{d.f()}}}catch(e){o.e(e)}finally{o.f()}}else{var u,h=xe(t);try{for(h.s();!(u=h.n()).done;){var f=u.value;f.checked=!1;var m,p=xe(f.list);try{for(p.s();!(m=p.n()).done;){m.value.checked=!1}}catch(e){p.e(e)}finally{p.f()}}}catch(e){h.e(e)}finally{h.f()}}n.setState({dashes:t,sFolder:a,sDash:r})})),(0,C.Z)((0,y.Z)(n),"handleSelectFolder",(function(e,t){t.stopPropagation();var a,r=n.state,l=r.dashes,o=r.sFolder,i=r.sDash,s=xe(l);try{for(s.s();!(a=s.n()).done;){var d=a.value;if(d.uid===e){d.checked=t.target.checked;var c,u=xe(d.list);try{for(u.s();!(c=u.n()).done;){c.value.checked=t.target.checked}}catch(e){u.e(e)}finally{u.f()}t.target.checked?(o.push(d.uid),i=V.concat(i,d.list)):(o=V.difference(o,[e]),i=V.differenceBy(i,d.list,"id"))}}}catch(e){s.e(e)}finally{s.f()}n.setState({dashes:l,sFolder:o,sDash:i},(function(){}))})),(0,C.Z)((0,y.Z)(n),"handleSelectDash",(function(e,t){t.stopPropagation();var a,r=n.state,l=r.dashes,o=r.sDash,i=xe(l);try{for(i.s();!(a=i.n()).done;){var s,d=xe(a.value.list);try{for(d.s();!(s=d.n()).done;){var c=s.value;c.id===e&&(c.checked=t.target.checked,t.target.checked?o.push(c):o=V.differenceBy(o,[c],"id"))}}catch(e){d.e(e)}finally{d.f()}}}catch(e){i.e(e)}finally{i.f()}n.setState({dashes:l,sDash:o})})),(0,C.Z)((0,y.Z)(n),"handleDashExport",(function(){if(n.props.canEdit){var e=n.state.sDash,t=N()(e).call(e,(function(e){return e.id})),a="/api/v2/dashboard/export?dashboardId=".concat(t.join(","));window.open(a)}else A.Z.error("权限不足，请联系管理员！")})),(0,C.Z)((0,y.Z)(n),"showDeleteModal",(function(){n.props.canEdit?z.Z.confirm({title:"确定你要删除选中的dashboard吗？",icon:M.createElement(ae.Z,{type:"exclamation-circle",theme:"filled"}),okType:"danger",onOk:function(){n.handleConfirmDel()}}):A.Z.error("权限不足，请联系管理员！")})),(0,C.Z)((0,y.Z)(n),"handleConfirmDel",(function(){var e=(0,y.Z)(n),t=n.state,a=t.sDash,r=t.sFolder,l=[],o=function(t){var n,o=xe(a);try{for(o.s();!(n=o.n()).done;){var i=n.value;i.folderUid===r[t]&&l.push(i)}}catch(e){o.e(e)}finally{o.f()}T.PZ.delFolderByUid(r[t]).then((function(n){r.length-1===Ie()(t)&&(e.setState({sFolder:[]}),0===a.length&&e.props.onChange())}))};for(var i in r)o(i);l=V.differenceBy(a,l,"id");var s=function(t){T.PZ.delDashByUid(l[t].uid).then((function(a){l.length-1===Ie()(t)&&(e.setState({sFolder:[],sDash:[]}),e.props.onChange())}))};for(var d in l)s(d)})),(0,C.Z)((0,y.Z)(n),"showMoveModal",(function(){n.setState({moveModalVisible:!0})})),(0,C.Z)((0,y.Z)(n),"hideMoveModal",(function(){n.setState({moveModalVisible:!1,mFolder:{id:"",uid:"",title:""}})})),(0,C.Z)((0,y.Z)(n),"handleChangeMoveFolder",(function(e){var t,a=null,r=xe(n.state.dashes);try{for(r.s();!(t=r.n()).done;){var l=t.value;l.id===e&&(a=l)}}catch(e){r.e(e)}finally{r.f()}n.setState({mFolder:{id:a.id,title:a.title,uid:a.uid}})})),(0,C.Z)((0,y.Z)(n),"handleConfirmMove",(function(){var e=(0,y.Z)(n),t=n.state,a=t.sDash,r=t.mFolder,l=function(t){T.PZ.createDashboard({dashboard:a[t],folderId:r.id,overwrite:!0}).then((function(n){a.length-1===Ie()(t)&&(e.setState({sFolder:[],sDash:[],moveModalVisible:!1}),e.props.onChange())}))};for(var o in a)l(o)})),n}return(0,Z.Z)(a,[{key:"componentDidMount",value:function(){this.setState({dashes:this.convertDashList(this.props.list)})}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.list.length>0&&this.setState({dashes:this.convertDashList(e.list)})}},{key:"render",value:function(){var e=this,t=this.state,a=t.dashes,n=t.sFolder,r=t.sDash,l=t.moveModalVisible,o=t.mFolder;return M.createElement("div",{className:"dash-list-wrapper box-shadow-style"},M.createElement("div",{className:"dash-list-header"},M.createElement(Ne.Z,{onChange:this.handleSelectAll}),n.length||r.length?M.createElement(M.Fragment,null,M.createElement($.Z,{style:{marginRight:10},onClick:this.handleDashExport},"导出"),M.createElement($.Z,{onClick:this.showDeleteModal},"删除")):""),M.createElement("div",{className:"dash-list-body"},M.createElement("ul",{className:"folder-list"},a.length?N()(a).call(a,(function(t){var a;return M.createElement("li",{key:t.id,onClick:function(a){return e.handleFolderClick(t,t.isOpen?"dash-list-row active clearfix":"dash-list-row clearfix")},className:t.isOpen?"dash-list-row active clearfix":"dash-list-row clearfix"},M.createElement(Ne.Z,{checked:t.checked,onChange:X()(a=e.handleSelectFolder).call(a,e,t.uid),style:{marginLeft:16}}),M.createElement(ae.Z,{type:"folder-open"}),M.createElement(ae.Z,{type:"folder"}),t.title,M.createElement(ae.Z,{type:"down",style:{marginRight:16}}),M.createElement(ae.Z,{type:"right",style:{marginRight:16}}),M.createElement("ul",{className:"dash-list",style:t.isOpen?{display:"block",maxHeight:"calc(100vh - 230px)",overflowY:"auto"}:{display:"none"}},e.buildDashList(t.list)))})):"")),M.createElement(z.Z,{title:"移动",visible:l,onOk:this.handleConfirmMove,onCancel:this.hideMoveModal,okText:"确认",cancelText:"取消"},M.createElement("p",{style:{lineHeight:"40px"}},"将选择的dashboard移动到："),M.createElement("p",null,M.createElement("span",null,"文件夹："),M.createElement(q.Z,{style:{width:160},onChange:this.handleChangeMoveFolder,value:o.id},N()(a).call(a,(function(e){return M.createElement(_e,{key:e.id,value:e.id},e.title)}))))))}}]),a}(M.Component),Le=a(36808);function Pe(e,t){var a=void 0!==u()&&f()(e)||e["@@iterator"];if(!a){if(p()(e)||(a=function(e,t){var a;if(!e)return;if("string"==typeof e)return je(e,t);var n=i()(a=Object.prototype.toString.call(e)).call(a,8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return d()(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return je(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){s=!0,l=e},f:function(){try{o||null==a.return||a.return()}finally{if(s)throw l}}}}function je(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function Be(e){var t=function(){if("undefined"==typeof Reflect||!l())return!1;if(l().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(l()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,w.Z)(e);if(t){var r=(0,w.Z)(this).constructor;a=l()(n,arguments,r)}else a=n.apply(this,arguments);return(0,E.Z)(this,a)}}var Ue=U.Z.Content,Re=R.Z.Search,qe=q.Z.Option,He=H.Z.Item,$e=(0,x.$j)((function(e){return{dashboard:e.DashBoardStore,headerStore:e.HeaderStore,authorityList:e.UserCenterStore.authorityList}}),(function(e){return{actions:(0,O.DE)(F()({},n),e)}}))(Ae=function(e){(0,b.Z)(a,e);var t=Be(a);function a(e){var n;return(0,g.Z)(this,a),n=t.call(this,e),(0,C.Z)((0,y.Z)(n),"state",{selectTags:[],addModalVisible:!1,addFolderVisible:!1,newFolderName:"",newFolderError:"",newFolderStatus:"success",importModalVisible:!1,addDashFinish:!1,allTags:[]}),(0,C.Z)((0,y.Z)(n),"getDashList",(function(){n.props.actions.getDashboardList({mode:"tree",query:"",skipRecent:!0,skipStarred:!0,starred:!1,tags:n.state.selectTags})})),(0,C.Z)((0,y.Z)(n),"handleTagFilterChange",(function(e){n.setState({selectTags:e},(function(){n.getDashList()}))})),(0,C.Z)((0,y.Z)(n),"handleNameFilterChange",(function(e){n.props.actions.getDashboardList({mode:"tree",query:e,skipRecent:!0,skipStarred:!0,starred:!1,tags:n.state.selectTags})})),(0,C.Z)((0,y.Z)(n),"showAddModal",(function(e){e?n.setState({addModalVisible:!0}):A.Z.error("权限不足,请联系管理员！")})),(0,C.Z)((0,y.Z)(n),"hideAddModal",(function(){n.setState({addModalVisible:!1,addDashFinish:!1}),n.getDashList()})),(0,C.Z)((0,y.Z)(n),"showAddFolderModal",(function(){n.setState({addFolderVisible:!0})})),(0,C.Z)((0,y.Z)(n),"hideAddFolderModal",(function(){n.setState({addFolderVisible:!1,newFolderName:"",newFolderError:"",newFolderStatus:""})})),(0,C.Z)((0,y.Z)(n),"handleAddFolderNameChange",(function(e){n.setState({newFolderName:e.target.value}),n.validateAddFolder(e.target.value)})),(0,C.Z)((0,y.Z)(n),"validateAddFolder",(function(e){var t=n.props.dashboard.dashboards,a=!0,r=!1;if(""===e)n.setState({newFolderError:"请填写文件夹名称",newFolderStatus:"error"}),a=!1;else{var l,o=Pe(t);try{for(o.s();!(l=o.n()).done;){l.value.title===e&&(n.setState({newFolderError:"文件夹已经存在",newFolderStatus:"error"}),r=!0,a=!1)}}catch(e){o.e(e)}finally{o.f()}r||(n.setState({newFolderError:"",newFolderStatus:"success"}),a=!0)}return a})),(0,C.Z)((0,y.Z)(n),"handleAddFolderOk",(function(){var e=(0,y.Z)(n),t=n.state.newFolderName;n.validateAddFolder(t)&&T.PZ.createDashFolder({uid:null,title:t}).then((function(t){e.getDashList(),e.hideAddFolderModal()}))})),(0,C.Z)((0,y.Z)(n),"showImportModal",(function(e){e?n.setState({importModalVisible:!0}):A.Z.error("权限不足, 请联系管理员！")})),(0,C.Z)((0,y.Z)(n),"hideImportModal",(function(){n.setState({importModalVisible:!1}),n.getDashList()})),n}return(0,Z.Z)(a,[{key:"componentDidMount",value:function(){var e=this,t=this.props.headerStore,a="选择产品"!=(null==t?void 0:t.cur_parent_product)?null==t?void 0:t.cur_parent_product:Le.get("em_current_parent_product");this.setState({selectTags:a?[a]:[]},(function(){e.getDashList()}))}},{key:"render",value:function(){var e=this,t=this.props,a=t.dashboard,n=t.authorityList,r=this.state,l=r.addModalVisible,o=r.addFolderVisible,i=r.newFolderName,s=r.newFolderError,d=r.newFolderStatus,c=r.importModalVisible,u=r.addDashFinish,h=a.tags,f=null==n?void 0:n.sub_menu_service_grafana_edit;return M.createElement(U.Z,{style:{minHeight:document.body.clientHeight-88}},M.createElement(Ue,null,M.createElement("div",{className:"dash-page"},M.createElement("div",{className:"top-navbar mb-12 clearfix"},M.createElement(Re,{className:"dt-form-shadow-bg mr-20",placeholder:"按名称搜索",onSearch:this.handleNameFilterChange,style:{width:264,float:"left"}}),M.createElement("div",{className:"tag-filter clearfix"},M.createElement("div",{className:"filter-title box-shadow-style"},"Tags"),M.createElement(q.Z,{mode:"multiple",className:"dt-form-shadow-bg",style:{minWidth:264,float:"left"},placeholder:"按Tag筛选",optionFilterProp:"children",onChange:this.handleTagFilterChange,filterOption:function(e,t){var a;return D()(a=t.props.children.toLowerCase()).call(a,e.toLowerCase())>=0}},N()(h).call(h,(function(e,t){return M.createElement(qe,{key:"".concat(t),value:e},e)})))),M.createElement($.Z,{type:"primary",style:{float:"right",marginLeft:12},onClick:function(){return e.showImportModal(f)}},"+ 导入"),M.createElement($.Z,{type:"primary",style:{float:"right"},onClick:function(){e.showAddModal(f)}},"+ 仪表盘")),M.createElement(Ve,{canEdit:f,onChange:this.getDashList,list:a.dashboards}),M.createElement(ue,{visible:l,onClose:this.hideAddModal,finish:u}),M.createElement(Se,{visible:c,onClose:this.hideImportModal}),M.createElement(z.Z,{visible:o,title:"创建文件夹",onOk:this.handleAddFolderOk,onCancel:this.hideAddFolderModal},M.createElement(H.Z,null,M.createElement(He,(0,v.Z)({},{labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}}},{required:!0,label:"Name",validateStatus:d,help:s}),M.createElement(R.Z,{value:i,onChange:this.handleAddFolderNameChange,style:{width:400}})))))))}}]),a}(M.Component))||Ae},15165:(e,t,a)=>{e.exports=a.p+"images/0d83591cdb1f69ef715d.svg"}}]);