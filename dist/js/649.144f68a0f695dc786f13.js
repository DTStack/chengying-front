(self.webpackChunkdt_em_front=self.webpackChunkdt_em_front||[]).push([[649,3805,2575,5490,8956,3379,3979,2193,4974,8831,4310,1633,4676,726,5613],{58657:(e,t,n)=>{var r=n(60386);e.exports=function(e,t,n){for(n=n||document,e={parentNode:e};(e=e.parentNode)&&e!==n;)if(r(e,t))return e}},60386:e=>{"use strict";e.exports=function(e,t){var n=window.Element.prototype,r=n.matches||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector;if(!e||1!==e.nodeType)return!1;var o=e.parentNode;if(r)return r.call(e,t);for(var i=o.querySelectorAll(t),a=i.length,s=0;s<a;s++)if(i[s]===e)return!0;return!1}},62988:(e,t,n)=>{var r=n(61755),o=n(26665).each;function i(e,t){this.query=e,this.isUnconditional=t,this.handlers=[],this.mql=window.matchMedia(e);var n=this;this.listener=function(e){n.mql=e.currentTarget||e,n.assess()},this.mql.addListener(this.listener)}i.prototype={constuctor:i,addHandler:function(e){var t=new r(e);this.handlers.push(t),this.matches()&&t.on()},removeHandler:function(e){var t=this.handlers;o(t,(function(n,r){if(n.equals(e))return n.destroy(),!t.splice(r,1)}))},matches:function(){return this.mql.matches||this.isUnconditional},clear:function(){o(this.handlers,(function(e){e.destroy()})),this.mql.removeListener(this.listener),this.handlers.length=0},assess:function(){var e=this.matches()?"on":"off";o(this.handlers,(function(t){t[e]()}))}},e.exports=i},38177:(e,t,n)=>{var r=n(62988),o=n(26665),i=o.each,a=o.isFunction,s=o.isArray;function c(){if(!window.matchMedia)throw new Error("matchMedia not present, legacy browsers require a polyfill");this.queries={},this.browserIsIncapable=!window.matchMedia("only all").matches}c.prototype={constructor:c,register:function(e,t,n){var o=this.queries,c=n&&this.browserIsIncapable;return o[e]||(o[e]=new r(e,c)),a(t)&&(t={match:t}),s(t)||(t=[t]),i(t,(function(t){a(t)&&(t={match:t}),o[e].addHandler(t)})),this},unregister:function(e,t){var n=this.queries[e];return n&&(t?n.removeHandler(t):(n.clear(),delete this.queries[e])),this}},e.exports=c},61755:e=>{function t(e){this.options=e,!e.deferSetup&&this.setup()}t.prototype={constructor:t,setup:function(){this.options.setup&&this.options.setup(),this.initialised=!0},on:function(){!this.initialised&&this.setup(),this.options.match&&this.options.match()},off:function(){this.options.unmatch&&this.options.unmatch()},destroy:function(){this.options.destroy?this.options.destroy():this.off()},equals:function(e){return this.options===e||this.options.match===e}},e.exports=t},26665:e=>{e.exports={isFunction:function(e){return"function"==typeof e},isArray:function(e){return"[object Array]"===Object.prototype.toString.apply(e)},each:function(e,t){for(var n=0,r=e.length;n<r&&!1!==t(e[n],n);n++);}}},24974:(e,t,n)=>{var r=n(38177);e.exports=new r},63805:e=>{"use strict";e.exports=r,e.exports.isMobile=r,e.exports.default=r;var t=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,n=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|ipad|playbook|silk/i;function r(e){e||(e={});var r=e.ua;if(r||"undefined"==typeof navigator||(r=navigator.userAgent),r&&r.headers&&"string"==typeof r.headers["user-agent"]&&(r=r.headers["user-agent"]),"string"!=typeof r)return!1;var o=e.tablet?n.test(r):t.test(r);return!o&&e.tablet&&e.featureDetect&&navigator&&navigator.maxTouchPoints>1&&-1!==r.indexOf("Macintosh")&&-1!==r.indexOf("Safari")&&(o=!0),o}},81633:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var r=n(42723),o=n(88239),i=n(99663),a=n(49135),s=n(93196),c=n(67294),l=n(45697),u=n.n(l),d=n(94184),p=n.n(d),f=n(46871),h=function(e){function t(n){(0,i.default)(this,t);var r=(0,a.default)(this,e.call(this,n));r.handleChange=function(e){var t=r.props,n=t.disabled,i=t.onChange;n||("checked"in r.props||r.setState({checked:e.target.checked}),i&&i({target:(0,o.default)({},r.props,{checked:e.target.checked}),stopPropagation:function(){e.stopPropagation()},preventDefault:function(){e.preventDefault()},nativeEvent:e.nativeEvent}))},r.saveInput=function(e){r.input=e};var s="checked"in n?n.checked:n.defaultChecked;return r.state={checked:s},r}return(0,s.default)(t,e),t.getDerivedStateFromProps=function(e,t){return"checked"in e?(0,o.default)({},t,{checked:e.checked}):null},t.prototype.focus=function(){this.input.focus()},t.prototype.blur=function(){this.input.blur()},t.prototype.render=function(){var e,t=this.props,n=t.prefixCls,i=t.className,a=t.style,s=t.name,l=t.id,u=t.type,d=t.disabled,f=t.readOnly,h=t.tabIndex,m=t.onClick,v=t.onFocus,b=t.onBlur,y=t.autoFocus,g=t.value,k=(0,r.default)(t,["prefixCls","className","style","name","id","type","disabled","readOnly","tabIndex","onClick","onFocus","onBlur","autoFocus","value"]),x=Object.keys(k).reduce((function(e,t){return"aria-"!==t.substr(0,5)&&"data-"!==t.substr(0,5)&&"role"!==t||(e[t]=k[t]),e}),{}),w=this.state.checked,Z=p()(n,i,((e={})[n+"-checked"]=w,e[n+"-disabled"]=d,e));return c.createElement("span",{className:Z,style:a},c.createElement("input",(0,o.default)({name:s,id:l,type:u,readOnly:f,disabled:d,tabIndex:h,className:n+"-input",checked:!!w,onClick:m,onFocus:v,onBlur:b,onChange:this.handleChange,autoFocus:y,ref:this.saveInput,value:g},x)),c.createElement("span",{className:n+"-inner"}))},t}(c.Component);h.propTypes={prefixCls:u().string,className:u().string,style:u().object,name:u().string,id:u().string,type:u().string,defaultChecked:u().oneOfType([u().number,u().bool]),checked:u().oneOfType([u().number,u().bool]),disabled:u().bool,onFocus:u().func,onBlur:u().func,onChange:u().func,onClick:u().func,tabIndex:u().oneOfType([u().string,u().number]),readOnly:u().bool,autoFocus:u().bool,value:u().any},h.defaultProps={prefixCls:"rc-checkbox",className:"",style:{},type:"checkbox",defaultChecked:!1,onFocus:function(){},onBlur:function(){},onChange:function(){}},(0,f.polyfill)(h);const m=h},874:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>L});var r=n(44930),o=n(44845),i=n(95266),a=n(63109),s=n.n(a),c=n(2991),l=n.n(c),u=n(77149),d=n.n(u),p=n(20116),f=n.n(p),h=n(86902),m=n.n(h),v=n(14310),b=n.n(v),y=n(34074),g=n.n(y),k=n(78914),x=n.n(k),w=n(39649),Z=n.n(w),C=n(20368),E=n.n(C),I=n(63978),F=n.n(I),S=n(67294),N=n(69035),q=n(4107),_=n(45360),O=n(8263),B=n(77268),M=n(30258),P=n(38272),T=n(8663),j=n(78241),D=T.Z.backup;const z=function(e){return j[D.queryBuildBackupPath.method](D.queryBuildBackupPath.url,e)},A=function(e){return j[D.SetUpBackupPath.method](D.SetUpBackupPath.url,e)};function H(e,t){var n=m()(e);if(b()){var r=b()(e);t&&(r=f()(r).call(r,(function(t){return g()(e,t).enumerable}))),n.push.apply(n,r)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n,r,i=null!=arguments[t]?arguments[t]:{};t%2?x()(n=H(Object(i),!0)).call(n,(function(t){(0,o.Z)(e,t,i[t])})):Z()?E()(e,Z()(i)):x()(r=H(Object(i))).call(r,(function(t){F()(e,t,g()(i,t))}))}return e}const L=N.Z.create({name:"backup"})((function(e){var t,n,a,c,u,p=e.form,h=p.setFieldsValue,m=p.getFieldDecorator,v=p.setFields,b=(0,S.useState)([]),y=(0,i.Z)(b,2),g=y[0],k=y[1],x=(0,S.useState)(!1),w=(0,i.Z)(x,2),Z=w[0],C=w[1],E=(0,S.useState)([]),I=(0,i.Z)(E,2),F=I[0],T=I[1],j=(0,S.useState)({visible:!1,info:{clusterName:"",cluster_id:"",connect_error:[],permissions_error:[]}}),D=(0,i.Z)(j,2),H=D[0],L=D[1],K=[{title:"集群名称",dataIndex:"clusterName",key:"clusterName"},{title:"应用备份升级路径",dataIndex:"path",key:"path",render:function(e,t){return S.createElement(N.Z.Item,null,m("".concat(t.clusterId),{rules:[{required:!0,message:"请输入路径!"},{validator:Q}]})(S.createElement(q.Z,{style:{width:"90%"},placeholder:"请输入备份升级路径！"})))}}],V=function(e){l()(e).call(e,(function(e){h((0,o.Z)({},e.clusterId,e.path))}))},G=function(){var e=(0,r.Z)(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z({});case 2:0!==(t=(t=e.sent).data).code?_.Z.error(t.msg):(k(t.data.data),V(t.data.data));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),J=function(){var t=(0,r.Z)(s().mark((function t(n){var r,o;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return T([]),C(!0),t.next=4,A(n);case 4:if(0===(r=(r=t.sent).data).code){t.next=11;break}C(!1),_.Z.error(r.msg),t.next=20;break;case 11:if(null===r.data){t.next=18;break}return t.next=14,T(r.data);case 14:l()(o=r.data).call(o,(function(t){return e.form.validateFields(["".concat(t.cluster_id)],{force:!0})})),C(!1),t.next=20;break;case 18:C(!1),_.Z.success("操作成功！");case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Q=function(e,t,n){if(F.length&&d()(F).call(F,(function(t){return t.cluster_id===+e.field}))){var r,o,i,a=f()(F).call(F,(function(t){return t.cluster_id===+e.field})),s=f()(g).call(g,(function(t){return t.clusterId===+e.field})),c="";if((null===(r=a[0])||void 0===r?void 0:r.connect_error.length)>0)c=(null===(o=a[0])||void 0===o?void 0:o.permissions_error.length)>0?"存在主机agent连接失败，路径权限不足！":"存在主机agent连接失败！";else(null===(i=a[0])||void 0===i?void 0:i.permissions_error.length)>0&&(c="路径权限不足！");n(S.createElement("div",null," ",c,S.createElement("span",{onClick:function(){return R(a[0],s[0].clusterName)},style:{color:"#3F87FF",marginLeft:8,cursor:"pointer"}},"查看主机")))}else n()};(0,S.useEffect)((function(){G()}),[]);var R=function(e,t){var n={visible:!H.visible,info:U({clusterName:t},e)};L(n)};return S.createElement("div",{className:"backupConfig"},S.createElement(N.Z,{onSubmit:function(t){var n=[];t.preventDefault(),e.form.validateFields((function(e,t){for(var r in t)n.push({clusterId:+r,path:t[r]});if(e)for(var i in e){var a,s,c=null===(a=e[i])||void 0===a||null===(s=a.errors[0])||void 0===s?void 0:s.message;v((0,o.Z)({},i,{value:t[i],errors:null})),"string"!=typeof c&&J(n)}else J(n)}))}},S.createElement(O.Z,{rowKey:"clusterId",dataSource:g,columns:K,pagination:!1,style:{marginBottom:20}}),S.createElement(B.Z,{type:"primary",htmlType:"submit",loading:Z},"保存")),H.visible&&S.createElement(M.Z,{className:"error-list",title:"查看主机/".concat(null===(t=H.info)||void 0===t?void 0:t.clusterName),visible:H.visible,onCancel:R,footer:null},(null===(n=H.info)||void 0===n?void 0:n.connect_error.length)>0&&S.createElement(P.Z,{size:"small",header:S.createElement("div",null,"以下主机agent连接失败"),dataSource:null===(a=H.info)||void 0===a?void 0:a.connect_error,renderItem:function(e){return S.createElement(P.Z.Item,null,e)}}),(null===(c=H.info)||void 0===c?void 0:c.permissions_error.length)>0&&S.createElement(P.Z,{size:"small",header:S.createElement("div",null,"以下主机路径权限不足"),dataSource:null===(u=H.info)||void 0===u?void 0:u.permissions_error,renderItem:function(e){return S.createElement(P.Z.Item,null,e)}})))}))}}]);